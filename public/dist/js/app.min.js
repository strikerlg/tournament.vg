(function() {
    'use strict';

    angular
        .module('vg.app', [
            /* Angular modules */
            'ngAnimate',
            /* App modules */
            /* Third-party modules */
            'ui.router',
            'firebase',
            'validation.match',
            'ordinal',
            'ngFileUpload',
            'ngImgur'
        ]);
})();;(function() {
	'use strict';

	angular
		.module('vg.app')
		.constant('FIREBASEDATA', {
			'FBURL': 'https://wolfscontests.firebaseio.com'
		})
		.config(config);

	/* @ngInject */
	function config($stateProvider, $urlRouterProvider) {

		// Redirect any unmatched URL to /.
		$urlRouterProvider.otherwise('/');

		$stateProvider
		    .state('home', {
		    	url: '/',
		    	templateUrl: 'app/home/home.htm',
		    	controller: 'HomeController as home'
		    })

		    .state('registerOrLogin', {
		    	url: '/registerOrLogin',
		    	templateUrl: '/app/home/reg.htm',
		    	controller: 'RegController as reg'
		    })

		    .state('profile', {
		    	url: '/profile/:username',
		    	templateUrl: '/app/home/profile.htm',
		    	controller: 'ProfileController as profile'
		    })

		    .state('leaderboard', {
		    	url: '/leaderboard',
		    	templateUrl: '/app/home/leaderboard.htm',
		    	controller: 'LeaderboardController as leaderboard'
		    })

		    .state('event', {
		    	url: '/event/:eventName/main',
		    	templateUrl: '/app/event/main.htm',
		    	controller: 'EventMainController as event'
		    })

		    .state('customizeAvatar', {
		    	url: '/customizeAvatar',
		    	templateUrl: '/app/home/avatar.htm',
		    	controller: 'AvatarController as avatar',

		    	resolve: {
		    		'currentAuth': ['AuthWrapper', function(AuthWrapper) {
		    			return AuthWrapper.$requireAuth();
		    		}]
		    	}
		    })

		    .state('changePassword', {
		    	url: '/changePassword',
		    	templateUrl: '/app/home/changePassword.htm',
		    	controller: 'ChangePasswordController as pwchange',

		    	resolve: {
		    		'currentAuth': ['AuthWrapper', function(AuthWrapper) {
		    			return AuthWrapper.$requireAuth();
		    		}]
		    	}
		    });
	}
	config.$inject = ["$stateProvider", "$urlRouterProvider"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .run(run);

    function run($rootScope, $location, $state, $firebaseObject, AuthWrapper, FIREBASEDATA) {

        $rootScope.$on('$stateChangeError', function(event, toState, toParams, fromState, fromParams, error) {
            if (error === 'AUTH_REQUIRED') {
                $state.go('registerOrLogin');
            }
        });

        $rootScope.$on('$stateChangeSuccess', function() {

            // If user is logged in, download their profile data to an object in $rootScope.
            // FIXME: We shouldn't need to do this every successful state change.
            if (AuthWrapper.$getAuth()) {
                
                var authData = AuthWrapper.$getAuth();
                var ref = new Firebase(FIREBASEDATA.FBURL);

                var profileData = $firebaseObject(ref.child('users').child(authData.uid));
                profileData.$bindTo($rootScope, 'profile').then(function(unbind) {
                    $rootScope.unbindFunction = unbind;
                });

            }

        });

    }
    run.$inject = ["$rootScope", "$location", "$state", "$firebaseObject", "AuthWrapper", "FIREBASEDATA"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('authService', authService);

    /* @ngInject */
    function authService($q, $rootScope, $state, $window, $timeout, $firebaseObject, AuthWrapper, FIREBASEDATA) {
        
        this.testData = 'hello world!';

    	this.checkIfUserExists = checkIfUserExists;
    	this.createNewUser = createNewUser;
        this.loginToAccount = loginToAccount;
        this.logOut = logOut;

    	///////////////////

    	function checkIfUserExists(inputUsername) {

    		var deferred = $q.defer();

    		var doesUserExist = false;
    		var usersRef = new $window.Firebase(FIREBASEDATA.FBURL + '/users');

    		usersRef.once('value', function(dataSnapshot) {

                $timeout(function() {
                    dataSnapshot.forEach(function(user) {
                        if (user.val().userName === inputUsername) {
                            doesUserExist = true;
                        }
                    });

                    deferred.resolve(doesUserExist);
                });

    		});

    		return deferred.promise;

    	}

    	function createNewUser(inputEmail, inputPassword, inputUsername) {

            var deferred = $q.defer();

    		AuthWrapper.$createUser({
    			email: inputEmail,
    			password: inputPassword
    		}).then(function(userData) {

    			// Create a data entry for the new username.
    			new Firebase(FIREBASEDATA.FBURL).child('users/' + userData.uid).set({

    				userName: inputUsername,
    				role: 'User'

    			}, function(errorData) {
    				console.error(errorData);
                    return errorData.code;
    			});

                // Create a data entry for the user's avatar.
                new Firebase(FIREBASEDATA.FBURL).child('avatars').child(inputUsername).set('http://api.adorable.io/avatars/42/' + inputUsername);

    			// Log the user in.
    			AuthWrapper.$authWithPassword({
    				email: inputEmail,
    				password: inputPassword
    			}).then(function() {
                    deferred.resolve('ACCOUNT_CREATED');
                });

    		}).catch(function(errorData) {

    			console.error(errorData);

    			if (errorData.code === 'EMAIL_TAKEN') {
                    deferred.resolve(errorData.code);
    			}

    		});

            return deferred.promise;

    	}

        function loginToAccount(inputEmail, inputPassword) {

            var deferred = $q.defer();

            AuthWrapper.$authWithPassword({
                email: inputEmail,
                password: inputPassword
            }).then(function(authData) {

                deferred.resolve('LOGIN_SUCCESS');

            }).catch(function(errorData) {

                if (errorData.code === 'INVALID_USER') {
                    deferred.resolve('INVALID_USER');
                } else if (errorData.code === 'INVALID_PASSWORD') {
                    deferred.resolve('INVALID_PASSWORD');
                }

            });

            return deferred.promise;

        }

        function logOut() {
            AuthWrapper.$unauth();
            $rootScope.unbindFunction();
        }

    }
    authService.$inject = ["$q", "$rootScope", "$state", "$window", "$timeout", "$firebaseObject", "AuthWrapper", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .factory('AuthWrapper', AuthWrapper);

    /* @ngInject */
    function AuthWrapper($firebaseAuth, FIREBASEDATA) {

        var ref = new Firebase(FIREBASEDATA.FBURL);
        return $firebaseAuth(ref);

    }
    AuthWrapper.$inject = ["$firebaseAuth", "FIREBASEDATA"];
    
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('eventService', eventService);

    /* @ngInject */
    function eventService($q, $filter, $firebaseObject, $firebaseArray, FIREBASEDATA) {

        var _eventProperties = null;
        var _gameList = null;
        var _leaderboardLength = null;
        var _summarizedLeaderboard = null;
        var _teamList = null;

        this.createMultiGameFinalStandings = createMultiGameFinalStandings;
        this.getEventProperties = getEventProperties;
        this.getEventPropertiesObject = getEventPropertiesObject;
        this.getGameData = getGameData;
        this.getGameListObject = getGameListObject;
        this.getGamesList = getGamesList;
        this.getLeaderboardLengthValue = getLeaderboardLengthValue;
        this.getMultiGameLeaderboard = getMultiGameLeaderboard;
        this.getPlayerScores = getPlayerScores;
        this.getSingleGameLeaderboard = getSingleGameLeaderboard;
        this.getSummarizedLeaderboardObject = getSummarizedLeaderboardObject;
        this.getTeamListObject = getTeamListObject;
        this.loadEventProperties = loadEventProperties;

        ////////////////

        function createMultiGameFinalStandings(inputEvent) {

            // Calculate the final standings of the event.
            getMultiGameLeaderboard(inputEvent).then(function then(model) {

                var ref = new Firebase(FIREBASEDATA.FBURL);
                var inputEventStandings = $firebaseObject(
                    ref
                        .child('standings')
                        .child(inputEvent)
                );

                inputEventStandings.$loaded().then(function() {

                    model.forEach(function(standing) {
                        inputEventStandings[standing.key] = standing.position;
                    });

                    inputEventStandings.$save();

                });

            });

        }

        function getEventProperties(inputEvent) {

            var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var eventProperties = $firebaseObject(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('properties')
        	);

            deferred.resolve(eventProperties);

        	return deferred.promise;

        }

        function getEventPropertiesObject() {
            return _eventProperties;
        }

        function getFirstPlaceScores() {

            _gameList.forEach(function(game) {

                // If there are scores, get the top one.
                if (game.scores) {

                    var scoresArray = $.map(game.scores, function(el) { return el; });
                    scoresArray = $filter('orderBy')(scoresArray, '-score');
                    game.firstScore = scoresArray[0];

                }

            });

        }

        function getGameData(inputEvent, inputGame) {

            var deferred = $q.defer();

            var ref = new Firebase(FIREBASEDATA.FBURL);

            getGamesList(inputEvent).then(function(gamesList) {

                gamesList.forEach(function(game) {

                    if (game.camelName === inputGame) {
                        deferred.resolve(game);
                    }

                });

            });

            return deferred.promise;

        }

        function getGameListObject() {
            return _gameList;
        }

        function getGamesList(inputEvent) {

        	var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var gamesList = $firebaseArray(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('activeGames')
        	);

        	gamesList.$loaded().then(function() {
        		deferred.resolve(gamesList);
        	});

        	return deferred.promise;

        }

        function getLeaderboardLengthValue() {
            return _leaderboardLength;
        }

        function getMultiGameLeaderboard(inputEvent) {

        	var deferred = $q.defer();

        	// We need to get the top 12 players for every game.
        	var playerPoints = {};

        	getGamesList(inputEvent).then(function then(model) {

        		var gamesList = model;
        		gamesList.forEach(function(game) {

        			if (game.scores) {

        				// Convert the game's scores to an array.
        				var scoresArray = $.map(game.scores, function(el) { return el; });
        				scoresArray = $filter('orderBy')(scoresArray, '-score');

        				var totalAward = 12;

        				// Iterate through the top scores awarding points.
        				for (var i = 0; i < scoresArray.length; i++) {

        					if (!playerPoints[scoresArray[i].userName]) {
        						playerPoints[scoresArray[i].userName] = {
        							points: 0
        						};
        					}

        					playerPoints[scoresArray[i].userName].points += totalAward;

        					if (totalAward > 0) {
        						totalAward -= 1;
        					}

        				}

        			}

        		});

        		// Find and resolve ties.
        		playerPoints = $filter('orderObjectBy')(playerPoints, 'points', true);
                var haveBottomScorersFloor = false;
                var floorRange = 0;
        		for (var i = 0; i < playerPoints.length; i += 1) {

        			if (playerPoints[i-1] && playerPoints[i].points && playerPoints[i-1].points) {

        				if (playerPoints[i].points === playerPoints[i-1].points) {
        					playerPoints[i].position = playerPoints[i-1].position;
        				} else {
        					playerPoints[i].position = (i+1);
        				}

        			} else {

        				if (i === 0) {
        					playerPoints[i].position = 1;
        				} else {

                            if (!haveBottomScorersFloor) {
                                // Get count of players in one position higher.
                                var getScoreCountOf = playerPoints[i-1].points;

                                for (var j = 0; j < playerPoints.length; j += 1) {
                                    if (playerPoints[j].points === getScoreCountOf) {
                                        floorRange += 1;
                                    }
                                }

                                haveBottomScorersFloor = true;
                            }

        					playerPoints[i].position = (playerPoints.length + 1) - floorRange;
        				}

        			}

        		}

        		deferred.resolve(playerPoints);

        	});

			return deferred.promise;

        }

        function getSingleGameLeaderboard(inputEvent) {

            var deferred = $q.defer();

            var ref = new Firebase(FIREBASEDATA.FBURL);
            var leaderboardData = $firebaseArray(
                ref
                    .child('contests')
                    .child(inputEvent)
                    .child('scores')
            );

            deferred.resolve(leaderboardData);

            return deferred.promise;

        }

        function getSummarizedLeaderboardObject() {
            return _summarizedLeaderboard;
        }

        function getTeamListObject() {
            return _teamList;
        }

        function getPlayerScores(inputEvent, inputGamesList, inputPlayer) {

            var deferred = $q.defer();

            var displayScores = [];

            // Iterate through every game.
            inputGamesList.forEach(function(game) {

                if (game.scores) {

                    // Convert the game's scores to an array.
                    var scoresArray = $.map(game.scores, function(el) { return el; });
                    scoresArray = $filter('orderBy')(scoresArray, '-score');

                    var totalAward = 12;

                    // Iterate through the scores starting from the top and find our user.
                    for (var i = 0; i < scoresArray.length; i++) {

                        // Found our player.
                        if (scoresArray[i].userName === inputPlayer) {

                            var newScoreObject = game;
                            newScoreObject.position = i+1;
                            newScoreObject.score = scoresArray[i].score;
                            newScoreObject.pointsEarned = totalAward;
                            newScoreObject.inpUrl = scoresArray[i].inpUrl ? scoresArray[i].inpUrl : null;
                            newScoreObject.twitchUrl = scoresArray[i].twitchUrl ? scoresArray[i].twitchUrl : null;
                            newScoreObject.mameVersion = scoresArray[i].mameVersion ? scoresArray[i].mameVersion : null;

                            displayScores.push(newScoreObject);
                            totalAward = 12;
                            break;

                        } else {
                            if (totalAward > 0) {
                                totalAward -= 1;
                            }
                        }

                    }

                }

            });

            deferred.resolve(displayScores);

            return deferred.promise;

        }

        function loadEventProperties(inputEvent) {

            var ref = new Firebase(FIREBASEDATA.FBURL);
            var inputEventProperties = $firebaseObject(
                ref
                    .child('contests')
                    .child(inputEvent)
                    .child('properties')
            );

            inputEventProperties.$loaded().then(function() {
                _eventProperties = inputEventProperties;

                // If this is a multigame event, get the data needed for multigame components.
                if (_eventProperties.format.multiGame) {

                    getGamesList(inputEvent).then(function then(model) {
                        _gameList = model;
                        getFirstPlaceScores();
                    });

                    getMultiGameLeaderboard(inputEvent).then(function then(model) {
                        var leaderboard = model;
                        _leaderboardLength = leaderboard.length;
                        _summarizedLeaderboard = leaderboard.slice(0, 8);
                    });

                // If this is a single game event, get the data needed for single game components.
                } else {

                    getSingleGameLeaderboard(inputEvent).then(function then(model) {
                        var leaderboard = model;
                        _leaderboardLength = leaderboard.length;
                        _summarizedLeaderboard = leaderboard;
                    });

                }

                // If this is a team-based event, get the data needed for team event components.
                if (_eventProperties.format.teamBased) {

                    teamService.getTeamList(vm.eventName).then(function then(model) {
                        _teamList = model;
                    });

                }

            });

        }

    }
    eventService.$inject = ["$q", "$filter", "$firebaseObject", "$firebaseArray", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('EventMainController', EventMainController);

    /* @ngInject */
    function EventMainController($scope, $filter, $stateParams, $state, $timeout, $firebaseArray, eventService, authService, profileService, teamService, FIREBASEDATA) {

        /* jshint validthis: true */
        var vm = this;

        vm.eventName = $stateParams.eventName;

        vm.createTeam = createTeam;
        vm.determinePoints = determinePoints;
        vm.goToPlayerProfile = goToPlayerProfile;
        vm.openGameModal = openGameModal;
        vm.openModal = openModal;
        vm.openMultiGameLeaderboardModal = openMultiGameLeaderboardModal;
        vm.openPlayerModal = openPlayerModal;

        initEvent();

        /////////////////////////////////

        function closeModal() {
            angular.element('.modal').closeModal();
        }

        function createTeam() {
            teamService.createTeam(vm.eventName, vm.newTeam).then(function() {
                Materialize.toast('Team ' + vm.newTeam.shortName + ' created.', 4000);
                vm.newTeam = null;
            });
        }

        function determinePoints(inputScoreData, inputIndex) {

            var userGamePoints;

            // No position greater than 12 gets points.
            if (inputIndex > 11) {
                userGamePoints = 0;
                return userGamePoints;
            }

            userGamePoints = 12 - inputIndex;

            var sortedScores = $filter('orderBy')(vm.gameScores, '-score');

            // Am I tied with the person above me? If so, match their points.
            if (sortedScores[inputIndex - 1]) {

                if (sortedScores[inputIndex - 1].score === inputScoreData.score) {
                    userGamePoints += 1;
                }
            }

            return userGamePoints;

        }

        function goToPlayerProfile(inputPlayer) {

            closeModal();
            $state.go('profile', {username: inputPlayer});

        }

        function initEvent() {

            eventService.loadEventProperties(vm.eventName);

            $scope.$watch(function() { return eventService.getEventPropertiesObject(); }, function(model) {
                vm.eventProperties = model;
            }, true);

            $scope.$watch(function() { return eventService.getGameListObject(); }, function(model) {
                vm.gameList = model;
            }, true);

            $scope.$watch(function() { return eventService.getLeaderboardLengthValue(); }, function(model) {
                vm.leaderboardLength = model;
            }, true);

            $scope.$watch(function() { return eventService.getSummarizedLeaderboardObject(); }, function(model) {
                vm.summarizedLeaderboard = model;
            }, true);

            $scope.$watch(function() { return eventService.getTeamListObject(); }, function(model) {
                vm.teamList = model;
            }, true);

            profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });

        }

        function openModal(inputModal) {

            // This will evaluate to true if a Materialize modal is open.
            if (angular.element('#lean-overlay').length === 1) {

                closeModal();
                $timeout(function() {
                    angular.element(inputModal).openModal();
                    angular.element(inputModal + 'Content').scrollTop(0);
                }, 450);

            } else {

                angular.element(inputModal).openModal();
                angular.element(inputModal + 'Content').scrollTop(0);

            }

        }

        function openGameModal(inputGameName) {

            var ref = new Firebase(FIREBASEDATA.FBURL);

            eventService.getGameData(vm.eventName, inputGameName).then(function then(model) {
                vm.gameData = model;

                vm.gameScores = $firebaseArray(
                    ref
                        .child('contests')
                        .child(vm.eventName)
                        .child('activeGames')
                        .child(vm.gameData.$id)
                        .child('scores')
                );
            });

            openModal('#gameModal');

        }

        function openMultiGameLeaderboardModal() {

            eventService.getMultiGameLeaderboard(vm.eventName).then(function then(model) {
                vm.completeLeaderboard = model;
            });

            openModal('#multiGameLeaderboardModal');

        }

        function openPlayerModal(inputPlayer) {

            vm.focusPlayer = inputPlayer;

            eventService.getPlayerScores(vm.eventName, vm.gameList, vm.focusPlayer).then(function then(model) {
                vm.playerScores = model;
            });

            openModal('#playerModal');

        }

    }
    EventMainController.$inject = ["$scope", "$filter", "$stateParams", "$state", "$timeout", "$firebaseArray", "eventService", "authService", "profileService", "teamService", "FIREBASEDATA"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('teamService', teamService);

    /* @ngInject */
    function teamService($q, $firebaseArray, $firebaseObject, FIREBASEDATA) {

    	this.createTeam = createTeam;
        this.getTeamList = getTeamList;

        ////////////////

        function createTeam(inputEvent, inputNewTeamProperties) {

        	var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var teamPool = $firebaseObject(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('teamPool')
        	);

        	teamPool.$loaded().then(function() {

        		teamPool[inputNewTeamProperties.shortName] = {
        			fullName: inputNewTeamProperties.formalName
        		};
        		teamPool.$save();
        		deferred.resolve();

        	});

        	return deferred.promise;

        }

        function getTeamList(inputEvent) {

        	var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var teamList = $firebaseArray(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('teamPool')
        	);

        	teamList.$loaded().then(function() {
        		deferred.resolve(teamList);
        	});

        	return deferred.promise;

        }
    }
    teamService.$inject = ["$q", "$firebaseArray", "$firebaseObject", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgGamesList', vgGamesList);

    /* @ngInject */
    function vgGamesList () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: GamesListController,
            controllerAs: 'vm',
            restrict: 'E',
            templateUrl: './app/eventComponents/gamesList.directive.htm',
            scope: {
            	data: '=',
            	openGameFunction: '='
            }
        };
        return directive;
    }

    /* @ngInject */
    function GamesListController() {
        /* jshint validthis: true */
    	var vm = this;
    }
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgMultiGameLeaderboard', vgMultiGameLeaderboard);

    /* @ngInject */
    function vgMultiGameLeaderboard () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: MultiGameLeaderboardController,
            controllerAs: 'vm',
            restrict: 'E',
            templateUrl: './app/eventComponents/multiGameLeaderboard.directive.htm',
            scope: {
            	data: '=',
                avatarData: '=',
            	completeLength: '=',
                openPlayerFunction: '=',
            	openModalFunction: '='
            }
        };
        return directive;
    }

    /* @ngInject */
    function MultiGameLeaderboardController() {
        /* jshint validthis: true */
    	var vm = this;
    }
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgSingleGameLeaderboard', vgSingleGameLeaderboard);

    /* @ngInject */
    function vgSingleGameLeaderboard () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: SingleGameLeaderboardController,
            controllerAs: 'vm',
            restrict: 'E',
            templateUrl: './app/eventComponents/singleGameLeaderboard.directive.htm',
            scope: {
            	data: '=',
                avatarData: '=',
            	completeLength: '=',
                openLeaderboardFunction: '='
            }
        };
        return directive;
    }

    /* @ngInject */
    function SingleGameLeaderboardController() {
        /* jshint validthis: true */
    	var vm = this;
    }
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgStickyMessage', vgStickyMessage);

    /* @ngInject */
    function vgStickyMessage () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: StickyMessageController,
            controllerAs: 'vm',
            restrict: 'E',
            templateUrl: './app/eventComponents/stickyMessage.directive.htm',
            scope: {
            	properties: '='
            }
        };
        return directive;
    }

    /* @ngInject */
    function StickyMessageController($timeout) {
        /* jshint validthis: true */
    	var vm = this;
    }
    StickyMessageController.$inject = ["$timeout"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('HeaderController', HeaderController);

    /* @ngInject */
    function HeaderController($timeout, $rootScope, $window, $state, authService) {

        /* jshint validthis: true */
        var vm = this;
        vm.logOut = logOut;

        activate();

        //////////////////////////

        function activate() {
            $timeout(function() {
                angular.element('.dropdown-button')
                    .dropdown({
                        inDuration: 300,
                        outDuration: 225,
                        constrain_width: false,
                        hover: false,
                        gutter: -114,
                        belowOrigin: true
                    });
            }, 400);
        }

        function logOut() {
            authService.logOut();
            $window.location.reload();
        }

    }
    HeaderController.$inject = ["$timeout", "$rootScope", "$window", "$state", "authService"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('AvatarController', AvatarController);

    /* @ngInject */
    function AvatarController($rootScope, $state, $stateParams, $timeout, Upload, imgur, profileService) {

        /* jshint validthis: true */
        var vm = this;
        vm.uploadAvatar = uploadAvatar;

        activate();

        ////////////////

        function activate() {
        	profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });

            // FIXME: This needs to be triggered by a $rootScope broadcast of when it receives profile data.
            $timeout(function() {
                profileService.getBadgesData($rootScope.profile.userName).then(function then(model) {
                    vm.badgesData = model;
                });
            }, 500);
        }

        function uploadAvatar() {

        	vm.disableButton = true;

        	imgur.setAPIKey('Client-ID f53d6d5833b07bc');
        	imgur.upload(vm.file).then(function then(model) {
        		profileService.saveAvatarLink(model[0].link, $rootScope.profile.userName);
        		Materialize.toast('Your avatar was uploaded', 4000);

        		$timeout(function() {
        			$state.go('home');
        		}, 1000);
        	});

        }

    }
    AvatarController.$inject = ["$rootScope", "$state", "$stateParams", "$timeout", "Upload", "imgur", "profileService"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('ChangePasswordController', ChangePasswordController);

    /* @ngInject */
    function ChangePasswordController($scope, $timeout, $state, AuthWrapper) {

        /* jshint validthis: true */
        var vm = this;
        
        vm.submitChangePassword = submitChangePassword;

        //////////////////

        function submitChangePassword() {

            if ($scope.pwChangeForm.$valid) {

                AuthWrapper.$changePassword({
                    email: AuthWrapper.$getAuth().password.email,
                    oldPassword: vm.inputCurrentPassword,
                    newPassword: vm.inputNewPassword
                }).then(function() {

                    Materialize.toast('Your password was changed.', 4000);
                    $timeout(function() {
                        $state.go('home');
                    }, 1000);

                }).catch(function(error) {
                    
                    if (error.code === 'INVALID_PASSWORD') {
                        vm.showChangePasswordMessage = true;
                    }

                });

            }

        }

    }
    ChangePasswordController.$inject = ["$scope", "$timeout", "$state", "AuthWrapper"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('HomeController', HomeController);

    /* @ngInject */
    function HomeController($scope, $timeout) {

        /* jshint validthis: true */
        var vm = this;

        ////////////////////////

    }
    HomeController.$inject = ["$scope", "$timeout"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('LeaderboardController', LeaderboardController);

    /* @ngInject */
    function LeaderboardController($q, $timeout, $firebaseArray, profileService, FIREBASEDATA) {

        /* jshint validthis: true */
    	var vm = this;

        activate();

        ////////////////

        function activate() {
            getProfileScores().then(function then(model) {
                vm.profileScoreData = model;
            });

            profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });
        }

        function getProfileScores() {

        	var deferred = $q.defer();
        	var ref = new Firebase(FIREBASEDATA.FBURL);

        	var profileScoreData = $firebaseArray(
        		ref
        			.child('badges')
        	);

        	profileScoreData.$loaded(function() {
        		deferred.resolve(profileScoreData);
        	});

        	return deferred.promise;

        }

    }
    LeaderboardController.$inject = ["$q", "$timeout", "$firebaseArray", "profileService", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('ProfileController', ProfileController);

    /* @ngInject */
    function ProfileController($scope, $stateParams, $q, $timeout, $state, $firebaseArray, authService, profileService, eventService) {

        /* jshint validthis: true */
        var vm = this;
        
        activate();

        /////////////////////////////////

        function activate() {

            profileService.getUserData($stateParams.username).then(function then(model) {
                vm.profileData = model;

                profileService.getTournamentHistory(vm.profileData).then(function then(model) {
                    var tournamentHistoryData = model;
                    vm.eventStandings = profileService.getTournamentStandings(tournamentHistoryData, $stateParams.username);
                });

                $('.collapsible').collapsible({
                    accordion: true
                });
            });

            profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });

            profileService.getBadgesData($stateParams.username).then(function then(model) {
                vm.badgesData = model;
            });

        }

    }
    ProfileController.$inject = ["$scope", "$stateParams", "$q", "$timeout", "$state", "$firebaseArray", "authService", "profileService", "eventService"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('profileService', profileService);

    /* @ngInject */
    function profileService($rootScope, $q, $firebaseArray, $firebaseObject, eventService, FIREBASEDATA) {

    	this.getAvatarData = getAvatarData;
        this.getBadgesData = getBadgesData;
    	this.getTournamentHistory = getTournamentHistory;
        this.getTournamentStandings = getTournamentStandings;
        this.getUserData = getUserData;
        this.saveAvatarLink = saveAvatarLink;

        ////////////////

        function getAvatarData() {

            var deferred = $q.defer();
            var ref = new Firebase(FIREBASEDATA.FBURL);

            var avatarData = $firebaseObject(
                ref
                    .child('avatars')
            );

            avatarData.$loaded(function() {
                deferred.resolve(avatarData);
            });

            return deferred.promise;

        }

        function getBadgesData(inputUser) {

            var deferred = $q.defer();
            var ref = new Firebase(FIREBASEDATA.FBURL);

            var badgesData = $firebaseObject(
                ref
                    .child('badges')
                    .child(inputUser)
            );

            badgesData.$loaded(function() {
                deferred.resolve(badgesData);
            });

            return deferred.promise;

        }

        function getTournamentHistory(inputUserData) {

        	var deferred = $q.defer();
        	var ref = new Firebase(FIREBASEDATA.FBURL);

        	// Loop through each event in the pledgedTo object.
        	var eventsArray = [];
        	for (var key in inputUserData.pledgedTo) {
        		eventsArray.push(key);
        	}

        	deferred.resolve(eventsArray);

        	return deferred.promise;

        }

        function getTournamentStandings(inputTournamentHistory, inputUser) {

            var ref = new Firebase(FIREBASEDATA.FBURL);

            // Loop through each event in the user's history.
            var eventStandings = [];
            inputTournamentHistory.forEach(function(event) {

                eventService.getEventProperties(event).then(function(eventProperties) {

                    eventProperties.$loaded().then(function() {

                        // If concluded, get the user's standing.
                        if (eventProperties.state === 'concluded') {

                            var eventStandingData = $firebaseObject(
                                ref
                                    .child('standings')
                                    .child(event)
                            );

                            eventStandingData.$loaded().then(function() {

                                if (eventStandingData[inputUser]) {

                                    eventStandings.push({
                                        name: eventProperties.name,
                                        premier: eventProperties.premier ? true : null,
                                        shortName: event,
                                        state: 'concluded',
                                        color: eventProperties.color,
                                        position: eventStandingData[inputUser]
                                    });

                                } else {

                                    eventStandings.push({
                                        name: eventProperties.name,
                                        premier: eventProperties.premier ? true : null,
                                        shortName: event,
                                        state: 'concluded',
                                        color: eventProperties.color,
                                        position: -1
                                    });

                                }

                            });

                        } else if (eventProperties.state === 'inprogress' || eventProperties.state === 'upcoming') {

                            eventStandings.push({
                                name: eventProperties.name,
                                premier: eventProperties.premier ? true : null,
                                shortName: event,
                                color: eventProperties.color,
                                state: eventProperties.state
                            });

                        }

                    });

                });

            });

            return eventStandings;

        }

        function getUserData(inputUser) {

        	var deferred = $q.defer();
        	var ref = new Firebase(FIREBASEDATA.FBURL);

        	var usersData = $firebaseArray(
        		ref
        			.child('users')
        	);

        	usersData.$loaded(function() {

        		usersData.forEach(function(user) {
        			if (user.userName === inputUser) {
        				deferred.resolve(user);
        			}
        		});

        	});

        	return deferred.promise;

        }

        // FIXME: Make this server-side.
        function saveAvatarLink(inputLink, inputUser) {
            
            var ref = new Firebase(FIREBASEDATA.FBURL);

            var avatarData = $firebaseObject(
                ref
                    .child('avatars')
            );

            avatarData.$loaded(function() {
                avatarData[inputUser] = inputLink;
                avatarData.$save();
            });

        }

    }
    profileService.$inject = ["$rootScope", "$q", "$firebaseArray", "$firebaseObject", "eventService", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('RegController', RegController);

    /* @ngInject */
    function RegController($scope, $rootScope, $timeout, $window, $state, $firebaseObject, authService, AuthWrapper) {

        /* jshint validthis: true */
        var vm = this;

        vm.loginToAccount = loginToAccount;
        vm.passwordReset = passwordReset;
        vm.submitNewAccount = submitNewAccount;

        /////////////////////

        function loginToAccount() {

            authService.loginToAccount(vm.loginEmail, vm.loginPassword).then(function then(model) {

                vm.showInvalidUserError = false;
                vm.showInvalidPasswordError = false;

                if (model === 'LOGIN_SUCCESS') {

                    $state.go('home');

                } else if (model === 'INVALID_USER') {
                    vm.showInvalidUserError = true;
                    return;
                } else if (model === 'INVALID_PASSWORD') {
                    vm.showInvalidPasswordError = true;
                }

            });

        }

        function passwordReset() {

            if (!vm.loginEmail) {
                vm.showPasswordResetEmailMessage = true;
                return;
            }

            AuthWrapper.$resetPassword({
                email: vm.loginEmail
            }).then(function() {
                vm.showPasswordResetEmailMessage = false;
                Materialize.toast('A password reset email has been sent to ' + vm.loginEmail + '.', 4000);
            });

        }

        function submitNewAccount() {
            
            // Does the user exist? If so, show an error message.
            authService.checkIfUserExists(vm.newUsername).then(function(userExists) {

                vm.showDuplicateUserError = false;
                vm.showEmailTakenError = false;

                if (userExists) {

                    vm.showDuplicateUserError = true;
                    return;

                // Try to create the new user.
                } else {

                    authService.createNewUser(vm.newEmail, vm.newPassword, vm.newUsername).then(function then(model) {

                        if (model === 'EMAIL_TAKEN') {

                            vm.showEmailTakenError = true;
                            return;

                        } else if (model === 'ACCOUNT_CREATED') {

                            $state.go('profile', {username: vm.newUsername});

                        }

                    });

                }

            });

        }

    }
    RegController.$inject = ["$scope", "$rootScope", "$timeout", "$window", "$state", "$firebaseObject", "authService", "AuthWrapper"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .filter('orderObjectBy', orderObjectBy);

    function orderObjectBy() {
        return function(items, field, reverse) {
            var filtered = [];

            angular.forEach(items, function(item, key) {
                item.key = key;
                filtered.push(item);
            });

            filtered.sort(function (a, b) {
                return (a[field] > b[field] ? 1 : -1);
            });

            if(reverse) filtered.reverse();

            return filtered;
        };
    }

})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJhcHAuY29uZmlnLmpzIiwiYXBwLnJ1bi5qcyIsImF1dGgvYXV0aC5zZXJ2aWNlLmpzIiwiYXV0aC9hdXRod3JhcHBlci5mYWN0b3J5LmpzIiwiZXZlbnQvZXZlbnQuc2VydmljZS5qcyIsImV2ZW50L21haW4uY29udHJvbGxlci5qcyIsImV2ZW50L3RlYW0uc2VydmljZS5qcyIsImV2ZW50Q29tcG9uZW50cy9nYW1lc0xpc3QuZGlyZWN0aXZlLmpzIiwiZXZlbnRDb21wb25lbnRzL211bHRpR2FtZUxlYWRlcmJvYXJkLmRpcmVjdGl2ZS5qcyIsImV2ZW50Q29tcG9uZW50cy9zaW5nbGVHYW1lTGVhZGVyYm9hcmQuZGlyZWN0aXZlLmpzIiwiZXZlbnRDb21wb25lbnRzL3N0aWNreU1lc3NhZ2UuZGlyZWN0aXZlLmpzIiwiaGVhZGVyL2hlYWRlci5jb250cm9sbGVyLmpzIiwiaG9tZS9hdmF0YXIuY29udHJvbGxlci5qcyIsImhvbWUvY2hhbmdlUGFzc3dvcmQuY29udHJvbGxlci5qcyIsImhvbWUvaG9tZS5jb250cm9sbGVyLmpzIiwiaG9tZS9sZWFkZXJib2FyZC5jb250cm9sbGVyLmpzIiwiaG9tZS9wcm9maWxlLmNvbnRyb2xsZXIuanMiLCJob21lL3Byb2ZpbGUuc2VydmljZS5qcyIsImhvbWUvcmVnLmNvbnRyb2xsZXIuanMiLCJoZWxwZXJzL29yZGVyT2JqZWN0QnkuZmlsdGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQSxVQUFBOztZQUVBOzs7WUFHQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7O0tBRUEsQ0NoQkEsQ0FBQSxXQUFBO0NBQ0E7O0NBRUE7R0FDQSxPQUFBO0dBQ0EsU0FBQSxnQkFBQTtHQUNBLFNBQUE7O0dBRUEsT0FBQTs7O0NBR0EsU0FBQSxPQUFBLGdCQUFBLG9CQUFBOzs7RUFHQSxtQkFBQSxVQUFBOztFQUVBO09BQ0EsTUFB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QSxPQUFBO1NBQ0EsT0FBQSxpQkFBQTs7SUFFQSxTQUFBLGdCQUFBO1FBQ0EsT0FBQSxTQUFBLE9BQUEsT0FBQSxTQUFBO1lBQ0EsSUFBQSxXQUFBOztZQUVBLFFBQUEsUUFBQSxPQUFBLFNBQUEsTUFBQSxLQUFBO2dCQUNBLEtBQUEsTUFBQTtnQkFDQSxTQUFBLEtBQUE7OztZQUdBLFNBQUEsS0FBQSxVQUFBLEdBQUEsR0FBQTtnQkFDQSxRQUFBLEVBQUEsU0FBQSxFQUFBLFNBQUEsSUFBQSxDQUFBOzs7WUFHQSxHQUFBLFNBQUEsU0FBQTs7WUFFQSxPQUFBOzs7O0tBSUEiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcsIFtcbiAgICAgICAgICAgIC8qIEFuZ3VsYXIgbW9kdWxlcyAqL1xuICAgICAgICAgICAgJ25nQW5pbWF0ZScsXG4gICAgICAgICAgICAvKiBBcHAgbW9kdWxlcyAqL1xuICAgICAgICAgICAgLyogVGhpcmQtcGFydHkgbW9kdWxlcyAqL1xuICAgICAgICAgICAgJ3VpLnJvdXRlcicsXG4gICAgICAgICAgICAnZmlyZWJhc2UnLFxuICAgICAgICAgICAgJ3ZhbGlkYXRpb24ubWF0Y2gnLFxuICAgICAgICAgICAgJ29yZGluYWwnLFxuICAgICAgICAgICAgJ25nRmlsZVVwbG9hZCcsXG4gICAgICAgICAgICAnbmdJbWd1cidcbiAgICAgICAgXSk7XG59KSgpOyIsIihmdW5jdGlvbigpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdGFuZ3VsYXJcblx0XHQubW9kdWxlKCd2Zy5hcHAnKVxuXHRcdC5jb25zdGFudCgnRklSRUJBU0VEQVRBJywge1xuXHRcdFx0J0ZCVVJMJzogJ2h0dHBzOi8vd29sZnNjb250ZXN0cy5maXJlYmFzZWlvLmNvbSdcblx0XHR9KVxuXHRcdC5jb25maWcoY29uZmlnKTtcblxuXHQvKiBAbmdJbmplY3QgKi9cblx0ZnVuY3Rpb24gY29uZmlnKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcblxuXHRcdC8vIFJlZGlyZWN0IGFueSB1bm1hdGNoZWQgVVJMIHRvIC8uXG5cdFx0JHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xuXG5cdFx0JHN0YXRlUHJvdmlkZXJcblx0XHQgICAgLnN0YXRlKCdob21lJywge1xuXHRcdCAgICBcdHVybDogJy8nLFxuXHRcdCAgICBcdHRlbXBsYXRlVXJsOiAnYXBwL2hvbWUvaG9tZS5odG0nLFxuXHRcdCAgICBcdGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlciBhcyBob21lJ1xuXHRcdCAgICB9KVxuXG5cdFx0ICAgIC5zdGF0ZSgncmVnaXN0ZXJPckxvZ2luJywge1xuXHRcdCAgICBcdHVybDogJy9yZWdpc3Rlck9yTG9naW4nLFxuXHRcdCAgICBcdHRlbXBsYXRlVXJsOiAnL2FwcC9ob21lL3JlZy5odG0nLFxuXHRcdCAgICBcdGNvbnRyb2xsZXI6ICdSZWdDb250cm9sbGVyIGFzIHJlZydcblx0XHQgICAgfSlcblxuXHRcdCAgICAuc3RhdGUoJ3Byb2ZpbGUnLCB7XG5cdFx0ICAgIFx0dXJsOiAnL3Byb2ZpbGUvOnVzZXJuYW1lJyxcblx0XHQgICAgXHR0ZW1wbGF0ZVVybDogJy9hcHAvaG9tZS9wcm9maWxlLmh0bScsXG5cdFx0ICAgIFx0Y29udHJvbGxlcjogJ1Byb2ZpbGVDb250cm9sbGVyIGFzIHByb2ZpbGUnXG5cdFx0ICAgIH0pXG5cblx0XHQgICAgLnN0YXRlKCdsZWFkZXJib2FyZCcsIHtcblx0XHQgICAgXHR1cmw6ICcvbGVhZGVyYm9hcmQnLFxuXHRcdCAgICBcdHRlbXBsYXRlVXJsOiAnL2FwcC9ob21lL2xlYWRlcmJvYXJkLmh0bScsXG5cdFx0ICAgIFx0Y29udHJvbGxlcjogJ0xlYWRlcmJvYXJkQ29udHJvbGxlciBhcyBsZWFkZXJib2FyZCdcblx0XHQgICAgfSlcblxuXHRcdCAgICAuc3RhdGUoJ2V2ZW50Jywge1xuXHRcdCAgICBcdHVybDogJy9ldmVudC86ZXZlbnROYW1lL21haW4nLFxuXHRcdCAgICBcdHRlbXBsYXRlVXJsOiAnL2FwcC9ldmVudC9tYWluLmh0bScsXG5cdFx0ICAgIFx0Y29udHJvbGxlcjogJ0V2ZW50TWFpbkNvbnRyb2xsZXIgYXMgZXZlbnQnXG5cdFx0ICAgIH0pXG5cblx0XHQgICAgLnN0YXRlKCdjdXN0b21pemVBdmF0YXInLCB7XG5cdFx0ICAgIFx0dXJsOiAnL2N1c3RvbWl6ZUF2YXRhcicsXG5cdFx0ICAgIFx0dGVtcGxhdGVVcmw6ICcvYXBwL2hvbWUvYXZhdGFyLmh0bScsXG5cdFx0ICAgIFx0Y29udHJvbGxlcjogJ0F2YXRhckNvbnRyb2xsZXIgYXMgYXZhdGFyJyxcblxuXHRcdCAgICBcdHJlc29sdmU6IHtcblx0XHQgICAgXHRcdCdjdXJyZW50QXV0aCc6IFsnQXV0aFdyYXBwZXInLCBmdW5jdGlvbihBdXRoV3JhcHBlcikge1xuXHRcdCAgICBcdFx0XHRyZXR1cm4gQXV0aFdyYXBwZXIuJHJlcXVpcmVBdXRoKCk7XG5cdFx0ICAgIFx0XHR9XVxuXHRcdCAgICBcdH1cblx0XHQgICAgfSlcblxuXHRcdCAgICAuc3RhdGUoJ2NoYW5nZVBhc3N3b3JkJywge1xuXHRcdCAgICBcdHVybDogJy9jaGFuZ2VQYXNzd29yZCcsXG5cdFx0ICAgIFx0dGVtcGxhdGVVcmw6ICcvYXBwL2hvbWUvY2hhbmdlUGFzc3dvcmQuaHRtJyxcblx0XHQgICAgXHRjb250cm9sbGVyOiAnQ2hhbmdlUGFzc3dvcmRDb250cm9sbGVyIGFzIHB3Y2hhbmdlJyxcblxuXHRcdCAgICBcdHJlc29sdmU6IHtcblx0XHQgICAgXHRcdCdjdXJyZW50QXV0aCc6IFsnQXV0aFdyYXBwZXInLCBmdW5jdGlvbihBdXRoV3JhcHBlcikge1xuXHRcdCAgICBcdFx0XHRyZXR1cm4gQXV0aFdyYXBwZXIuJHJlcXVpcmVBdXRoKCk7XG5cdFx0ICAgIFx0XHR9XVxuXHRcdCAgICBcdH1cblx0XHQgICAgfSk7XG5cdH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLnJ1bihydW4pO1xuXG4gICAgZnVuY3Rpb24gcnVuKCRyb290U2NvcGUsICRsb2NhdGlvbiwgJHN0YXRlLCAkZmlyZWJhc2VPYmplY3QsIEF1dGhXcmFwcGVyLCBGSVJFQkFTRURBVEEpIHtcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlRXJyb3InLCBmdW5jdGlvbihldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcywgZXJyb3IpIHtcbiAgICAgICAgICAgIGlmIChlcnJvciA9PT0gJ0FVVEhfUkVRVUlSRUQnKSB7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdyZWdpc3Rlck9yTG9naW4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgLy8gSWYgdXNlciBpcyBsb2dnZWQgaW4sIGRvd25sb2FkIHRoZWlyIHByb2ZpbGUgZGF0YSB0byBhbiBvYmplY3QgaW4gJHJvb3RTY29wZS5cbiAgICAgICAgICAgIC8vIEZJWE1FOiBXZSBzaG91bGRuJ3QgbmVlZCB0byBkbyB0aGlzIGV2ZXJ5IHN1Y2Nlc3NmdWwgc3RhdGUgY2hhbmdlLlxuICAgICAgICAgICAgaWYgKEF1dGhXcmFwcGVyLiRnZXRBdXRoKCkpIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgYXV0aERhdGEgPSBBdXRoV3JhcHBlci4kZ2V0QXV0aCgpO1xuICAgICAgICAgICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcblxuICAgICAgICAgICAgICAgIHZhciBwcm9maWxlRGF0YSA9ICRmaXJlYmFzZU9iamVjdChyZWYuY2hpbGQoJ3VzZXJzJykuY2hpbGQoYXV0aERhdGEudWlkKSk7XG4gICAgICAgICAgICAgICAgcHJvZmlsZURhdGEuJGJpbmRUbygkcm9vdFNjb3BlLCAncHJvZmlsZScpLnRoZW4oZnVuY3Rpb24odW5iaW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUudW5iaW5kRnVuY3Rpb24gPSB1bmJpbmQ7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuc2VydmljZSgnYXV0aFNlcnZpY2UnLCBhdXRoU2VydmljZSk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBhdXRoU2VydmljZSgkcSwgJHJvb3RTY29wZSwgJHN0YXRlLCAkd2luZG93LCAkdGltZW91dCwgJGZpcmViYXNlT2JqZWN0LCBBdXRoV3JhcHBlciwgRklSRUJBU0VEQVRBKSB7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnRlc3REYXRhID0gJ2hlbGxvIHdvcmxkISc7XG5cbiAgICBcdHRoaXMuY2hlY2tJZlVzZXJFeGlzdHMgPSBjaGVja0lmVXNlckV4aXN0cztcbiAgICBcdHRoaXMuY3JlYXRlTmV3VXNlciA9IGNyZWF0ZU5ld1VzZXI7XG4gICAgICAgIHRoaXMubG9naW5Ub0FjY291bnQgPSBsb2dpblRvQWNjb3VudDtcbiAgICAgICAgdGhpcy5sb2dPdXQgPSBsb2dPdXQ7XG5cbiAgICBcdC8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgIFx0ZnVuY3Rpb24gY2hlY2tJZlVzZXJFeGlzdHMoaW5wdXRVc2VybmFtZSkge1xuXG4gICAgXHRcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICBcdFx0dmFyIGRvZXNVc2VyRXhpc3QgPSBmYWxzZTtcbiAgICBcdFx0dmFyIHVzZXJzUmVmID0gbmV3ICR3aW5kb3cuRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMICsgJy91c2VycycpO1xuXG4gICAgXHRcdHVzZXJzUmVmLm9uY2UoJ3ZhbHVlJywgZnVuY3Rpb24oZGF0YVNuYXBzaG90KSB7XG5cbiAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVNuYXBzaG90LmZvckVhY2goZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIudmFsKCkudXNlck5hbWUgPT09IGlucHV0VXNlcm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2VzVXNlckV4aXN0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkb2VzVXNlckV4aXN0KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgIFx0XHR9KTtcblxuICAgIFx0XHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgIFx0fVxuXG4gICAgXHRmdW5jdGlvbiBjcmVhdGVOZXdVc2VyKGlucHV0RW1haWwsIGlucHV0UGFzc3dvcmQsIGlucHV0VXNlcm5hbWUpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgIFx0XHRBdXRoV3JhcHBlci4kY3JlYXRlVXNlcih7XG4gICAgXHRcdFx0ZW1haWw6IGlucHV0RW1haWwsXG4gICAgXHRcdFx0cGFzc3dvcmQ6IGlucHV0UGFzc3dvcmRcbiAgICBcdFx0fSkudGhlbihmdW5jdGlvbih1c2VyRGF0YSkge1xuXG4gICAgXHRcdFx0Ly8gQ3JlYXRlIGEgZGF0YSBlbnRyeSBmb3IgdGhlIG5ldyB1c2VybmFtZS5cbiAgICBcdFx0XHRuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKS5jaGlsZCgndXNlcnMvJyArIHVzZXJEYXRhLnVpZCkuc2V0KHtcblxuICAgIFx0XHRcdFx0dXNlck5hbWU6IGlucHV0VXNlcm5hbWUsXG4gICAgXHRcdFx0XHRyb2xlOiAnVXNlcidcblxuICAgIFx0XHRcdH0sIGZ1bmN0aW9uKGVycm9yRGF0YSkge1xuICAgIFx0XHRcdFx0Y29uc29sZS5lcnJvcihlcnJvckRhdGEpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3JEYXRhLmNvZGU7XG4gICAgXHRcdFx0fSk7XG5cbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYSBkYXRhIGVudHJ5IGZvciB0aGUgdXNlcidzIGF2YXRhci5cbiAgICAgICAgICAgICAgICBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKS5jaGlsZCgnYXZhdGFycycpLmNoaWxkKGlucHV0VXNlcm5hbWUpLnNldCgnaHR0cDovL2FwaS5hZG9yYWJsZS5pby9hdmF0YXJzLzQyLycgKyBpbnB1dFVzZXJuYW1lKTtcblxuICAgIFx0XHRcdC8vIExvZyB0aGUgdXNlciBpbi5cbiAgICBcdFx0XHRBdXRoV3JhcHBlci4kYXV0aFdpdGhQYXNzd29yZCh7XG4gICAgXHRcdFx0XHRlbWFpbDogaW5wdXRFbWFpbCxcbiAgICBcdFx0XHRcdHBhc3N3b3JkOiBpbnB1dFBhc3N3b3JkXG4gICAgXHRcdFx0fSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgnQUNDT1VOVF9DUkVBVEVEJyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICBcdFx0fSkuY2F0Y2goZnVuY3Rpb24oZXJyb3JEYXRhKSB7XG5cbiAgICBcdFx0XHRjb25zb2xlLmVycm9yKGVycm9yRGF0YSk7XG5cbiAgICBcdFx0XHRpZiAoZXJyb3JEYXRhLmNvZGUgPT09ICdFTUFJTF9UQUtFTicpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShlcnJvckRhdGEuY29kZSk7XG4gICAgXHRcdFx0fVxuXG4gICAgXHRcdH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgIFx0fVxuXG4gICAgICAgIGZ1bmN0aW9uIGxvZ2luVG9BY2NvdW50KGlucHV0RW1haWwsIGlucHV0UGFzc3dvcmQpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgQXV0aFdyYXBwZXIuJGF1dGhXaXRoUGFzc3dvcmQoe1xuICAgICAgICAgICAgICAgIGVtYWlsOiBpbnB1dEVtYWlsLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBpbnB1dFBhc3N3b3JkXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGF1dGhEYXRhKSB7XG5cbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCdMT0dJTl9TVUNDRVNTJyk7XG5cbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yRGF0YSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKGVycm9yRGF0YS5jb2RlID09PSAnSU5WQUxJRF9VU0VSJykge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCdJTlZBTElEX1VTRVInKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yRGF0YS5jb2RlID09PSAnSU5WQUxJRF9QQVNTV09SRCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgnSU5WQUxJRF9QQVNTV09SRCcpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsb2dPdXQoKSB7XG4gICAgICAgICAgICBBdXRoV3JhcHBlci4kdW5hdXRoKCk7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLnVuYmluZEZ1bmN0aW9uKCk7XG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ0F1dGhXcmFwcGVyJywgQXV0aFdyYXBwZXIpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gQXV0aFdyYXBwZXIoJGZpcmViYXNlQXV0aCwgRklSRUJBU0VEQVRBKSB7XG5cbiAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuICAgICAgICByZXR1cm4gJGZpcmViYXNlQXV0aChyZWYpO1xuXG4gICAgfVxuICAgIFxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuc2VydmljZSgnZXZlbnRTZXJ2aWNlJywgZXZlbnRTZXJ2aWNlKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIGV2ZW50U2VydmljZSgkcSwgJGZpbHRlciwgJGZpcmViYXNlT2JqZWN0LCAkZmlyZWJhc2VBcnJheSwgRklSRUJBU0VEQVRBKSB7XG5cbiAgICAgICAgdmFyIF9ldmVudFByb3BlcnRpZXMgPSBudWxsO1xuICAgICAgICB2YXIgX2dhbWVMaXN0ID0gbnVsbDtcbiAgICAgICAgdmFyIF9sZWFkZXJib2FyZExlbmd0aCA9IG51bGw7XG4gICAgICAgIHZhciBfc3VtbWFyaXplZExlYWRlcmJvYXJkID0gbnVsbDtcbiAgICAgICAgdmFyIF90ZWFtTGlzdCA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5jcmVhdGVNdWx0aUdhbWVGaW5hbFN0YW5kaW5ncyA9IGNyZWF0ZU11bHRpR2FtZUZpbmFsU3RhbmRpbmdzO1xuICAgICAgICB0aGlzLmdldEV2ZW50UHJvcGVydGllcyA9IGdldEV2ZW50UHJvcGVydGllcztcbiAgICAgICAgdGhpcy5nZXRFdmVudFByb3BlcnRpZXNPYmplY3QgPSBnZXRFdmVudFByb3BlcnRpZXNPYmplY3Q7XG4gICAgICAgIHRoaXMuZ2V0R2FtZURhdGEgPSBnZXRHYW1lRGF0YTtcbiAgICAgICAgdGhpcy5nZXRHYW1lTGlzdE9iamVjdCA9IGdldEdhbWVMaXN0T2JqZWN0O1xuICAgICAgICB0aGlzLmdldEdhbWVzTGlzdCA9IGdldEdhbWVzTGlzdDtcbiAgICAgICAgdGhpcy5nZXRMZWFkZXJib2FyZExlbmd0aFZhbHVlID0gZ2V0TGVhZGVyYm9hcmRMZW5ndGhWYWx1ZTtcbiAgICAgICAgdGhpcy5nZXRNdWx0aUdhbWVMZWFkZXJib2FyZCA9IGdldE11bHRpR2FtZUxlYWRlcmJvYXJkO1xuICAgICAgICB0aGlzLmdldFBsYXllclNjb3JlcyA9IGdldFBsYXllclNjb3JlcztcbiAgICAgICAgdGhpcy5nZXRTaW5nbGVHYW1lTGVhZGVyYm9hcmQgPSBnZXRTaW5nbGVHYW1lTGVhZGVyYm9hcmQ7XG4gICAgICAgIHRoaXMuZ2V0U3VtbWFyaXplZExlYWRlcmJvYXJkT2JqZWN0ID0gZ2V0U3VtbWFyaXplZExlYWRlcmJvYXJkT2JqZWN0O1xuICAgICAgICB0aGlzLmdldFRlYW1MaXN0T2JqZWN0ID0gZ2V0VGVhbUxpc3RPYmplY3Q7XG4gICAgICAgIHRoaXMubG9hZEV2ZW50UHJvcGVydGllcyA9IGxvYWRFdmVudFByb3BlcnRpZXM7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZU11bHRpR2FtZUZpbmFsU3RhbmRpbmdzKGlucHV0RXZlbnQpIHtcblxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBmaW5hbCBzdGFuZGluZ3Mgb2YgdGhlIGV2ZW50LlxuICAgICAgICAgICAgZ2V0TXVsdGlHYW1lTGVhZGVyYm9hcmQoaW5wdXRFdmVudCkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG4gICAgICAgICAgICAgICAgdmFyIGlucHV0RXZlbnRTdGFuZGluZ3MgPSAkZmlyZWJhc2VPYmplY3QoXG4gICAgICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKCdzdGFuZGluZ3MnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKGlucHV0RXZlbnQpXG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIGlucHV0RXZlbnRTdGFuZGluZ3MuJGxvYWRlZCgpLnRoZW4oZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgbW9kZWwuZm9yRWFjaChmdW5jdGlvbihzdGFuZGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRFdmVudFN0YW5kaW5nc1tzdGFuZGluZy5rZXldID0gc3RhbmRpbmcucG9zaXRpb247XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlucHV0RXZlbnRTdGFuZGluZ3MuJHNhdmUoKTtcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0RXZlbnRQcm9wZXJ0aWVzKGlucHV0RXZlbnQpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICBcdHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcbiAgICAgICAgXHR2YXIgZXZlbnRQcm9wZXJ0aWVzID0gJGZpcmViYXNlT2JqZWN0KFxuICAgICAgICBcdFx0cmVmXG4gICAgICAgIFx0XHRcdC5jaGlsZCgnY29udGVzdHMnKVxuICAgICAgICBcdFx0XHQuY2hpbGQoaW5wdXRFdmVudClcbiAgICAgICAgXHRcdFx0LmNoaWxkKCdwcm9wZXJ0aWVzJylcbiAgICAgICAgXHQpO1xuXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGV2ZW50UHJvcGVydGllcyk7XG5cbiAgICAgICAgXHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0RXZlbnRQcm9wZXJ0aWVzT2JqZWN0KCkge1xuICAgICAgICAgICAgcmV0dXJuIF9ldmVudFByb3BlcnRpZXM7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRGaXJzdFBsYWNlU2NvcmVzKCkge1xuXG4gICAgICAgICAgICBfZ2FtZUxpc3QuZm9yRWFjaChmdW5jdGlvbihnYW1lKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSBhcmUgc2NvcmVzLCBnZXQgdGhlIHRvcCBvbmUuXG4gICAgICAgICAgICAgICAgaWYgKGdhbWUuc2NvcmVzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNjb3Jlc0FycmF5ID0gJC5tYXAoZ2FtZS5zY29yZXMsIGZ1bmN0aW9uKGVsKSB7IHJldHVybiBlbDsgfSk7XG4gICAgICAgICAgICAgICAgICAgIHNjb3Jlc0FycmF5ID0gJGZpbHRlcignb3JkZXJCeScpKHNjb3Jlc0FycmF5LCAnLXNjb3JlJyk7XG4gICAgICAgICAgICAgICAgICAgIGdhbWUuZmlyc3RTY29yZSA9IHNjb3Jlc0FycmF5WzBdO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0R2FtZURhdGEoaW5wdXRFdmVudCwgaW5wdXRHYW1lKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcblxuICAgICAgICAgICAgZ2V0R2FtZXNMaXN0KGlucHV0RXZlbnQpLnRoZW4oZnVuY3Rpb24oZ2FtZXNMaXN0KSB7XG5cbiAgICAgICAgICAgICAgICBnYW1lc0xpc3QuZm9yRWFjaChmdW5jdGlvbihnYW1lKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUuY2FtZWxOYW1lID09PSBpbnB1dEdhbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZ2FtZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEdhbWVMaXN0T2JqZWN0KCkge1xuICAgICAgICAgICAgcmV0dXJuIF9nYW1lTGlzdDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEdhbWVzTGlzdChpbnB1dEV2ZW50KSB7XG5cbiAgICAgICAgXHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIFx0dmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuICAgICAgICBcdHZhciBnYW1lc0xpc3QgPSAkZmlyZWJhc2VBcnJheShcbiAgICAgICAgXHRcdHJlZlxuICAgICAgICBcdFx0XHQuY2hpbGQoJ2NvbnRlc3RzJylcbiAgICAgICAgXHRcdFx0LmNoaWxkKGlucHV0RXZlbnQpXG4gICAgICAgIFx0XHRcdC5jaGlsZCgnYWN0aXZlR2FtZXMnKVxuICAgICAgICBcdCk7XG5cbiAgICAgICAgXHRnYW1lc0xpc3QuJGxvYWRlZCgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIFx0XHRkZWZlcnJlZC5yZXNvbHZlKGdhbWVzTGlzdCk7XG4gICAgICAgIFx0fSk7XG5cbiAgICAgICAgXHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0TGVhZGVyYm9hcmRMZW5ndGhWYWx1ZSgpIHtcbiAgICAgICAgICAgIHJldHVybiBfbGVhZGVyYm9hcmRMZW5ndGg7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRNdWx0aUdhbWVMZWFkZXJib2FyZChpbnB1dEV2ZW50KSB7XG5cbiAgICAgICAgXHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIFx0Ly8gV2UgbmVlZCB0byBnZXQgdGhlIHRvcCAxMiBwbGF5ZXJzIGZvciBldmVyeSBnYW1lLlxuICAgICAgICBcdHZhciBwbGF5ZXJQb2ludHMgPSB7fTtcblxuICAgICAgICBcdGdldEdhbWVzTGlzdChpbnB1dEV2ZW50KS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcblxuICAgICAgICBcdFx0dmFyIGdhbWVzTGlzdCA9IG1vZGVsO1xuICAgICAgICBcdFx0Z2FtZXNMaXN0LmZvckVhY2goZnVuY3Rpb24oZ2FtZSkge1xuXG4gICAgICAgIFx0XHRcdGlmIChnYW1lLnNjb3Jlcykge1xuXG4gICAgICAgIFx0XHRcdFx0Ly8gQ29udmVydCB0aGUgZ2FtZSdzIHNjb3JlcyB0byBhbiBhcnJheS5cbiAgICAgICAgXHRcdFx0XHR2YXIgc2NvcmVzQXJyYXkgPSAkLm1hcChnYW1lLnNjb3JlcywgZnVuY3Rpb24oZWwpIHsgcmV0dXJuIGVsOyB9KTtcbiAgICAgICAgXHRcdFx0XHRzY29yZXNBcnJheSA9ICRmaWx0ZXIoJ29yZGVyQnknKShzY29yZXNBcnJheSwgJy1zY29yZScpO1xuXG4gICAgICAgIFx0XHRcdFx0dmFyIHRvdGFsQXdhcmQgPSAxMjtcblxuICAgICAgICBcdFx0XHRcdC8vIEl0ZXJhdGUgdGhyb3VnaCB0aGUgdG9wIHNjb3JlcyBhd2FyZGluZyBwb2ludHMuXG4gICAgICAgIFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzY29yZXNBcnJheS5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgIFx0XHRcdFx0XHRpZiAoIXBsYXllclBvaW50c1tzY29yZXNBcnJheVtpXS51c2VyTmFtZV0pIHtcbiAgICAgICAgXHRcdFx0XHRcdFx0cGxheWVyUG9pbnRzW3Njb3Jlc0FycmF5W2ldLnVzZXJOYW1lXSA9IHtcbiAgICAgICAgXHRcdFx0XHRcdFx0XHRwb2ludHM6IDBcbiAgICAgICAgXHRcdFx0XHRcdFx0fTtcbiAgICAgICAgXHRcdFx0XHRcdH1cblxuICAgICAgICBcdFx0XHRcdFx0cGxheWVyUG9pbnRzW3Njb3Jlc0FycmF5W2ldLnVzZXJOYW1lXS5wb2ludHMgKz0gdG90YWxBd2FyZDtcblxuICAgICAgICBcdFx0XHRcdFx0aWYgKHRvdGFsQXdhcmQgPiAwKSB7XG4gICAgICAgIFx0XHRcdFx0XHRcdHRvdGFsQXdhcmQgLT0gMTtcbiAgICAgICAgXHRcdFx0XHRcdH1cblxuICAgICAgICBcdFx0XHRcdH1cblxuICAgICAgICBcdFx0XHR9XG5cbiAgICAgICAgXHRcdH0pO1xuXG4gICAgICAgIFx0XHQvLyBGaW5kIGFuZCByZXNvbHZlIHRpZXMuXG4gICAgICAgIFx0XHRwbGF5ZXJQb2ludHMgPSAkZmlsdGVyKCdvcmRlck9iamVjdEJ5JykocGxheWVyUG9pbnRzLCAncG9pbnRzJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgdmFyIGhhdmVCb3R0b21TY29yZXJzRmxvb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2YXIgZmxvb3JSYW5nZSA9IDA7XG4gICAgICAgIFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHBsYXllclBvaW50cy5sZW5ndGg7IGkgKz0gMSkge1xuXG4gICAgICAgIFx0XHRcdGlmIChwbGF5ZXJQb2ludHNbaS0xXSAmJiBwbGF5ZXJQb2ludHNbaV0ucG9pbnRzICYmIHBsYXllclBvaW50c1tpLTFdLnBvaW50cykge1xuXG4gICAgICAgIFx0XHRcdFx0aWYgKHBsYXllclBvaW50c1tpXS5wb2ludHMgPT09IHBsYXllclBvaW50c1tpLTFdLnBvaW50cykge1xuICAgICAgICBcdFx0XHRcdFx0cGxheWVyUG9pbnRzW2ldLnBvc2l0aW9uID0gcGxheWVyUG9pbnRzW2ktMV0ucG9zaXRpb247XG4gICAgICAgIFx0XHRcdFx0fSBlbHNlIHtcbiAgICAgICAgXHRcdFx0XHRcdHBsYXllclBvaW50c1tpXS5wb3NpdGlvbiA9IChpKzEpO1xuICAgICAgICBcdFx0XHRcdH1cblxuICAgICAgICBcdFx0XHR9IGVsc2Uge1xuXG4gICAgICAgIFx0XHRcdFx0aWYgKGkgPT09IDApIHtcbiAgICAgICAgXHRcdFx0XHRcdHBsYXllclBvaW50c1tpXS5wb3NpdGlvbiA9IDE7XG4gICAgICAgIFx0XHRcdFx0fSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaGF2ZUJvdHRvbVNjb3JlcnNGbG9vcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBHZXQgY291bnQgb2YgcGxheWVycyBpbiBvbmUgcG9zaXRpb24gaGlnaGVyLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ2V0U2NvcmVDb3VudE9mID0gcGxheWVyUG9pbnRzW2ktMV0ucG9pbnRzO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcGxheWVyUG9pbnRzLmxlbmd0aDsgaiArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyUG9pbnRzW2pdLnBvaW50cyA9PT0gZ2V0U2NvcmVDb3VudE9mKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvb3JSYW5nZSArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGF2ZUJvdHRvbVNjb3JlcnNGbG9vciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgIFx0XHRcdFx0XHRwbGF5ZXJQb2ludHNbaV0ucG9zaXRpb24gPSAocGxheWVyUG9pbnRzLmxlbmd0aCArIDEpIC0gZmxvb3JSYW5nZTtcbiAgICAgICAgXHRcdFx0XHR9XG5cbiAgICAgICAgXHRcdFx0fVxuXG4gICAgICAgIFx0XHR9XG5cbiAgICAgICAgXHRcdGRlZmVycmVkLnJlc29sdmUocGxheWVyUG9pbnRzKTtcblxuICAgICAgICBcdH0pO1xuXG5cdFx0XHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0U2luZ2xlR2FtZUxlYWRlcmJvYXJkKGlucHV0RXZlbnQpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuICAgICAgICAgICAgdmFyIGxlYWRlcmJvYXJkRGF0YSA9ICRmaXJlYmFzZUFycmF5KFxuICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoJ2NvbnRlc3RzJylcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkKGlucHV0RXZlbnQpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnc2NvcmVzJylcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUobGVhZGVyYm9hcmREYXRhKTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldFN1bW1hcml6ZWRMZWFkZXJib2FyZE9iamVjdCgpIHtcbiAgICAgICAgICAgIHJldHVybiBfc3VtbWFyaXplZExlYWRlcmJvYXJkO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0VGVhbUxpc3RPYmplY3QoKSB7XG4gICAgICAgICAgICByZXR1cm4gX3RlYW1MaXN0O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0UGxheWVyU2NvcmVzKGlucHV0RXZlbnQsIGlucHV0R2FtZXNMaXN0LCBpbnB1dFBsYXllcikge1xuXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICB2YXIgZGlzcGxheVNjb3JlcyA9IFtdO1xuXG4gICAgICAgICAgICAvLyBJdGVyYXRlIHRocm91Z2ggZXZlcnkgZ2FtZS5cbiAgICAgICAgICAgIGlucHV0R2FtZXNMaXN0LmZvckVhY2goZnVuY3Rpb24oZ2FtZSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKGdhbWUuc2NvcmVzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ29udmVydCB0aGUgZ2FtZSdzIHNjb3JlcyB0byBhbiBhcnJheS5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNjb3Jlc0FycmF5ID0gJC5tYXAoZ2FtZS5zY29yZXMsIGZ1bmN0aW9uKGVsKSB7IHJldHVybiBlbDsgfSk7XG4gICAgICAgICAgICAgICAgICAgIHNjb3Jlc0FycmF5ID0gJGZpbHRlcignb3JkZXJCeScpKHNjb3Jlc0FycmF5LCAnLXNjb3JlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvdGFsQXdhcmQgPSAxMjtcblxuICAgICAgICAgICAgICAgICAgICAvLyBJdGVyYXRlIHRocm91Z2ggdGhlIHNjb3JlcyBzdGFydGluZyBmcm9tIHRoZSB0b3AgYW5kIGZpbmQgb3VyIHVzZXIuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2NvcmVzQXJyYXkubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm91bmQgb3VyIHBsYXllci5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29yZXNBcnJheVtpXS51c2VyTmFtZSA9PT0gaW5wdXRQbGF5ZXIpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdTY29yZU9iamVjdCA9IGdhbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2NvcmVPYmplY3QucG9zaXRpb24gPSBpKzE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2NvcmVPYmplY3Quc2NvcmUgPSBzY29yZXNBcnJheVtpXS5zY29yZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTY29yZU9iamVjdC5wb2ludHNFYXJuZWQgPSB0b3RhbEF3YXJkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Njb3JlT2JqZWN0LmlucFVybCA9IHNjb3Jlc0FycmF5W2ldLmlucFVybCA/IHNjb3Jlc0FycmF5W2ldLmlucFVybCA6IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2NvcmVPYmplY3QudHdpdGNoVXJsID0gc2NvcmVzQXJyYXlbaV0udHdpdGNoVXJsID8gc2NvcmVzQXJyYXlbaV0udHdpdGNoVXJsIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTY29yZU9iamVjdC5tYW1lVmVyc2lvbiA9IHNjb3Jlc0FycmF5W2ldLm1hbWVWZXJzaW9uID8gc2NvcmVzQXJyYXlbaV0ubWFtZVZlcnNpb24gOiBudWxsO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVNjb3Jlcy5wdXNoKG5ld1Njb3JlT2JqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF3YXJkID0gMTI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvdGFsQXdhcmQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXdhcmQgLT0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkaXNwbGF5U2NvcmVzKTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGxvYWRFdmVudFByb3BlcnRpZXMoaW5wdXRFdmVudCkge1xuXG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG4gICAgICAgICAgICB2YXIgaW5wdXRFdmVudFByb3BlcnRpZXMgPSAkZmlyZWJhc2VPYmplY3QoXG4gICAgICAgICAgICAgICAgcmVmXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnY29udGVzdHMnKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoaW5wdXRFdmVudClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkKCdwcm9wZXJ0aWVzJylcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlucHV0RXZlbnRQcm9wZXJ0aWVzLiRsb2FkZWQoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF9ldmVudFByb3BlcnRpZXMgPSBpbnB1dEV2ZW50UHJvcGVydGllcztcblxuICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYSBtdWx0aWdhbWUgZXZlbnQsIGdldCB0aGUgZGF0YSBuZWVkZWQgZm9yIG11bHRpZ2FtZSBjb21wb25lbnRzLlxuICAgICAgICAgICAgICAgIGlmIChfZXZlbnRQcm9wZXJ0aWVzLmZvcm1hdC5tdWx0aUdhbWUpIHtcblxuICAgICAgICAgICAgICAgICAgICBnZXRHYW1lc0xpc3QoaW5wdXRFdmVudCkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZ2FtZUxpc3QgPSBtb2RlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldEZpcnN0UGxhY2VTY29yZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZ2V0TXVsdGlHYW1lTGVhZGVyYm9hcmQoaW5wdXRFdmVudCkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGVhZGVyYm9hcmQgPSBtb2RlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9sZWFkZXJib2FyZExlbmd0aCA9IGxlYWRlcmJvYXJkLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zdW1tYXJpemVkTGVhZGVyYm9hcmQgPSBsZWFkZXJib2FyZC5zbGljZSgwLCA4KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGEgc2luZ2xlIGdhbWUgZXZlbnQsIGdldCB0aGUgZGF0YSBuZWVkZWQgZm9yIHNpbmdsZSBnYW1lIGNvbXBvbmVudHMuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICBnZXRTaW5nbGVHYW1lTGVhZGVyYm9hcmQoaW5wdXRFdmVudCkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGVhZGVyYm9hcmQgPSBtb2RlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9sZWFkZXJib2FyZExlbmd0aCA9IGxlYWRlcmJvYXJkLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zdW1tYXJpemVkTGVhZGVyYm9hcmQgPSBsZWFkZXJib2FyZDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGEgdGVhbS1iYXNlZCBldmVudCwgZ2V0IHRoZSBkYXRhIG5lZWRlZCBmb3IgdGVhbSBldmVudCBjb21wb25lbnRzLlxuICAgICAgICAgICAgICAgIGlmIChfZXZlbnRQcm9wZXJ0aWVzLmZvcm1hdC50ZWFtQmFzZWQpIHtcblxuICAgICAgICAgICAgICAgICAgICB0ZWFtU2VydmljZS5nZXRUZWFtTGlzdCh2bS5ldmVudE5hbWUpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RlYW1MaXN0ID0gbW9kZWw7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdFdmVudE1haW5Db250cm9sbGVyJywgRXZlbnRNYWluQ29udHJvbGxlcik7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBFdmVudE1haW5Db250cm9sbGVyKCRzY29wZSwgJGZpbHRlciwgJHN0YXRlUGFyYW1zLCAkc3RhdGUsICR0aW1lb3V0LCAkZmlyZWJhc2VBcnJheSwgZXZlbnRTZXJ2aWNlLCBhdXRoU2VydmljZSwgcHJvZmlsZVNlcnZpY2UsIHRlYW1TZXJ2aWNlLCBGSVJFQkFTRURBVEEpIHtcblxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0uZXZlbnROYW1lID0gJHN0YXRlUGFyYW1zLmV2ZW50TmFtZTtcblxuICAgICAgICB2bS5jcmVhdGVUZWFtID0gY3JlYXRlVGVhbTtcbiAgICAgICAgdm0uZGV0ZXJtaW5lUG9pbnRzID0gZGV0ZXJtaW5lUG9pbnRzO1xuICAgICAgICB2bS5nb1RvUGxheWVyUHJvZmlsZSA9IGdvVG9QbGF5ZXJQcm9maWxlO1xuICAgICAgICB2bS5vcGVuR2FtZU1vZGFsID0gb3BlbkdhbWVNb2RhbDtcbiAgICAgICAgdm0ub3Blbk1vZGFsID0gb3Blbk1vZGFsO1xuICAgICAgICB2bS5vcGVuTXVsdGlHYW1lTGVhZGVyYm9hcmRNb2RhbCA9IG9wZW5NdWx0aUdhbWVMZWFkZXJib2FyZE1vZGFsO1xuICAgICAgICB2bS5vcGVuUGxheWVyTW9kYWwgPSBvcGVuUGxheWVyTW9kYWw7XG5cbiAgICAgICAgaW5pdEV2ZW50KCk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gY2xvc2VNb2RhbCgpIHtcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnLm1vZGFsJykuY2xvc2VNb2RhbCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVGVhbSgpIHtcbiAgICAgICAgICAgIHRlYW1TZXJ2aWNlLmNyZWF0ZVRlYW0odm0uZXZlbnROYW1lLCB2bS5uZXdUZWFtKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIE1hdGVyaWFsaXplLnRvYXN0KCdUZWFtICcgKyB2bS5uZXdUZWFtLnNob3J0TmFtZSArICcgY3JlYXRlZC4nLCA0MDAwKTtcbiAgICAgICAgICAgICAgICB2bS5uZXdUZWFtID0gbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZGV0ZXJtaW5lUG9pbnRzKGlucHV0U2NvcmVEYXRhLCBpbnB1dEluZGV4KSB7XG5cbiAgICAgICAgICAgIHZhciB1c2VyR2FtZVBvaW50cztcblxuICAgICAgICAgICAgLy8gTm8gcG9zaXRpb24gZ3JlYXRlciB0aGFuIDEyIGdldHMgcG9pbnRzLlxuICAgICAgICAgICAgaWYgKGlucHV0SW5kZXggPiAxMSkge1xuICAgICAgICAgICAgICAgIHVzZXJHYW1lUG9pbnRzID0gMDtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlckdhbWVQb2ludHM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHVzZXJHYW1lUG9pbnRzID0gMTIgLSBpbnB1dEluZGV4O1xuXG4gICAgICAgICAgICB2YXIgc29ydGVkU2NvcmVzID0gJGZpbHRlcignb3JkZXJCeScpKHZtLmdhbWVTY29yZXMsICctc2NvcmUnKTtcblxuICAgICAgICAgICAgLy8gQW0gSSB0aWVkIHdpdGggdGhlIHBlcnNvbiBhYm92ZSBtZT8gSWYgc28sIG1hdGNoIHRoZWlyIHBvaW50cy5cbiAgICAgICAgICAgIGlmIChzb3J0ZWRTY29yZXNbaW5wdXRJbmRleCAtIDFdKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc29ydGVkU2NvcmVzW2lucHV0SW5kZXggLSAxXS5zY29yZSA9PT0gaW5wdXRTY29yZURhdGEuc2NvcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdXNlckdhbWVQb2ludHMgKz0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB1c2VyR2FtZVBvaW50cztcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ29Ub1BsYXllclByb2ZpbGUoaW5wdXRQbGF5ZXIpIHtcblxuICAgICAgICAgICAgY2xvc2VNb2RhbCgpO1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdwcm9maWxlJywge3VzZXJuYW1lOiBpbnB1dFBsYXllcn0pO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpbml0RXZlbnQoKSB7XG5cbiAgICAgICAgICAgIGV2ZW50U2VydmljZS5sb2FkRXZlbnRQcm9wZXJ0aWVzKHZtLmV2ZW50TmFtZSk7XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKSB7IHJldHVybiBldmVudFNlcnZpY2UuZ2V0RXZlbnRQcm9wZXJ0aWVzT2JqZWN0KCk7IH0sIGZ1bmN0aW9uKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgdm0uZXZlbnRQcm9wZXJ0aWVzID0gbW9kZWw7XG4gICAgICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbigpIHsgcmV0dXJuIGV2ZW50U2VydmljZS5nZXRHYW1lTGlzdE9iamVjdCgpOyB9LCBmdW5jdGlvbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLmdhbWVMaXN0ID0gbW9kZWw7XG4gICAgICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbigpIHsgcmV0dXJuIGV2ZW50U2VydmljZS5nZXRMZWFkZXJib2FyZExlbmd0aFZhbHVlKCk7IH0sIGZ1bmN0aW9uKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgdm0ubGVhZGVyYm9hcmRMZW5ndGggPSBtb2RlbDtcbiAgICAgICAgICAgIH0sIHRydWUpO1xuXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCkgeyByZXR1cm4gZXZlbnRTZXJ2aWNlLmdldFN1bW1hcml6ZWRMZWFkZXJib2FyZE9iamVjdCgpOyB9LCBmdW5jdGlvbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLnN1bW1hcml6ZWRMZWFkZXJib2FyZCA9IG1vZGVsO1xuICAgICAgICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKSB7IHJldHVybiBldmVudFNlcnZpY2UuZ2V0VGVhbUxpc3RPYmplY3QoKTsgfSwgZnVuY3Rpb24obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS50ZWFtTGlzdCA9IG1vZGVsO1xuICAgICAgICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgIHByb2ZpbGVTZXJ2aWNlLmdldEF2YXRhckRhdGEoKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5hdmF0YXJEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb3Blbk1vZGFsKGlucHV0TW9kYWwpIHtcblxuICAgICAgICAgICAgLy8gVGhpcyB3aWxsIGV2YWx1YXRlIHRvIHRydWUgaWYgYSBNYXRlcmlhbGl6ZSBtb2RhbCBpcyBvcGVuLlxuICAgICAgICAgICAgaWYgKGFuZ3VsYXIuZWxlbWVudCgnI2xlYW4tb3ZlcmxheScpLmxlbmd0aCA9PT0gMSkge1xuXG4gICAgICAgICAgICAgICAgY2xvc2VNb2RhbCgpO1xuICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoaW5wdXRNb2RhbCkub3Blbk1vZGFsKCk7XG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudChpbnB1dE1vZGFsICsgJ0NvbnRlbnQnKS5zY3JvbGxUb3AoMCk7XG4gICAgICAgICAgICAgICAgfSwgNDUwKTtcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudChpbnB1dE1vZGFsKS5vcGVuTW9kYWwoKTtcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoaW5wdXRNb2RhbCArICdDb250ZW50Jykuc2Nyb2xsVG9wKDApO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG9wZW5HYW1lTW9kYWwoaW5wdXRHYW1lTmFtZSkge1xuXG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgIGV2ZW50U2VydmljZS5nZXRHYW1lRGF0YSh2bS5ldmVudE5hbWUsIGlucHV0R2FtZU5hbWUpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLmdhbWVEYXRhID0gbW9kZWw7XG5cbiAgICAgICAgICAgICAgICB2bS5nYW1lU2NvcmVzID0gJGZpcmViYXNlQXJyYXkoXG4gICAgICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKCdjb250ZXN0cycpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2hpbGQodm0uZXZlbnROYW1lKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKCdhY3RpdmVHYW1lcycpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2hpbGQodm0uZ2FtZURhdGEuJGlkKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKCdzY29yZXMnKVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgb3Blbk1vZGFsKCcjZ2FtZU1vZGFsJyk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG9wZW5NdWx0aUdhbWVMZWFkZXJib2FyZE1vZGFsKCkge1xuXG4gICAgICAgICAgICBldmVudFNlcnZpY2UuZ2V0TXVsdGlHYW1lTGVhZGVyYm9hcmQodm0uZXZlbnROYW1lKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5jb21wbGV0ZUxlYWRlcmJvYXJkID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgb3Blbk1vZGFsKCcjbXVsdGlHYW1lTGVhZGVyYm9hcmRNb2RhbCcpO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuUGxheWVyTW9kYWwoaW5wdXRQbGF5ZXIpIHtcblxuICAgICAgICAgICAgdm0uZm9jdXNQbGF5ZXIgPSBpbnB1dFBsYXllcjtcblxuICAgICAgICAgICAgZXZlbnRTZXJ2aWNlLmdldFBsYXllclNjb3Jlcyh2bS5ldmVudE5hbWUsIHZtLmdhbWVMaXN0LCB2bS5mb2N1c1BsYXllcikudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgdm0ucGxheWVyU2NvcmVzID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgb3Blbk1vZGFsKCcjcGxheWVyTW9kYWwnKTtcblxuICAgICAgICB9XG5cbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLnNlcnZpY2UoJ3RlYW1TZXJ2aWNlJywgdGVhbVNlcnZpY2UpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gdGVhbVNlcnZpY2UoJHEsICRmaXJlYmFzZUFycmF5LCAkZmlyZWJhc2VPYmplY3QsIEZJUkVCQVNFREFUQSkge1xuXG4gICAgXHR0aGlzLmNyZWF0ZVRlYW0gPSBjcmVhdGVUZWFtO1xuICAgICAgICB0aGlzLmdldFRlYW1MaXN0ID0gZ2V0VGVhbUxpc3Q7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVRlYW0oaW5wdXRFdmVudCwgaW5wdXROZXdUZWFtUHJvcGVydGllcykge1xuXG4gICAgICAgIFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICBcdHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcbiAgICAgICAgXHR2YXIgdGVhbVBvb2wgPSAkZmlyZWJhc2VPYmplY3QoXG4gICAgICAgIFx0XHRyZWZcbiAgICAgICAgXHRcdFx0LmNoaWxkKCdjb250ZXN0cycpXG4gICAgICAgIFx0XHRcdC5jaGlsZChpbnB1dEV2ZW50KVxuICAgICAgICBcdFx0XHQuY2hpbGQoJ3RlYW1Qb29sJylcbiAgICAgICAgXHQpO1xuXG4gICAgICAgIFx0dGVhbVBvb2wuJGxvYWRlZCgpLnRoZW4oZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgXHRcdHRlYW1Qb29sW2lucHV0TmV3VGVhbVByb3BlcnRpZXMuc2hvcnROYW1lXSA9IHtcbiAgICAgICAgXHRcdFx0ZnVsbE5hbWU6IGlucHV0TmV3VGVhbVByb3BlcnRpZXMuZm9ybWFsTmFtZVxuICAgICAgICBcdFx0fTtcbiAgICAgICAgXHRcdHRlYW1Qb29sLiRzYXZlKCk7XG4gICAgICAgIFx0XHRkZWZlcnJlZC5yZXNvbHZlKCk7XG5cbiAgICAgICAgXHR9KTtcblxuICAgICAgICBcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRUZWFtTGlzdChpbnB1dEV2ZW50KSB7XG5cbiAgICAgICAgXHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIFx0dmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuICAgICAgICBcdHZhciB0ZWFtTGlzdCA9ICRmaXJlYmFzZUFycmF5KFxuICAgICAgICBcdFx0cmVmXG4gICAgICAgIFx0XHRcdC5jaGlsZCgnY29udGVzdHMnKVxuICAgICAgICBcdFx0XHQuY2hpbGQoaW5wdXRFdmVudClcbiAgICAgICAgXHRcdFx0LmNoaWxkKCd0ZWFtUG9vbCcpXG4gICAgICAgIFx0KTtcblxuICAgICAgICBcdHRlYW1MaXN0LiRsb2FkZWQoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICBcdFx0ZGVmZXJyZWQucmVzb2x2ZSh0ZWFtTGlzdCk7XG4gICAgICAgIFx0fSk7XG5cbiAgICAgICAgXHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCd2Z0dhbWVzTGlzdCcsIHZnR2FtZXNMaXN0KTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIHZnR2FtZXNMaXN0ICgpIHtcbiAgICAgICAgLy8gVXNhZ2U6XG4gICAgICAgIC8vXG4gICAgICAgIC8vIENyZWF0ZXM6XG4gICAgICAgIC8vXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbGxlcjogR2FtZXNMaXN0Q29udHJvbGxlcixcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy4vYXBwL2V2ZW50Q29tcG9uZW50cy9nYW1lc0xpc3QuZGlyZWN0aXZlLmh0bScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgXHRkYXRhOiAnPScsXG4gICAgICAgICAgICBcdG9wZW5HYW1lRnVuY3Rpb246ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuICAgIH1cblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIEdhbWVzTGlzdENvbnRyb2xsZXIoKSB7XG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICBcdHZhciB2bSA9IHRoaXM7XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCd2Z011bHRpR2FtZUxlYWRlcmJvYXJkJywgdmdNdWx0aUdhbWVMZWFkZXJib2FyZCk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiB2Z011bHRpR2FtZUxlYWRlcmJvYXJkICgpIHtcbiAgICAgICAgLy8gVXNhZ2U6XG4gICAgICAgIC8vXG4gICAgICAgIC8vIENyZWF0ZXM6XG4gICAgICAgIC8vXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbGxlcjogTXVsdGlHYW1lTGVhZGVyYm9hcmRDb250cm9sbGVyLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnLi9hcHAvZXZlbnRDb21wb25lbnRzL211bHRpR2FtZUxlYWRlcmJvYXJkLmRpcmVjdGl2ZS5odG0nLFxuICAgICAgICAgICAgc2NvcGU6IHtcbiAgICAgICAgICAgIFx0ZGF0YTogJz0nLFxuICAgICAgICAgICAgICAgIGF2YXRhckRhdGE6ICc9JyxcbiAgICAgICAgICAgIFx0Y29tcGxldGVMZW5ndGg6ICc9JyxcbiAgICAgICAgICAgICAgICBvcGVuUGxheWVyRnVuY3Rpb246ICc9JyxcbiAgICAgICAgICAgIFx0b3Blbk1vZGFsRnVuY3Rpb246ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuICAgIH1cblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIE11bHRpR2FtZUxlYWRlcmJvYXJkQ29udHJvbGxlcigpIHtcbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgIFx0dmFyIHZtID0gdGhpcztcbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3ZnU2luZ2xlR2FtZUxlYWRlcmJvYXJkJywgdmdTaW5nbGVHYW1lTGVhZGVyYm9hcmQpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gdmdTaW5nbGVHYW1lTGVhZGVyYm9hcmQgKCkge1xuICAgICAgICAvLyBVc2FnZTpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gQ3JlYXRlczpcbiAgICAgICAgLy9cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBTaW5nbGVHYW1lTGVhZGVyYm9hcmRDb250cm9sbGVyLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnLi9hcHAvZXZlbnRDb21wb25lbnRzL3NpbmdsZUdhbWVMZWFkZXJib2FyZC5kaXJlY3RpdmUuaHRtJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBcdGRhdGE6ICc9JyxcbiAgICAgICAgICAgICAgICBhdmF0YXJEYXRhOiAnPScsXG4gICAgICAgICAgICBcdGNvbXBsZXRlTGVuZ3RoOiAnPScsXG4gICAgICAgICAgICAgICAgb3BlbkxlYWRlcmJvYXJkRnVuY3Rpb246ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuICAgIH1cblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIFNpbmdsZUdhbWVMZWFkZXJib2FyZENvbnRyb2xsZXIoKSB7XG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICBcdHZhciB2bSA9IHRoaXM7XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuZGlyZWN0aXZlKCd2Z1N0aWNreU1lc3NhZ2UnLCB2Z1N0aWNreU1lc3NhZ2UpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gdmdTdGlja3lNZXNzYWdlICgpIHtcbiAgICAgICAgLy8gVXNhZ2U6XG4gICAgICAgIC8vXG4gICAgICAgIC8vIENyZWF0ZXM6XG4gICAgICAgIC8vXG4gICAgICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICAgICAgICBiaW5kVG9Db250cm9sbGVyOiB0cnVlLFxuICAgICAgICAgICAgY29udHJvbGxlcjogU3RpY2t5TWVzc2FnZUNvbnRyb2xsZXIsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuL2FwcC9ldmVudENvbXBvbmVudHMvc3RpY2t5TWVzc2FnZS5kaXJlY3RpdmUuaHRtJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBcdHByb3BlcnRpZXM6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuICAgIH1cblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIFN0aWNreU1lc3NhZ2VDb250cm9sbGVyKCR0aW1lb3V0KSB7XG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICBcdHZhciB2bSA9IHRoaXM7XG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuY29udHJvbGxlcignSGVhZGVyQ29udHJvbGxlcicsIEhlYWRlckNvbnRyb2xsZXIpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gSGVhZGVyQ29udHJvbGxlcigkdGltZW91dCwgJHJvb3RTY29wZSwgJHdpbmRvdywgJHN0YXRlLCBhdXRoU2VydmljZSkge1xuXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgdm0ubG9nT3V0ID0gbG9nT3V0O1xuXG4gICAgICAgIGFjdGl2YXRlKCk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnLmRyb3Bkb3duLWJ1dHRvbicpXG4gICAgICAgICAgICAgICAgICAgIC5kcm9wZG93bih7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbkR1cmF0aW9uOiAzMDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXREdXJhdGlvbjogMjI1LFxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3RyYWluX3dpZHRoOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGhvdmVyOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGd1dHRlcjogLTExNCxcbiAgICAgICAgICAgICAgICAgICAgICAgIGJlbG93T3JpZ2luOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgNDAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGxvZ091dCgpIHtcbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmxvZ091dCgpO1xuICAgICAgICAgICAgJHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcbiAgICAgICAgfVxuXG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuY29udHJvbGxlcignQXZhdGFyQ29udHJvbGxlcicsIEF2YXRhckNvbnRyb2xsZXIpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gQXZhdGFyQ29udHJvbGxlcigkcm9vdFNjb3BlLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgJHRpbWVvdXQsIFVwbG9hZCwgaW1ndXIsIHByb2ZpbGVTZXJ2aWNlKSB7XG5cbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS51cGxvYWRBdmF0YXIgPSB1cGxvYWRBdmF0YXI7XG5cbiAgICAgICAgYWN0aXZhdGUoKTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG4gICAgICAgIFx0cHJvZmlsZVNlcnZpY2UuZ2V0QXZhdGFyRGF0YSgpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLmF2YXRhckRhdGEgPSBtb2RlbDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAvLyBGSVhNRTogVGhpcyBuZWVkcyB0byBiZSB0cmlnZ2VyZWQgYnkgYSAkcm9vdFNjb3BlIGJyb2FkY2FzdCBvZiB3aGVuIGl0IHJlY2VpdmVzIHByb2ZpbGUgZGF0YS5cbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHByb2ZpbGVTZXJ2aWNlLmdldEJhZGdlc0RhdGEoJHJvb3RTY29wZS5wcm9maWxlLnVzZXJOYW1lKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uYmFkZ2VzRGF0YSA9IG1vZGVsO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSwgNTAwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHVwbG9hZEF2YXRhcigpIHtcblxuICAgICAgICBcdHZtLmRpc2FibGVCdXR0b24gPSB0cnVlO1xuXG4gICAgICAgIFx0aW1ndXIuc2V0QVBJS2V5KCdDbGllbnQtSUQgZjUzZDZkNTgzM2IwN2JjJyk7XG4gICAgICAgIFx0aW1ndXIudXBsb2FkKHZtLmZpbGUpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICBcdFx0cHJvZmlsZVNlcnZpY2Uuc2F2ZUF2YXRhckxpbmsobW9kZWxbMF0ubGluaywgJHJvb3RTY29wZS5wcm9maWxlLnVzZXJOYW1lKTtcbiAgICAgICAgXHRcdE1hdGVyaWFsaXplLnRvYXN0KCdZb3VyIGF2YXRhciB3YXMgdXBsb2FkZWQnLCA0MDAwKTtcblxuICAgICAgICBcdFx0JHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgIFx0XHRcdCRzdGF0ZS5nbygnaG9tZScpO1xuICAgICAgICBcdFx0fSwgMTAwMCk7XG4gICAgICAgIFx0fSk7XG5cbiAgICAgICAgfVxuXG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuY29udHJvbGxlcignQ2hhbmdlUGFzc3dvcmRDb250cm9sbGVyJywgQ2hhbmdlUGFzc3dvcmRDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIENoYW5nZVBhc3N3b3JkQ29udHJvbGxlcigkc2NvcGUsICR0aW1lb3V0LCAkc3RhdGUsIEF1dGhXcmFwcGVyKSB7XG5cbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgdm0uc3VibWl0Q2hhbmdlUGFzc3dvcmQgPSBzdWJtaXRDaGFuZ2VQYXNzd29yZDtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBzdWJtaXRDaGFuZ2VQYXNzd29yZCgpIHtcblxuICAgICAgICAgICAgaWYgKCRzY29wZS5wd0NoYW5nZUZvcm0uJHZhbGlkKSB7XG5cbiAgICAgICAgICAgICAgICBBdXRoV3JhcHBlci4kY2hhbmdlUGFzc3dvcmQoe1xuICAgICAgICAgICAgICAgICAgICBlbWFpbDogQXV0aFdyYXBwZXIuJGdldEF1dGgoKS5wYXNzd29yZC5lbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgb2xkUGFzc3dvcmQ6IHZtLmlucHV0Q3VycmVudFBhc3N3b3JkLFxuICAgICAgICAgICAgICAgICAgICBuZXdQYXNzd29yZDogdm0uaW5wdXROZXdQYXNzd29yZFxuICAgICAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgTWF0ZXJpYWxpemUudG9hc3QoJ1lvdXIgcGFzc3dvcmQgd2FzIGNoYW5nZWQuJywgNDAwMCk7XG4gICAgICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGlmIChlcnJvci5jb2RlID09PSAnSU5WQUxJRF9QQVNTV09SRCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLnNob3dDaGFuZ2VQYXNzd29yZE1lc3NhZ2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cblxuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuY29udHJvbGxlcignSG9tZUNvbnRyb2xsZXInLCBIb21lQ29udHJvbGxlcik7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBIb21lQ29udHJvbGxlcigkc2NvcGUsICR0aW1lb3V0KSB7XG5cbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdMZWFkZXJib2FyZENvbnRyb2xsZXInLCBMZWFkZXJib2FyZENvbnRyb2xsZXIpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gTGVhZGVyYm9hcmRDb250cm9sbGVyKCRxLCAkdGltZW91dCwgJGZpcmViYXNlQXJyYXksIHByb2ZpbGVTZXJ2aWNlLCBGSVJFQkFTRURBVEEpIHtcblxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgXHR2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIGFjdGl2YXRlKCk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xuICAgICAgICAgICAgZ2V0UHJvZmlsZVNjb3JlcygpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLnByb2ZpbGVTY29yZURhdGEgPSBtb2RlbDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBwcm9maWxlU2VydmljZS5nZXRBdmF0YXJEYXRhKCkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgdm0uYXZhdGFyRGF0YSA9IG1vZGVsO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRQcm9maWxlU2NvcmVzKCkge1xuXG4gICAgICAgIFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgXHR2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgXHR2YXIgcHJvZmlsZVNjb3JlRGF0YSA9ICRmaXJlYmFzZUFycmF5KFxuICAgICAgICBcdFx0cmVmXG4gICAgICAgIFx0XHRcdC5jaGlsZCgnYmFkZ2VzJylcbiAgICAgICAgXHQpO1xuXG4gICAgICAgIFx0cHJvZmlsZVNjb3JlRGF0YS4kbG9hZGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICBcdFx0ZGVmZXJyZWQucmVzb2x2ZShwcm9maWxlU2NvcmVEYXRhKTtcbiAgICAgICAgXHR9KTtcblxuICAgICAgICBcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1Byb2ZpbGVDb250cm9sbGVyJywgUHJvZmlsZUNvbnRyb2xsZXIpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gUHJvZmlsZUNvbnRyb2xsZXIoJHNjb3BlLCAkc3RhdGVQYXJhbXMsICRxLCAkdGltZW91dCwgJHN0YXRlLCAkZmlyZWJhc2VBcnJheSwgYXV0aFNlcnZpY2UsIHByb2ZpbGVTZXJ2aWNlLCBldmVudFNlcnZpY2UpIHtcblxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIFxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xuXG4gICAgICAgICAgICBwcm9maWxlU2VydmljZS5nZXRVc2VyRGF0YSgkc3RhdGVQYXJhbXMudXNlcm5hbWUpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLnByb2ZpbGVEYXRhID0gbW9kZWw7XG5cbiAgICAgICAgICAgICAgICBwcm9maWxlU2VydmljZS5nZXRUb3VybmFtZW50SGlzdG9yeSh2bS5wcm9maWxlRGF0YSkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciB0b3VybmFtZW50SGlzdG9yeURhdGEgPSBtb2RlbDtcbiAgICAgICAgICAgICAgICAgICAgdm0uZXZlbnRTdGFuZGluZ3MgPSBwcm9maWxlU2VydmljZS5nZXRUb3VybmFtZW50U3RhbmRpbmdzKHRvdXJuYW1lbnRIaXN0b3J5RGF0YSwgJHN0YXRlUGFyYW1zLnVzZXJuYW1lKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICQoJy5jb2xsYXBzaWJsZScpLmNvbGxhcHNpYmxlKHtcbiAgICAgICAgICAgICAgICAgICAgYWNjb3JkaW9uOiB0cnVlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcHJvZmlsZVNlcnZpY2UuZ2V0QXZhdGFyRGF0YSgpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLmF2YXRhckRhdGEgPSBtb2RlbDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBwcm9maWxlU2VydmljZS5nZXRCYWRnZXNEYXRhKCRzdGF0ZVBhcmFtcy51c2VybmFtZSkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgdm0uYmFkZ2VzRGF0YSA9IG1vZGVsO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5zZXJ2aWNlKCdwcm9maWxlU2VydmljZScsIHByb2ZpbGVTZXJ2aWNlKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIHByb2ZpbGVTZXJ2aWNlKCRyb290U2NvcGUsICRxLCAkZmlyZWJhc2VBcnJheSwgJGZpcmViYXNlT2JqZWN0LCBldmVudFNlcnZpY2UsIEZJUkVCQVNFREFUQSkge1xuXG4gICAgXHR0aGlzLmdldEF2YXRhckRhdGEgPSBnZXRBdmF0YXJEYXRhO1xuICAgICAgICB0aGlzLmdldEJhZGdlc0RhdGEgPSBnZXRCYWRnZXNEYXRhO1xuICAgIFx0dGhpcy5nZXRUb3VybmFtZW50SGlzdG9yeSA9IGdldFRvdXJuYW1lbnRIaXN0b3J5O1xuICAgICAgICB0aGlzLmdldFRvdXJuYW1lbnRTdGFuZGluZ3MgPSBnZXRUb3VybmFtZW50U3RhbmRpbmdzO1xuICAgICAgICB0aGlzLmdldFVzZXJEYXRhID0gZ2V0VXNlckRhdGE7XG4gICAgICAgIHRoaXMuc2F2ZUF2YXRhckxpbmsgPSBzYXZlQXZhdGFyTGluaztcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0QXZhdGFyRGF0YSgpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcblxuICAgICAgICAgICAgdmFyIGF2YXRhckRhdGEgPSAkZmlyZWJhc2VPYmplY3QoXG4gICAgICAgICAgICAgICAgcmVmXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnYXZhdGFycycpXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBhdmF0YXJEYXRhLiRsb2FkZWQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShhdmF0YXJEYXRhKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0QmFkZ2VzRGF0YShpbnB1dFVzZXIpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcblxuICAgICAgICAgICAgdmFyIGJhZGdlc0RhdGEgPSAkZmlyZWJhc2VPYmplY3QoXG4gICAgICAgICAgICAgICAgcmVmXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnYmFkZ2VzJylcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkKGlucHV0VXNlcilcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGJhZGdlc0RhdGEuJGxvYWRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGJhZGdlc0RhdGEpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRUb3VybmFtZW50SGlzdG9yeShpbnB1dFVzZXJEYXRhKSB7XG5cbiAgICAgICAgXHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICBcdHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcblxuICAgICAgICBcdC8vIExvb3AgdGhyb3VnaCBlYWNoIGV2ZW50IGluIHRoZSBwbGVkZ2VkVG8gb2JqZWN0LlxuICAgICAgICBcdHZhciBldmVudHNBcnJheSA9IFtdO1xuICAgICAgICBcdGZvciAodmFyIGtleSBpbiBpbnB1dFVzZXJEYXRhLnBsZWRnZWRUbykge1xuICAgICAgICBcdFx0ZXZlbnRzQXJyYXkucHVzaChrZXkpO1xuICAgICAgICBcdH1cblxuICAgICAgICBcdGRlZmVycmVkLnJlc29sdmUoZXZlbnRzQXJyYXkpO1xuXG4gICAgICAgIFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldFRvdXJuYW1lbnRTdGFuZGluZ3MoaW5wdXRUb3VybmFtZW50SGlzdG9yeSwgaW5wdXRVc2VyKSB7XG5cbiAgICAgICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcblxuICAgICAgICAgICAgLy8gTG9vcCB0aHJvdWdoIGVhY2ggZXZlbnQgaW4gdGhlIHVzZXIncyBoaXN0b3J5LlxuICAgICAgICAgICAgdmFyIGV2ZW50U3RhbmRpbmdzID0gW107XG4gICAgICAgICAgICBpbnB1dFRvdXJuYW1lbnRIaXN0b3J5LmZvckVhY2goZnVuY3Rpb24oZXZlbnQpIHtcblxuICAgICAgICAgICAgICAgIGV2ZW50U2VydmljZS5nZXRFdmVudFByb3BlcnRpZXMoZXZlbnQpLnRoZW4oZnVuY3Rpb24oZXZlbnRQcm9wZXJ0aWVzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgZXZlbnRQcm9wZXJ0aWVzLiRsb2FkZWQoKS50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBJZiBjb25jbHVkZWQsIGdldCB0aGUgdXNlcidzIHN0YW5kaW5nLlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50UHJvcGVydGllcy5zdGF0ZSA9PT0gJ2NvbmNsdWRlZCcpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBldmVudFN0YW5kaW5nRGF0YSA9ICRmaXJlYmFzZU9iamVjdChcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVmXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2hpbGQoJ3N0YW5kaW5ncycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuY2hpbGQoZXZlbnQpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U3RhbmRpbmdEYXRhLiRsb2FkZWQoKS50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudFN0YW5kaW5nRGF0YVtpbnB1dFVzZXJdKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U3RhbmRpbmdzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGV2ZW50UHJvcGVydGllcy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZW1pZXI6IGV2ZW50UHJvcGVydGllcy5wcmVtaWVyID8gdHJ1ZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnROYW1lOiBldmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogJ2NvbmNsdWRlZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGV2ZW50UHJvcGVydGllcy5jb2xvcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogZXZlbnRTdGFuZGluZ0RhdGFbaW5wdXRVc2VyXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTdGFuZGluZ3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZXZlbnRQcm9wZXJ0aWVzLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJlbWllcjogZXZlbnRQcm9wZXJ0aWVzLnByZW1pZXIgPyB0cnVlIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG9ydE5hbWU6IGV2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlOiAnY29uY2x1ZGVkJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogZXZlbnRQcm9wZXJ0aWVzLmNvbG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiAtMVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXZlbnRQcm9wZXJ0aWVzLnN0YXRlID09PSAnaW5wcm9ncmVzcycgfHwgZXZlbnRQcm9wZXJ0aWVzLnN0YXRlID09PSAndXBjb21pbmcnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFN0YW5kaW5ncy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogZXZlbnRQcm9wZXJ0aWVzLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZW1pZXI6IGV2ZW50UHJvcGVydGllcy5wcmVtaWVyID8gdHJ1ZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3J0TmFtZTogZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBldmVudFByb3BlcnRpZXMuY29sb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlOiBldmVudFByb3BlcnRpZXMuc3RhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZXZlbnRTdGFuZGluZ3M7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldFVzZXJEYXRhKGlucHV0VXNlcikge1xuXG4gICAgICAgIFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgXHR2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgXHR2YXIgdXNlcnNEYXRhID0gJGZpcmViYXNlQXJyYXkoXG4gICAgICAgIFx0XHRyZWZcbiAgICAgICAgXHRcdFx0LmNoaWxkKCd1c2VycycpXG4gICAgICAgIFx0KTtcblxuICAgICAgICBcdHVzZXJzRGF0YS4kbG9hZGVkKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIFx0XHR1c2Vyc0RhdGEuZm9yRWFjaChmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgIFx0XHRcdGlmICh1c2VyLnVzZXJOYW1lID09PSBpbnB1dFVzZXIpIHtcbiAgICAgICAgXHRcdFx0XHRkZWZlcnJlZC5yZXNvbHZlKHVzZXIpO1xuICAgICAgICBcdFx0XHR9XG4gICAgICAgIFx0XHR9KTtcblxuICAgICAgICBcdH0pO1xuXG4gICAgICAgIFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEZJWE1FOiBNYWtlIHRoaXMgc2VydmVyLXNpZGUuXG4gICAgICAgIGZ1bmN0aW9uIHNhdmVBdmF0YXJMaW5rKGlucHV0TGluaywgaW5wdXRVc2VyKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcblxuICAgICAgICAgICAgdmFyIGF2YXRhckRhdGEgPSAkZmlyZWJhc2VPYmplY3QoXG4gICAgICAgICAgICAgICAgcmVmXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnYXZhdGFycycpXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBhdmF0YXJEYXRhLiRsb2FkZWQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgYXZhdGFyRGF0YVtpbnB1dFVzZXJdID0gaW5wdXRMaW5rO1xuICAgICAgICAgICAgICAgIGF2YXRhckRhdGEuJHNhdmUoKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ1JlZ0NvbnRyb2xsZXInLCBSZWdDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIFJlZ0NvbnRyb2xsZXIoJHNjb3BlLCAkcm9vdFNjb3BlLCAkdGltZW91dCwgJHdpbmRvdywgJHN0YXRlLCAkZmlyZWJhc2VPYmplY3QsIGF1dGhTZXJ2aWNlLCBBdXRoV3JhcHBlcikge1xuXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5sb2dpblRvQWNjb3VudCA9IGxvZ2luVG9BY2NvdW50O1xuICAgICAgICB2bS5wYXNzd29yZFJlc2V0ID0gcGFzc3dvcmRSZXNldDtcbiAgICAgICAgdm0uc3VibWl0TmV3QWNjb3VudCA9IHN1Ym1pdE5ld0FjY291bnQ7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gbG9naW5Ub0FjY291bnQoKSB7XG5cbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmxvZ2luVG9BY2NvdW50KHZtLmxvZ2luRW1haWwsIHZtLmxvZ2luUGFzc3dvcmQpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuXG4gICAgICAgICAgICAgICAgdm0uc2hvd0ludmFsaWRVc2VyRXJyb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2bS5zaG93SW52YWxpZFBhc3N3b3JkRXJyb3IgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIGlmIChtb2RlbCA9PT0gJ0xPR0lOX1NVQ0NFU1MnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lJyk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vZGVsID09PSAnSU5WQUxJRF9VU0VSJykge1xuICAgICAgICAgICAgICAgICAgICB2bS5zaG93SW52YWxpZFVzZXJFcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vZGVsID09PSAnSU5WQUxJRF9QQVNTV09SRCcpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uc2hvd0ludmFsaWRQYXNzd29yZEVycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBwYXNzd29yZFJlc2V0KCkge1xuXG4gICAgICAgICAgICBpZiAoIXZtLmxvZ2luRW1haWwpIHtcbiAgICAgICAgICAgICAgICB2bS5zaG93UGFzc3dvcmRSZXNldEVtYWlsTWVzc2FnZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBBdXRoV3JhcHBlci4kcmVzZXRQYXNzd29yZCh7XG4gICAgICAgICAgICAgICAgZW1haWw6IHZtLmxvZ2luRW1haWxcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgdm0uc2hvd1Bhc3N3b3JkUmVzZXRFbWFpbE1lc3NhZ2UgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBNYXRlcmlhbGl6ZS50b2FzdCgnQSBwYXNzd29yZCByZXNldCBlbWFpbCBoYXMgYmVlbiBzZW50IHRvICcgKyB2bS5sb2dpbkVtYWlsICsgJy4nLCA0MDAwKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzdWJtaXROZXdBY2NvdW50KCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBEb2VzIHRoZSB1c2VyIGV4aXN0PyBJZiBzbywgc2hvdyBhbiBlcnJvciBtZXNzYWdlLlxuICAgICAgICAgICAgYXV0aFNlcnZpY2UuY2hlY2tJZlVzZXJFeGlzdHModm0ubmV3VXNlcm5hbWUpLnRoZW4oZnVuY3Rpb24odXNlckV4aXN0cykge1xuXG4gICAgICAgICAgICAgICAgdm0uc2hvd0R1cGxpY2F0ZVVzZXJFcnJvciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZtLnNob3dFbWFpbFRha2VuRXJyb3IgPSBmYWxzZTtcblxuICAgICAgICAgICAgICAgIGlmICh1c2VyRXhpc3RzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdm0uc2hvd0R1cGxpY2F0ZVVzZXJFcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcblxuICAgICAgICAgICAgICAgIC8vIFRyeSB0byBjcmVhdGUgdGhlIG5ldyB1c2VyLlxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgYXV0aFNlcnZpY2UuY3JlYXRlTmV3VXNlcih2bS5uZXdFbWFpbCwgdm0ubmV3UGFzc3dvcmQsIHZtLm5ld1VzZXJuYW1lKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1vZGVsID09PSAnRU1BSUxfVEFLRU4nKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5zaG93RW1haWxUYWtlbkVycm9yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobW9kZWwgPT09ICdBQ0NPVU5UX0NSRUFURUQnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3Byb2ZpbGUnLCB7dXNlcm5hbWU6IHZtLm5ld1VzZXJuYW1lfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5maWx0ZXIoJ29yZGVyT2JqZWN0QnknLCBvcmRlck9iamVjdEJ5KTtcblxuICAgIGZ1bmN0aW9uIG9yZGVyT2JqZWN0QnkoKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihpdGVtcywgZmllbGQsIHJldmVyc2UpIHtcbiAgICAgICAgICAgIHZhciBmaWx0ZXJlZCA9IFtdO1xuXG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goaXRlbXMsIGZ1bmN0aW9uKGl0ZW0sIGtleSkge1xuICAgICAgICAgICAgICAgIGl0ZW0ua2V5ID0ga2V5O1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkLnB1c2goaXRlbSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZmlsdGVyZWQuc29ydChmdW5jdGlvbiAoYSwgYikge1xuICAgICAgICAgICAgICAgIHJldHVybiAoYVtmaWVsZF0gPiBiW2ZpZWxkXSA/IDEgOiAtMSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYocmV2ZXJzZSkgZmlsdGVyZWQucmV2ZXJzZSgpO1xuXG4gICAgICAgICAgICByZXR1cm4gZmlsdGVyZWQ7XG4gICAgICAgIH07XG4gICAgfVxuXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==