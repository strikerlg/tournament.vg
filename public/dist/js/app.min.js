(function() {
    'use strict';

    angular
        .module('vg.app', [
            /* Angular modules */
            'ngAnimate',
            /* App modules */
            /* Third-party modules */
            'ui.router',
            'firebase',
            'validation.match',
            'ordinal',
            'ngFileUpload',
            'ngImgur'
        ]);
})();;(function() {
	'use strict';

	angular
		.module('vg.app')
		.constant('FIREBASEDATA', {
			'FBURL': 'https://wolfscontests.firebaseio.com'
		})
		.config(config);

	/* @ngInject */
	function config($stateProvider, $urlRouterProvider) {

		// Redirect any unmatched URL to /.
		$urlRouterProvider.otherwise('/');

		$stateProvider
		    .state('home', {
		    	url: '/',
		    	templateUrl: 'app/home/home.htm',
		    	controller: 'HomeController as home'
		    })

		    .state('registerOrLogin', {
		    	url: '/registerOrLogin',
		    	templateUrl: '/app/home/reg.htm',
		    	controller: 'RegController as reg'
		    })

		    .state('profile', {
		    	url: '/profile/:username',
		    	templateUrl: '/app/home/profile.htm',
		    	controller: 'ProfileController as profile'
		    })

		    .state('leaderboard', {
		    	url: '/leaderboard',
		    	templateUrl: '/app/home/leaderboard.htm',
		    	controller: 'LeaderboardController as leaderboard'
		    })

		    .state('event', {
		    	url: '/event/:eventName/main',
		    	templateUrl: '/app/event/main.htm',
		    	controller: 'EventMainController as event'
		    })

		    .state('customizeAvatar', {
		    	url: '/customizeAvatar',
		    	templateUrl: '/app/home/avatar.htm',
		    	controller: 'AvatarController as avatar',

		    	resolve: {
		    		'currentAuth': ['AuthWrapper', function(AuthWrapper) {
		    			return AuthWrapper.$requireAuth();
		    		}]
		    	}
		    })

		    .state('changePassword', {
		    	url: '/changePassword',
		    	templateUrl: '/app/home/changePassword.htm',
		    	controller: 'ChangePasswordController as pwchange',

		    	resolve: {
		    		'currentAuth': ['AuthWrapper', function(AuthWrapper) {
		    			return AuthWrapper.$requireAuth();
		    		}]
		    	}
		    });
	}
	config.$inject = ["$stateProvider", "$urlRouterProvider"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .run(run);

    function run($rootScope, $location, $state, $firebaseObject, AuthWrapper, FIREBASEDATA) {

        $rootScope.$on('$stateChangeError', function(event, toState, toParams, fromState, fromParams, error) {
            if (error === 'AUTH_REQUIRED') {
                $state.go('registerOrLogin');
            }
        });

        $rootScope.$on('$stateChangeSuccess', function() {

            // If user is logged in, download their profile data to an object in $rootScope.
            // FIXME: We shouldn't need to do this every successful state change.
            if (AuthWrapper.$getAuth()) {
                
                var authData = AuthWrapper.$getAuth();
                var ref = new Firebase(FIREBASEDATA.FBURL);

                var profileData = $firebaseObject(ref.child('users').child(authData.uid));
                profileData.$bindTo($rootScope, 'profile').then(function(unbind) {
                    $rootScope.unbindFunction = unbind;
                });

            }

        });

    }
    run.$inject = ["$rootScope", "$location", "$state", "$firebaseObject", "AuthWrapper", "FIREBASEDATA"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('authService', authService);

    /* @ngInject */
    function authService($q, $rootScope, $state, $window, $timeout, $firebaseObject, AuthWrapper, FIREBASEDATA) {
        
        this.testData = 'hello world!';

    	this.checkIfUserExists = checkIfUserExists;
    	this.createNewUser = createNewUser;
        this.loginToAccount = loginToAccount;
        this.logOut = logOut;

    	///////////////////

    	function checkIfUserExists(inputUsername) {

    		var deferred = $q.defer();

    		var doesUserExist = false;
    		var usersRef = new $window.Firebase(FIREBASEDATA.FBURL + '/users');

    		usersRef.once('value', function(dataSnapshot) {

                $timeout(function() {
                    dataSnapshot.forEach(function(user) {
                        if (user.val().userName === inputUsername) {
                            doesUserExist = true;
                        }
                    });

                    deferred.resolve(doesUserExist);
                });

    		});

    		return deferred.promise;

    	}

    	function createNewUser(inputEmail, inputPassword, inputUsername) {

            var deferred = $q.defer();

    		AuthWrapper.$createUser({
    			email: inputEmail,
    			password: inputPassword
    		}).then(function(userData) {

    			// Create a data entry for the new username.
    			new Firebase(FIREBASEDATA.FBURL).child('users/' + userData.uid).set({

    				userName: inputUsername,
    				role: 'User'

    			}, function(errorData) {
    				console.error(errorData);
                    return errorData.code;
    			});

                // Create a data entry for the user's avatar.
                new Firebase(FIREBASEDATA.FBURL).child('avatars').child(inputUsername).set('http://api.adorable.io/avatars/42/' + inputUsername);

    			// Log the user in.
    			AuthWrapper.$authWithPassword({
    				email: inputEmail,
    				password: inputPassword
    			}).then(function() {
                    deferred.resolve('ACCOUNT_CREATED');
                });

    		}).catch(function(errorData) {

    			console.error(errorData);

    			if (errorData.code === 'EMAIL_TAKEN') {
                    deferred.resolve(errorData.code);
    			}

    		});

            return deferred.promise;

    	}

        function loginToAccount(inputEmail, inputPassword) {

            var deferred = $q.defer();

            AuthWrapper.$authWithPassword({
                email: inputEmail,
                password: inputPassword
            }).then(function(authData) {

                deferred.resolve('LOGIN_SUCCESS');

            }).catch(function(errorData) {

                if (errorData.code === 'INVALID_USER') {
                    deferred.resolve('INVALID_USER');
                } else if (errorData.code === 'INVALID_PASSWORD') {
                    deferred.resolve('INVALID_PASSWORD');
                }

            });

            return deferred.promise;

        }

        function logOut() {
            AuthWrapper.$unauth();
            $rootScope.unbindFunction();
        }

    }
    authService.$inject = ["$q", "$rootScope", "$state", "$window", "$timeout", "$firebaseObject", "AuthWrapper", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .factory('AuthWrapper', AuthWrapper);

    /* @ngInject */
    function AuthWrapper($firebaseAuth, FIREBASEDATA) {

        var ref = new Firebase(FIREBASEDATA.FBURL);
        return $firebaseAuth(ref);

    }
    AuthWrapper.$inject = ["$firebaseAuth", "FIREBASEDATA"];
    
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('eventService', eventService);

    /* @ngInject */
    function eventService($q, $filter, $firebaseObject, $firebaseArray, FIREBASEDATA) {

        var _eventProperties = null;
        var _gameList = null;
        var _leaderboardLength = null;
        var _summarizedLeaderboard = null;
        var _teamList = null;

        this.createMultiGameFinalStandings = createMultiGameFinalStandings;
        this.getEventProperties = getEventProperties;
        this.getEventPropertiesObject = getEventPropertiesObject;
        this.getGameData = getGameData;
        this.getGameListObject = getGameListObject;
        this.getGamesList = getGamesList;
        this.getLeaderboardLengthValue = getLeaderboardLengthValue;
        this.getMultiGameLeaderboard = getMultiGameLeaderboard;
        this.getPlayerScores = getPlayerScores;
        this.getSingleGameLeaderboard = getSingleGameLeaderboard;
        this.getSummarizedLeaderboardObject = getSummarizedLeaderboardObject;
        this.getTeamListObject = getTeamListObject;
        this.loadEventProperties = loadEventProperties;

        ////////////////

        function createMultiGameFinalStandings(inputEvent) {

            // Calculate the final standings of the event.
            getMultiGameLeaderboard(inputEvent).then(function then(model) {

                var ref = new Firebase(FIREBASEDATA.FBURL);
                var inputEventStandings = $firebaseObject(
                    ref
                        .child('standings')
                        .child(inputEvent)
                );

                inputEventStandings.$loaded().then(function() {

                    model.forEach(function(standing) {
                        inputEventStandings[standing.key] = standing.position;
                    });

                    inputEventStandings.$save();

                });

            });

        }

        function getEventProperties(inputEvent) {

            var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var eventProperties = $firebaseObject(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('properties')
        	);

            deferred.resolve(eventProperties);

        	return deferred.promise;

        }

        function getEventPropertiesObject() {
            return _eventProperties;
        }

        function getFirstPlaceScores() {

            _gameList.forEach(function(game) {

                // If there are scores, get the top one.
                if (game.scores) {

                    var scoresArray = $.map(game.scores, function(el) { return el; });
                    scoresArray = $filter('orderBy')(scoresArray, '-score');
                    game.firstScore = scoresArray[0];

                }

            });

        }

        function getGameData(inputEvent, inputGame) {

            var deferred = $q.defer();

            var ref = new Firebase(FIREBASEDATA.FBURL);

            getGamesList(inputEvent).then(function(gamesList) {

                gamesList.forEach(function(game) {

                    if (game.camelName === inputGame) {
                        deferred.resolve(game);
                    }

                });

            });

            return deferred.promise;

        }

        function getGameListObject() {
            return _gameList;
        }

        function getGamesList(inputEvent) {

        	var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var gamesList = $firebaseArray(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('activeGames')
        	);

        	gamesList.$loaded().then(function() {
        		deferred.resolve(gamesList);
        	});

        	return deferred.promise;

        }

        function getLeaderboardLengthValue() {
            return _leaderboardLength;
        }

        function getMultiGameLeaderboard(inputEvent) {

        	var deferred = $q.defer();

        	// We need to get the top 12 players for every game.
        	var playerPoints = {};

        	getGamesList(inputEvent).then(function then(model) {

        		var gamesList = model;
        		gamesList.forEach(function(game) {

        			if (game.scores) {

        				// Convert the game's scores to an array.
        				var scoresArray = $.map(game.scores, function(el) { return el; });
        				scoresArray = $filter('orderBy')(scoresArray, '-score');

        				var totalAward = 12;

        				// Iterate through the top scores awarding points.
        				for (var i = 0; i < scoresArray.length; i++) {

        					if (!playerPoints[scoresArray[i].userName]) {
        						playerPoints[scoresArray[i].userName] = {
        							points: 0
        						};
        					}

        					playerPoints[scoresArray[i].userName].points += totalAward;

        					if (totalAward > 0) {
        						totalAward -= 1;
        					}

        				}

        			}

        		});

        		// Find and resolve ties.
        		playerPoints = $filter('orderObjectBy')(playerPoints, 'points', true);
                var haveBottomScorersFloor = false;
                var floorRange = 0;
        		for (var i = 0; i < playerPoints.length; i += 1) {

        			if (playerPoints[i-1] && playerPoints[i].points && playerPoints[i-1].points) {

        				if (playerPoints[i].points === playerPoints[i-1].points) {
        					playerPoints[i].position = playerPoints[i-1].position;
        				} else {
        					playerPoints[i].position = (i+1);
        				}

        			} else {

        				if (i === 0) {
        					playerPoints[i].position = 1;
        				} else {

                            if (!haveBottomScorersFloor) {
                                // Get count of players in one position higher.
                                var getScoreCountOf = playerPoints[i-1].points;

                                for (var j = 0; j < playerPoints.length; j += 1) {
                                    if (playerPoints[j].points === getScoreCountOf) {
                                        floorRange += 1;
                                    }
                                }

                                haveBottomScorersFloor = true;
                            }

        					playerPoints[i].position = (playerPoints.length + 1) - floorRange;
        				}

        			}

        		}

        		deferred.resolve(playerPoints);

        	});

			return deferred.promise;

        }

        function getSingleGameLeaderboard(inputEvent) {

            var deferred = $q.defer();

            var ref = new Firebase(FIREBASEDATA.FBURL);
            var leaderboardData = $firebaseArray(
                ref
                    .child('contests')
                    .child(inputEvent)
                    .child('scores')
            );

            deferred.resolve(leaderboardData);

            return deferred.promise;

        }

        function getSummarizedLeaderboardObject() {
            return _summarizedLeaderboard;
        }

        function getTeamListObject() {
            return _teamList;
        }

        function getPlayerScores(inputEvent, inputGamesList, inputPlayer) {

            var deferred = $q.defer();

            var displayScores = [];

            // Iterate through every game.
            inputGamesList.forEach(function(game) {

                if (game.scores) {

                    // Convert the game's scores to an array.
                    var scoresArray = $.map(game.scores, function(el) { return el; });
                    scoresArray = $filter('orderBy')(scoresArray, '-score');

                    var totalAward = 12;

                    // Iterate through the scores starting from the top and find our user.
                    for (var i = 0; i < scoresArray.length; i++) {

                        // Found our player.
                        if (scoresArray[i].userName === inputPlayer) {

                            var newScoreObject = game;
                            newScoreObject.position = i+1;
                            newScoreObject.score = scoresArray[i].score;
                            newScoreObject.pointsEarned = totalAward;
                            newScoreObject.inpUrl = scoresArray[i].inpUrl ? scoresArray[i].inpUrl : null;
                            newScoreObject.twitchUrl = scoresArray[i].twitchUrl ? scoresArray[i].twitchUrl : null;
                            newScoreObject.mameVersion = scoresArray[i].mameVersion ? scoresArray[i].mameVersion : null;

                            displayScores.push(newScoreObject);
                            totalAward = 12;
                            break;

                        } else {
                            if (totalAward > 0) {
                                totalAward -= 1;
                            }
                        }

                    }

                }

            });

            deferred.resolve(displayScores);

            return deferred.promise;

        }

        function loadEventProperties(inputEvent) {

            var ref = new Firebase(FIREBASEDATA.FBURL);
            var inputEventProperties = $firebaseObject(
                ref
                    .child('contests')
                    .child(inputEvent)
                    .child('properties')
            );

            inputEventProperties.$loaded().then(function() {
                _eventProperties = inputEventProperties;

                // If this is a multigame event, get the data needed for multigame components.
                if (_eventProperties.format.multiGame) {

                    getGamesList(inputEvent).then(function then(model) {
                        _gameList = model;
                        getFirstPlaceScores();
                    });

                    getMultiGameLeaderboard(inputEvent).then(function then(model) {
                        var leaderboard = model;
                        _leaderboardLength = leaderboard.length;
                        _summarizedLeaderboard = leaderboard.slice(0, 8);
                    });

                // If this is a single game event, get the data needed for single game components.
                } else {

                    getSingleGameLeaderboard(inputEvent).then(function then(model) {
                        var leaderboard = model;
                        _leaderboardLength = leaderboard.length;
                        _summarizedLeaderboard = leaderboard;
                    });

                }

                // If this is a team-based event, get the data needed for team event components.
                if (_eventProperties.format.teamBased) {

                    teamService.getTeamList(vm.eventName).then(function then(model) {
                        _teamList = model;
                    });

                }

            });

        }

    }
    eventService.$inject = ["$q", "$filter", "$firebaseObject", "$firebaseArray", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('EventMainController', EventMainController);

    /* @ngInject */
    function EventMainController($scope, $filter, $stateParams, $state, $timeout, $firebaseArray, eventService, authService, profileService, teamService, FIREBASEDATA) {

        /* jshint validthis: true */
        var vm = this;

        vm.eventName = $stateParams.eventName;

        vm.createTeam = createTeam;
        vm.determinePoints = determinePoints;
        vm.getFirstPlaceScores = getFirstPlaceScores;
        vm.goToPlayerProfile = goToPlayerProfile;
        vm.openBadgesModal = openBadgesModal;
        vm.openGameModal = openGameModal;
        vm.openGameModalFromPlayerModal = openGameModalFromPlayerModal;
        vm.openManagementModal = openManagementModal;
        vm.openMultiGameLeaderboardModal = openMultiGameLeaderboardModal;
        vm.openPlayerModal = openPlayerModal;
        vm.openPlayerModalFromGameModal = openPlayerModalFromGameModal;
        vm.openPlayerModalFromLeaderboardModal = openPlayerModalFromLeaderboardModal;
        vm.openRulesModal = openRulesModal;

        initEvent();

        /////////////////////////////////

        function closeModal() {
            angular.element('.modal').closeModal();
        }

        function createTeam() {
            teamService.createTeam(vm.eventName, vm.newTeam).then(function() {
                Materialize.toast('Team ' + vm.newTeam.shortName + ' created.', 4000);
                vm.newTeam = null;
            });
        }

        function determinePoints(inputScoreData, inputIndex) {

            var userGamePoints;

            // No position greater than 12 gets points.
            if (inputIndex > 11) {
                userGamePoints = 0;
                return userGamePoints;
            }

            userGamePoints = 12 - inputIndex;

            var sortedScores = $filter('orderBy')(vm.gameScores, '-score');

            // Am I tied with the person above me? If so, match their points.
            if (sortedScores[inputIndex - 1]) {

                if (sortedScores[inputIndex - 1].score === inputScoreData.score) {
                    userGamePoints += 1;
                }
            }

            return userGamePoints;

        }

        function getFirstPlaceScores() {

            vm.gameList.forEach(function(game) {

                // If there are scores, get the top one.
                if (game.scores) {

                    var scoresArray = $.map(game.scores, function(el) { return el; });
                    scoresArray = $filter('orderBy')(scoresArray, '-score');
                    game.firstScore = scoresArray[0];

                }

            });

        }

        function goToPlayerProfile(inputPlayer) {

            closeModal();
            $state.go('profile', {username: inputPlayer});

        }

        function initEvent() {

            eventService.loadEventProperties(vm.eventName);

            $scope.$watch(function() { return eventService.getEventPropertiesObject(); }, function(model) {
                vm.eventProperties = model;
            }, true);

            $scope.$watch(function() { return eventService.getGameListObject(); }, function(model) {
                vm.gameList = model;
            }, true);

            $scope.$watch(function() { return eventService.getLeaderboardLengthValue(); }, function(model) {
                vm.leaderboardLength = model;
            }, true);

            $scope.$watch(function() { return eventService.getSummarizedLeaderboardObject(); }, function(model) {
                vm.summarizedLeaderboard = model;
            }, true);

            $scope.$watch(function() { return eventService.getTeamListObject(); }, function(model) {
                vm.teamList = model;
            }, true);

            profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });

        }

        function openBadgesModal() {

            angular.element('#badgesModal').openModal();
            angular.element('#badgesModalContent').scrollTop(0);

        }

        function openGameModal(inputGameName) {

            var ref = new Firebase(FIREBASEDATA.FBURL);

            eventService.getGameData(vm.eventName, inputGameName).then(function then(model) {
                vm.gameData = model;

                vm.gameScores = $firebaseArray(
                    ref
                        .child('contests')
                        .child(vm.eventName)
                        .child('activeGames')
                        .child(vm.gameData.$id)
                        .child('scores')
                );
            });

            angular.element('#gameModal').openModal();
            angular.element('#gameModal').addClass('.open-modal');
            angular.element('#gameModalContent').scrollTop(0);

        }

        function openManagementModal() {

            angular.element('#managementModal').openModal();
            angular.element('#managementModalContent').scrollTop(0);

        }

        function openMultiGameLeaderboardModal() {

            eventService.getMultiGameLeaderboard(vm.eventName).then(function then(model) {
                vm.completeLeaderboard = model;
            });

            angular.element('#multiGameLeaderboardModal').openModal();
            angular.element('#multiGameLeaderboardModalContent').scrollTop(0);

        }

        function openPlayerModal(inputPlayer) {

            vm.focusPlayer = inputPlayer;

            eventService.getPlayerScores(vm.eventName, vm.gameList, vm.focusPlayer).then(function then(model) {
                vm.playerScores = model;
            });

            angular.element('#playerModal').openModal();
            angular.element('#playerModalContent').scrollTop(0);

        }

        function openGameModalFromPlayerModal(inputGame) {

            closeModal();
            $timeout(function() {
                openGameModal(inputGame);
            }, 450);

        }

        function openPlayerModalFromGameModal(inputPlayer) {

            closeModal();
            $timeout(function() {
                openPlayerModal(inputPlayer);
            }, 450);

        }

        function openPlayerModalFromLeaderboardModal(inputPlayer) {

            closeModal();
            $timeout(function() {
                openPlayerModal(inputPlayer);
            }, 450);

        }

        function openRulesModal() {
            angular.element('#rulesModal').openModal();
        }

    }
    EventMainController.$inject = ["$scope", "$filter", "$stateParams", "$state", "$timeout", "$firebaseArray", "eventService", "authService", "profileService", "teamService", "FIREBASEDATA"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('teamService', teamService);

    /* @ngInject */
    function teamService($q, $firebaseArray, $firebaseObject, FIREBASEDATA) {

    	this.createTeam = createTeam;
        this.getTeamList = getTeamList;

        ////////////////

        function createTeam(inputEvent, inputNewTeamProperties) {

        	var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var teamPool = $firebaseObject(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('teamPool')
        	);

        	teamPool.$loaded().then(function() {

        		teamPool[inputNewTeamProperties.shortName] = {
        			fullName: inputNewTeamProperties.formalName
        		};
        		teamPool.$save();
        		deferred.resolve();

        	});

        	return deferred.promise;

        }

        function getTeamList(inputEvent) {

        	var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var teamList = $firebaseArray(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('teamPool')
        	);

        	teamList.$loaded().then(function() {
        		deferred.resolve(teamList);
        	});

        	return deferred.promise;

        }
    }
    teamService.$inject = ["$q", "$firebaseArray", "$firebaseObject", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgGamesList', vgGamesList);

    /* @ngInject */
    function vgGamesList () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: GamesListController,
            controllerAs: 'vm',
            link: link,
            restrict: 'E',
            templateUrl: './app/eventComponents/gamesList.directive.htm',
            scope: {
            	data: '=',
            	openGameFunction: '='
            }
        };
        return directive;

        function link(scope, element, attrs) {
        }
    }

    /* @ngInject */
    function GamesListController() {
        /* jshint validthis: true */
    	var vm = this;
    }
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgMultiGameLeaderboard', vgMultiGameLeaderboard);

    /* @ngInject */
    function vgMultiGameLeaderboard () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: MultiGameLeaderboardController,
            controllerAs: 'vm',
            link: link,
            restrict: 'E',
            templateUrl: './app/eventComponents/multiGameLeaderboard.directive.htm',
            scope: {
            	data: '=',
                avatarData: '=',
            	completeLength: '=',
            	openPlayerFunction: '=',
                openLeaderboardFunction: '='
            }
        };
        return directive;

        function link(scope, element, attrs) {
        }
    }

    /* @ngInject */
    function MultiGameLeaderboardController() {
        /* jshint validthis: true */
    	var vm = this;
    }
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgSingleGameLeaderboard', vgSingleGameLeaderboard);

    /* @ngInject */
    function vgSingleGameLeaderboard () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: SingleGameLeaderboardController,
            controllerAs: 'vm',
            link: link,
            restrict: 'E',
            templateUrl: './app/eventComponents/singleGameLeaderboard.directive.htm',
            scope: {
            	data: '=',
                avatarData: '=',
            	completeLength: '=',
                openLeaderboardFunction: '='
            }
        };
        return directive;

        function link(scope, element, attrs) {
        }
    }

    /* @ngInject */
    function SingleGameLeaderboardController() {
        /* jshint validthis: true */
    	var vm = this;
    }
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgStickyMessage', vgStickyMessage);

    /* @ngInject */
    function vgStickyMessage () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: StickyMessageController,
            controllerAs: 'vm',
            link: link,
            restrict: 'E',
            templateUrl: './app/eventComponents/stickyMessage.directive.htm',
            scope: {
            	properties: '='
            }
        };
        return directive;

        function link(scope, element, attrs) {
        }
    }

    /* @ngInject */
    function StickyMessageController($timeout) {
        /* jshint validthis: true */
    	var vm = this;
    }
    StickyMessageController.$inject = ["$timeout"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('HeaderController', HeaderController);

    /* @ngInject */
    function HeaderController($timeout, $rootScope, $window, $state, authService) {

        /* jshint validthis: true */
        var vm = this;
        vm.logOut = logOut;

        activate();

        //////////////////////////

        function activate() {
            $timeout(function() {
                angular.element('.dropdown-button')
                    .dropdown({
                        inDuration: 300,
                        outDuration: 225,
                        constrain_width: false,
                        hover: false,
                        gutter: -114,
                        belowOrigin: true
                    });
            }, 400);
        }

        function logOut() {
            authService.logOut();
            $window.location.reload();
        }

    }
    HeaderController.$inject = ["$timeout", "$rootScope", "$window", "$state", "authService"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .filter('orderObjectBy', orderObjectBy);

    function orderObjectBy() {
        return function(items, field, reverse) {
            var filtered = [];

            angular.forEach(items, function(item, key) {
                item.key = key;
                filtered.push(item);
            });

            filtered.sort(function (a, b) {
                return (a[field] > b[field] ? 1 : -1);
            });

            if(reverse) filtered.reverse();

            return filtered;
        };
    }

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('AvatarController', AvatarController);

    /* @ngInject */
    function AvatarController($rootScope, $state, $stateParams, $timeout, Upload, imgur, profileService) {

        /* jshint validthis: true */
        var vm = this;
        vm.uploadAvatar = uploadAvatar;

        activate();

        ////////////////

        function activate() {
        	profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });

            // FIXME: This needs to be triggered by a $rootScope broadcast of when it receives profile data.
            $timeout(function() {
                profileService.getBadgesData($rootScope.profile.userName).then(function then(model) {
                    vm.badgesData = model;
                });
            }, 500);
        }

        function uploadAvatar() {

        	vm.disableButton = true;

        	imgur.setAPIKey('Client-ID f53d6d5833b07bc');
        	imgur.upload(vm.file).then(function then(model) {
        		profileService.saveAvatarLink(model[0].link, $rootScope.profile.userName);
        		Materialize.toast('Your avatar was uploaded', 4000);

        		$timeout(function() {
        			$state.go('home');
        		}, 1000);
        	});

        }

    }
    AvatarController.$inject = ["$rootScope", "$state", "$stateParams", "$timeout", "Upload", "imgur", "profileService"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('ChangePasswordController', ChangePasswordController);

    /* @ngInject */
    function ChangePasswordController($scope, $timeout, $state, AuthWrapper) {

        /* jshint validthis: true */
        var vm = this;
        
        vm.submitChangePassword = submitChangePassword;

        //////////////////

        function submitChangePassword() {

            if ($scope.pwChangeForm.$valid) {

                AuthWrapper.$changePassword({
                    email: AuthWrapper.$getAuth().password.email,
                    oldPassword: vm.inputCurrentPassword,
                    newPassword: vm.inputNewPassword
                }).then(function() {

                    Materialize.toast('Your password was changed.', 4000);
                    $timeout(function() {
                        $state.go('home');
                    }, 1000);

                }).catch(function(error) {
                    
                    if (error.code === 'INVALID_PASSWORD') {
                        vm.showChangePasswordMessage = true;
                    }

                });

            }

        }

    }
    ChangePasswordController.$inject = ["$scope", "$timeout", "$state", "AuthWrapper"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('HomeController', HomeController);

    /* @ngInject */
    function HomeController($scope, $timeout) {

        /* jshint validthis: true */
        var vm = this;

        ////////////////////////

    }
    HomeController.$inject = ["$scope", "$timeout"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('LeaderboardController', LeaderboardController);

    /* @ngInject */
    function LeaderboardController($q, $timeout, $firebaseArray, profileService, FIREBASEDATA) {

        /* jshint validthis: true */
    	var vm = this;

        activate();

        ////////////////

        function activate() {
            getProfileScores().then(function then(model) {
                vm.profileScoreData = model;
            });

            profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });
        }

        function getProfileScores() {

        	var deferred = $q.defer();
        	var ref = new Firebase(FIREBASEDATA.FBURL);

        	var profileScoreData = $firebaseArray(
        		ref
        			.child('badges')
        	);

        	profileScoreData.$loaded(function() {
        		deferred.resolve(profileScoreData);
        	});

        	return deferred.promise;

        }

    }
    LeaderboardController.$inject = ["$q", "$timeout", "$firebaseArray", "profileService", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('ProfileController', ProfileController);

    /* @ngInject */
    function ProfileController($scope, $stateParams, $q, $timeout, $state, $firebaseArray, authService, profileService, eventService) {

        /* jshint validthis: true */
        var vm = this;
        
        activate();

        /////////////////////////////////

        function activate() {

            profileService.getUserData($stateParams.username).then(function then(model) {
                vm.profileData = model;

                profileService.getTournamentHistory(vm.profileData).then(function then(model) {
                    var tournamentHistoryData = model;
                    vm.eventStandings = profileService.getTournamentStandings(tournamentHistoryData, $stateParams.username);
                });

                $('.collapsible').collapsible({
                    accordion: true
                });
            });

            profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });

            profileService.getBadgesData($stateParams.username).then(function then(model) {
                vm.badgesData = model;
            });

        }

    }
    ProfileController.$inject = ["$scope", "$stateParams", "$q", "$timeout", "$state", "$firebaseArray", "authService", "profileService", "eventService"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('profileService', profileService);

    /* @ngInject */
    function profileService($rootScope, $q, $firebaseArray, $firebaseObject, eventService, FIREBASEDATA) {

    	this.getAvatarData = getAvatarData;
        this.getBadgesData = getBadgesData;
    	this.getTournamentHistory = getTournamentHistory;
        this.getTournamentStandings = getTournamentStandings;
        this.getUserData = getUserData;
        this.saveAvatarLink = saveAvatarLink;

        ////////////////

        function getAvatarData() {

            var deferred = $q.defer();
            var ref = new Firebase(FIREBASEDATA.FBURL);

            var avatarData = $firebaseObject(
                ref
                    .child('avatars')
            );

            avatarData.$loaded(function() {
                deferred.resolve(avatarData);
            });

            return deferred.promise;

        }

        function getBadgesData(inputUser) {

            var deferred = $q.defer();
            var ref = new Firebase(FIREBASEDATA.FBURL);

            var badgesData = $firebaseObject(
                ref
                    .child('badges')
                    .child(inputUser)
            );

            badgesData.$loaded(function() {
                deferred.resolve(badgesData);
            });

            return deferred.promise;

        }

        function getTournamentHistory(inputUserData) {

        	var deferred = $q.defer();
        	var ref = new Firebase(FIREBASEDATA.FBURL);

        	// Loop through each event in the pledgedTo object.
        	var eventsArray = [];
        	for (var key in inputUserData.pledgedTo) {
        		eventsArray.push(key);
        	}

        	deferred.resolve(eventsArray);

        	return deferred.promise;

        }

        function getTournamentStandings(inputTournamentHistory, inputUser) {

            var ref = new Firebase(FIREBASEDATA.FBURL);

            // Loop through each event in the user's history.
            var eventStandings = [];
            inputTournamentHistory.forEach(function(event) {

                eventService.getEventProperties(event).then(function(eventProperties) {

                    eventProperties.$loaded().then(function() {

                        // If concluded, get the user's standing.
                        if (eventProperties.state === 'concluded') {

                            var eventStandingData = $firebaseObject(
                                ref
                                    .child('standings')
                                    .child(event)
                            );

                            eventStandingData.$loaded().then(function() {

                                if (eventStandingData[inputUser]) {

                                    eventStandings.push({
                                        name: eventProperties.name,
                                        premier: eventProperties.premier ? true : null,
                                        shortName: event,
                                        state: 'concluded',
                                        color: eventProperties.color,
                                        position: eventStandingData[inputUser]
                                    });

                                } else {

                                    eventStandings.push({
                                        name: eventProperties.name,
                                        premier: eventProperties.premier ? true : null,
                                        shortName: event,
                                        state: 'concluded',
                                        color: eventProperties.color,
                                        position: -1
                                    });

                                }

                            });

                        } else if (eventProperties.state === 'inprogress' || eventProperties.state === 'upcoming') {

                            eventStandings.push({
                                name: eventProperties.name,
                                premier: eventProperties.premier ? true : null,
                                shortName: event,
                                color: eventProperties.color,
                                state: eventProperties.state
                            });

                        }

                    });

                });

            });

            return eventStandings;

        }

        function getUserData(inputUser) {

        	var deferred = $q.defer();
        	var ref = new Firebase(FIREBASEDATA.FBURL);

        	var usersData = $firebaseArray(
        		ref
        			.child('users')
        	);

        	usersData.$loaded(function() {

        		usersData.forEach(function(user) {
        			if (user.userName === inputUser) {
        				deferred.resolve(user);
        			}
        		});

        	});

        	return deferred.promise;

        }

        // FIXME: Make this server-side.
        function saveAvatarLink(inputLink, inputUser) {
            
            var ref = new Firebase(FIREBASEDATA.FBURL);

            var avatarData = $firebaseObject(
                ref
                    .child('avatars')
            );

            avatarData.$loaded(function() {
                avatarData[inputUser] = inputLink;
                avatarData.$save();
            });

        }

    }
    profileService.$inject = ["$rootScope", "$q", "$firebaseArray", "$firebaseObject", "eventService", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('RegController', RegController);

    /* @ngInject */
    function RegController($scope, $rootScope, $timeout, $window, $state, $firebaseObject, authService, AuthWrapper) {

        /* jshint validthis: true */
        var vm = this;

        vm.loginToAccount = loginToAccount;
        vm.passwordReset = passwordReset;
        vm.submitNewAccount = submitNewAccount;

        /////////////////////

        function loginToAccount() {

            authService.loginToAccount(vm.loginEmail, vm.loginPassword).then(function then(model) {

                vm.showInvalidUserError = false;
                vm.showInvalidPasswordError = false;

                if (model === 'LOGIN_SUCCESS') {

                    $state.go('home');

                } else if (model === 'INVALID_USER') {
                    vm.showInvalidUserError = true;
                    return;
                } else if (model === 'INVALID_PASSWORD') {
                    vm.showInvalidPasswordError = true;
                }

            });

        }

        function passwordReset() {

            if (!vm.loginEmail) {
                vm.showPasswordResetEmailMessage = true;
                return;
            }

            AuthWrapper.$resetPassword({
                email: vm.loginEmail
            }).then(function() {
                vm.showPasswordResetEmailMessage = false;
                Materialize.toast('A password reset email has been sent to ' + vm.loginEmail + '.', 4000);
            });

        }

        function submitNewAccount() {
            
            // Does the user exist? If so, show an error message.
            authService.checkIfUserExists(vm.newUsername).then(function(userExists) {

                vm.showDuplicateUserError = false;
                vm.showEmailTakenError = false;

                if (userExists) {

                    vm.showDuplicateUserError = true;
                    return;

                // Try to create the new user.
                } else {

                    authService.createNewUser(vm.newEmail, vm.newPassword, vm.newUsername).then(function then(model) {

                        if (model === 'EMAIL_TAKEN') {

                            vm.showEmailTakenError = true;
                            return;

                        } else if (model === 'ACCOUNT_CREATED') {

                            $state.go('profile', {username: vm.newUsername});

                        }

                    });

                }

            });

        }

    }
    RegController.$inject = ["$scope", "$rootScope", "$timeout", "$window", "$state", "$firebaseObject", "authService", "AuthWrapper"];

})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJhcHAuY29uZmlnLmpzIiwiYXBwLnJ1bi5qcyIsImF1dGgvYXV0aC5zZXJ2aWNlLmpzIiwiYXV0aC9hdXRod3JhcHBlci5mYWN0b3J5LmpzIiwiZXZlbnQvZXZlbnQuc2VydmljZS5qcyIsImV2ZW50L21haW4uY29udHJvbGxlci5qcyIsImV2ZW50L3RlYW0uc2VydmljZS5qcyIsImV2ZW50Q29tcG9uZW50cy9nYW1lc0xpc3QuZGlyZWN0aXZlLmpzIiwiZXZlbnRDb21wb25lbnRzL211bHRpR2FtZUxlYWRlcmJvYXJkLmRpcmVjdGl2ZS5qcyIsImV2ZW50Q29tcG9uZW50cy9zaW5nbGVHYW1lTGVhZGVyYm9hcmQuZGlyZWN0aXZlLmpzIiwiZXZlbnRDb21wb25lbnRzL3N0aWNreU1lc3NhZ2UuZGlyZWN0aXZlLmpzIiwiaGVhZGVyL2hlYWRlci5jb250cm9sbGVyLmpzIiwiaGVscGVycy9vcmRlck9iamVjdEJ5LmZpbHRlci5qcyIsImhvbWUvYXZhdGFyLmNvbnRyb2xsZXIuanMiLCJob21lL2NoYW5nZVBhc3N3b3JkLmNvbnRyb2xsZXIuanMiLCJob21lL2hvbWUuY29udHJvbGxlci5qcyIsImhvbWUvbGVhZGVyYm9hcmQuY29udHJvbGxlci5qcyIsImhvbWUvcHJvZmlsZS5jb250cm9sbGVyLmpzIiwiaG9tZS9wcm9maWxlLnNlcnZpY2UuanMiLCJob21lL3JlZy5jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQSxVQUFBOztZQUVBOzs7WUFHQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7O0tBRUEsQ0NoQkEsQ0FBQSxXQUFBO0NBQ0E7O0NBRUE7R0FDQSxPQUFBO0dBQ0EsU0FBQSxnQkFBQTtHQUNBLFNBQUE7O0dBRUEsT0FBQTs7O0NBR0EsU0FBQSxPQUFBLGdCQUFBLG9CQUFBOzs7RUFHQSxtQkFBQSxVQUFBOztFQUVBO09BQ0EsTUFB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LFdBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUE7U0FDQSxXQUFBLGtCQUFBOzs7SUFHQSxTQUFBLGVBQUEsUUFBQSxVQUFBOzs7UUFHQSxJQUFBLEtBQUE7Ozs7Ozs7S0FNQSxDQ2pCQSxDQUFBLFdBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUE7U0FDQSxXQUFBLHlCQUFBOzs7SUFHQSxTQUFBLHNCQUFBLElBQUEsVUFBQSxnQkFBQSxnQkFBQSxjQUFBOzs7S0FHQSxJQUFBLEtBQUE7O1FBRUE7Ozs7UUFJQSxTQUFBLFdBQUE7WUFDQSxtQkFBQSxLQUFBLFNBQUEsS0FBQSxPQUFBO2dCQUNBLEdBQUEsbUJBQUE7OztZQUdBLGVBQUEsZ0JBQUEsS0FBQSxTQUFBLEtBQUEsT0FBQTtnQkFDQSxHQUFBLGFBQUE7Ozs7UUFJQSxTQUFBLG1CQUFBOztTQUVBLElBQUEsV0FBQSxHQUFBO1NBQ0EsSUFBQSxNQUFBLElBQUEsU0FBQSxhQUFBOztTQUVBLElBQUEsbUJBQUE7VUFDQTtZQUNBLE1BQUE7OztTQUdBLGlCQUFBLFFBQUEsV0FBQTtVQUNBLFNBQUEsUUFBQTs7O1NBR0EsT0FBQSxTQUFBOzs7Ozs7S0FLQSxDQzlDQSxDQUFBLFdBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUE7U0FDQSxXQUFBLHFCQUFBOzs7SUFHQSxTQUFBLGtCQUFBLFFBQUEsY0FBQSxJQUFBLFVBQUEsUUFBQSxnQkFBQSxhQUFBLGdCQUFBLGNBQUE7OztRQUdBLElBQUEsS0FBQTs7UUFFQTs7OztRQUlBLFNBQUEsV0FBQTs7WUFFQSxlQUFBLFlBQUEsYUFBQSxVQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUE7Z0JBQ0EsR0FBQSxjQUFBOztnQkFFQSxlQUFBLHFCQUFBLEdBQUEsYUFBQSxLQUFBLFNBQUEsS0FBQSxPQUFBO29CQUNBLElBQUEsd0JBQUE7b0JBQ0EsR0FBQSxpQkFBQSxlQUFBLHVCQUFBLHVCQUFBLGFBQUE7OztnQkFHQSxFQUFBLGdCQUFBLFlBQUE7b0JBQ0EsV0FBQTs7OztZQUlBLGVBQUEsZ0JBQUEsS0FBQSxTQUFBLEtBQUEs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QkFFQSxHQUFBLHNCQUFBOzRCQUNBOzsrQkFFQSxJQUFBLFVBQUEsbUJBQUE7OzRCQUVBLE9BQUEsR0FBQSxXQUFBLENBQUEsVUFBQSxHQUFBOzs7Ozs7Ozs7Ozs7Ozs7S0FjQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJywgW1xuICAgICAgICAgICAgLyogQW5ndWxhciBtb2R1bGVzICovXG4gICAgICAgICAgICAnbmdBbmltYXRlJyxcbiAgICAgICAgICAgIC8qIEFwcCBtb2R1bGVzICovXG4gICAgICAgICAgICAvKiBUaGlyZC1wYXJ0eSBtb2R1bGVzICovXG4gICAgICAgICAgICAndWkucm91dGVyJyxcbiAgICAgICAgICAgICdmaXJlYmFzZScsXG4gICAgICAgICAgICAndmFsaWRhdGlvbi5tYXRjaCcsXG4gICAgICAgICAgICAnb3JkaW5hbCcsXG4gICAgICAgICAgICAnbmdGaWxlVXBsb2FkJyxcbiAgICAgICAgICAgICduZ0ltZ3VyJ1xuICAgICAgICBdKTtcbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0YW5ndWxhclxuXHRcdC5tb2R1bGUoJ3ZnLmFwcCcpXG5cdFx0LmNvbnN0YW50KCdGSVJFQkFTRURBVEEnLCB7XG5cdFx0XHQnRkJVUkwnOiAnaHR0cHM6Ly93b2xmc2NvbnRlc3RzLmZpcmViYXNlaW8uY29tJ1xuXHRcdH0pXG5cdFx0LmNvbmZpZyhjb25maWcpO1xuXG5cdC8qIEBuZ0luamVjdCAqL1xuXHRmdW5jdGlvbiBjb25maWcoJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xuXG5cdFx0Ly8gUmVkaXJlY3QgYW55IHVubWF0Y2hlZCBVUkwgdG8gLy5cblx0XHQkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG5cblx0XHQkc3RhdGVQcm92aWRlclxuXHRcdCAgICAuc3RhdGUoJ2hvbWUnLCB7XG5cdFx0ICAgIFx0dXJsOiAnLycsXG5cdFx0ICAgIFx0dGVtcGxhdGVVcmw6ICdhcHAvaG9tZS9ob21lLmh0bScsXG5cdFx0ICAgIFx0Y29udHJvbGxlcjogJ0hvbWVDb250cm9sbGVyIGFzIGhvbWUnXG5cdFx0ICAgIH0pXG5cblx0XHQgICAgLnN0YXRlKCdyZWdpc3Rlck9yTG9naW4nLCB7XG5cdFx0ICAgIFx0dXJsOiAnL3JlZ2lzdGVyT3JMb2dpbicsXG5cdFx0ICAgIFx0dGVtcGxhdGVVcmw6ICcvYXBwL2hvbWUvcmVnLmh0bScsXG5cdFx0ICAgIFx0Y29udHJvbGxlcjogJ1JlZ0NvbnRyb2xsZXIgYXMgcmVnJ1xuXHRcdCAgICB9KVxuXG5cdFx0ICAgIC5zdGF0ZSgncHJvZmlsZScsIHtcblx0XHQgICAgXHR1cmw6ICcvcHJvZmlsZS86dXNlcm5hbWUnLFxuXHRcdCAgICBcdHRlbXBsYXRlVXJsOiAnL2FwcC9ob21lL3Byb2ZpbGUuaHRtJyxcblx0XHQgICAgXHRjb250cm9sbGVyOiAnUHJvZmlsZUNvbnRyb2xsZXIgYXMgcHJvZmlsZSdcblx0XHQgICAgfSlcblxuXHRcdCAgICAuc3RhdGUoJ2xlYWRlcmJvYXJkJywge1xuXHRcdCAgICBcdHVybDogJy9sZWFkZXJib2FyZCcsXG5cdFx0ICAgIFx0dGVtcGxhdGVVcmw6ICcvYXBwL2hvbWUvbGVhZGVyYm9hcmQuaHRtJyxcblx0XHQgICAgXHRjb250cm9sbGVyOiAnTGVhZGVyYm9hcmRDb250cm9sbGVyIGFzIGxlYWRlcmJvYXJkJ1xuXHRcdCAgICB9KVxuXG5cdFx0ICAgIC5zdGF0ZSgnZXZlbnQnLCB7XG5cdFx0ICAgIFx0dXJsOiAnL2V2ZW50LzpldmVudE5hbWUvbWFpbicsXG5cdFx0ICAgIFx0dGVtcGxhdGVVcmw6ICcvYXBwL2V2ZW50L21haW4uaHRtJyxcblx0XHQgICAgXHRjb250cm9sbGVyOiAnRXZlbnRNYWluQ29udHJvbGxlciBhcyBldmVudCdcblx0XHQgICAgfSlcblxuXHRcdCAgICAuc3RhdGUoJ2N1c3RvbWl6ZUF2YXRhcicsIHtcblx0XHQgICAgXHR1cmw6ICcvY3VzdG9taXplQXZhdGFyJyxcblx0XHQgICAgXHR0ZW1wbGF0ZVVybDogJy9hcHAvaG9tZS9hdmF0YXIuaHRtJyxcblx0XHQgICAgXHRjb250cm9sbGVyOiAnQXZhdGFyQ29udHJvbGxlciBhcyBhdmF0YXInLFxuXG5cdFx0ICAgIFx0cmVzb2x2ZToge1xuXHRcdCAgICBcdFx0J2N1cnJlbnRBdXRoJzogWydBdXRoV3JhcHBlcicsIGZ1bmN0aW9uKEF1dGhXcmFwcGVyKSB7XG5cdFx0ICAgIFx0XHRcdHJldHVybiBBdXRoV3JhcHBlci4kcmVxdWlyZUF1dGgoKTtcblx0XHQgICAgXHRcdH1dXG5cdFx0ICAgIFx0fVxuXHRcdCAgICB9KVxuXG5cdFx0ICAgIC5zdGF0ZSgnY2hhbmdlUGFzc3dvcmQnLCB7XG5cdFx0ICAgIFx0dXJsOiAnL2NoYW5nZVBhc3N3b3JkJyxcblx0XHQgICAgXHR0ZW1wbGF0ZVVybDogJy9hcHAvaG9tZS9jaGFuZ2VQYXNzd29yZC5odG0nLFxuXHRcdCAgICBcdGNvbnRyb2xsZXI6ICdDaGFuZ2VQYXNzd29yZENvbnRyb2xsZXIgYXMgcHdjaGFuZ2UnLFxuXG5cdFx0ICAgIFx0cmVzb2x2ZToge1xuXHRcdCAgICBcdFx0J2N1cnJlbnRBdXRoJzogWydBdXRoV3JhcHBlcicsIGZ1bmN0aW9uKEF1dGhXcmFwcGVyKSB7XG5cdFx0ICAgIFx0XHRcdHJldHVybiBBdXRoV3JhcHBlci4kcmVxdWlyZUF1dGgoKTtcblx0XHQgICAgXHRcdH1dXG5cdFx0ICAgIFx0fVxuXHRcdCAgICB9KTtcblx0fVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAucnVuKHJ1bik7XG5cbiAgICBmdW5jdGlvbiBydW4oJHJvb3RTY29wZSwgJGxvY2F0aW9uLCAkc3RhdGUsICRmaXJlYmFzZU9iamVjdCwgQXV0aFdyYXBwZXIsIEZJUkVCQVNFREFUQSkge1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VFcnJvcicsIGZ1bmN0aW9uKGV2ZW50LCB0b1N0YXRlLCB0b1BhcmFtcywgZnJvbVN0YXRlLCBmcm9tUGFyYW1zLCBlcnJvcikge1xuICAgICAgICAgICAgaWYgKGVycm9yID09PSAnQVVUSF9SRVFVSVJFRCcpIHtcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ3JlZ2lzdGVyT3JMb2dpbicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlU3VjY2VzcycsIGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAvLyBJZiB1c2VyIGlzIGxvZ2dlZCBpbiwgZG93bmxvYWQgdGhlaXIgcHJvZmlsZSBkYXRhIHRvIGFuIG9iamVjdCBpbiAkcm9vdFNjb3BlLlxuICAgICAgICAgICAgLy8gRklYTUU6IFdlIHNob3VsZG4ndCBuZWVkIHRvIGRvIHRoaXMgZXZlcnkgc3VjY2Vzc2Z1bCBzdGF0ZSBjaGFuZ2UuXG4gICAgICAgICAgICBpZiAoQXV0aFdyYXBwZXIuJGdldEF1dGgoKSkge1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHZhciBhdXRoRGF0YSA9IEF1dGhXcmFwcGVyLiRnZXRBdXRoKCk7XG4gICAgICAgICAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuXG4gICAgICAgICAgICAgICAgdmFyIHByb2ZpbGVEYXRhID0gJGZpcmViYXNlT2JqZWN0KHJlZi5jaGlsZCgndXNlcnMnKS5jaGlsZChhdXRoRGF0YS51aWQpKTtcbiAgICAgICAgICAgICAgICBwcm9maWxlRGF0YS4kYmluZFRvKCRyb290U2NvcGUsICdwcm9maWxlJykudGhlbihmdW5jdGlvbih1bmJpbmQpIHtcbiAgICAgICAgICAgICAgICAgICAgJHJvb3RTY29wZS51bmJpbmRGdW5jdGlvbiA9IHVuYmluZDtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5zZXJ2aWNlKCdhdXRoU2VydmljZScsIGF1dGhTZXJ2aWNlKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIGF1dGhTZXJ2aWNlKCRxLCAkcm9vdFNjb3BlLCAkc3RhdGUsICR3aW5kb3csICR0aW1lb3V0LCAkZmlyZWJhc2VPYmplY3QsIEF1dGhXcmFwcGVyLCBGSVJFQkFTRURBVEEpIHtcbiAgICAgICAgXG4gICAgICAgIHRoaXMudGVzdERhdGEgPSAnaGVsbG8gd29ybGQhJztcblxuICAgIFx0dGhpcy5jaGVja0lmVXNlckV4aXN0cyA9IGNoZWNrSWZVc2VyRXhpc3RzO1xuICAgIFx0dGhpcy5jcmVhdGVOZXdVc2VyID0gY3JlYXRlTmV3VXNlcjtcbiAgICAgICAgdGhpcy5sb2dpblRvQWNjb3VudCA9IGxvZ2luVG9BY2NvdW50O1xuICAgICAgICB0aGlzLmxvZ091dCA9IGxvZ091dDtcblxuICAgIFx0Ly8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgXHRmdW5jdGlvbiBjaGVja0lmVXNlckV4aXN0cyhpbnB1dFVzZXJuYW1lKSB7XG5cbiAgICBcdFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgIFx0XHR2YXIgZG9lc1VzZXJFeGlzdCA9IGZhbHNlO1xuICAgIFx0XHR2YXIgdXNlcnNSZWYgPSBuZXcgJHdpbmRvdy5GaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwgKyAnL3VzZXJzJyk7XG5cbiAgICBcdFx0dXNlcnNSZWYub25jZSgndmFsdWUnLCBmdW5jdGlvbihkYXRhU25hcHNob3QpIHtcblxuICAgICAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBkYXRhU25hcHNob3QuZm9yRWFjaChmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlci52YWwoKS51c2VyTmFtZSA9PT0gaW5wdXRVc2VybmFtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvZXNVc2VyRXhpc3QgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRvZXNVc2VyRXhpc3QpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgXHRcdH0pO1xuXG4gICAgXHRcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgXHR9XG5cbiAgICBcdGZ1bmN0aW9uIGNyZWF0ZU5ld1VzZXIoaW5wdXRFbWFpbCwgaW5wdXRQYXNzd29yZCwgaW5wdXRVc2VybmFtZSkge1xuXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgXHRcdEF1dGhXcmFwcGVyLiRjcmVhdGVVc2VyKHtcbiAgICBcdFx0XHRlbWFpbDogaW5wdXRFbWFpbCxcbiAgICBcdFx0XHRwYXNzd29yZDogaW5wdXRQYXNzd29yZFxuICAgIFx0XHR9KS50aGVuKGZ1bmN0aW9uKHVzZXJEYXRhKSB7XG5cbiAgICBcdFx0XHQvLyBDcmVhdGUgYSBkYXRhIGVudHJ5IGZvciB0aGUgbmV3IHVzZXJuYW1lLlxuICAgIFx0XHRcdG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpLmNoaWxkKCd1c2Vycy8nICsgdXNlckRhdGEudWlkKS5zZXQoe1xuXG4gICAgXHRcdFx0XHR1c2VyTmFtZTogaW5wdXRVc2VybmFtZSxcbiAgICBcdFx0XHRcdHJvbGU6ICdVc2VyJ1xuXG4gICAgXHRcdFx0fSwgZnVuY3Rpb24oZXJyb3JEYXRhKSB7XG4gICAgXHRcdFx0XHRjb25zb2xlLmVycm9yKGVycm9yRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlcnJvckRhdGEuY29kZTtcbiAgICBcdFx0XHR9KTtcblxuICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBhIGRhdGEgZW50cnkgZm9yIHRoZSB1c2VyJ3MgYXZhdGFyLlxuICAgICAgICAgICAgICAgIG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpLmNoaWxkKCdhdmF0YXJzJykuY2hpbGQoaW5wdXRVc2VybmFtZSkuc2V0KCdodHRwOi8vYXBpLmFkb3JhYmxlLmlvL2F2YXRhcnMvNDIvJyArIGlucHV0VXNlcm5hbWUpO1xuXG4gICAgXHRcdFx0Ly8gTG9nIHRoZSB1c2VyIGluLlxuICAgIFx0XHRcdEF1dGhXcmFwcGVyLiRhdXRoV2l0aFBhc3N3b3JkKHtcbiAgICBcdFx0XHRcdGVtYWlsOiBpbnB1dEVtYWlsLFxuICAgIFx0XHRcdFx0cGFzc3dvcmQ6IGlucHV0UGFzc3dvcmRcbiAgICBcdFx0XHR9KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCdBQ0NPVU5UX0NSRUFURUQnKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgIFx0XHR9KS5jYXRjaChmdW5jdGlvbihlcnJvckRhdGEpIHtcblxuICAgIFx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyb3JEYXRhKTtcblxuICAgIFx0XHRcdGlmIChlcnJvckRhdGEuY29kZSA9PT0gJ0VNQUlMX1RBS0VOJykge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGVycm9yRGF0YS5jb2RlKTtcbiAgICBcdFx0XHR9XG5cbiAgICBcdFx0fSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgXHR9XG5cbiAgICAgICAgZnVuY3Rpb24gbG9naW5Ub0FjY291bnQoaW5wdXRFbWFpbCwgaW5wdXRQYXNzd29yZCkge1xuXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICBBdXRoV3JhcHBlci4kYXV0aFdpdGhQYXNzd29yZCh7XG4gICAgICAgICAgICAgICAgZW1haWw6IGlucHV0RW1haWwsXG4gICAgICAgICAgICAgICAgcGFzc3dvcmQ6IGlucHV0UGFzc3dvcmRcbiAgICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24oYXV0aERhdGEpIHtcblxuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoJ0xPR0lOX1NVQ0NFU1MnKTtcblxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyb3JEYXRhKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoZXJyb3JEYXRhLmNvZGUgPT09ICdJTlZBTElEX1VTRVInKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoJ0lOVkFMSURfVVNFUicpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZXJyb3JEYXRhLmNvZGUgPT09ICdJTlZBTElEX1BBU1NXT1JEJykge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCdJTlZBTElEX1BBU1NXT1JEJyk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGxvZ091dCgpIHtcbiAgICAgICAgICAgIEF1dGhXcmFwcGVyLiR1bmF1dGgoKTtcbiAgICAgICAgICAgICRyb290U2NvcGUudW5iaW5kRnVuY3Rpb24oKTtcbiAgICAgICAgfVxuXG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuZmFjdG9yeSgnQXV0aFdyYXBwZXInLCBBdXRoV3JhcHBlcik7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBBdXRoV3JhcHBlcigkZmlyZWJhc2VBdXRoLCBGSVJFQkFTRURBVEEpIHtcblxuICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG4gICAgICAgIHJldHVybiAkZmlyZWJhc2VBdXRoKHJlZik7XG5cbiAgICB9XG4gICAgXG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5zZXJ2aWNlKCdldmVudFNlcnZpY2UnLCBldmVudFNlcnZpY2UpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gZXZlbnRTZXJ2aWNlKCRxLCAkZmlsdGVyLCAkZmlyZWJhc2VPYmplY3QsICRmaXJlYmFzZUFycmF5LCBGSVJFQkFTRURBVEEpIHtcblxuICAgICAgICB2YXIgX2V2ZW50UHJvcGVydGllcyA9IG51bGw7XG4gICAgICAgIHZhciBfZ2FtZUxpc3QgPSBudWxsO1xuICAgICAgICB2YXIgX2xlYWRlcmJvYXJkTGVuZ3RoID0gbnVsbDtcbiAgICAgICAgdmFyIF9zdW1tYXJpemVkTGVhZGVyYm9hcmQgPSBudWxsO1xuICAgICAgICB2YXIgX3RlYW1MaXN0ID0gbnVsbDtcblxuICAgICAgICB0aGlzLmNyZWF0ZU11bHRpR2FtZUZpbmFsU3RhbmRpbmdzID0gY3JlYXRlTXVsdGlHYW1lRmluYWxTdGFuZGluZ3M7XG4gICAgICAgIHRoaXMuZ2V0RXZlbnRQcm9wZXJ0aWVzID0gZ2V0RXZlbnRQcm9wZXJ0aWVzO1xuICAgICAgICB0aGlzLmdldEV2ZW50UHJvcGVydGllc09iamVjdCA9IGdldEV2ZW50UHJvcGVydGllc09iamVjdDtcbiAgICAgICAgdGhpcy5nZXRHYW1lRGF0YSA9IGdldEdhbWVEYXRhO1xuICAgICAgICB0aGlzLmdldEdhbWVMaXN0T2JqZWN0ID0gZ2V0R2FtZUxpc3RPYmplY3Q7XG4gICAgICAgIHRoaXMuZ2V0R2FtZXNMaXN0ID0gZ2V0R2FtZXNMaXN0O1xuICAgICAgICB0aGlzLmdldExlYWRlcmJvYXJkTGVuZ3RoVmFsdWUgPSBnZXRMZWFkZXJib2FyZExlbmd0aFZhbHVlO1xuICAgICAgICB0aGlzLmdldE11bHRpR2FtZUxlYWRlcmJvYXJkID0gZ2V0TXVsdGlHYW1lTGVhZGVyYm9hcmQ7XG4gICAgICAgIHRoaXMuZ2V0UGxheWVyU2NvcmVzID0gZ2V0UGxheWVyU2NvcmVzO1xuICAgICAgICB0aGlzLmdldFNpbmdsZUdhbWVMZWFkZXJib2FyZCA9IGdldFNpbmdsZUdhbWVMZWFkZXJib2FyZDtcbiAgICAgICAgdGhpcy5nZXRTdW1tYXJpemVkTGVhZGVyYm9hcmRPYmplY3QgPSBnZXRTdW1tYXJpemVkTGVhZGVyYm9hcmRPYmplY3Q7XG4gICAgICAgIHRoaXMuZ2V0VGVhbUxpc3RPYmplY3QgPSBnZXRUZWFtTGlzdE9iamVjdDtcbiAgICAgICAgdGhpcy5sb2FkRXZlbnRQcm9wZXJ0aWVzID0gbG9hZEV2ZW50UHJvcGVydGllcztcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlTXVsdGlHYW1lRmluYWxTdGFuZGluZ3MoaW5wdXRFdmVudCkge1xuXG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgdGhlIGZpbmFsIHN0YW5kaW5ncyBvZiB0aGUgZXZlbnQuXG4gICAgICAgICAgICBnZXRNdWx0aUdhbWVMZWFkZXJib2FyZChpbnB1dEV2ZW50KS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcblxuICAgICAgICAgICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcbiAgICAgICAgICAgICAgICB2YXIgaW5wdXRFdmVudFN0YW5kaW5ncyA9ICRmaXJlYmFzZU9iamVjdChcbiAgICAgICAgICAgICAgICAgICAgcmVmXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2hpbGQoJ3N0YW5kaW5ncycpXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2hpbGQoaW5wdXRFdmVudClcbiAgICAgICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAgICAgaW5wdXRFdmVudFN0YW5kaW5ncy4kbG9hZGVkKCkudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICBtb2RlbC5mb3JFYWNoKGZ1bmN0aW9uKHN0YW5kaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dEV2ZW50U3RhbmRpbmdzW3N0YW5kaW5nLmtleV0gPSBzdGFuZGluZy5wb3NpdGlvbjtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgaW5wdXRFdmVudFN0YW5kaW5ncy4kc2F2ZSgpO1xuXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRFdmVudFByb3BlcnRpZXMoaW5wdXRFdmVudCkge1xuXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIFx0dmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuICAgICAgICBcdHZhciBldmVudFByb3BlcnRpZXMgPSAkZmlyZWJhc2VPYmplY3QoXG4gICAgICAgIFx0XHRyZWZcbiAgICAgICAgXHRcdFx0LmNoaWxkKCdjb250ZXN0cycpXG4gICAgICAgIFx0XHRcdC5jaGlsZChpbnB1dEV2ZW50KVxuICAgICAgICBcdFx0XHQuY2hpbGQoJ3Byb3BlcnRpZXMnKVxuICAgICAgICBcdCk7XG5cbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZXZlbnRQcm9wZXJ0aWVzKTtcblxuICAgICAgICBcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRFdmVudFByb3BlcnRpZXNPYmplY3QoKSB7XG4gICAgICAgICAgICByZXR1cm4gX2V2ZW50UHJvcGVydGllcztcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEZpcnN0UGxhY2VTY29yZXMoKSB7XG5cbiAgICAgICAgICAgIF9nYW1lTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGdhbWUpIHtcblxuICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBzY29yZXMsIGdldCB0aGUgdG9wIG9uZS5cbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5zY29yZXMpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgc2NvcmVzQXJyYXkgPSAkLm1hcChnYW1lLnNjb3JlcywgZnVuY3Rpb24oZWwpIHsgcmV0dXJuIGVsOyB9KTtcbiAgICAgICAgICAgICAgICAgICAgc2NvcmVzQXJyYXkgPSAkZmlsdGVyKCdvcmRlckJ5Jykoc2NvcmVzQXJyYXksICctc2NvcmUnKTtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5maXJzdFNjb3JlID0gc2NvcmVzQXJyYXlbMF07XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRHYW1lRGF0YShpbnB1dEV2ZW50LCBpbnB1dEdhbWUpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuXG4gICAgICAgICAgICBnZXRHYW1lc0xpc3QoaW5wdXRFdmVudCkudGhlbihmdW5jdGlvbihnYW1lc0xpc3QpIHtcblxuICAgICAgICAgICAgICAgIGdhbWVzTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGdhbWUpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoZ2FtZS5jYW1lbE5hbWUgPT09IGlucHV0R2FtZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShnYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0R2FtZUxpc3RPYmplY3QoKSB7XG4gICAgICAgICAgICByZXR1cm4gX2dhbWVMaXN0O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0R2FtZXNMaXN0KGlucHV0RXZlbnQpIHtcblxuICAgICAgICBcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgXHR2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG4gICAgICAgIFx0dmFyIGdhbWVzTGlzdCA9ICRmaXJlYmFzZUFycmF5KFxuICAgICAgICBcdFx0cmVmXG4gICAgICAgIFx0XHRcdC5jaGlsZCgnY29udGVzdHMnKVxuICAgICAgICBcdFx0XHQuY2hpbGQoaW5wdXRFdmVudClcbiAgICAgICAgXHRcdFx0LmNoaWxkKCdhY3RpdmVHYW1lcycpXG4gICAgICAgIFx0KTtcblxuICAgICAgICBcdGdhbWVzTGlzdC4kbG9hZGVkKCkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgXHRcdGRlZmVycmVkLnJlc29sdmUoZ2FtZXNMaXN0KTtcbiAgICAgICAgXHR9KTtcblxuICAgICAgICBcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRMZWFkZXJib2FyZExlbmd0aFZhbHVlKCkge1xuICAgICAgICAgICAgcmV0dXJuIF9sZWFkZXJib2FyZExlbmd0aDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldE11bHRpR2FtZUxlYWRlcmJvYXJkKGlucHV0RXZlbnQpIHtcblxuICAgICAgICBcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgXHQvLyBXZSBuZWVkIHRvIGdldCB0aGUgdG9wIDEyIHBsYXllcnMgZm9yIGV2ZXJ5IGdhbWUuXG4gICAgICAgIFx0dmFyIHBsYXllclBvaW50cyA9IHt9O1xuXG4gICAgICAgIFx0Z2V0R2FtZXNMaXN0KGlucHV0RXZlbnQpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuXG4gICAgICAgIFx0XHR2YXIgZ2FtZXNMaXN0ID0gbW9kZWw7XG4gICAgICAgIFx0XHRnYW1lc0xpc3QuZm9yRWFjaChmdW5jdGlvbihnYW1lKSB7XG5cbiAgICAgICAgXHRcdFx0aWYgKGdhbWUuc2NvcmVzKSB7XG5cbiAgICAgICAgXHRcdFx0XHQvLyBDb252ZXJ0IHRoZSBnYW1lJ3Mgc2NvcmVzIHRvIGFuIGFycmF5LlxuICAgICAgICBcdFx0XHRcdHZhciBzY29yZXNBcnJheSA9ICQubWFwKGdhbWUuc2NvcmVzLCBmdW5jdGlvbihlbCkgeyByZXR1cm4gZWw7IH0pO1xuICAgICAgICBcdFx0XHRcdHNjb3Jlc0FycmF5ID0gJGZpbHRlcignb3JkZXJCeScpKHNjb3Jlc0FycmF5LCAnLXNjb3JlJyk7XG5cbiAgICAgICAgXHRcdFx0XHR2YXIgdG90YWxBd2FyZCA9IDEyO1xuXG4gICAgICAgIFx0XHRcdFx0Ly8gSXRlcmF0ZSB0aHJvdWdoIHRoZSB0b3Agc2NvcmVzIGF3YXJkaW5nIHBvaW50cy5cbiAgICAgICAgXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHNjb3Jlc0FycmF5Lmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgXHRcdFx0XHRcdGlmICghcGxheWVyUG9pbnRzW3Njb3Jlc0FycmF5W2ldLnVzZXJOYW1lXSkge1xuICAgICAgICBcdFx0XHRcdFx0XHRwbGF5ZXJQb2ludHNbc2NvcmVzQXJyYXlbaV0udXNlck5hbWVdID0ge1xuICAgICAgICBcdFx0XHRcdFx0XHRcdHBvaW50czogMFxuICAgICAgICBcdFx0XHRcdFx0XHR9O1xuICAgICAgICBcdFx0XHRcdFx0fVxuXG4gICAgICAgIFx0XHRcdFx0XHRwbGF5ZXJQb2ludHNbc2NvcmVzQXJyYXlbaV0udXNlck5hbWVdLnBvaW50cyArPSB0b3RhbEF3YXJkO1xuXG4gICAgICAgIFx0XHRcdFx0XHRpZiAodG90YWxBd2FyZCA+IDApIHtcbiAgICAgICAgXHRcdFx0XHRcdFx0dG90YWxBd2FyZCAtPSAxO1xuICAgICAgICBcdFx0XHRcdFx0fVxuXG4gICAgICAgIFx0XHRcdFx0fVxuXG4gICAgICAgIFx0XHRcdH1cblxuICAgICAgICBcdFx0fSk7XG5cbiAgICAgICAgXHRcdC8vIEZpbmQgYW5kIHJlc29sdmUgdGllcy5cbiAgICAgICAgXHRcdHBsYXllclBvaW50cyA9ICRmaWx0ZXIoJ29yZGVyT2JqZWN0QnknKShwbGF5ZXJQb2ludHMsICdwb2ludHMnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB2YXIgaGF2ZUJvdHRvbVNjb3JlcnNGbG9vciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZhciBmbG9vclJhbmdlID0gMDtcbiAgICAgICAgXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcGxheWVyUG9pbnRzLmxlbmd0aDsgaSArPSAxKSB7XG5cbiAgICAgICAgXHRcdFx0aWYgKHBsYXllclBvaW50c1tpLTFdICYmIHBsYXllclBvaW50c1tpXS5wb2ludHMgJiYgcGxheWVyUG9pbnRzW2ktMV0ucG9pbnRzKSB7XG5cbiAgICAgICAgXHRcdFx0XHRpZiAocGxheWVyUG9pbnRzW2ldLnBvaW50cyA9PT0gcGxheWVyUG9pbnRzW2ktMV0ucG9pbnRzKSB7XG4gICAgICAgIFx0XHRcdFx0XHRwbGF5ZXJQb2ludHNbaV0ucG9zaXRpb24gPSBwbGF5ZXJQb2ludHNbaS0xXS5wb3NpdGlvbjtcbiAgICAgICAgXHRcdFx0XHR9IGVsc2Uge1xuICAgICAgICBcdFx0XHRcdFx0cGxheWVyUG9pbnRzW2ldLnBvc2l0aW9uID0gKGkrMSk7XG4gICAgICAgIFx0XHRcdFx0fVxuXG4gICAgICAgIFx0XHRcdH0gZWxzZSB7XG5cbiAgICAgICAgXHRcdFx0XHRpZiAoaSA9PT0gMCkge1xuICAgICAgICBcdFx0XHRcdFx0cGxheWVyUG9pbnRzW2ldLnBvc2l0aW9uID0gMTtcbiAgICAgICAgXHRcdFx0XHR9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXZlQm90dG9tU2NvcmVyc0Zsb29yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEdldCBjb3VudCBvZiBwbGF5ZXJzIGluIG9uZSBwb3NpdGlvbiBoaWdoZXIuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnZXRTY29yZUNvdW50T2YgPSBwbGF5ZXJQb2ludHNbaS0xXS5wb2ludHM7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBwbGF5ZXJQb2ludHMubGVuZ3RoOyBqICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXJQb2ludHNbal0ucG9pbnRzID09PSBnZXRTY29yZUNvdW50T2YpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9vclJhbmdlICs9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXZlQm90dG9tU2NvcmVyc0Zsb29yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgXHRcdFx0XHRcdHBsYXllclBvaW50c1tpXS5wb3NpdGlvbiA9IChwbGF5ZXJQb2ludHMubGVuZ3RoICsgMSkgLSBmbG9vclJhbmdlO1xuICAgICAgICBcdFx0XHRcdH1cblxuICAgICAgICBcdFx0XHR9XG5cbiAgICAgICAgXHRcdH1cblxuICAgICAgICBcdFx0ZGVmZXJyZWQucmVzb2x2ZShwbGF5ZXJQb2ludHMpO1xuXG4gICAgICAgIFx0fSk7XG5cblx0XHRcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRTaW5nbGVHYW1lTGVhZGVyYm9hcmQoaW5wdXRFdmVudCkge1xuXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG4gICAgICAgICAgICB2YXIgbGVhZGVyYm9hcmREYXRhID0gJGZpcmViYXNlQXJyYXkoXG4gICAgICAgICAgICAgICAgcmVmXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnY29udGVzdHMnKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoaW5wdXRFdmVudClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkKCdzY29yZXMnKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShsZWFkZXJib2FyZERhdGEpO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0U3VtbWFyaXplZExlYWRlcmJvYXJkT2JqZWN0KCkge1xuICAgICAgICAgICAgcmV0dXJuIF9zdW1tYXJpemVkTGVhZGVyYm9hcmQ7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRUZWFtTGlzdE9iamVjdCgpIHtcbiAgICAgICAgICAgIHJldHVybiBfdGVhbUxpc3Q7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRQbGF5ZXJTY29yZXMoaW5wdXRFdmVudCwgaW5wdXRHYW1lc0xpc3QsIGlucHV0UGxheWVyKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgIHZhciBkaXNwbGF5U2NvcmVzID0gW107XG5cbiAgICAgICAgICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCBldmVyeSBnYW1lLlxuICAgICAgICAgICAgaW5wdXRHYW1lc0xpc3QuZm9yRWFjaChmdW5jdGlvbihnYW1lKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5zY29yZXMpIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBDb252ZXJ0IHRoZSBnYW1lJ3Mgc2NvcmVzIHRvIGFuIGFycmF5LlxuICAgICAgICAgICAgICAgICAgICB2YXIgc2NvcmVzQXJyYXkgPSAkLm1hcChnYW1lLnNjb3JlcywgZnVuY3Rpb24oZWwpIHsgcmV0dXJuIGVsOyB9KTtcbiAgICAgICAgICAgICAgICAgICAgc2NvcmVzQXJyYXkgPSAkZmlsdGVyKCdvcmRlckJ5Jykoc2NvcmVzQXJyYXksICctc2NvcmUnKTtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgdG90YWxBd2FyZCA9IDEyO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIEl0ZXJhdGUgdGhyb3VnaCB0aGUgc2NvcmVzIHN0YXJ0aW5nIGZyb20gdGhlIHRvcCBhbmQgZmluZCBvdXIgdXNlci5cbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzY29yZXNBcnJheS5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBGb3VuZCBvdXIgcGxheWVyLlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNjb3Jlc0FycmF5W2ldLnVzZXJOYW1lID09PSBpbnB1dFBsYXllcikge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG5ld1Njb3JlT2JqZWN0ID0gZ2FtZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTY29yZU9iamVjdC5wb3NpdGlvbiA9IGkrMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTY29yZU9iamVjdC5zY29yZSA9IHNjb3Jlc0FycmF5W2ldLnNjb3JlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Njb3JlT2JqZWN0LnBvaW50c0Vhcm5lZCA9IHRvdGFsQXdhcmQ7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2NvcmVPYmplY3QuaW5wVXJsID0gc2NvcmVzQXJyYXlbaV0uaW5wVXJsID8gc2NvcmVzQXJyYXlbaV0uaW5wVXJsIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTY29yZU9iamVjdC50d2l0Y2hVcmwgPSBzY29yZXNBcnJheVtpXS50d2l0Y2hVcmwgPyBzY29yZXNBcnJheVtpXS50d2l0Y2hVcmwgOiBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Njb3JlT2JqZWN0Lm1hbWVWZXJzaW9uID0gc2NvcmVzQXJyYXlbaV0ubWFtZVZlcnNpb24gPyBzY29yZXNBcnJheVtpXS5tYW1lVmVyc2lvbiA6IG51bGw7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5U2NvcmVzLnB1c2gobmV3U2NvcmVPYmplY3QpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXdhcmQgPSAxMjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodG90YWxBd2FyZCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBd2FyZCAtPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRpc3BsYXlTY29yZXMpO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbG9hZEV2ZW50UHJvcGVydGllcyhpbnB1dEV2ZW50KSB7XG5cbiAgICAgICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcbiAgICAgICAgICAgIHZhciBpbnB1dEV2ZW50UHJvcGVydGllcyA9ICRmaXJlYmFzZU9iamVjdChcbiAgICAgICAgICAgICAgICByZWZcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkKCdjb250ZXN0cycpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZChpbnB1dEV2ZW50KVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoJ3Byb3BlcnRpZXMnKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgaW5wdXRFdmVudFByb3BlcnRpZXMuJGxvYWRlZCgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgX2V2ZW50UHJvcGVydGllcyA9IGlucHV0RXZlbnRQcm9wZXJ0aWVzO1xuXG4gICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBpcyBhIG11bHRpZ2FtZSBldmVudCwgZ2V0IHRoZSBkYXRhIG5lZWRlZCBmb3IgbXVsdGlnYW1lIGNvbXBvbmVudHMuXG4gICAgICAgICAgICAgICAgaWYgKF9ldmVudFByb3BlcnRpZXMuZm9ybWF0Lm11bHRpR2FtZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGdldEdhbWVzTGlzdChpbnB1dEV2ZW50KS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9nYW1lTGlzdCA9IG1vZGVsO1xuICAgICAgICAgICAgICAgICAgICAgICAgZ2V0Rmlyc3RQbGFjZVNjb3JlcygpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBnZXRNdWx0aUdhbWVMZWFkZXJib2FyZChpbnB1dEV2ZW50KS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsZWFkZXJib2FyZCA9IG1vZGVsO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2xlYWRlcmJvYXJkTGVuZ3RoID0gbGVhZGVyYm9hcmQubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3N1bW1hcml6ZWRMZWFkZXJib2FyZCA9IGxlYWRlcmJvYXJkLnNsaWNlKDAsIDgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYSBzaW5nbGUgZ2FtZSBldmVudCwgZ2V0IHRoZSBkYXRhIG5lZWRlZCBmb3Igc2luZ2xlIGdhbWUgY29tcG9uZW50cy5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIGdldFNpbmdsZUdhbWVMZWFkZXJib2FyZChpbnB1dEV2ZW50KS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBsZWFkZXJib2FyZCA9IG1vZGVsO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2xlYWRlcmJvYXJkTGVuZ3RoID0gbGVhZGVyYm9hcmQubGVuZ3RoO1xuICAgICAgICAgICAgICAgICAgICAgICAgX3N1bW1hcml6ZWRMZWFkZXJib2FyZCA9IGxlYWRlcmJvYXJkO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYSB0ZWFtLWJhc2VkIGV2ZW50LCBnZXQgdGhlIGRhdGEgbmVlZGVkIGZvciB0ZWFtIGV2ZW50IGNvbXBvbmVudHMuXG4gICAgICAgICAgICAgICAgaWYgKF9ldmVudFByb3BlcnRpZXMuZm9ybWF0LnRlYW1CYXNlZCkge1xuXG4gICAgICAgICAgICAgICAgICAgIHRlYW1TZXJ2aWNlLmdldFRlYW1MaXN0KHZtLmV2ZW50TmFtZSkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfdGVhbUxpc3QgPSBtb2RlbDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0V2ZW50TWFpbkNvbnRyb2xsZXInLCBFdmVudE1haW5Db250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIEV2ZW50TWFpbkNvbnRyb2xsZXIoJHNjb3BlLCAkZmlsdGVyLCAkc3RhdGVQYXJhbXMsICRzdGF0ZSwgJHRpbWVvdXQsICRmaXJlYmFzZUFycmF5LCBldmVudFNlcnZpY2UsIGF1dGhTZXJ2aWNlLCBwcm9maWxlU2VydmljZSwgdGVhbVNlcnZpY2UsIEZJUkVCQVNFREFUQSkge1xuXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICB2bS5ldmVudE5hbWUgPSAkc3RhdGVQYXJhbXMuZXZlbnROYW1lO1xuXG4gICAgICAgIHZtLmNyZWF0ZVRlYW0gPSBjcmVhdGVUZWFtO1xuICAgICAgICB2bS5kZXRlcm1pbmVQb2ludHMgPSBkZXRlcm1pbmVQb2ludHM7XG4gICAgICAgIHZtLmdldEZpcnN0UGxhY2VTY29yZXMgPSBnZXRGaXJzdFBsYWNlU2NvcmVzO1xuICAgICAgICB2bS5nb1RvUGxheWVyUHJvZmlsZSA9IGdvVG9QbGF5ZXJQcm9maWxlO1xuICAgICAgICB2bS5vcGVuQmFkZ2VzTW9kYWwgPSBvcGVuQmFkZ2VzTW9kYWw7XG4gICAgICAgIHZtLm9wZW5HYW1lTW9kYWwgPSBvcGVuR2FtZU1vZGFsO1xuICAgICAgICB2bS5vcGVuR2FtZU1vZGFsRnJvbVBsYXllck1vZGFsID0gb3BlbkdhbWVNb2RhbEZyb21QbGF5ZXJNb2RhbDtcbiAgICAgICAgdm0ub3Blbk1hbmFnZW1lbnRNb2RhbCA9IG9wZW5NYW5hZ2VtZW50TW9kYWw7XG4gICAgICAgIHZtLm9wZW5NdWx0aUdhbWVMZWFkZXJib2FyZE1vZGFsID0gb3Blbk11bHRpR2FtZUxlYWRlcmJvYXJkTW9kYWw7XG4gICAgICAgIHZtLm9wZW5QbGF5ZXJNb2RhbCA9IG9wZW5QbGF5ZXJNb2RhbDtcbiAgICAgICAgdm0ub3BlblBsYXllck1vZGFsRnJvbUdhbWVNb2RhbCA9IG9wZW5QbGF5ZXJNb2RhbEZyb21HYW1lTW9kYWw7XG4gICAgICAgIHZtLm9wZW5QbGF5ZXJNb2RhbEZyb21MZWFkZXJib2FyZE1vZGFsID0gb3BlblBsYXllck1vZGFsRnJvbUxlYWRlcmJvYXJkTW9kYWw7XG4gICAgICAgIHZtLm9wZW5SdWxlc01vZGFsID0gb3BlblJ1bGVzTW9kYWw7XG5cbiAgICAgICAgaW5pdEV2ZW50KCk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gY2xvc2VNb2RhbCgpIHtcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnLm1vZGFsJykuY2xvc2VNb2RhbCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVGVhbSgpIHtcbiAgICAgICAgICAgIHRlYW1TZXJ2aWNlLmNyZWF0ZVRlYW0odm0uZXZlbnROYW1lLCB2bS5uZXdUZWFtKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIE1hdGVyaWFsaXplLnRvYXN0KCdUZWFtICcgKyB2bS5uZXdUZWFtLnNob3J0TmFtZSArICcgY3JlYXRlZC4nLCA0MDAwKTtcbiAgICAgICAgICAgICAgICB2bS5uZXdUZWFtID0gbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZGV0ZXJtaW5lUG9pbnRzKGlucHV0U2NvcmVEYXRhLCBpbnB1dEluZGV4KSB7XG5cbiAgICAgICAgICAgIHZhciB1c2VyR2FtZVBvaW50cztcblxuICAgICAgICAgICAgLy8gTm8gcG9zaXRpb24gZ3JlYXRlciB0aGFuIDEyIGdldHMgcG9pbnRzLlxuICAgICAgICAgICAgaWYgKGlucHV0SW5kZXggPiAxMSkge1xuICAgICAgICAgICAgICAgIHVzZXJHYW1lUG9pbnRzID0gMDtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlckdhbWVQb2ludHM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHVzZXJHYW1lUG9pbnRzID0gMTIgLSBpbnB1dEluZGV4O1xuXG4gICAgICAgICAgICB2YXIgc29ydGVkU2NvcmVzID0gJGZpbHRlcignb3JkZXJCeScpKHZtLmdhbWVTY29yZXMsICctc2NvcmUnKTtcblxuICAgICAgICAgICAgLy8gQW0gSSB0aWVkIHdpdGggdGhlIHBlcnNvbiBhYm92ZSBtZT8gSWYgc28sIG1hdGNoIHRoZWlyIHBvaW50cy5cbiAgICAgICAgICAgIGlmIChzb3J0ZWRTY29yZXNbaW5wdXRJbmRleCAtIDFdKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc29ydGVkU2NvcmVzW2lucHV0SW5kZXggLSAxXS5zY29yZSA9PT0gaW5wdXRTY29yZURhdGEuc2NvcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdXNlckdhbWVQb2ludHMgKz0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB1c2VyR2FtZVBvaW50cztcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0Rmlyc3RQbGFjZVNjb3JlcygpIHtcblxuICAgICAgICAgICAgdm0uZ2FtZUxpc3QuZm9yRWFjaChmdW5jdGlvbihnYW1lKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSBhcmUgc2NvcmVzLCBnZXQgdGhlIHRvcCBvbmUuXG4gICAgICAgICAgICAgICAgaWYgKGdhbWUuc2NvcmVzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNjb3Jlc0FycmF5ID0gJC5tYXAoZ2FtZS5zY29yZXMsIGZ1bmN0aW9uKGVsKSB7IHJldHVybiBlbDsgfSk7XG4gICAgICAgICAgICAgICAgICAgIHNjb3Jlc0FycmF5ID0gJGZpbHRlcignb3JkZXJCeScpKHNjb3Jlc0FycmF5LCAnLXNjb3JlJyk7XG4gICAgICAgICAgICAgICAgICAgIGdhbWUuZmlyc3RTY29yZSA9IHNjb3Jlc0FycmF5WzBdO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ29Ub1BsYXllclByb2ZpbGUoaW5wdXRQbGF5ZXIpIHtcblxuICAgICAgICAgICAgY2xvc2VNb2RhbCgpO1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdwcm9maWxlJywge3VzZXJuYW1lOiBpbnB1dFBsYXllcn0pO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpbml0RXZlbnQoKSB7XG5cbiAgICAgICAgICAgIGV2ZW50U2VydmljZS5sb2FkRXZlbnRQcm9wZXJ0aWVzKHZtLmV2ZW50TmFtZSk7XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKSB7IHJldHVybiBldmVudFNlcnZpY2UuZ2V0RXZlbnRQcm9wZXJ0aWVzT2JqZWN0KCk7IH0sIGZ1bmN0aW9uKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgdm0uZXZlbnRQcm9wZXJ0aWVzID0gbW9kZWw7XG4gICAgICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbigpIHsgcmV0dXJuIGV2ZW50U2VydmljZS5nZXRHYW1lTGlzdE9iamVjdCgpOyB9LCBmdW5jdGlvbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLmdhbWVMaXN0ID0gbW9kZWw7XG4gICAgICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbigpIHsgcmV0dXJuIGV2ZW50U2VydmljZS5nZXRMZWFkZXJib2FyZExlbmd0aFZhbHVlKCk7IH0sIGZ1bmN0aW9uKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgdm0ubGVhZGVyYm9hcmRMZW5ndGggPSBtb2RlbDtcbiAgICAgICAgICAgIH0sIHRydWUpO1xuXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCkgeyByZXR1cm4gZXZlbnRTZXJ2aWNlLmdldFN1bW1hcml6ZWRMZWFkZXJib2FyZE9iamVjdCgpOyB9LCBmdW5jdGlvbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLnN1bW1hcml6ZWRMZWFkZXJib2FyZCA9IG1vZGVsO1xuICAgICAgICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKSB7IHJldHVybiBldmVudFNlcnZpY2UuZ2V0VGVhbUxpc3RPYmplY3QoKTsgfSwgZnVuY3Rpb24obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS50ZWFtTGlzdCA9IG1vZGVsO1xuICAgICAgICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgIHByb2ZpbGVTZXJ2aWNlLmdldEF2YXRhckRhdGEoKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5hdmF0YXJEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb3BlbkJhZGdlc01vZGFsKCkge1xuXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNiYWRnZXNNb2RhbCcpLm9wZW5Nb2RhbCgpO1xuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjYmFkZ2VzTW9kYWxDb250ZW50Jykuc2Nyb2xsVG9wKDApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuR2FtZU1vZGFsKGlucHV0R2FtZU5hbWUpIHtcblxuICAgICAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuXG4gICAgICAgICAgICBldmVudFNlcnZpY2UuZ2V0R2FtZURhdGEodm0uZXZlbnROYW1lLCBpbnB1dEdhbWVOYW1lKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5nYW1lRGF0YSA9IG1vZGVsO1xuXG4gICAgICAgICAgICAgICAgdm0uZ2FtZVNjb3JlcyA9ICRmaXJlYmFzZUFycmF5KFxuICAgICAgICAgICAgICAgICAgICByZWZcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnY29udGVzdHMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKHZtLmV2ZW50TmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnYWN0aXZlR2FtZXMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKHZtLmdhbWVEYXRhLiRpZClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnc2NvcmVzJylcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnI2dhbWVNb2RhbCcpLm9wZW5Nb2RhbCgpO1xuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjZ2FtZU1vZGFsJykuYWRkQ2xhc3MoJy5vcGVuLW1vZGFsJyk7XG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNnYW1lTW9kYWxDb250ZW50Jykuc2Nyb2xsVG9wKDApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuTWFuYWdlbWVudE1vZGFsKCkge1xuXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNtYW5hZ2VtZW50TW9kYWwnKS5vcGVuTW9kYWwoKTtcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnI21hbmFnZW1lbnRNb2RhbENvbnRlbnQnKS5zY3JvbGxUb3AoMCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG9wZW5NdWx0aUdhbWVMZWFkZXJib2FyZE1vZGFsKCkge1xuXG4gICAgICAgICAgICBldmVudFNlcnZpY2UuZ2V0TXVsdGlHYW1lTGVhZGVyYm9hcmQodm0uZXZlbnROYW1lKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5jb21wbGV0ZUxlYWRlcmJvYXJkID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjbXVsdGlHYW1lTGVhZGVyYm9hcmRNb2RhbCcpLm9wZW5Nb2RhbCgpO1xuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjbXVsdGlHYW1lTGVhZGVyYm9hcmRNb2RhbENvbnRlbnQnKS5zY3JvbGxUb3AoMCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG9wZW5QbGF5ZXJNb2RhbChpbnB1dFBsYXllcikge1xuXG4gICAgICAgICAgICB2bS5mb2N1c1BsYXllciA9IGlucHV0UGxheWVyO1xuXG4gICAgICAgICAgICBldmVudFNlcnZpY2UuZ2V0UGxheWVyU2NvcmVzKHZtLmV2ZW50TmFtZSwgdm0uZ2FtZUxpc3QsIHZtLmZvY3VzUGxheWVyKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5wbGF5ZXJTY29yZXMgPSBtb2RlbDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNwbGF5ZXJNb2RhbCcpLm9wZW5Nb2RhbCgpO1xuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjcGxheWVyTW9kYWxDb250ZW50Jykuc2Nyb2xsVG9wKDApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuR2FtZU1vZGFsRnJvbVBsYXllck1vZGFsKGlucHV0R2FtZSkge1xuXG4gICAgICAgICAgICBjbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBvcGVuR2FtZU1vZGFsKGlucHV0R2FtZSk7XG4gICAgICAgICAgICB9LCA0NTApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuUGxheWVyTW9kYWxGcm9tR2FtZU1vZGFsKGlucHV0UGxheWVyKSB7XG5cbiAgICAgICAgICAgIGNsb3NlTW9kYWwoKTtcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIG9wZW5QbGF5ZXJNb2RhbChpbnB1dFBsYXllcik7XG4gICAgICAgICAgICB9LCA0NTApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuUGxheWVyTW9kYWxGcm9tTGVhZGVyYm9hcmRNb2RhbChpbnB1dFBsYXllcikge1xuXG4gICAgICAgICAgICBjbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBvcGVuUGxheWVyTW9kYWwoaW5wdXRQbGF5ZXIpO1xuICAgICAgICAgICAgfSwgNDUwKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb3BlblJ1bGVzTW9kYWwoKSB7XG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNydWxlc01vZGFsJykub3Blbk1vZGFsKCk7XG4gICAgICAgIH1cblxuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuc2VydmljZSgndGVhbVNlcnZpY2UnLCB0ZWFtU2VydmljZSk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiB0ZWFtU2VydmljZSgkcSwgJGZpcmViYXNlQXJyYXksICRmaXJlYmFzZU9iamVjdCwgRklSRUJBU0VEQVRBKSB7XG5cbiAgICBcdHRoaXMuY3JlYXRlVGVhbSA9IGNyZWF0ZVRlYW07XG4gICAgICAgIHRoaXMuZ2V0VGVhbUxpc3QgPSBnZXRUZWFtTGlzdDtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVGVhbShpbnB1dEV2ZW50LCBpbnB1dE5ld1RlYW1Qcm9wZXJ0aWVzKSB7XG5cbiAgICAgICAgXHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIFx0dmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuICAgICAgICBcdHZhciB0ZWFtUG9vbCA9ICRmaXJlYmFzZU9iamVjdChcbiAgICAgICAgXHRcdHJlZlxuICAgICAgICBcdFx0XHQuY2hpbGQoJ2NvbnRlc3RzJylcbiAgICAgICAgXHRcdFx0LmNoaWxkKGlucHV0RXZlbnQpXG4gICAgICAgIFx0XHRcdC5jaGlsZCgndGVhbVBvb2wnKVxuICAgICAgICBcdCk7XG5cbiAgICAgICAgXHR0ZWFtUG9vbC4kbG9hZGVkKCkudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICBcdFx0dGVhbVBvb2xbaW5wdXROZXdUZWFtUHJvcGVydGllcy5zaG9ydE5hbWVdID0ge1xuICAgICAgICBcdFx0XHRmdWxsTmFtZTogaW5wdXROZXdUZWFtUHJvcGVydGllcy5mb3JtYWxOYW1lXG4gICAgICAgIFx0XHR9O1xuICAgICAgICBcdFx0dGVhbVBvb2wuJHNhdmUoKTtcbiAgICAgICAgXHRcdGRlZmVycmVkLnJlc29sdmUoKTtcblxuICAgICAgICBcdH0pO1xuXG4gICAgICAgIFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldFRlYW1MaXN0KGlucHV0RXZlbnQpIHtcblxuICAgICAgICBcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgXHR2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG4gICAgICAgIFx0dmFyIHRlYW1MaXN0ID0gJGZpcmViYXNlQXJyYXkoXG4gICAgICAgIFx0XHRyZWZcbiAgICAgICAgXHRcdFx0LmNoaWxkKCdjb250ZXN0cycpXG4gICAgICAgIFx0XHRcdC5jaGlsZChpbnB1dEV2ZW50KVxuICAgICAgICBcdFx0XHQuY2hpbGQoJ3RlYW1Qb29sJylcbiAgICAgICAgXHQpO1xuXG4gICAgICAgIFx0dGVhbUxpc3QuJGxvYWRlZCgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIFx0XHRkZWZlcnJlZC5yZXNvbHZlKHRlYW1MaXN0KTtcbiAgICAgICAgXHR9KTtcblxuICAgICAgICBcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3ZnR2FtZXNMaXN0JywgdmdHYW1lc0xpc3QpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gdmdHYW1lc0xpc3QgKCkge1xuICAgICAgICAvLyBVc2FnZTpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gQ3JlYXRlczpcbiAgICAgICAgLy9cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBHYW1lc0xpc3RDb250cm9sbGVyLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgbGluazogbGluayxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy4vYXBwL2V2ZW50Q29tcG9uZW50cy9nYW1lc0xpc3QuZGlyZWN0aXZlLmh0bScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgXHRkYXRhOiAnPScsXG4gICAgICAgICAgICBcdG9wZW5HYW1lRnVuY3Rpb246ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBHYW1lc0xpc3RDb250cm9sbGVyKCkge1xuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgXHR2YXIgdm0gPSB0aGlzO1xuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgndmdNdWx0aUdhbWVMZWFkZXJib2FyZCcsIHZnTXVsdGlHYW1lTGVhZGVyYm9hcmQpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gdmdNdWx0aUdhbWVMZWFkZXJib2FyZCAoKSB7XG4gICAgICAgIC8vIFVzYWdlOlxuICAgICAgICAvL1xuICAgICAgICAvLyBDcmVhdGVzOlxuICAgICAgICAvL1xuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IE11bHRpR2FtZUxlYWRlcmJvYXJkQ29udHJvbGxlcixcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmssXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuL2FwcC9ldmVudENvbXBvbmVudHMvbXVsdGlHYW1lTGVhZGVyYm9hcmQuZGlyZWN0aXZlLmh0bScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgXHRkYXRhOiAnPScsXG4gICAgICAgICAgICAgICAgYXZhdGFyRGF0YTogJz0nLFxuICAgICAgICAgICAgXHRjb21wbGV0ZUxlbmd0aDogJz0nLFxuICAgICAgICAgICAgXHRvcGVuUGxheWVyRnVuY3Rpb246ICc9JyxcbiAgICAgICAgICAgICAgICBvcGVuTGVhZGVyYm9hcmRGdW5jdGlvbjogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIE11bHRpR2FtZUxlYWRlcmJvYXJkQ29udHJvbGxlcigpIHtcbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgIFx0dmFyIHZtID0gdGhpcztcbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3ZnU2luZ2xlR2FtZUxlYWRlcmJvYXJkJywgdmdTaW5nbGVHYW1lTGVhZGVyYm9hcmQpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gdmdTaW5nbGVHYW1lTGVhZGVyYm9hcmQgKCkge1xuICAgICAgICAvLyBVc2FnZTpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gQ3JlYXRlczpcbiAgICAgICAgLy9cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBTaW5nbGVHYW1lTGVhZGVyYm9hcmRDb250cm9sbGVyLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgbGluazogbGluayxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy4vYXBwL2V2ZW50Q29tcG9uZW50cy9zaW5nbGVHYW1lTGVhZGVyYm9hcmQuZGlyZWN0aXZlLmh0bScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgXHRkYXRhOiAnPScsXG4gICAgICAgICAgICAgICAgYXZhdGFyRGF0YTogJz0nLFxuICAgICAgICAgICAgXHRjb21wbGV0ZUxlbmd0aDogJz0nLFxuICAgICAgICAgICAgICAgIG9wZW5MZWFkZXJib2FyZEZ1bmN0aW9uOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gU2luZ2xlR2FtZUxlYWRlcmJvYXJkQ29udHJvbGxlcigpIHtcbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgIFx0dmFyIHZtID0gdGhpcztcbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3ZnU3RpY2t5TWVzc2FnZScsIHZnU3RpY2t5TWVzc2FnZSk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiB2Z1N0aWNreU1lc3NhZ2UgKCkge1xuICAgICAgICAvLyBVc2FnZTpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gQ3JlYXRlczpcbiAgICAgICAgLy9cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBTdGlja3lNZXNzYWdlQ29udHJvbGxlcixcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmssXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuL2FwcC9ldmVudENvbXBvbmVudHMvc3RpY2t5TWVzc2FnZS5kaXJlY3RpdmUuaHRtJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBcdHByb3BlcnRpZXM6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBTdGlja3lNZXNzYWdlQ29udHJvbGxlcigkdGltZW91dCkge1xuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgXHR2YXIgdm0gPSB0aGlzO1xuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0hlYWRlckNvbnRyb2xsZXInLCBIZWFkZXJDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIEhlYWRlckNvbnRyb2xsZXIoJHRpbWVvdXQsICRyb290U2NvcGUsICR3aW5kb3csICRzdGF0ZSwgYXV0aFNlcnZpY2UpIHtcblxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIHZtLmxvZ091dCA9IGxvZ091dDtcblxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJy5kcm9wZG93bi1idXR0b24nKVxuICAgICAgICAgICAgICAgICAgICAuZHJvcGRvd24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5EdXJhdGlvbjogMzAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0RHVyYXRpb246IDIyNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbl93aWR0aDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBob3ZlcjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBndXR0ZXI6IC0xMTQsXG4gICAgICAgICAgICAgICAgICAgICAgICBiZWxvd09yaWdpbjogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIDQwMCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsb2dPdXQoKSB7XG4gICAgICAgICAgICBhdXRoU2VydmljZS5sb2dPdXQoKTtcbiAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmZpbHRlcignb3JkZXJPYmplY3RCeScsIG9yZGVyT2JqZWN0QnkpO1xuXG4gICAgZnVuY3Rpb24gb3JkZXJPYmplY3RCeSgpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGl0ZW1zLCBmaWVsZCwgcmV2ZXJzZSkge1xuICAgICAgICAgICAgdmFyIGZpbHRlcmVkID0gW107XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpdGVtcywgZnVuY3Rpb24oaXRlbSwga2V5KSB7XG4gICAgICAgICAgICAgICAgaXRlbS5rZXkgPSBrZXk7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWQucHVzaChpdGVtKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBmaWx0ZXJlZC5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChhW2ZpZWxkXSA+IGJbZmllbGRdID8gMSA6IC0xKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZihyZXZlcnNlKSBmaWx0ZXJlZC5yZXZlcnNlKCk7XG5cbiAgICAgICAgICAgIHJldHVybiBmaWx0ZXJlZDtcbiAgICAgICAgfTtcbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0F2YXRhckNvbnRyb2xsZXInLCBBdmF0YXJDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIEF2YXRhckNvbnRyb2xsZXIoJHJvb3RTY29wZSwgJHN0YXRlLCAkc3RhdGVQYXJhbXMsICR0aW1lb3V0LCBVcGxvYWQsIGltZ3VyLCBwcm9maWxlU2VydmljZSkge1xuXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgdm0udXBsb2FkQXZhdGFyID0gdXBsb2FkQXZhdGFyO1xuXG4gICAgICAgIGFjdGl2YXRlKCk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xuICAgICAgICBcdHByb2ZpbGVTZXJ2aWNlLmdldEF2YXRhckRhdGEoKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5hdmF0YXJEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gRklYTUU6IFRoaXMgbmVlZHMgdG8gYmUgdHJpZ2dlcmVkIGJ5IGEgJHJvb3RTY29wZSBicm9hZGNhc3Qgb2Ygd2hlbiBpdCByZWNlaXZlcyBwcm9maWxlIGRhdGEuXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwcm9maWxlU2VydmljZS5nZXRCYWRnZXNEYXRhKCRyb290U2NvcGUucHJvZmlsZS51c2VyTmFtZSkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmJhZGdlc0RhdGEgPSBtb2RlbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1cGxvYWRBdmF0YXIoKSB7XG5cbiAgICAgICAgXHR2bS5kaXNhYmxlQnV0dG9uID0gdHJ1ZTtcblxuICAgICAgICBcdGltZ3VyLnNldEFQSUtleSgnQ2xpZW50LUlEIGY1M2Q2ZDU4MzNiMDdiYycpO1xuICAgICAgICBcdGltZ3VyLnVwbG9hZCh2bS5maWxlKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgXHRcdHByb2ZpbGVTZXJ2aWNlLnNhdmVBdmF0YXJMaW5rKG1vZGVsWzBdLmxpbmssICRyb290U2NvcGUucHJvZmlsZS51c2VyTmFtZSk7XG4gICAgICAgIFx0XHRNYXRlcmlhbGl6ZS50b2FzdCgnWW91ciBhdmF0YXIgd2FzIHVwbG9hZGVkJywgNDAwMCk7XG5cbiAgICAgICAgXHRcdCR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICBcdFx0XHQkc3RhdGUuZ28oJ2hvbWUnKTtcbiAgICAgICAgXHRcdH0sIDEwMDApO1xuICAgICAgICBcdH0pO1xuXG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0NoYW5nZVBhc3N3b3JkQ29udHJvbGxlcicsIENoYW5nZVBhc3N3b3JkQ29udHJvbGxlcik7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBDaGFuZ2VQYXNzd29yZENvbnRyb2xsZXIoJHNjb3BlLCAkdGltZW91dCwgJHN0YXRlLCBBdXRoV3JhcHBlcikge1xuXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHZtLnN1Ym1pdENoYW5nZVBhc3N3b3JkID0gc3VibWl0Q2hhbmdlUGFzc3dvcmQ7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gc3VibWl0Q2hhbmdlUGFzc3dvcmQoKSB7XG5cbiAgICAgICAgICAgIGlmICgkc2NvcGUucHdDaGFuZ2VGb3JtLiR2YWxpZCkge1xuXG4gICAgICAgICAgICAgICAgQXV0aFdyYXBwZXIuJGNoYW5nZVBhc3N3b3JkKHtcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6IEF1dGhXcmFwcGVyLiRnZXRBdXRoKCkucGFzc3dvcmQuZW1haWwsXG4gICAgICAgICAgICAgICAgICAgIG9sZFBhc3N3b3JkOiB2bS5pbnB1dEN1cnJlbnRQYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgbmV3UGFzc3dvcmQ6IHZtLmlucHV0TmV3UGFzc3dvcmRcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIE1hdGVyaWFsaXplLnRvYXN0KCdZb3VyIHBhc3N3b3JkIHdhcyBjaGFuZ2VkLicsIDQwMDApO1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xuICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKTtcblxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ0lOVkFMSURfUEFTU1dPUkQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zaG93Q2hhbmdlUGFzc3dvcmRNZXNzYWdlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0hvbWVDb250cm9sbGVyJywgSG9tZUNvbnRyb2xsZXIpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gSG9tZUNvbnRyb2xsZXIoJHNjb3BlLCAkdGltZW91dCkge1xuXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuY29udHJvbGxlcignTGVhZGVyYm9hcmRDb250cm9sbGVyJywgTGVhZGVyYm9hcmRDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIExlYWRlcmJvYXJkQ29udHJvbGxlcigkcSwgJHRpbWVvdXQsICRmaXJlYmFzZUFycmF5LCBwcm9maWxlU2VydmljZSwgRklSRUJBU0VEQVRBKSB7XG5cbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgIFx0dmFyIHZtID0gdGhpcztcblxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgICAgICAgICAgIGdldFByb2ZpbGVTY29yZXMoKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5wcm9maWxlU2NvcmVEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcHJvZmlsZVNlcnZpY2UuZ2V0QXZhdGFyRGF0YSgpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLmF2YXRhckRhdGEgPSBtb2RlbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0UHJvZmlsZVNjb3JlcygpIHtcblxuICAgICAgICBcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgIFx0dmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuXG4gICAgICAgIFx0dmFyIHByb2ZpbGVTY29yZURhdGEgPSAkZmlyZWJhc2VBcnJheShcbiAgICAgICAgXHRcdHJlZlxuICAgICAgICBcdFx0XHQuY2hpbGQoJ2JhZGdlcycpXG4gICAgICAgIFx0KTtcblxuICAgICAgICBcdHByb2ZpbGVTY29yZURhdGEuJGxvYWRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgXHRcdGRlZmVycmVkLnJlc29sdmUocHJvZmlsZVNjb3JlRGF0YSk7XG4gICAgICAgIFx0fSk7XG5cbiAgICAgICAgXHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdQcm9maWxlQ29udHJvbGxlcicsIFByb2ZpbGVDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIFByb2ZpbGVDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlUGFyYW1zLCAkcSwgJHRpbWVvdXQsICRzdGF0ZSwgJGZpcmViYXNlQXJyYXksIGF1dGhTZXJ2aWNlLCBwcm9maWxlU2VydmljZSwgZXZlbnRTZXJ2aWNlKSB7XG5cbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgYWN0aXZhdGUoKTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcblxuICAgICAgICAgICAgcHJvZmlsZVNlcnZpY2UuZ2V0VXNlckRhdGEoJHN0YXRlUGFyYW1zLnVzZXJuYW1lKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5wcm9maWxlRGF0YSA9IG1vZGVsO1xuXG4gICAgICAgICAgICAgICAgcHJvZmlsZVNlcnZpY2UuZ2V0VG91cm5hbWVudEhpc3Rvcnkodm0ucHJvZmlsZURhdGEpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG91cm5hbWVudEhpc3RvcnlEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICAgICAgICAgIHZtLmV2ZW50U3RhbmRpbmdzID0gcHJvZmlsZVNlcnZpY2UuZ2V0VG91cm5hbWVudFN0YW5kaW5ncyh0b3VybmFtZW50SGlzdG9yeURhdGEsICRzdGF0ZVBhcmFtcy51c2VybmFtZSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAkKCcuY29sbGFwc2libGUnKS5jb2xsYXBzaWJsZSh7XG4gICAgICAgICAgICAgICAgICAgIGFjY29yZGlvbjogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHByb2ZpbGVTZXJ2aWNlLmdldEF2YXRhckRhdGEoKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5hdmF0YXJEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcHJvZmlsZVNlcnZpY2UuZ2V0QmFkZ2VzRGF0YSgkc3RhdGVQYXJhbXMudXNlcm5hbWUpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLmJhZGdlc0RhdGEgPSBtb2RlbDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuc2VydmljZSgncHJvZmlsZVNlcnZpY2UnLCBwcm9maWxlU2VydmljZSk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBwcm9maWxlU2VydmljZSgkcm9vdFNjb3BlLCAkcSwgJGZpcmViYXNlQXJyYXksICRmaXJlYmFzZU9iamVjdCwgZXZlbnRTZXJ2aWNlLCBGSVJFQkFTRURBVEEpIHtcblxuICAgIFx0dGhpcy5nZXRBdmF0YXJEYXRhID0gZ2V0QXZhdGFyRGF0YTtcbiAgICAgICAgdGhpcy5nZXRCYWRnZXNEYXRhID0gZ2V0QmFkZ2VzRGF0YTtcbiAgICBcdHRoaXMuZ2V0VG91cm5hbWVudEhpc3RvcnkgPSBnZXRUb3VybmFtZW50SGlzdG9yeTtcbiAgICAgICAgdGhpcy5nZXRUb3VybmFtZW50U3RhbmRpbmdzID0gZ2V0VG91cm5hbWVudFN0YW5kaW5ncztcbiAgICAgICAgdGhpcy5nZXRVc2VyRGF0YSA9IGdldFVzZXJEYXRhO1xuICAgICAgICB0aGlzLnNhdmVBdmF0YXJMaW5rID0gc2F2ZUF2YXRhckxpbms7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldEF2YXRhckRhdGEoKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgIHZhciBhdmF0YXJEYXRhID0gJGZpcmViYXNlT2JqZWN0KFxuICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoJ2F2YXRhcnMnKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgYXZhdGFyRGF0YS4kbG9hZGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoYXZhdGFyRGF0YSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEJhZGdlc0RhdGEoaW5wdXRVc2VyKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgIHZhciBiYWRnZXNEYXRhID0gJGZpcmViYXNlT2JqZWN0KFxuICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoJ2JhZGdlcycpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZChpbnB1dFVzZXIpXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBiYWRnZXNEYXRhLiRsb2FkZWQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShiYWRnZXNEYXRhKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0VG91cm5hbWVudEhpc3RvcnkoaW5wdXRVc2VyRGF0YSkge1xuXG4gICAgICAgIFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgXHR2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgXHQvLyBMb29wIHRocm91Z2ggZWFjaCBldmVudCBpbiB0aGUgcGxlZGdlZFRvIG9iamVjdC5cbiAgICAgICAgXHR2YXIgZXZlbnRzQXJyYXkgPSBbXTtcbiAgICAgICAgXHRmb3IgKHZhciBrZXkgaW4gaW5wdXRVc2VyRGF0YS5wbGVkZ2VkVG8pIHtcbiAgICAgICAgXHRcdGV2ZW50c0FycmF5LnB1c2goa2V5KTtcbiAgICAgICAgXHR9XG5cbiAgICAgICAgXHRkZWZlcnJlZC5yZXNvbHZlKGV2ZW50c0FycmF5KTtcblxuICAgICAgICBcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRUb3VybmFtZW50U3RhbmRpbmdzKGlucHV0VG91cm5hbWVudEhpc3RvcnksIGlucHV0VXNlcikge1xuXG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCBlYWNoIGV2ZW50IGluIHRoZSB1c2VyJ3MgaGlzdG9yeS5cbiAgICAgICAgICAgIHZhciBldmVudFN0YW5kaW5ncyA9IFtdO1xuICAgICAgICAgICAgaW5wdXRUb3VybmFtZW50SGlzdG9yeS5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICAgICAgICAgICAgICBldmVudFNlcnZpY2UuZ2V0RXZlbnRQcm9wZXJ0aWVzKGV2ZW50KS50aGVuKGZ1bmN0aW9uKGV2ZW50UHJvcGVydGllcykge1xuXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50UHJvcGVydGllcy4kbG9hZGVkKCkudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgY29uY2x1ZGVkLCBnZXQgdGhlIHVzZXIncyBzdGFuZGluZy5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudFByb3BlcnRpZXMuc3RhdGUgPT09ICdjb25jbHVkZWQnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRTdGFuZGluZ0RhdGEgPSAkZmlyZWJhc2VPYmplY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKCdzdGFuZGluZ3MnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKGV2ZW50KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFN0YW5kaW5nRGF0YS4kbG9hZGVkKCkudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnRTdGFuZGluZ0RhdGFbaW5wdXRVc2VyXSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFN0YW5kaW5ncy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBldmVudFByb3BlcnRpZXMubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVtaWVyOiBldmVudFByb3BlcnRpZXMucHJlbWllciA/IHRydWUgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3J0TmFtZTogZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6ICdjb25jbHVkZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBldmVudFByb3BlcnRpZXMuY29sb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGV2ZW50U3RhbmRpbmdEYXRhW2lucHV0VXNlcl1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U3RhbmRpbmdzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGV2ZW50UHJvcGVydGllcy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZW1pZXI6IGV2ZW50UHJvcGVydGllcy5wcmVtaWVyID8gdHJ1ZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnROYW1lOiBldmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogJ2NvbmNsdWRlZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGV2ZW50UHJvcGVydGllcy5jb2xvcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogLTFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50UHJvcGVydGllcy5zdGF0ZSA9PT0gJ2lucHJvZ3Jlc3MnIHx8IGV2ZW50UHJvcGVydGllcy5zdGF0ZSA9PT0gJ3VwY29taW5nJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTdGFuZGluZ3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGV2ZW50UHJvcGVydGllcy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVtaWVyOiBldmVudFByb3BlcnRpZXMucHJlbWllciA/IHRydWUgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG9ydE5hbWU6IGV2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogZXZlbnRQcm9wZXJ0aWVzLmNvbG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogZXZlbnRQcm9wZXJ0aWVzLnN0YXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGV2ZW50U3RhbmRpbmdzO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRVc2VyRGF0YShpbnB1dFVzZXIpIHtcblxuICAgICAgICBcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgIFx0dmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuXG4gICAgICAgIFx0dmFyIHVzZXJzRGF0YSA9ICRmaXJlYmFzZUFycmF5KFxuICAgICAgICBcdFx0cmVmXG4gICAgICAgIFx0XHRcdC5jaGlsZCgndXNlcnMnKVxuICAgICAgICBcdCk7XG5cbiAgICAgICAgXHR1c2Vyc0RhdGEuJGxvYWRlZChmdW5jdGlvbigpIHtcblxuICAgICAgICBcdFx0dXNlcnNEYXRhLmZvckVhY2goZnVuY3Rpb24odXNlcikge1xuICAgICAgICBcdFx0XHRpZiAodXNlci51c2VyTmFtZSA9PT0gaW5wdXRVc2VyKSB7XG4gICAgICAgIFx0XHRcdFx0ZGVmZXJyZWQucmVzb2x2ZSh1c2VyKTtcbiAgICAgICAgXHRcdFx0fVxuICAgICAgICBcdFx0fSk7XG5cbiAgICAgICAgXHR9KTtcblxuICAgICAgICBcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICAvLyBGSVhNRTogTWFrZSB0aGlzIHNlcnZlci1zaWRlLlxuICAgICAgICBmdW5jdGlvbiBzYXZlQXZhdGFyTGluayhpbnB1dExpbmssIGlucHV0VXNlcikge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgIHZhciBhdmF0YXJEYXRhID0gJGZpcmViYXNlT2JqZWN0KFxuICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoJ2F2YXRhcnMnKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgYXZhdGFyRGF0YS4kbG9hZGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGF2YXRhckRhdGFbaW5wdXRVc2VyXSA9IGlucHV0TGluaztcbiAgICAgICAgICAgICAgICBhdmF0YXJEYXRhLiRzYXZlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdSZWdDb250cm9sbGVyJywgUmVnQ29udHJvbGxlcik7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBSZWdDb250cm9sbGVyKCRzY29wZSwgJHJvb3RTY29wZSwgJHRpbWVvdXQsICR3aW5kb3csICRzdGF0ZSwgJGZpcmViYXNlT2JqZWN0LCBhdXRoU2VydmljZSwgQXV0aFdyYXBwZXIpIHtcblxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0ubG9naW5Ub0FjY291bnQgPSBsb2dpblRvQWNjb3VudDtcbiAgICAgICAgdm0ucGFzc3dvcmRSZXNldCA9IHBhc3N3b3JkUmVzZXQ7XG4gICAgICAgIHZtLnN1Ym1pdE5ld0FjY291bnQgPSBzdWJtaXROZXdBY2NvdW50O1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGxvZ2luVG9BY2NvdW50KCkge1xuXG4gICAgICAgICAgICBhdXRoU2VydmljZS5sb2dpblRvQWNjb3VudCh2bS5sb2dpbkVtYWlsLCB2bS5sb2dpblBhc3N3b3JkKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcblxuICAgICAgICAgICAgICAgIHZtLnNob3dJbnZhbGlkVXNlckVycm9yID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdm0uc2hvd0ludmFsaWRQYXNzd29yZEVycm9yID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAobW9kZWwgPT09ICdMT0dJTl9TVUNDRVNTJykge1xuXG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtb2RlbCA9PT0gJ0lOVkFMSURfVVNFUicpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uc2hvd0ludmFsaWRVc2VyRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtb2RlbCA9PT0gJ0lOVkFMSURfUEFTU1dPUkQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dJbnZhbGlkUGFzc3dvcmRFcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcGFzc3dvcmRSZXNldCgpIHtcblxuICAgICAgICAgICAgaWYgKCF2bS5sb2dpbkVtYWlsKSB7XG4gICAgICAgICAgICAgICAgdm0uc2hvd1Bhc3N3b3JkUmVzZXRFbWFpbE1lc3NhZ2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgQXV0aFdyYXBwZXIuJHJlc2V0UGFzc3dvcmQoe1xuICAgICAgICAgICAgICAgIGVtYWlsOiB2bS5sb2dpbkVtYWlsXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZtLnNob3dQYXNzd29yZFJlc2V0RW1haWxNZXNzYWdlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgTWF0ZXJpYWxpemUudG9hc3QoJ0EgcGFzc3dvcmQgcmVzZXQgZW1haWwgaGFzIGJlZW4gc2VudCB0byAnICsgdm0ubG9naW5FbWFpbCArICcuJywgNDAwMCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3VibWl0TmV3QWNjb3VudCgpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gRG9lcyB0aGUgdXNlciBleGlzdD8gSWYgc28sIHNob3cgYW4gZXJyb3IgbWVzc2FnZS5cbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmNoZWNrSWZVc2VyRXhpc3RzKHZtLm5ld1VzZXJuYW1lKS50aGVuKGZ1bmN0aW9uKHVzZXJFeGlzdHMpIHtcblxuICAgICAgICAgICAgICAgIHZtLnNob3dEdXBsaWNhdGVVc2VyRXJyb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2bS5zaG93RW1haWxUYWtlbkVycm9yID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAodXNlckV4aXN0cykge1xuXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dEdXBsaWNhdGVVc2VyRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICAvLyBUcnkgdG8gY3JlYXRlIHRoZSBuZXcgdXNlci5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmNyZWF0ZU5ld1VzZXIodm0ubmV3RW1haWwsIHZtLm5ld1Bhc3N3b3JkLCB2bS5uZXdVc2VybmFtZSkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2RlbCA9PT0gJ0VNQUlMX1RBS0VOJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2hvd0VtYWlsVGFrZW5FcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vZGVsID09PSAnQUNDT1VOVF9DUkVBVEVEJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdwcm9maWxlJywge3VzZXJuYW1lOiB2bS5uZXdVc2VybmFtZX0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=