(function() {
    'use strict';

    angular
        .module('vg.app', [
            /* Angular modules */
            'ngAnimate',
            /* App modules */
            /* Third-party modules */
            'ui.router',
            'firebase',
            'validation.match',
            'ordinal',
            'ngFileUpload',
            'ngImgur'
        ]);
})();;(function() {
	'use strict';

	angular
		.module('vg.app')
		.constant('FIREBASEDATA', {
			'FBURL': 'https://wolfscontests.firebaseio.com'
		})
		.config(config);

	/* @ngInject */
	function config($stateProvider, $urlRouterProvider) {

		// Redirect any unmatched URL to /.
		$urlRouterProvider.otherwise('/');

		$stateProvider
		    .state('home', {
		    	url: '/',
		    	templateUrl: 'app/home/home.htm',
		    	controller: 'HomeController as home'
		    })

		    .state('registerOrLogin', {
		    	url: '/registerOrLogin',
		    	templateUrl: '/app/home/reg.htm',
		    	controller: 'RegController as reg'
		    })

		    .state('profile', {
		    	url: '/profile/:username',
		    	templateUrl: '/app/home/profile.htm',
		    	controller: 'ProfileController as profile'
		    })

		    .state('leaderboard', {
		    	url: '/leaderboard',
		    	templateUrl: '/app/home/leaderboard.htm',
		    	controller: 'LeaderboardController as leaderboard'
		    })

		    .state('event', {
		    	url: '/event/:eventName/main',
		    	templateUrl: '/app/event/main.htm',
		    	controller: 'EventMainController as event'
		    })

		    .state('customizeAvatar', {
		    	url: '/customizeAvatar',
		    	templateUrl: '/app/home/avatar.htm',
		    	controller: 'AvatarController as avatar',

		    	resolve: {
		    		'currentAuth': ['AuthWrapper', function(AuthWrapper) {
		    			return AuthWrapper.$requireAuth();
		    		}]
		    	}
		    })

		    .state('changePassword', {
		    	url: '/changePassword',
		    	templateUrl: '/app/home/changePassword.htm',
		    	controller: 'ChangePasswordController as pwchange',

		    	resolve: {
		    		'currentAuth': ['AuthWrapper', function(AuthWrapper) {
		    			return AuthWrapper.$requireAuth();
		    		}]
		    	}
		    });
	}
	config.$inject = ["$stateProvider", "$urlRouterProvider"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .run(run);

    function run($rootScope, $location, $state, $firebaseObject, AuthWrapper, FIREBASEDATA) {

        $rootScope.$on('$stateChangeError', function(event, toState, toParams, fromState, fromParams, error) {
            if (error === 'AUTH_REQUIRED') {
                $state.go('registerOrLogin');
            }
        });

        $rootScope.$on('$stateChangeSuccess', function() {

            // If user is logged in, download their profile data to an object in $rootScope.
            // FIXME: We shouldn't need to do this every successful state change.
            if (AuthWrapper.$getAuth()) {
                
                var authData = AuthWrapper.$getAuth();
                var ref = new Firebase(FIREBASEDATA.FBURL);

                var profileData = $firebaseObject(ref.child('users').child(authData.uid));
                profileData.$bindTo($rootScope, 'profile').then(function(unbind) {
                    $rootScope.unbindFunction = unbind;
                });

            }

        });

    }
    run.$inject = ["$rootScope", "$location", "$state", "$firebaseObject", "AuthWrapper", "FIREBASEDATA"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('authService', authService);

    /* @ngInject */
    function authService($q, $rootScope, $state, $window, $timeout, $firebaseObject, AuthWrapper, FIREBASEDATA) {
        
        this.testData = 'hello world!';

    	this.checkIfUserExists = checkIfUserExists;
    	this.createNewUser = createNewUser;
        this.loginToAccount = loginToAccount;
        this.logOut = logOut;

    	///////////////////

    	function checkIfUserExists(inputUsername) {

    		var deferred = $q.defer();

    		var doesUserExist = false;
    		var usersRef = new $window.Firebase(FIREBASEDATA.FBURL + '/users');

    		usersRef.once('value', function(dataSnapshot) {

                $timeout(function() {
                    dataSnapshot.forEach(function(user) {
                        if (user.val().userName === inputUsername) {
                            doesUserExist = true;
                        }
                    });

                    deferred.resolve(doesUserExist);
                });

    		});

    		return deferred.promise;

    	}

    	function createNewUser(inputEmail, inputPassword, inputUsername) {

            var deferred = $q.defer();

    		AuthWrapper.$createUser({
    			email: inputEmail,
    			password: inputPassword
    		}).then(function(userData) {

    			// Create a data entry for the new username.
    			new Firebase(FIREBASEDATA.FBURL).child('users/' + userData.uid).set({

    				userName: inputUsername,
    				role: 'User'

    			}, function(errorData) {
    				console.error(errorData);
                    return errorData.code;
    			});

                // Create a data entry for the user's avatar.
                new Firebase(FIREBASEDATA.FBURL).child('avatars').child(inputUsername).set('http://api.adorable.io/avatars/42/' + inputUsername);

    			// Log the user in.
    			AuthWrapper.$authWithPassword({
    				email: inputEmail,
    				password: inputPassword
    			}).then(function() {
                    deferred.resolve('ACCOUNT_CREATED');
                });

    		}).catch(function(errorData) {

    			console.error(errorData);

    			if (errorData.code === 'EMAIL_TAKEN') {
                    deferred.resolve(errorData.code);
    			}

    		});

            return deferred.promise;

    	}

        function loginToAccount(inputEmail, inputPassword) {

            var deferred = $q.defer();

            AuthWrapper.$authWithPassword({
                email: inputEmail,
                password: inputPassword
            }).then(function(authData) {

                deferred.resolve('LOGIN_SUCCESS');

            }).catch(function(errorData) {

                if (errorData.code === 'INVALID_USER') {
                    deferred.resolve('INVALID_USER');
                } else if (errorData.code === 'INVALID_PASSWORD') {
                    deferred.resolve('INVALID_PASSWORD');
                }

            });

            return deferred.promise;

        }

        function logOut() {
            AuthWrapper.$unauth();
            $rootScope.unbindFunction();
        }

    }
    authService.$inject = ["$q", "$rootScope", "$state", "$window", "$timeout", "$firebaseObject", "AuthWrapper", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .factory('AuthWrapper', AuthWrapper);

    /* @ngInject */
    function AuthWrapper($firebaseAuth, FIREBASEDATA) {

        var ref = new Firebase(FIREBASEDATA.FBURL);
        return $firebaseAuth(ref);

    }
    AuthWrapper.$inject = ["$firebaseAuth", "FIREBASEDATA"];
    
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('eventService', eventService);

    /* @ngInject */
    function eventService($q, $filter, $firebaseObject, $firebaseArray, FIREBASEDATA) {

        var _eventProperties = null;
        var _gameList = null;
        var _leaderboardLength = null;
        var _summarizedLeaderboard = null;
        var _teamList = null;

        this.createMultiGameFinalStandings = createMultiGameFinalStandings;
        this.getEventProperties = getEventProperties;
        this.getEventPropertiesObject = getEventPropertiesObject;
        this.getGameData = getGameData;
        this.getGameListObject = getGameListObject;
        this.getGamesList = getGamesList;
        this.getLeaderboardLengthValue = getLeaderboardLengthValue;
        this.getMultiGameLeaderboard = getMultiGameLeaderboard;
        this.getPlayerScores = getPlayerScores;
        this.getSingleGameLeaderboard = getSingleGameLeaderboard;
        this.getSummarizedLeaderboardObject = getSummarizedLeaderboardObject;
        this.getTeamListObject = getTeamListObject;
        this.loadEventProperties = loadEventProperties;

        ////////////////

        function createMultiGameFinalStandings(inputEvent) {

            // Calculate the final standings of the event.
            getMultiGameLeaderboard(inputEvent).then(function then(model) {

                var ref = new Firebase(FIREBASEDATA.FBURL);
                var inputEventStandings = $firebaseObject(
                    ref
                        .child('standings')
                        .child(inputEvent)
                );

                inputEventStandings.$loaded().then(function() {

                    model.forEach(function(standing) {
                        inputEventStandings[standing.key] = standing.position;
                    });

                    inputEventStandings.$save();

                });

            });

        }

        function getEventProperties(inputEvent) {

            var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var eventProperties = $firebaseObject(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('properties')
        	);

            deferred.resolve(eventProperties);

        	return deferred.promise;

        }

        function getEventPropertiesObject() {
            return _eventProperties;
        }

        function getFirstPlaceScores() {

            _gameList.forEach(function(game) {

                // If there are scores, get the top one.
                if (game.scores) {

                    var scoresArray = $.map(game.scores, function(el) { return el; });
                    scoresArray = $filter('orderBy')(scoresArray, '-score');
                    game.firstScore = scoresArray[0];

                }

            });

        }

        function getGameData(inputEvent, inputGame) {

            var deferred = $q.defer();

            var ref = new Firebase(FIREBASEDATA.FBURL);

            getGamesList(inputEvent).then(function(gamesList) {

                gamesList.forEach(function(game) {

                    if (game.camelName === inputGame) {
                        deferred.resolve(game);
                    }

                });

            });

            return deferred.promise;

        }

        function getGameListObject() {
            return _gameList;
        }

        function getGamesList(inputEvent) {

        	var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var gamesList = $firebaseArray(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('activeGames')
        	);

        	gamesList.$loaded().then(function() {
        		deferred.resolve(gamesList);
        	});

        	return deferred.promise;

        }

        function getLeaderboardLengthValue() {
            return _leaderboardLength;
        }

        function getMultiGameLeaderboard(inputEvent) {

        	var deferred = $q.defer();

        	// We need to get the top 12 players for every game.
        	var playerPoints = {};

        	getGamesList(inputEvent).then(function then(model) {

        		var gamesList = model;
        		gamesList.forEach(function(game) {

        			if (game.scores) {

        				// Convert the game's scores to an array.
        				var scoresArray = $.map(game.scores, function(el) { return el; });
        				scoresArray = $filter('orderBy')(scoresArray, '-score');

        				var totalAward = 12;

        				// Iterate through the top scores awarding points.
        				for (var i = 0; i < scoresArray.length; i++) {

        					if (!playerPoints[scoresArray[i].userName]) {
        						playerPoints[scoresArray[i].userName] = {
        							points: 0
        						};
        					}

        					playerPoints[scoresArray[i].userName].points += totalAward;

        					if (totalAward > 0) {
        						totalAward -= 1;
        					}

        				}

        			}

        		});

        		// Find and resolve ties.
        		playerPoints = $filter('orderObjectBy')(playerPoints, 'points', true);
                var haveBottomScorersFloor = false;
                var floorRange = 0;
        		for (var i = 0; i < playerPoints.length; i += 1) {

        			if (playerPoints[i-1] && playerPoints[i].points && playerPoints[i-1].points) {

        				if (playerPoints[i].points === playerPoints[i-1].points) {
        					playerPoints[i].position = playerPoints[i-1].position;
        				} else {
        					playerPoints[i].position = (i+1);
        				}

        			} else {

        				if (i === 0) {
        					playerPoints[i].position = 1;
        				} else {

                            if (!haveBottomScorersFloor) {
                                // Get count of players in one position higher.
                                var getScoreCountOf = playerPoints[i-1].points;

                                for (var j = 0; j < playerPoints.length; j += 1) {
                                    if (playerPoints[j].points === getScoreCountOf) {
                                        floorRange += 1;
                                    }
                                }

                                haveBottomScorersFloor = true;
                            }

        					playerPoints[i].position = (playerPoints.length + 1) - floorRange;
        				}

        			}

        		}

        		deferred.resolve(playerPoints);

        	});

			return deferred.promise;

        }

        function getSingleGameLeaderboard(inputEvent) {

            var deferred = $q.defer();

            var ref = new Firebase(FIREBASEDATA.FBURL);
            var leaderboardData = $firebaseArray(
                ref
                    .child('contests')
                    .child(inputEvent)
                    .child('scores')
            );

            deferred.resolve(leaderboardData);

            return deferred.promise;

        }

        function getSummarizedLeaderboardObject() {
            return _summarizedLeaderboard;
        }

        function getTeamListObject() {
            return _teamList;
        }

        function getPlayerScores(inputEvent, inputGamesList, inputPlayer) {

            var deferred = $q.defer();

            var displayScores = [];

            // Iterate through every game.
            inputGamesList.forEach(function(game) {

                if (game.scores) {

                    // Convert the game's scores to an array.
                    var scoresArray = $.map(game.scores, function(el) { return el; });
                    scoresArray = $filter('orderBy')(scoresArray, '-score');

                    var totalAward = 12;

                    // Iterate through the scores starting from the top and find our user.
                    for (var i = 0; i < scoresArray.length; i++) {

                        // Found our player.
                        if (scoresArray[i].userName === inputPlayer) {

                            var newScoreObject = game;
                            newScoreObject.position = i+1;
                            newScoreObject.score = scoresArray[i].score;
                            newScoreObject.pointsEarned = totalAward;
                            newScoreObject.inpUrl = scoresArray[i].inpUrl ? scoresArray[i].inpUrl : null;
                            newScoreObject.twitchUrl = scoresArray[i].twitchUrl ? scoresArray[i].twitchUrl : null;
                            newScoreObject.mameVersion = scoresArray[i].mameVersion ? scoresArray[i].mameVersion : null;

                            displayScores.push(newScoreObject);
                            totalAward = 12;
                            break;

                        } else {
                            if (totalAward > 0) {
                                totalAward -= 1;
                            }
                        }

                    }

                }

            });

            deferred.resolve(displayScores);

            return deferred.promise;

        }

        function loadEventProperties(inputEvent) {

            var ref = new Firebase(FIREBASEDATA.FBURL);
            var inputEventProperties = $firebaseObject(
                ref
                    .child('contests')
                    .child(inputEvent)
                    .child('properties')
            );

            inputEventProperties.$loaded().then(function() {
                _eventProperties = inputEventProperties;

                // If this is a multigame event, get the data needed for multigame components.
                if (_eventProperties.format.multiGame) {

                    getGamesList(inputEvent).then(function then(model) {
                        _gameList = model;
                        getFirstPlaceScores();
                    });

                    getMultiGameLeaderboard(inputEvent).then(function then(model) {
                        var leaderboard = model;
                        _leaderboardLength = leaderboard.length;
                        _summarizedLeaderboard = leaderboard.slice(0, 8);
                    });

                // If this is a single game event, get the data needed for single game components.
                } else {

                    getSingleGameLeaderboard(inputEvent).then(function then(model) {
                        var leaderboard = model;
                        _leaderboardLength = leaderboard.length;
                        _summarizedLeaderboard = leaderboard;
                    });

                }

                // If this is a team-based event, get the data needed for team event components.
                if (_eventProperties.format.teamBased) {

                    teamService.getTeamList(vm.eventName).then(function then(model) {
                        _teamList = model;
                    });

                }

            });

        }

    }
    eventService.$inject = ["$q", "$filter", "$firebaseObject", "$firebaseArray", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('EventMainController', EventMainController);

    /* @ngInject */
    function EventMainController($scope, $filter, $stateParams, $state, $timeout, $firebaseArray, eventService, authService, profileService, teamService, FIREBASEDATA) {

        /* jshint validthis: true */
        var vm = this;

        vm.eventName = $stateParams.eventName;

        vm.createTeam = createTeam;
        vm.determinePoints = determinePoints;
        vm.goToPlayerProfile = goToPlayerProfile;
        vm.openBadgesModal = openBadgesModal;
        vm.openGameModal = openGameModal;
        vm.openGameModalFromPlayerModal = openGameModalFromPlayerModal;
        vm.openManagementModal = openManagementModal;
        vm.openMultiGameLeaderboardModal = openMultiGameLeaderboardModal;
        vm.openPlayerModal = openPlayerModal;
        vm.openPlayerModalFromGameModal = openPlayerModalFromGameModal;
        vm.openPlayerModalFromLeaderboardModal = openPlayerModalFromLeaderboardModal;
        vm.openRulesModal = openRulesModal;

        initEvent();

        /////////////////////////////////

        function closeModal() {
            angular.element('.modal').closeModal();
        }

        function createTeam() {
            teamService.createTeam(vm.eventName, vm.newTeam).then(function() {
                Materialize.toast('Team ' + vm.newTeam.shortName + ' created.', 4000);
                vm.newTeam = null;
            });
        }

        function determinePoints(inputScoreData, inputIndex) {

            var userGamePoints;

            // No position greater than 12 gets points.
            if (inputIndex > 11) {
                userGamePoints = 0;
                return userGamePoints;
            }

            userGamePoints = 12 - inputIndex;

            var sortedScores = $filter('orderBy')(vm.gameScores, '-score');

            // Am I tied with the person above me? If so, match their points.
            if (sortedScores[inputIndex - 1]) {

                if (sortedScores[inputIndex - 1].score === inputScoreData.score) {
                    userGamePoints += 1;
                }
            }

            return userGamePoints;

        }

        function goToPlayerProfile(inputPlayer) {

            closeModal();
            $state.go('profile', {username: inputPlayer});

        }

        function initEvent() {

            eventService.loadEventProperties(vm.eventName);

            $scope.$watch(function() { return eventService.getEventPropertiesObject(); }, function(model) {
                vm.eventProperties = model;
            }, true);

            $scope.$watch(function() { return eventService.getGameListObject(); }, function(model) {
                vm.gameList = model;
            }, true);

            $scope.$watch(function() { return eventService.getLeaderboardLengthValue(); }, function(model) {
                vm.leaderboardLength = model;
            }, true);

            $scope.$watch(function() { return eventService.getSummarizedLeaderboardObject(); }, function(model) {
                vm.summarizedLeaderboard = model;
            }, true);

            $scope.$watch(function() { return eventService.getTeamListObject(); }, function(model) {
                vm.teamList = model;
            }, true);

            profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });

        }

        function openBadgesModal() {

            angular.element('#badgesModal').openModal();
            angular.element('#badgesModalContent').scrollTop(0);

        }

        function openGameModal(inputGameName) {

            var ref = new Firebase(FIREBASEDATA.FBURL);

            eventService.getGameData(vm.eventName, inputGameName).then(function then(model) {
                vm.gameData = model;

                vm.gameScores = $firebaseArray(
                    ref
                        .child('contests')
                        .child(vm.eventName)
                        .child('activeGames')
                        .child(vm.gameData.$id)
                        .child('scores')
                );
            });

            angular.element('#gameModal').openModal();
            angular.element('#gameModal').addClass('.open-modal');
            angular.element('#gameModalContent').scrollTop(0);

        }

        function openManagementModal() {

            angular.element('#managementModal').openModal();
            angular.element('#managementModalContent').scrollTop(0);

        }

        function openMultiGameLeaderboardModal() {

            eventService.getMultiGameLeaderboard(vm.eventName).then(function then(model) {
                vm.completeLeaderboard = model;
            });

            angular.element('#multiGameLeaderboardModal').openModal();
            angular.element('#multiGameLeaderboardModalContent').scrollTop(0);

        }

        function openPlayerModal(inputPlayer) {

            vm.focusPlayer = inputPlayer;

            eventService.getPlayerScores(vm.eventName, vm.gameList, vm.focusPlayer).then(function then(model) {
                vm.playerScores = model;
            });

            angular.element('#playerModal').openModal();
            angular.element('#playerModalContent').scrollTop(0);

        }

        function openGameModalFromPlayerModal(inputGame) {

            closeModal();
            $timeout(function() {
                openGameModal(inputGame);
            }, 450);

        }

        function openPlayerModalFromGameModal(inputPlayer) {

            closeModal();
            $timeout(function() {
                openPlayerModal(inputPlayer);
            }, 450);

        }

        function openPlayerModalFromLeaderboardModal(inputPlayer) {

            closeModal();
            $timeout(function() {
                openPlayerModal(inputPlayer);
            }, 450);

        }

        function openRulesModal() {
            angular.element('#rulesModal').openModal();
        }

    }
    EventMainController.$inject = ["$scope", "$filter", "$stateParams", "$state", "$timeout", "$firebaseArray", "eventService", "authService", "profileService", "teamService", "FIREBASEDATA"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('teamService', teamService);

    /* @ngInject */
    function teamService($q, $firebaseArray, $firebaseObject, FIREBASEDATA) {

    	this.createTeam = createTeam;
        this.getTeamList = getTeamList;

        ////////////////

        function createTeam(inputEvent, inputNewTeamProperties) {

        	var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var teamPool = $firebaseObject(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('teamPool')
        	);

        	teamPool.$loaded().then(function() {

        		teamPool[inputNewTeamProperties.shortName] = {
        			fullName: inputNewTeamProperties.formalName
        		};
        		teamPool.$save();
        		deferred.resolve();

        	});

        	return deferred.promise;

        }

        function getTeamList(inputEvent) {

        	var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var teamList = $firebaseArray(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('teamPool')
        	);

        	teamList.$loaded().then(function() {
        		deferred.resolve(teamList);
        	});

        	return deferred.promise;

        }
    }
    teamService.$inject = ["$q", "$firebaseArray", "$firebaseObject", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('HeaderController', HeaderController);

    /* @ngInject */
    function HeaderController($timeout, $rootScope, $window, $state, authService) {

        /* jshint validthis: true */
        var vm = this;
        vm.logOut = logOut;

        activate();

        //////////////////////////

        function activate() {
            $timeout(function() {
                angular.element('.dropdown-button')
                    .dropdown({
                        inDuration: 300,
                        outDuration: 225,
                        constrain_width: false,
                        hover: false,
                        gutter: -114,
                        belowOrigin: true
                    });
            }, 400);
        }

        function logOut() {
            authService.logOut();
            $window.location.reload();
        }

    }
    HeaderController.$inject = ["$timeout", "$rootScope", "$window", "$state", "authService"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgGamesList', vgGamesList);

    /* @ngInject */
    function vgGamesList () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: GamesListController,
            controllerAs: 'vm',
            link: link,
            restrict: 'E',
            templateUrl: './app/eventComponents/gamesList.directive.htm',
            scope: {
            	data: '=',
            	openGameFunction: '='
            }
        };
        return directive;

        function link(scope, element, attrs) {
        }
    }

    /* @ngInject */
    function GamesListController() {
        /* jshint validthis: true */
    	var vm = this;
    }
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgMultiGameLeaderboard', vgMultiGameLeaderboard);

    /* @ngInject */
    function vgMultiGameLeaderboard () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: MultiGameLeaderboardController,
            controllerAs: 'vm',
            link: link,
            restrict: 'E',
            templateUrl: './app/eventComponents/multiGameLeaderboard.directive.htm',
            scope: {
            	data: '=',
                avatarData: '=',
            	completeLength: '=',
            	openPlayerFunction: '=',
                openLeaderboardFunction: '='
            }
        };
        return directive;

        function link(scope, element, attrs) {
        }
    }

    /* @ngInject */
    function MultiGameLeaderboardController() {
        /* jshint validthis: true */
    	var vm = this;
    }
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgSingleGameLeaderboard', vgSingleGameLeaderboard);

    /* @ngInject */
    function vgSingleGameLeaderboard () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: SingleGameLeaderboardController,
            controllerAs: 'vm',
            link: link,
            restrict: 'E',
            templateUrl: './app/eventComponents/singleGameLeaderboard.directive.htm',
            scope: {
            	data: '=',
                avatarData: '=',
            	completeLength: '=',
                openLeaderboardFunction: '='
            }
        };
        return directive;

        function link(scope, element, attrs) {
        }
    }

    /* @ngInject */
    function SingleGameLeaderboardController() {
        /* jshint validthis: true */
    	var vm = this;
    }
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgStickyMessage', vgStickyMessage);

    /* @ngInject */
    function vgStickyMessage () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: StickyMessageController,
            controllerAs: 'vm',
            link: link,
            restrict: 'E',
            templateUrl: './app/eventComponents/stickyMessage.directive.htm',
            scope: {
            	properties: '='
            }
        };
        return directive;

        function link(scope, element, attrs) {
        }
    }

    /* @ngInject */
    function StickyMessageController($timeout) {
        /* jshint validthis: true */
    	var vm = this;
    }
    StickyMessageController.$inject = ["$timeout"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .filter('orderObjectBy', orderObjectBy);

    function orderObjectBy() {
        return function(items, field, reverse) {
            var filtered = [];

            angular.forEach(items, function(item, key) {
                item.key = key;
                filtered.push(item);
            });

            filtered.sort(function (a, b) {
                return (a[field] > b[field] ? 1 : -1);
            });

            if(reverse) filtered.reverse();

            return filtered;
        };
    }

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('AvatarController', AvatarController);

    /* @ngInject */
    function AvatarController($rootScope, $state, $stateParams, $timeout, Upload, imgur, profileService) {

        /* jshint validthis: true */
        var vm = this;
        vm.uploadAvatar = uploadAvatar;

        activate();

        ////////////////

        function activate() {
        	profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });

            // FIXME: This needs to be triggered by a $rootScope broadcast of when it receives profile data.
            $timeout(function() {
                profileService.getBadgesData($rootScope.profile.userName).then(function then(model) {
                    vm.badgesData = model;
                });
            }, 500);
        }

        function uploadAvatar() {

        	vm.disableButton = true;

        	imgur.setAPIKey('Client-ID f53d6d5833b07bc');
        	imgur.upload(vm.file).then(function then(model) {
        		profileService.saveAvatarLink(model[0].link, $rootScope.profile.userName);
        		Materialize.toast('Your avatar was uploaded', 4000);

        		$timeout(function() {
        			$state.go('home');
        		}, 1000);
        	});

        }

    }
    AvatarController.$inject = ["$rootScope", "$state", "$stateParams", "$timeout", "Upload", "imgur", "profileService"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('ChangePasswordController', ChangePasswordController);

    /* @ngInject */
    function ChangePasswordController($scope, $timeout, $state, AuthWrapper) {

        /* jshint validthis: true */
        var vm = this;
        
        vm.submitChangePassword = submitChangePassword;

        //////////////////

        function submitChangePassword() {

            if ($scope.pwChangeForm.$valid) {

                AuthWrapper.$changePassword({
                    email: AuthWrapper.$getAuth().password.email,
                    oldPassword: vm.inputCurrentPassword,
                    newPassword: vm.inputNewPassword
                }).then(function() {

                    Materialize.toast('Your password was changed.', 4000);
                    $timeout(function() {
                        $state.go('home');
                    }, 1000);

                }).catch(function(error) {
                    
                    if (error.code === 'INVALID_PASSWORD') {
                        vm.showChangePasswordMessage = true;
                    }

                });

            }

        }

    }
    ChangePasswordController.$inject = ["$scope", "$timeout", "$state", "AuthWrapper"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('HomeController', HomeController);

    /* @ngInject */
    function HomeController($scope, $timeout) {

        /* jshint validthis: true */
        var vm = this;

        ////////////////////////

    }
    HomeController.$inject = ["$scope", "$timeout"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('LeaderboardController', LeaderboardController);

    /* @ngInject */
    function LeaderboardController($q, $timeout, $firebaseArray, profileService, FIREBASEDATA) {

        /* jshint validthis: true */
    	var vm = this;

        activate();

        ////////////////

        function activate() {
            getProfileScores().then(function then(model) {
                vm.profileScoreData = model;
            });

            profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });
        }

        function getProfileScores() {

        	var deferred = $q.defer();
        	var ref = new Firebase(FIREBASEDATA.FBURL);

        	var profileScoreData = $firebaseArray(
        		ref
        			.child('badges')
        	);

        	profileScoreData.$loaded(function() {
        		deferred.resolve(profileScoreData);
        	});

        	return deferred.promise;

        }

    }
    LeaderboardController.$inject = ["$q", "$timeout", "$firebaseArray", "profileService", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('ProfileController', ProfileController);

    /* @ngInject */
    function ProfileController($scope, $stateParams, $q, $timeout, $state, $firebaseArray, authService, profileService, eventService) {

        /* jshint validthis: true */
        var vm = this;
        
        activate();

        /////////////////////////////////

        function activate() {

            profileService.getUserData($stateParams.username).then(function then(model) {
                vm.profileData = model;

                profileService.getTournamentHistory(vm.profileData).then(function then(model) {
                    var tournamentHistoryData = model;
                    vm.eventStandings = profileService.getTournamentStandings(tournamentHistoryData, $stateParams.username);
                });

                $('.collapsible').collapsible({
                    accordion: true
                });
            });

            profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });

            profileService.getBadgesData($stateParams.username).then(function then(model) {
                vm.badgesData = model;
            });

        }

    }
    ProfileController.$inject = ["$scope", "$stateParams", "$q", "$timeout", "$state", "$firebaseArray", "authService", "profileService", "eventService"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('profileService', profileService);

    /* @ngInject */
    function profileService($rootScope, $q, $firebaseArray, $firebaseObject, eventService, FIREBASEDATA) {

    	this.getAvatarData = getAvatarData;
        this.getBadgesData = getBadgesData;
    	this.getTournamentHistory = getTournamentHistory;
        this.getTournamentStandings = getTournamentStandings;
        this.getUserData = getUserData;
        this.saveAvatarLink = saveAvatarLink;

        ////////////////

        function getAvatarData() {

            var deferred = $q.defer();
            var ref = new Firebase(FIREBASEDATA.FBURL);

            var avatarData = $firebaseObject(
                ref
                    .child('avatars')
            );

            avatarData.$loaded(function() {
                deferred.resolve(avatarData);
            });

            return deferred.promise;

        }

        function getBadgesData(inputUser) {

            var deferred = $q.defer();
            var ref = new Firebase(FIREBASEDATA.FBURL);

            var badgesData = $firebaseObject(
                ref
                    .child('badges')
                    .child(inputUser)
            );

            badgesData.$loaded(function() {
                deferred.resolve(badgesData);
            });

            return deferred.promise;

        }

        function getTournamentHistory(inputUserData) {

        	var deferred = $q.defer();
        	var ref = new Firebase(FIREBASEDATA.FBURL);

        	// Loop through each event in the pledgedTo object.
        	var eventsArray = [];
        	for (var key in inputUserData.pledgedTo) {
        		eventsArray.push(key);
        	}

        	deferred.resolve(eventsArray);

        	return deferred.promise;

        }

        function getTournamentStandings(inputTournamentHistory, inputUser) {

            var ref = new Firebase(FIREBASEDATA.FBURL);

            // Loop through each event in the user's history.
            var eventStandings = [];
            inputTournamentHistory.forEach(function(event) {

                eventService.getEventProperties(event).then(function(eventProperties) {

                    eventProperties.$loaded().then(function() {

                        // If concluded, get the user's standing.
                        if (eventProperties.state === 'concluded') {

                            var eventStandingData = $firebaseObject(
                                ref
                                    .child('standings')
                                    .child(event)
                            );

                            eventStandingData.$loaded().then(function() {

                                if (eventStandingData[inputUser]) {

                                    eventStandings.push({
                                        name: eventProperties.name,
                                        premier: eventProperties.premier ? true : null,
                                        shortName: event,
                                        state: 'concluded',
                                        color: eventProperties.color,
                                        position: eventStandingData[inputUser]
                                    });

                                } else {

                                    eventStandings.push({
                                        name: eventProperties.name,
                                        premier: eventProperties.premier ? true : null,
                                        shortName: event,
                                        state: 'concluded',
                                        color: eventProperties.color,
                                        position: -1
                                    });

                                }

                            });

                        } else if (eventProperties.state === 'inprogress' || eventProperties.state === 'upcoming') {

                            eventStandings.push({
                                name: eventProperties.name,
                                premier: eventProperties.premier ? true : null,
                                shortName: event,
                                color: eventProperties.color,
                                state: eventProperties.state
                            });

                        }

                    });

                });

            });

            return eventStandings;

        }

        function getUserData(inputUser) {

        	var deferred = $q.defer();
        	var ref = new Firebase(FIREBASEDATA.FBURL);

        	var usersData = $firebaseArray(
        		ref
        			.child('users')
        	);

        	usersData.$loaded(function() {

        		usersData.forEach(function(user) {
        			if (user.userName === inputUser) {
        				deferred.resolve(user);
        			}
        		});

        	});

        	return deferred.promise;

        }

        // FIXME: Make this server-side.
        function saveAvatarLink(inputLink, inputUser) {
            
            var ref = new Firebase(FIREBASEDATA.FBURL);

            var avatarData = $firebaseObject(
                ref
                    .child('avatars')
            );

            avatarData.$loaded(function() {
                avatarData[inputUser] = inputLink;
                avatarData.$save();
            });

        }

    }
    profileService.$inject = ["$rootScope", "$q", "$firebaseArray", "$firebaseObject", "eventService", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('RegController', RegController);

    /* @ngInject */
    function RegController($scope, $rootScope, $timeout, $window, $state, $firebaseObject, authService, AuthWrapper) {

        /* jshint validthis: true */
        var vm = this;

        vm.loginToAccount = loginToAccount;
        vm.passwordReset = passwordReset;
        vm.submitNewAccount = submitNewAccount;

        /////////////////////

        function loginToAccount() {

            authService.loginToAccount(vm.loginEmail, vm.loginPassword).then(function then(model) {

                vm.showInvalidUserError = false;
                vm.showInvalidPasswordError = false;

                if (model === 'LOGIN_SUCCESS') {

                    $state.go('home');

                } else if (model === 'INVALID_USER') {
                    vm.showInvalidUserError = true;
                    return;
                } else if (model === 'INVALID_PASSWORD') {
                    vm.showInvalidPasswordError = true;
                }

            });

        }

        function passwordReset() {

            if (!vm.loginEmail) {
                vm.showPasswordResetEmailMessage = true;
                return;
            }

            AuthWrapper.$resetPassword({
                email: vm.loginEmail
            }).then(function() {
                vm.showPasswordResetEmailMessage = false;
                Materialize.toast('A password reset email has been sent to ' + vm.loginEmail + '.', 4000);
            });

        }

        function submitNewAccount() {
            
            // Does the user exist? If so, show an error message.
            authService.checkIfUserExists(vm.newUsername).then(function(userExists) {

                vm.showDuplicateUserError = false;
                vm.showEmailTakenError = false;

                if (userExists) {

                    vm.showDuplicateUserError = true;
                    return;

                // Try to create the new user.
                } else {

                    authService.createNewUser(vm.newEmail, vm.newPassword, vm.newUsername).then(function then(model) {

                        if (model === 'EMAIL_TAKEN') {

                            vm.showEmailTakenError = true;
                            return;

                        } else if (model === 'ACCOUNT_CREATED') {

                            $state.go('profile', {username: vm.newUsername});

                        }

                    });

                }

            });

        }

    }
    RegController.$inject = ["$scope", "$rootScope", "$timeout", "$window", "$state", "$firebaseObject", "authService", "AuthWrapper"];

})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJhcHAuY29uZmlnLmpzIiwiYXBwLnJ1bi5qcyIsImF1dGgvYXV0aC5zZXJ2aWNlLmpzIiwiYXV0aC9hdXRod3JhcHBlci5mYWN0b3J5LmpzIiwiZXZlbnQvZXZlbnQuc2VydmljZS5qcyIsImV2ZW50L21haW4uY29udHJvbGxlci5qcyIsImV2ZW50L3RlYW0uc2VydmljZS5qcyIsImhlYWRlci9oZWFkZXIuY29udHJvbGxlci5qcyIsImV2ZW50Q29tcG9uZW50cy9nYW1lc0xpc3QuZGlyZWN0aXZlLmpzIiwiZXZlbnRDb21wb25lbnRzL211bHRpR2FtZUxlYWRlcmJvYXJkLmRpcmVjdGl2ZS5qcyIsImV2ZW50Q29tcG9uZW50cy9zaW5nbGVHYW1lTGVhZGVyYm9hcmQuZGlyZWN0aXZlLmpzIiwiZXZlbnRDb21wb25lbnRzL3N0aWNreU1lc3NhZ2UuZGlyZWN0aXZlLmpzIiwiaGVscGVycy9vcmRlck9iamVjdEJ5LmZpbHRlci5qcyIsImhvbWUvYXZhdGFyLmNvbnRyb2xsZXIuanMiLCJob21lL2NoYW5nZVBhc3N3b3JkLmNvbnRyb2xsZXIuanMiLCJob21lL2hvbWUuY29udHJvbGxlci5qcyIsImhvbWUvbGVhZGVyYm9hcmQuY29udHJvbGxlci5qcyIsImhvbWUvcHJvZmlsZS5jb250cm9sbGVyLmpzIiwiaG9tZS9wcm9maWxlLnNlcnZpY2UuanMiLCJob21lL3JlZy5jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQSxVQUFBOztZQUVBOzs7WUFHQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7O0tBRUEsQ0NoQkEsQ0FBQSxXQUFBO0NBQ0E7O0NBRUE7R0FDQSxPQUFBO0dBQ0EsU0FBQSxnQkFBQTtHQUNBLFNBQUE7O0dBRUEsT0FBQTs7O0NBR0EsU0FBQSxPQUFBLGdCQUFBLG9CQUFBOzs7RUFHQSxtQkFBQSxVQUFBOztFQUVBO09BQ0EsTUFB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O2dCQUNBLGNBQUE7ZUFDQTs7OztRQUlBLFNBQUEsNkJBQUEsYUFBQTs7WUFFQTtZQUNBLFNBQUEsV0FBQTtnQkFDQSxnQkFBQTtlQUNBOzs7O1FBSUEsU0FBQSxvQ0FBQSxhQUFBOztZQUVBO1lBQ0EsU0FBQSxXQUFBO2dCQUNBLGdCQUFBO2VBQ0E7Ozs7UUFJQSxTQUFBLGlCQUFBO1lBQ0EsUUFBQSxRQUFBLGVBQUE7Ozs7OztLQUtBLENDeE1BLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLFFBQUEsZUFBQTs7O0lBR0EsU0FBQSxZQUFBLElBQUEsZ0JBQUEsaUJBQUEsY0FBQTs7S0FFQSxLQUFBLGFBQUE7UUFDQSxLQUFBLGNBQUE7Ozs7UUFJQSxTQUFBLFdBQUEsWUFBQSx3QkFBQTs7U0FFQSxJQUFBLFdBQUEsR0FBQTs7U0FFQSxJQUFBLE1BQUEsSUFBQSxTQUFBLGFBQUE7U0FDQSxJQUFBLFdBQUE7VUFDQTtZQUNBLE1BQUE7WUFDQSxNQUFBO1lBQ0EsTUFBQTs7O1NBR0EsU0FBQSxVQUFBLEtBQUEsV0FBQTs7VUFFQSxTQUFBLHVCQUFBLGFBQUE7V0FDQSxVQUFBLHVCQUFBOztVQUVBLFNBQUE7VUFDQSxTQUFBOzs7O1NBSUEsT0FBQSxTQUFBOzs7O1FBSUEsU0FBQSxZQUFBLFlBQUE7O1NBRUEsSUFBQSxXQUFBLEdBQUE7O1NBRUEsSUFBQSxNQUFBLElBQUEsU0FBQSxhQUFBO1NBQ0EsSUFBQSxXQUFBO1VBQ0E7WUFDQSxNQUFBO1lBQ0EsTUFBQTtZQUNBLE1BQUE7OztTQUdBLFNBQUEsVUFBQSxLQUFBLFdBQUE7VUFDQSxTQUFBLFFBQUE7OztTQUdBLE9BQUEsU0FBQTs7Ozs7S0FJQSxDQzdEQSxDQUFBLFdBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUE7U0FDQSxXQUFBLG9CQUFBOzs7SUFHQSxTQUFBLGlCQUFBLFVBQUEsWUFBQSxTQUFBLFFBQUEsYUFBQTs7O1FBR0EsSUFBQSxLQUFBO1FBQ0EsR0FBQSxTQUFBOztRQUVBOzs7O1FBSUEsU0FBQSxXQUFBO1lBQ0EsU0FB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QUEsS0FBQTs7UUFFQSxHQUFBLGlCQUFBO1FBQ0EsR0FBQSxnQkFBQTtRQUNBLEdBQUEsbUJBQUE7Ozs7UUFJQSxTQUFBLGlCQUFBOztZQUVBLFlBQUEsZUFBQSxHQUFBLFlBQUEsR0FBQSxlQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUE7O2dCQUVBLEdBQUEsdUJBQUE7Z0JBQ0EsR0FBQSwyQkFBQTs7Z0JBRUEsSUFBQSxVQUFBLGlCQUFBOztvQkFFQSxPQUFBLEdBQUE7O3VCQUVBLElBQUEsVUFBQSxnQkFBQTtvQkFDQSxHQUFBLHVCQUFBO29CQUNBO3VCQUNBLElBQUEsVUFBQSxvQkFBQTtvQkFDQSxHQUFBLDJCQUFBOzs7Ozs7O1FBT0EsU0FBQSxnQkFBQTs7WUFFQSxJQUFBLENBQUEsR0FBQSxZQUFBO2dCQUNBLEdBQUEsZ0NBQUE7Z0JBQ0E7OztZQUdBLFlBQUEsZUFBQTtnQkFDQSxPQUFBLEdBQUE7ZUFDQSxLQUFBLFdBQUE7Z0JBQ0EsR0FBQSxnQ0FBQTtnQkFDQSxZQUFBLE1BQUEsNkNBQUEsR0FBQSxhQUFBLEtBQUE7Ozs7O1FBS0EsU0FBQSxtQkFBQTs7O1lBR0EsWUFBQSxrQkFBQSxHQUFBLGFBQUEsS0FBQSxTQUFBLFlBQUE7O2dCQUVBLEdBQUEseUJBQUE7Z0JBQ0EsR0FBQSxzQkFBQTs7Z0JBRUEsSUFBQSxZQUFBOztvQkFFQSxHQUFBLHlCQUFBO29CQUNBOzs7dUJBR0E7O29CQUVBLFlBQUEsY0FBQSxHQUFBLFVBQUEsR0FBQSxhQUFBLEdBQUEsYUFBQSxLQUFBLFNBQUEsS0FBQSxPQUFBOzt3QkFFQSxJQUFBLFVBQUEsZUFBQTs7NEJBRUEsR0FBQSxzQkFBQTs0QkFDQTs7K0JBRUEsSUFBQSxVQUFBLG1CQUFBOzs0QkFFQSxPQUFBLEdBQUEsV0FBQSxDQUFBLFVBQUEsR0FBQTs7Ozs7Ozs7Ozs7Ozs7O0tBY0EiLCJmaWxlIjoiYXBwLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcsIFtcbiAgICAgICAgICAgIC8qIEFuZ3VsYXIgbW9kdWxlcyAqL1xuICAgICAgICAgICAgJ25nQW5pbWF0ZScsXG4gICAgICAgICAgICAvKiBBcHAgbW9kdWxlcyAqL1xuICAgICAgICAgICAgLyogVGhpcmQtcGFydHkgbW9kdWxlcyAqL1xuICAgICAgICAgICAgJ3VpLnJvdXRlcicsXG4gICAgICAgICAgICAnZmlyZWJhc2UnLFxuICAgICAgICAgICAgJ3ZhbGlkYXRpb24ubWF0Y2gnLFxuICAgICAgICAgICAgJ29yZGluYWwnLFxuICAgICAgICAgICAgJ25nRmlsZVVwbG9hZCcsXG4gICAgICAgICAgICAnbmdJbWd1cidcbiAgICAgICAgXSk7XG59KSgpOyIsIihmdW5jdGlvbigpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdGFuZ3VsYXJcblx0XHQubW9kdWxlKCd2Zy5hcHAnKVxuXHRcdC5jb25zdGFudCgnRklSRUJBU0VEQVRBJywge1xuXHRcdFx0J0ZCVVJMJzogJ2h0dHBzOi8vd29sZnNjb250ZXN0cy5maXJlYmFzZWlvLmNvbSdcblx0XHR9KVxuXHRcdC5jb25maWcoY29uZmlnKTtcblxuXHQvKiBAbmdJbmplY3QgKi9cblx0ZnVuY3Rpb24gY29uZmlnKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcblxuXHRcdC8vIFJlZGlyZWN0IGFueSB1bm1hdGNoZWQgVVJMIHRvIC8uXG5cdFx0JHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xuXG5cdFx0JHN0YXRlUHJvdmlkZXJcblx0XHQgICAgLnN0YXRlKCdob21lJywge1xuXHRcdCAgICBcdHVybDogJy8nLFxuXHRcdCAgICBcdHRlbXBsYXRlVXJsOiAnYXBwL2hvbWUvaG9tZS5odG0nLFxuXHRcdCAgICBcdGNvbnRyb2xsZXI6ICdIb21lQ29udHJvbGxlciBhcyBob21lJ1xuXHRcdCAgICB9KVxuXG5cdFx0ICAgIC5zdGF0ZSgncmVnaXN0ZXJPckxvZ2luJywge1xuXHRcdCAgICBcdHVybDogJy9yZWdpc3Rlck9yTG9naW4nLFxuXHRcdCAgICBcdHRlbXBsYXRlVXJsOiAnL2FwcC9ob21lL3JlZy5odG0nLFxuXHRcdCAgICBcdGNvbnRyb2xsZXI6ICdSZWdDb250cm9sbGVyIGFzIHJlZydcblx0XHQgICAgfSlcblxuXHRcdCAgICAuc3RhdGUoJ3Byb2ZpbGUnLCB7XG5cdFx0ICAgIFx0dXJsOiAnL3Byb2ZpbGUvOnVzZXJuYW1lJyxcblx0XHQgICAgXHR0ZW1wbGF0ZVVybDogJy9hcHAvaG9tZS9wcm9maWxlLmh0bScsXG5cdFx0ICAgIFx0Y29udHJvbGxlcjogJ1Byb2ZpbGVDb250cm9sbGVyIGFzIHByb2ZpbGUnXG5cdFx0ICAgIH0pXG5cblx0XHQgICAgLnN0YXRlKCdsZWFkZXJib2FyZCcsIHtcblx0XHQgICAgXHR1cmw6ICcvbGVhZGVyYm9hcmQnLFxuXHRcdCAgICBcdHRlbXBsYXRlVXJsOiAnL2FwcC9ob21lL2xlYWRlcmJvYXJkLmh0bScsXG5cdFx0ICAgIFx0Y29udHJvbGxlcjogJ0xlYWRlcmJvYXJkQ29udHJvbGxlciBhcyBsZWFkZXJib2FyZCdcblx0XHQgICAgfSlcblxuXHRcdCAgICAuc3RhdGUoJ2V2ZW50Jywge1xuXHRcdCAgICBcdHVybDogJy9ldmVudC86ZXZlbnROYW1lL21haW4nLFxuXHRcdCAgICBcdHRlbXBsYXRlVXJsOiAnL2FwcC9ldmVudC9tYWluLmh0bScsXG5cdFx0ICAgIFx0Y29udHJvbGxlcjogJ0V2ZW50TWFpbkNvbnRyb2xsZXIgYXMgZXZlbnQnXG5cdFx0ICAgIH0pXG5cblx0XHQgICAgLnN0YXRlKCdjdXN0b21pemVBdmF0YXInLCB7XG5cdFx0ICAgIFx0dXJsOiAnL2N1c3RvbWl6ZUF2YXRhcicsXG5cdFx0ICAgIFx0dGVtcGxhdGVVcmw6ICcvYXBwL2hvbWUvYXZhdGFyLmh0bScsXG5cdFx0ICAgIFx0Y29udHJvbGxlcjogJ0F2YXRhckNvbnRyb2xsZXIgYXMgYXZhdGFyJyxcblxuXHRcdCAgICBcdHJlc29sdmU6IHtcblx0XHQgICAgXHRcdCdjdXJyZW50QXV0aCc6IFsnQXV0aFdyYXBwZXInLCBmdW5jdGlvbihBdXRoV3JhcHBlcikge1xuXHRcdCAgICBcdFx0XHRyZXR1cm4gQXV0aFdyYXBwZXIuJHJlcXVpcmVBdXRoKCk7XG5cdFx0ICAgIFx0XHR9XVxuXHRcdCAgICBcdH1cblx0XHQgICAgfSlcblxuXHRcdCAgICAuc3RhdGUoJ2NoYW5nZVBhc3N3b3JkJywge1xuXHRcdCAgICBcdHVybDogJy9jaGFuZ2VQYXNzd29yZCcsXG5cdFx0ICAgIFx0dGVtcGxhdGVVcmw6ICcvYXBwL2hvbWUvY2hhbmdlUGFzc3dvcmQuaHRtJyxcblx0XHQgICAgXHRjb250cm9sbGVyOiAnQ2hhbmdlUGFzc3dvcmRDb250cm9sbGVyIGFzIHB3Y2hhbmdlJyxcblxuXHRcdCAgICBcdHJlc29sdmU6IHtcblx0XHQgICAgXHRcdCdjdXJyZW50QXV0aCc6IFsnQXV0aFdyYXBwZXInLCBmdW5jdGlvbihBdXRoV3JhcHBlcikge1xuXHRcdCAgICBcdFx0XHRyZXR1cm4gQXV0aFdyYXBwZXIuJHJlcXVpcmVBdXRoKCk7XG5cdFx0ICAgIFx0XHR9XVxuXHRcdCAgICBcdH1cblx0XHQgICAgfSk7XG5cdH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLnJ1bihydW4pO1xuXG4gICAgZnVuY3Rpb24gcnVuKCRyb290U2NvcGUsICRsb2NhdGlvbiwgJHN0YXRlLCAkZmlyZWJhc2VPYmplY3QsIEF1dGhXcmFwcGVyLCBGSVJFQkFTRURBVEEpIHtcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHN0YXRlQ2hhbmdlRXJyb3InLCBmdW5jdGlvbihldmVudCwgdG9TdGF0ZSwgdG9QYXJhbXMsIGZyb21TdGF0ZSwgZnJvbVBhcmFtcywgZXJyb3IpIHtcbiAgICAgICAgICAgIGlmIChlcnJvciA9PT0gJ0FVVEhfUkVRVUlSRUQnKSB7XG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdyZWdpc3Rlck9yTG9naW4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgLy8gSWYgdXNlciBpcyBsb2dnZWQgaW4sIGRvd25sb2FkIHRoZWlyIHByb2ZpbGUgZGF0YSB0byBhbiBvYmplY3QgaW4gJHJvb3RTY29wZS5cbiAgICAgICAgICAgIC8vIEZJWE1FOiBXZSBzaG91bGRuJ3QgbmVlZCB0byBkbyB0aGlzIGV2ZXJ5IHN1Y2Nlc3NmdWwgc3RhdGUgY2hhbmdlLlxuICAgICAgICAgICAgaWYgKEF1dGhXcmFwcGVyLiRnZXRBdXRoKCkpIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB2YXIgYXV0aERhdGEgPSBBdXRoV3JhcHBlci4kZ2V0QXV0aCgpO1xuICAgICAgICAgICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcblxuICAgICAgICAgICAgICAgIHZhciBwcm9maWxlRGF0YSA9ICRmaXJlYmFzZU9iamVjdChyZWYuY2hpbGQoJ3VzZXJzJykuY2hpbGQoYXV0aERhdGEudWlkKSk7XG4gICAgICAgICAgICAgICAgcHJvZmlsZURhdGEuJGJpbmRUbygkcm9vdFNjb3BlLCAncHJvZmlsZScpLnRoZW4oZnVuY3Rpb24odW5iaW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUudW5iaW5kRnVuY3Rpb24gPSB1bmJpbmQ7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcblxuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuc2VydmljZSgnYXV0aFNlcnZpY2UnLCBhdXRoU2VydmljZSk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBhdXRoU2VydmljZSgkcSwgJHJvb3RTY29wZSwgJHN0YXRlLCAkd2luZG93LCAkdGltZW91dCwgJGZpcmViYXNlT2JqZWN0LCBBdXRoV3JhcHBlciwgRklSRUJBU0VEQVRBKSB7XG4gICAgICAgIFxuICAgICAgICB0aGlzLnRlc3REYXRhID0gJ2hlbGxvIHdvcmxkISc7XG5cbiAgICBcdHRoaXMuY2hlY2tJZlVzZXJFeGlzdHMgPSBjaGVja0lmVXNlckV4aXN0cztcbiAgICBcdHRoaXMuY3JlYXRlTmV3VXNlciA9IGNyZWF0ZU5ld1VzZXI7XG4gICAgICAgIHRoaXMubG9naW5Ub0FjY291bnQgPSBsb2dpblRvQWNjb3VudDtcbiAgICAgICAgdGhpcy5sb2dPdXQgPSBsb2dPdXQ7XG5cbiAgICBcdC8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgIFx0ZnVuY3Rpb24gY2hlY2tJZlVzZXJFeGlzdHMoaW5wdXRVc2VybmFtZSkge1xuXG4gICAgXHRcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICBcdFx0dmFyIGRvZXNVc2VyRXhpc3QgPSBmYWxzZTtcbiAgICBcdFx0dmFyIHVzZXJzUmVmID0gbmV3ICR3aW5kb3cuRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMICsgJy91c2VycycpO1xuXG4gICAgXHRcdHVzZXJzUmVmLm9uY2UoJ3ZhbHVlJywgZnVuY3Rpb24oZGF0YVNuYXBzaG90KSB7XG5cbiAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YVNuYXBzaG90LmZvckVhY2goZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHVzZXIudmFsKCkudXNlck5hbWUgPT09IGlucHV0VXNlcm5hbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb2VzVXNlckV4aXN0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkb2VzVXNlckV4aXN0KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgIFx0XHR9KTtcblxuICAgIFx0XHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgIFx0fVxuXG4gICAgXHRmdW5jdGlvbiBjcmVhdGVOZXdVc2VyKGlucHV0RW1haWwsIGlucHV0UGFzc3dvcmQsIGlucHV0VXNlcm5hbWUpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgIFx0XHRBdXRoV3JhcHBlci4kY3JlYXRlVXNlcih7XG4gICAgXHRcdFx0ZW1haWw6IGlucHV0RW1haWwsXG4gICAgXHRcdFx0cGFzc3dvcmQ6IGlucHV0UGFzc3dvcmRcbiAgICBcdFx0fSkudGhlbihmdW5jdGlvbih1c2VyRGF0YSkge1xuXG4gICAgXHRcdFx0Ly8gQ3JlYXRlIGEgZGF0YSBlbnRyeSBmb3IgdGhlIG5ldyB1c2VybmFtZS5cbiAgICBcdFx0XHRuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKS5jaGlsZCgndXNlcnMvJyArIHVzZXJEYXRhLnVpZCkuc2V0KHtcblxuICAgIFx0XHRcdFx0dXNlck5hbWU6IGlucHV0VXNlcm5hbWUsXG4gICAgXHRcdFx0XHRyb2xlOiAnVXNlcidcblxuICAgIFx0XHRcdH0sIGZ1bmN0aW9uKGVycm9yRGF0YSkge1xuICAgIFx0XHRcdFx0Y29uc29sZS5lcnJvcihlcnJvckRhdGEpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZXJyb3JEYXRhLmNvZGU7XG4gICAgXHRcdFx0fSk7XG5cbiAgICAgICAgICAgICAgICAvLyBDcmVhdGUgYSBkYXRhIGVudHJ5IGZvciB0aGUgdXNlcidzIGF2YXRhci5cbiAgICAgICAgICAgICAgICBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKS5jaGlsZCgnYXZhdGFycycpLmNoaWxkKGlucHV0VXNlcm5hbWUpLnNldCgnaHR0cDovL2FwaS5hZG9yYWJsZS5pby9hdmF0YXJzLzQyLycgKyBpbnB1dFVzZXJuYW1lKTtcblxuICAgIFx0XHRcdC8vIExvZyB0aGUgdXNlciBpbi5cbiAgICBcdFx0XHRBdXRoV3JhcHBlci4kYXV0aFdpdGhQYXNzd29yZCh7XG4gICAgXHRcdFx0XHRlbWFpbDogaW5wdXRFbWFpbCxcbiAgICBcdFx0XHRcdHBhc3N3b3JkOiBpbnB1dFBhc3N3b3JkXG4gICAgXHRcdFx0fSkudGhlbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgnQUNDT1VOVF9DUkVBVEVEJyk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICBcdFx0fSkuY2F0Y2goZnVuY3Rpb24oZXJyb3JEYXRhKSB7XG5cbiAgICBcdFx0XHRjb25zb2xlLmVycm9yKGVycm9yRGF0YSk7XG5cbiAgICBcdFx0XHRpZiAoZXJyb3JEYXRhLmNvZGUgPT09ICdFTUFJTF9UQUtFTicpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShlcnJvckRhdGEuY29kZSk7XG4gICAgXHRcdFx0fVxuXG4gICAgXHRcdH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgIFx0fVxuXG4gICAgICAgIGZ1bmN0aW9uIGxvZ2luVG9BY2NvdW50KGlucHV0RW1haWwsIGlucHV0UGFzc3dvcmQpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgQXV0aFdyYXBwZXIuJGF1dGhXaXRoUGFzc3dvcmQoe1xuICAgICAgICAgICAgICAgIGVtYWlsOiBpbnB1dEVtYWlsLFxuICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBpbnB1dFBhc3N3b3JkXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKGF1dGhEYXRhKSB7XG5cbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCdMT0dJTl9TVUNDRVNTJyk7XG5cbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yRGF0YSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKGVycm9yRGF0YS5jb2RlID09PSAnSU5WQUxJRF9VU0VSJykge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCdJTlZBTElEX1VTRVInKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVycm9yRGF0YS5jb2RlID09PSAnSU5WQUxJRF9QQVNTV09SRCcpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgnSU5WQUxJRF9QQVNTV09SRCcpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsb2dPdXQoKSB7XG4gICAgICAgICAgICBBdXRoV3JhcHBlci4kdW5hdXRoKCk7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLnVuYmluZEZ1bmN0aW9uKCk7XG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmZhY3RvcnkoJ0F1dGhXcmFwcGVyJywgQXV0aFdyYXBwZXIpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gQXV0aFdyYXBwZXIoJGZpcmViYXNlQXV0aCwgRklSRUJBU0VEQVRBKSB7XG5cbiAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuICAgICAgICByZXR1cm4gJGZpcmViYXNlQXV0aChyZWYpO1xuXG4gICAgfVxuICAgIFxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuc2VydmljZSgnZXZlbnRTZXJ2aWNlJywgZXZlbnRTZXJ2aWNlKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIGV2ZW50U2VydmljZSgkcSwgJGZpbHRlciwgJGZpcmViYXNlT2JqZWN0LCAkZmlyZWJhc2VBcnJheSwgRklSRUJBU0VEQVRBKSB7XG5cbiAgICAgICAgdmFyIF9ldmVudFByb3BlcnRpZXMgPSBudWxsO1xuICAgICAgICB2YXIgX2dhbWVMaXN0ID0gbnVsbDtcbiAgICAgICAgdmFyIF9sZWFkZXJib2FyZExlbmd0aCA9IG51bGw7XG4gICAgICAgIHZhciBfc3VtbWFyaXplZExlYWRlcmJvYXJkID0gbnVsbDtcbiAgICAgICAgdmFyIF90ZWFtTGlzdCA9IG51bGw7XG5cbiAgICAgICAgdGhpcy5jcmVhdGVNdWx0aUdhbWVGaW5hbFN0YW5kaW5ncyA9IGNyZWF0ZU11bHRpR2FtZUZpbmFsU3RhbmRpbmdzO1xuICAgICAgICB0aGlzLmdldEV2ZW50UHJvcGVydGllcyA9IGdldEV2ZW50UHJvcGVydGllcztcbiAgICAgICAgdGhpcy5nZXRFdmVudFByb3BlcnRpZXNPYmplY3QgPSBnZXRFdmVudFByb3BlcnRpZXNPYmplY3Q7XG4gICAgICAgIHRoaXMuZ2V0R2FtZURhdGEgPSBnZXRHYW1lRGF0YTtcbiAgICAgICAgdGhpcy5nZXRHYW1lTGlzdE9iamVjdCA9IGdldEdhbWVMaXN0T2JqZWN0O1xuICAgICAgICB0aGlzLmdldEdhbWVzTGlzdCA9IGdldEdhbWVzTGlzdDtcbiAgICAgICAgdGhpcy5nZXRMZWFkZXJib2FyZExlbmd0aFZhbHVlID0gZ2V0TGVhZGVyYm9hcmRMZW5ndGhWYWx1ZTtcbiAgICAgICAgdGhpcy5nZXRNdWx0aUdhbWVMZWFkZXJib2FyZCA9IGdldE11bHRpR2FtZUxlYWRlcmJvYXJkO1xuICAgICAgICB0aGlzLmdldFBsYXllclNjb3JlcyA9IGdldFBsYXllclNjb3JlcztcbiAgICAgICAgdGhpcy5nZXRTaW5nbGVHYW1lTGVhZGVyYm9hcmQgPSBnZXRTaW5nbGVHYW1lTGVhZGVyYm9hcmQ7XG4gICAgICAgIHRoaXMuZ2V0U3VtbWFyaXplZExlYWRlcmJvYXJkT2JqZWN0ID0gZ2V0U3VtbWFyaXplZExlYWRlcmJvYXJkT2JqZWN0O1xuICAgICAgICB0aGlzLmdldFRlYW1MaXN0T2JqZWN0ID0gZ2V0VGVhbUxpc3RPYmplY3Q7XG4gICAgICAgIHRoaXMubG9hZEV2ZW50UHJvcGVydGllcyA9IGxvYWRFdmVudFByb3BlcnRpZXM7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZU11bHRpR2FtZUZpbmFsU3RhbmRpbmdzKGlucHV0RXZlbnQpIHtcblxuICAgICAgICAgICAgLy8gQ2FsY3VsYXRlIHRoZSBmaW5hbCBzdGFuZGluZ3Mgb2YgdGhlIGV2ZW50LlxuICAgICAgICAgICAgZ2V0TXVsdGlHYW1lTGVhZGVyYm9hcmQoaW5wdXRFdmVudCkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG4gICAgICAgICAgICAgICAgdmFyIGlucHV0RXZlbnRTdGFuZGluZ3MgPSAkZmlyZWJhc2VPYmplY3QoXG4gICAgICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKCdzdGFuZGluZ3MnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKGlucHV0RXZlbnQpXG4gICAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICAgIGlucHV0RXZlbnRTdGFuZGluZ3MuJGxvYWRlZCgpLnRoZW4oZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgbW9kZWwuZm9yRWFjaChmdW5jdGlvbihzdGFuZGluZykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXRFdmVudFN0YW5kaW5nc1tzdGFuZGluZy5rZXldID0gc3RhbmRpbmcucG9zaXRpb247XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGlucHV0RXZlbnRTdGFuZGluZ3MuJHNhdmUoKTtcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0RXZlbnRQcm9wZXJ0aWVzKGlucHV0RXZlbnQpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICBcdHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcbiAgICAgICAgXHR2YXIgZXZlbnRQcm9wZXJ0aWVzID0gJGZpcmViYXNlT2JqZWN0KFxuICAgICAgICBcdFx0cmVmXG4gICAgICAgIFx0XHRcdC5jaGlsZCgnY29udGVzdHMnKVxuICAgICAgICBcdFx0XHQuY2hpbGQoaW5wdXRFdmVudClcbiAgICAgICAgXHRcdFx0LmNoaWxkKCdwcm9wZXJ0aWVzJylcbiAgICAgICAgXHQpO1xuXG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGV2ZW50UHJvcGVydGllcyk7XG5cbiAgICAgICAgXHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0RXZlbnRQcm9wZXJ0aWVzT2JqZWN0KCkge1xuICAgICAgICAgICAgcmV0dXJuIF9ldmVudFByb3BlcnRpZXM7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRGaXJzdFBsYWNlU2NvcmVzKCkge1xuXG4gICAgICAgICAgICBfZ2FtZUxpc3QuZm9yRWFjaChmdW5jdGlvbihnYW1lKSB7XG5cbiAgICAgICAgICAgICAgICAvLyBJZiB0aGVyZSBhcmUgc2NvcmVzLCBnZXQgdGhlIHRvcCBvbmUuXG4gICAgICAgICAgICAgICAgaWYgKGdhbWUuc2NvcmVzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNjb3Jlc0FycmF5ID0gJC5tYXAoZ2FtZS5zY29yZXMsIGZ1bmN0aW9uKGVsKSB7IHJldHVybiBlbDsgfSk7XG4gICAgICAgICAgICAgICAgICAgIHNjb3Jlc0FycmF5ID0gJGZpbHRlcignb3JkZXJCeScpKHNjb3Jlc0FycmF5LCAnLXNjb3JlJyk7XG4gICAgICAgICAgICAgICAgICAgIGdhbWUuZmlyc3RTY29yZSA9IHNjb3Jlc0FycmF5WzBdO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0R2FtZURhdGEoaW5wdXRFdmVudCwgaW5wdXRHYW1lKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcblxuICAgICAgICAgICAgZ2V0R2FtZXNMaXN0KGlucHV0RXZlbnQpLnRoZW4oZnVuY3Rpb24oZ2FtZXNMaXN0KSB7XG5cbiAgICAgICAgICAgICAgICBnYW1lc0xpc3QuZm9yRWFjaChmdW5jdGlvbihnYW1lKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGdhbWUuY2FtZWxOYW1lID09PSBpbnB1dEdhbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZ2FtZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEdhbWVMaXN0T2JqZWN0KCkge1xuICAgICAgICAgICAgcmV0dXJuIF9nYW1lTGlzdDtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEdhbWVzTGlzdChpbnB1dEV2ZW50KSB7XG5cbiAgICAgICAgXHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIFx0dmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuICAgICAgICBcdHZhciBnYW1lc0xpc3QgPSAkZmlyZWJhc2VBcnJheShcbiAgICAgICAgXHRcdHJlZlxuICAgICAgICBcdFx0XHQuY2hpbGQoJ2NvbnRlc3RzJylcbiAgICAgICAgXHRcdFx0LmNoaWxkKGlucHV0RXZlbnQpXG4gICAgICAgIFx0XHRcdC5jaGlsZCgnYWN0aXZlR2FtZXMnKVxuICAgICAgICBcdCk7XG5cbiAgICAgICAgXHRnYW1lc0xpc3QuJGxvYWRlZCgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIFx0XHRkZWZlcnJlZC5yZXNvbHZlKGdhbWVzTGlzdCk7XG4gICAgICAgIFx0fSk7XG5cbiAgICAgICAgXHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0TGVhZGVyYm9hcmRMZW5ndGhWYWx1ZSgpIHtcbiAgICAgICAgICAgIHJldHVybiBfbGVhZGVyYm9hcmRMZW5ndGg7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRNdWx0aUdhbWVMZWFkZXJib2FyZChpbnB1dEV2ZW50KSB7XG5cbiAgICAgICAgXHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIFx0Ly8gV2UgbmVlZCB0byBnZXQgdGhlIHRvcCAxMiBwbGF5ZXJzIGZvciBldmVyeSBnYW1lLlxuICAgICAgICBcdHZhciBwbGF5ZXJQb2ludHMgPSB7fTtcblxuICAgICAgICBcdGdldEdhbWVzTGlzdChpbnB1dEV2ZW50KS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcblxuICAgICAgICBcdFx0dmFyIGdhbWVzTGlzdCA9IG1vZGVsO1xuICAgICAgICBcdFx0Z2FtZXNMaXN0LmZvckVhY2goZnVuY3Rpb24oZ2FtZSkge1xuXG4gICAgICAgIFx0XHRcdGlmIChnYW1lLnNjb3Jlcykge1xuXG4gICAgICAgIFx0XHRcdFx0Ly8gQ29udmVydCB0aGUgZ2FtZSdzIHNjb3JlcyB0byBhbiBhcnJheS5cbiAgICAgICAgXHRcdFx0XHR2YXIgc2NvcmVzQXJyYXkgPSAkLm1hcChnYW1lLnNjb3JlcywgZnVuY3Rpb24oZWwpIHsgcmV0dXJuIGVsOyB9KTtcbiAgICAgICAgXHRcdFx0XHRzY29yZXNBcnJheSA9ICRmaWx0ZXIoJ29yZGVyQnknKShzY29yZXNBcnJheSwgJy1zY29yZScpO1xuXG4gICAgICAgIFx0XHRcdFx0dmFyIHRvdGFsQXdhcmQgPSAxMjtcblxuICAgICAgICBcdFx0XHRcdC8vIEl0ZXJhdGUgdGhyb3VnaCB0aGUgdG9wIHNjb3JlcyBhd2FyZGluZyBwb2ludHMuXG4gICAgICAgIFx0XHRcdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCBzY29yZXNBcnJheS5sZW5ndGg7IGkrKykge1xuXG4gICAgICAgIFx0XHRcdFx0XHRpZiAoIXBsYXllclBvaW50c1tzY29yZXNBcnJheVtpXS51c2VyTmFtZV0pIHtcbiAgICAgICAgXHRcdFx0XHRcdFx0cGxheWVyUG9pbnRzW3Njb3Jlc0FycmF5W2ldLnVzZXJOYW1lXSA9IHtcbiAgICAgICAgXHRcdFx0XHRcdFx0XHRwb2ludHM6IDBcbiAgICAgICAgXHRcdFx0XHRcdFx0fTtcbiAgICAgICAgXHRcdFx0XHRcdH1cblxuICAgICAgICBcdFx0XHRcdFx0cGxheWVyUG9pbnRzW3Njb3Jlc0FycmF5W2ldLnVzZXJOYW1lXS5wb2ludHMgKz0gdG90YWxBd2FyZDtcblxuICAgICAgICBcdFx0XHRcdFx0aWYgKHRvdGFsQXdhcmQgPiAwKSB7XG4gICAgICAgIFx0XHRcdFx0XHRcdHRvdGFsQXdhcmQgLT0gMTtcbiAgICAgICAgXHRcdFx0XHRcdH1cblxuICAgICAgICBcdFx0XHRcdH1cblxuICAgICAgICBcdFx0XHR9XG5cbiAgICAgICAgXHRcdH0pO1xuXG4gICAgICAgIFx0XHQvLyBGaW5kIGFuZCByZXNvbHZlIHRpZXMuXG4gICAgICAgIFx0XHRwbGF5ZXJQb2ludHMgPSAkZmlsdGVyKCdvcmRlck9iamVjdEJ5JykocGxheWVyUG9pbnRzLCAncG9pbnRzJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgdmFyIGhhdmVCb3R0b21TY29yZXJzRmxvb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2YXIgZmxvb3JSYW5nZSA9IDA7XG4gICAgICAgIFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHBsYXllclBvaW50cy5sZW5ndGg7IGkgKz0gMSkge1xuXG4gICAgICAgIFx0XHRcdGlmIChwbGF5ZXJQb2ludHNbaS0xXSAmJiBwbGF5ZXJQb2ludHNbaV0ucG9pbnRzICYmIHBsYXllclBvaW50c1tpLTFdLnBvaW50cykge1xuXG4gICAgICAgIFx0XHRcdFx0aWYgKHBsYXllclBvaW50c1tpXS5wb2ludHMgPT09IHBsYXllclBvaW50c1tpLTFdLnBvaW50cykge1xuICAgICAgICBcdFx0XHRcdFx0cGxheWVyUG9pbnRzW2ldLnBvc2l0aW9uID0gcGxheWVyUG9pbnRzW2ktMV0ucG9zaXRpb247XG4gICAgICAgIFx0XHRcdFx0fSBlbHNlIHtcbiAgICAgICAgXHRcdFx0XHRcdHBsYXllclBvaW50c1tpXS5wb3NpdGlvbiA9IChpKzEpO1xuICAgICAgICBcdFx0XHRcdH1cblxuICAgICAgICBcdFx0XHR9IGVsc2Uge1xuXG4gICAgICAgIFx0XHRcdFx0aWYgKGkgPT09IDApIHtcbiAgICAgICAgXHRcdFx0XHRcdHBsYXllclBvaW50c1tpXS5wb3NpdGlvbiA9IDE7XG4gICAgICAgIFx0XHRcdFx0fSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaGF2ZUJvdHRvbVNjb3JlcnNGbG9vcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBHZXQgY291bnQgb2YgcGxheWVycyBpbiBvbmUgcG9zaXRpb24gaGlnaGVyLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZ2V0U2NvcmVDb3VudE9mID0gcGxheWVyUG9pbnRzW2ktMV0ucG9pbnRzO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcGxheWVyUG9pbnRzLmxlbmd0aDsgaiArPSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocGxheWVyUG9pbnRzW2pdLnBvaW50cyA9PT0gZ2V0U2NvcmVDb3VudE9mKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxvb3JSYW5nZSArPSAxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGF2ZUJvdHRvbVNjb3JlcnNGbG9vciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgIFx0XHRcdFx0XHRwbGF5ZXJQb2ludHNbaV0ucG9zaXRpb24gPSAocGxheWVyUG9pbnRzLmxlbmd0aCArIDEpIC0gZmxvb3JSYW5nZTtcbiAgICAgICAgXHRcdFx0XHR9XG5cbiAgICAgICAgXHRcdFx0fVxuXG4gICAgICAgIFx0XHR9XG5cbiAgICAgICAgXHRcdGRlZmVycmVkLnJlc29sdmUocGxheWVyUG9pbnRzKTtcblxuICAgICAgICBcdH0pO1xuXG5cdFx0XHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0U2luZ2xlR2FtZUxlYWRlcmJvYXJkKGlucHV0RXZlbnQpIHtcblxuICAgICAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuICAgICAgICAgICAgdmFyIGxlYWRlcmJvYXJkRGF0YSA9ICRmaXJlYmFzZUFycmF5KFxuICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoJ2NvbnRlc3RzJylcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkKGlucHV0RXZlbnQpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnc2NvcmVzJylcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUobGVhZGVyYm9hcmREYXRhKTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldFN1bW1hcml6ZWRMZWFkZXJib2FyZE9iamVjdCgpIHtcbiAgICAgICAgICAgIHJldHVybiBfc3VtbWFyaXplZExlYWRlcmJvYXJkO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0VGVhbUxpc3RPYmplY3QoKSB7XG4gICAgICAgICAgICByZXR1cm4gX3RlYW1MaXN0O1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0UGxheWVyU2NvcmVzKGlucHV0RXZlbnQsIGlucHV0R2FtZXNMaXN0LCBpbnB1dFBsYXllcikge1xuXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICB2YXIgZGlzcGxheVNjb3JlcyA9IFtdO1xuXG4gICAgICAgICAgICAvLyBJdGVyYXRlIHRocm91Z2ggZXZlcnkgZ2FtZS5cbiAgICAgICAgICAgIGlucHV0R2FtZXNMaXN0LmZvckVhY2goZnVuY3Rpb24oZ2FtZSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKGdhbWUuc2NvcmVzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ29udmVydCB0aGUgZ2FtZSdzIHNjb3JlcyB0byBhbiBhcnJheS5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNjb3Jlc0FycmF5ID0gJC5tYXAoZ2FtZS5zY29yZXMsIGZ1bmN0aW9uKGVsKSB7IHJldHVybiBlbDsgfSk7XG4gICAgICAgICAgICAgICAgICAgIHNjb3Jlc0FycmF5ID0gJGZpbHRlcignb3JkZXJCeScpKHNjb3Jlc0FycmF5LCAnLXNjb3JlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvdGFsQXdhcmQgPSAxMjtcblxuICAgICAgICAgICAgICAgICAgICAvLyBJdGVyYXRlIHRocm91Z2ggdGhlIHNjb3JlcyBzdGFydGluZyBmcm9tIHRoZSB0b3AgYW5kIGZpbmQgb3VyIHVzZXIuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2NvcmVzQXJyYXkubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm91bmQgb3VyIHBsYXllci5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29yZXNBcnJheVtpXS51c2VyTmFtZSA9PT0gaW5wdXRQbGF5ZXIpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdTY29yZU9iamVjdCA9IGdhbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2NvcmVPYmplY3QucG9zaXRpb24gPSBpKzE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2NvcmVPYmplY3Quc2NvcmUgPSBzY29yZXNBcnJheVtpXS5zY29yZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTY29yZU9iamVjdC5wb2ludHNFYXJuZWQgPSB0b3RhbEF3YXJkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Njb3JlT2JqZWN0LmlucFVybCA9IHNjb3Jlc0FycmF5W2ldLmlucFVybCA/IHNjb3Jlc0FycmF5W2ldLmlucFVybCA6IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2NvcmVPYmplY3QudHdpdGNoVXJsID0gc2NvcmVzQXJyYXlbaV0udHdpdGNoVXJsID8gc2NvcmVzQXJyYXlbaV0udHdpdGNoVXJsIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTY29yZU9iamVjdC5tYW1lVmVyc2lvbiA9IHNjb3Jlc0FycmF5W2ldLm1hbWVWZXJzaW9uID8gc2NvcmVzQXJyYXlbaV0ubWFtZVZlcnNpb24gOiBudWxsO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVNjb3Jlcy5wdXNoKG5ld1Njb3JlT2JqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF3YXJkID0gMTI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvdGFsQXdhcmQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXdhcmQgLT0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkaXNwbGF5U2NvcmVzKTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGxvYWRFdmVudFByb3BlcnRpZXMoaW5wdXRFdmVudCkge1xuXG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG4gICAgICAgICAgICB2YXIgaW5wdXRFdmVudFByb3BlcnRpZXMgPSAkZmlyZWJhc2VPYmplY3QoXG4gICAgICAgICAgICAgICAgcmVmXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnY29udGVzdHMnKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoaW5wdXRFdmVudClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkKCdwcm9wZXJ0aWVzJylcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGlucHV0RXZlbnRQcm9wZXJ0aWVzLiRsb2FkZWQoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIF9ldmVudFByb3BlcnRpZXMgPSBpbnB1dEV2ZW50UHJvcGVydGllcztcblxuICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYSBtdWx0aWdhbWUgZXZlbnQsIGdldCB0aGUgZGF0YSBuZWVkZWQgZm9yIG11bHRpZ2FtZSBjb21wb25lbnRzLlxuICAgICAgICAgICAgICAgIGlmIChfZXZlbnRQcm9wZXJ0aWVzLmZvcm1hdC5tdWx0aUdhbWUpIHtcblxuICAgICAgICAgICAgICAgICAgICBnZXRHYW1lc0xpc3QoaW5wdXRFdmVudCkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZ2FtZUxpc3QgPSBtb2RlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGdldEZpcnN0UGxhY2VTY29yZXMoKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgZ2V0TXVsdGlHYW1lTGVhZGVyYm9hcmQoaW5wdXRFdmVudCkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGVhZGVyYm9hcmQgPSBtb2RlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9sZWFkZXJib2FyZExlbmd0aCA9IGxlYWRlcmJvYXJkLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zdW1tYXJpemVkTGVhZGVyYm9hcmQgPSBsZWFkZXJib2FyZC5zbGljZSgwLCA4KTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGEgc2luZ2xlIGdhbWUgZXZlbnQsIGdldCB0aGUgZGF0YSBuZWVkZWQgZm9yIHNpbmdsZSBnYW1lIGNvbXBvbmVudHMuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICAgICBnZXRTaW5nbGVHYW1lTGVhZGVyYm9hcmQoaW5wdXRFdmVudCkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGVhZGVyYm9hcmQgPSBtb2RlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9sZWFkZXJib2FyZExlbmd0aCA9IGxlYWRlcmJvYXJkLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9zdW1tYXJpemVkTGVhZGVyYm9hcmQgPSBsZWFkZXJib2FyZDtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGEgdGVhbS1iYXNlZCBldmVudCwgZ2V0IHRoZSBkYXRhIG5lZWRlZCBmb3IgdGVhbSBldmVudCBjb21wb25lbnRzLlxuICAgICAgICAgICAgICAgIGlmIChfZXZlbnRQcm9wZXJ0aWVzLmZvcm1hdC50ZWFtQmFzZWQpIHtcblxuICAgICAgICAgICAgICAgICAgICB0ZWFtU2VydmljZS5nZXRUZWFtTGlzdCh2bS5ldmVudE5hbWUpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX3RlYW1MaXN0ID0gbW9kZWw7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdFdmVudE1haW5Db250cm9sbGVyJywgRXZlbnRNYWluQ29udHJvbGxlcik7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBFdmVudE1haW5Db250cm9sbGVyKCRzY29wZSwgJGZpbHRlciwgJHN0YXRlUGFyYW1zLCAkc3RhdGUsICR0aW1lb3V0LCAkZmlyZWJhc2VBcnJheSwgZXZlbnRTZXJ2aWNlLCBhdXRoU2VydmljZSwgcHJvZmlsZVNlcnZpY2UsIHRlYW1TZXJ2aWNlLCBGSVJFQkFTRURBVEEpIHtcblxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0uZXZlbnROYW1lID0gJHN0YXRlUGFyYW1zLmV2ZW50TmFtZTtcblxuICAgICAgICB2bS5jcmVhdGVUZWFtID0gY3JlYXRlVGVhbTtcbiAgICAgICAgdm0uZGV0ZXJtaW5lUG9pbnRzID0gZGV0ZXJtaW5lUG9pbnRzO1xuICAgICAgICB2bS5nb1RvUGxheWVyUHJvZmlsZSA9IGdvVG9QbGF5ZXJQcm9maWxlO1xuICAgICAgICB2bS5vcGVuQmFkZ2VzTW9kYWwgPSBvcGVuQmFkZ2VzTW9kYWw7XG4gICAgICAgIHZtLm9wZW5HYW1lTW9kYWwgPSBvcGVuR2FtZU1vZGFsO1xuICAgICAgICB2bS5vcGVuR2FtZU1vZGFsRnJvbVBsYXllck1vZGFsID0gb3BlbkdhbWVNb2RhbEZyb21QbGF5ZXJNb2RhbDtcbiAgICAgICAgdm0ub3Blbk1hbmFnZW1lbnRNb2RhbCA9IG9wZW5NYW5hZ2VtZW50TW9kYWw7XG4gICAgICAgIHZtLm9wZW5NdWx0aUdhbWVMZWFkZXJib2FyZE1vZGFsID0gb3Blbk11bHRpR2FtZUxlYWRlcmJvYXJkTW9kYWw7XG4gICAgICAgIHZtLm9wZW5QbGF5ZXJNb2RhbCA9IG9wZW5QbGF5ZXJNb2RhbDtcbiAgICAgICAgdm0ub3BlblBsYXllck1vZGFsRnJvbUdhbWVNb2RhbCA9IG9wZW5QbGF5ZXJNb2RhbEZyb21HYW1lTW9kYWw7XG4gICAgICAgIHZtLm9wZW5QbGF5ZXJNb2RhbEZyb21MZWFkZXJib2FyZE1vZGFsID0gb3BlblBsYXllck1vZGFsRnJvbUxlYWRlcmJvYXJkTW9kYWw7XG4gICAgICAgIHZtLm9wZW5SdWxlc01vZGFsID0gb3BlblJ1bGVzTW9kYWw7XG5cbiAgICAgICAgaW5pdEV2ZW50KCk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gY2xvc2VNb2RhbCgpIHtcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnLm1vZGFsJykuY2xvc2VNb2RhbCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVGVhbSgpIHtcbiAgICAgICAgICAgIHRlYW1TZXJ2aWNlLmNyZWF0ZVRlYW0odm0uZXZlbnROYW1lLCB2bS5uZXdUZWFtKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIE1hdGVyaWFsaXplLnRvYXN0KCdUZWFtICcgKyB2bS5uZXdUZWFtLnNob3J0TmFtZSArICcgY3JlYXRlZC4nLCA0MDAwKTtcbiAgICAgICAgICAgICAgICB2bS5uZXdUZWFtID0gbnVsbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZGV0ZXJtaW5lUG9pbnRzKGlucHV0U2NvcmVEYXRhLCBpbnB1dEluZGV4KSB7XG5cbiAgICAgICAgICAgIHZhciB1c2VyR2FtZVBvaW50cztcblxuICAgICAgICAgICAgLy8gTm8gcG9zaXRpb24gZ3JlYXRlciB0aGFuIDEyIGdldHMgcG9pbnRzLlxuICAgICAgICAgICAgaWYgKGlucHV0SW5kZXggPiAxMSkge1xuICAgICAgICAgICAgICAgIHVzZXJHYW1lUG9pbnRzID0gMDtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlckdhbWVQb2ludHM7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHVzZXJHYW1lUG9pbnRzID0gMTIgLSBpbnB1dEluZGV4O1xuXG4gICAgICAgICAgICB2YXIgc29ydGVkU2NvcmVzID0gJGZpbHRlcignb3JkZXJCeScpKHZtLmdhbWVTY29yZXMsICctc2NvcmUnKTtcblxuICAgICAgICAgICAgLy8gQW0gSSB0aWVkIHdpdGggdGhlIHBlcnNvbiBhYm92ZSBtZT8gSWYgc28sIG1hdGNoIHRoZWlyIHBvaW50cy5cbiAgICAgICAgICAgIGlmIChzb3J0ZWRTY29yZXNbaW5wdXRJbmRleCAtIDFdKSB7XG5cbiAgICAgICAgICAgICAgICBpZiAoc29ydGVkU2NvcmVzW2lucHV0SW5kZXggLSAxXS5zY29yZSA9PT0gaW5wdXRTY29yZURhdGEuc2NvcmUpIHtcbiAgICAgICAgICAgICAgICAgICAgdXNlckdhbWVQb2ludHMgKz0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB1c2VyR2FtZVBvaW50cztcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ29Ub1BsYXllclByb2ZpbGUoaW5wdXRQbGF5ZXIpIHtcblxuICAgICAgICAgICAgY2xvc2VNb2RhbCgpO1xuICAgICAgICAgICAgJHN0YXRlLmdvKCdwcm9maWxlJywge3VzZXJuYW1lOiBpbnB1dFBsYXllcn0pO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBpbml0RXZlbnQoKSB7XG5cbiAgICAgICAgICAgIGV2ZW50U2VydmljZS5sb2FkRXZlbnRQcm9wZXJ0aWVzKHZtLmV2ZW50TmFtZSk7XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKSB7IHJldHVybiBldmVudFNlcnZpY2UuZ2V0RXZlbnRQcm9wZXJ0aWVzT2JqZWN0KCk7IH0sIGZ1bmN0aW9uKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgdm0uZXZlbnRQcm9wZXJ0aWVzID0gbW9kZWw7XG4gICAgICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbigpIHsgcmV0dXJuIGV2ZW50U2VydmljZS5nZXRHYW1lTGlzdE9iamVjdCgpOyB9LCBmdW5jdGlvbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLmdhbWVMaXN0ID0gbW9kZWw7XG4gICAgICAgICAgICB9LCB0cnVlKTtcblxuICAgICAgICAgICAgJHNjb3BlLiR3YXRjaChmdW5jdGlvbigpIHsgcmV0dXJuIGV2ZW50U2VydmljZS5nZXRMZWFkZXJib2FyZExlbmd0aFZhbHVlKCk7IH0sIGZ1bmN0aW9uKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgdm0ubGVhZGVyYm9hcmRMZW5ndGggPSBtb2RlbDtcbiAgICAgICAgICAgIH0sIHRydWUpO1xuXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoKGZ1bmN0aW9uKCkgeyByZXR1cm4gZXZlbnRTZXJ2aWNlLmdldFN1bW1hcml6ZWRMZWFkZXJib2FyZE9iamVjdCgpOyB9LCBmdW5jdGlvbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLnN1bW1hcml6ZWRMZWFkZXJib2FyZCA9IG1vZGVsO1xuICAgICAgICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2goZnVuY3Rpb24oKSB7IHJldHVybiBldmVudFNlcnZpY2UuZ2V0VGVhbUxpc3RPYmplY3QoKTsgfSwgZnVuY3Rpb24obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS50ZWFtTGlzdCA9IG1vZGVsO1xuICAgICAgICAgICAgfSwgdHJ1ZSk7XG5cbiAgICAgICAgICAgIHByb2ZpbGVTZXJ2aWNlLmdldEF2YXRhckRhdGEoKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5hdmF0YXJEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb3BlbkJhZGdlc01vZGFsKCkge1xuXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNiYWRnZXNNb2RhbCcpLm9wZW5Nb2RhbCgpO1xuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjYmFkZ2VzTW9kYWxDb250ZW50Jykuc2Nyb2xsVG9wKDApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuR2FtZU1vZGFsKGlucHV0R2FtZU5hbWUpIHtcblxuICAgICAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuXG4gICAgICAgICAgICBldmVudFNlcnZpY2UuZ2V0R2FtZURhdGEodm0uZXZlbnROYW1lLCBpbnB1dEdhbWVOYW1lKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5nYW1lRGF0YSA9IG1vZGVsO1xuXG4gICAgICAgICAgICAgICAgdm0uZ2FtZVNjb3JlcyA9ICRmaXJlYmFzZUFycmF5KFxuICAgICAgICAgICAgICAgICAgICByZWZcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnY29udGVzdHMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKHZtLmV2ZW50TmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnYWN0aXZlR2FtZXMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKHZtLmdhbWVEYXRhLiRpZClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnc2NvcmVzJylcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnI2dhbWVNb2RhbCcpLm9wZW5Nb2RhbCgpO1xuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjZ2FtZU1vZGFsJykuYWRkQ2xhc3MoJy5vcGVuLW1vZGFsJyk7XG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNnYW1lTW9kYWxDb250ZW50Jykuc2Nyb2xsVG9wKDApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuTWFuYWdlbWVudE1vZGFsKCkge1xuXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNtYW5hZ2VtZW50TW9kYWwnKS5vcGVuTW9kYWwoKTtcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnI21hbmFnZW1lbnRNb2RhbENvbnRlbnQnKS5zY3JvbGxUb3AoMCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG9wZW5NdWx0aUdhbWVMZWFkZXJib2FyZE1vZGFsKCkge1xuXG4gICAgICAgICAgICBldmVudFNlcnZpY2UuZ2V0TXVsdGlHYW1lTGVhZGVyYm9hcmQodm0uZXZlbnROYW1lKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5jb21wbGV0ZUxlYWRlcmJvYXJkID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjbXVsdGlHYW1lTGVhZGVyYm9hcmRNb2RhbCcpLm9wZW5Nb2RhbCgpO1xuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjbXVsdGlHYW1lTGVhZGVyYm9hcmRNb2RhbENvbnRlbnQnKS5zY3JvbGxUb3AoMCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG9wZW5QbGF5ZXJNb2RhbChpbnB1dFBsYXllcikge1xuXG4gICAgICAgICAgICB2bS5mb2N1c1BsYXllciA9IGlucHV0UGxheWVyO1xuXG4gICAgICAgICAgICBldmVudFNlcnZpY2UuZ2V0UGxheWVyU2NvcmVzKHZtLmV2ZW50TmFtZSwgdm0uZ2FtZUxpc3QsIHZtLmZvY3VzUGxheWVyKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5wbGF5ZXJTY29yZXMgPSBtb2RlbDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNwbGF5ZXJNb2RhbCcpLm9wZW5Nb2RhbCgpO1xuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjcGxheWVyTW9kYWxDb250ZW50Jykuc2Nyb2xsVG9wKDApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuR2FtZU1vZGFsRnJvbVBsYXllck1vZGFsKGlucHV0R2FtZSkge1xuXG4gICAgICAgICAgICBjbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBvcGVuR2FtZU1vZGFsKGlucHV0R2FtZSk7XG4gICAgICAgICAgICB9LCA0NTApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuUGxheWVyTW9kYWxGcm9tR2FtZU1vZGFsKGlucHV0UGxheWVyKSB7XG5cbiAgICAgICAgICAgIGNsb3NlTW9kYWwoKTtcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIG9wZW5QbGF5ZXJNb2RhbChpbnB1dFBsYXllcik7XG4gICAgICAgICAgICB9LCA0NTApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuUGxheWVyTW9kYWxGcm9tTGVhZGVyYm9hcmRNb2RhbChpbnB1dFBsYXllcikge1xuXG4gICAgICAgICAgICBjbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBvcGVuUGxheWVyTW9kYWwoaW5wdXRQbGF5ZXIpO1xuICAgICAgICAgICAgfSwgNDUwKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb3BlblJ1bGVzTW9kYWwoKSB7XG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNydWxlc01vZGFsJykub3Blbk1vZGFsKCk7XG4gICAgICAgIH1cblxuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuc2VydmljZSgndGVhbVNlcnZpY2UnLCB0ZWFtU2VydmljZSk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiB0ZWFtU2VydmljZSgkcSwgJGZpcmViYXNlQXJyYXksICRmaXJlYmFzZU9iamVjdCwgRklSRUJBU0VEQVRBKSB7XG5cbiAgICBcdHRoaXMuY3JlYXRlVGVhbSA9IGNyZWF0ZVRlYW07XG4gICAgICAgIHRoaXMuZ2V0VGVhbUxpc3QgPSBnZXRUZWFtTGlzdDtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVGVhbShpbnB1dEV2ZW50LCBpbnB1dE5ld1RlYW1Qcm9wZXJ0aWVzKSB7XG5cbiAgICAgICAgXHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIFx0dmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuICAgICAgICBcdHZhciB0ZWFtUG9vbCA9ICRmaXJlYmFzZU9iamVjdChcbiAgICAgICAgXHRcdHJlZlxuICAgICAgICBcdFx0XHQuY2hpbGQoJ2NvbnRlc3RzJylcbiAgICAgICAgXHRcdFx0LmNoaWxkKGlucHV0RXZlbnQpXG4gICAgICAgIFx0XHRcdC5jaGlsZCgndGVhbVBvb2wnKVxuICAgICAgICBcdCk7XG5cbiAgICAgICAgXHR0ZWFtUG9vbC4kbG9hZGVkKCkudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICBcdFx0dGVhbVBvb2xbaW5wdXROZXdUZWFtUHJvcGVydGllcy5zaG9ydE5hbWVdID0ge1xuICAgICAgICBcdFx0XHRmdWxsTmFtZTogaW5wdXROZXdUZWFtUHJvcGVydGllcy5mb3JtYWxOYW1lXG4gICAgICAgIFx0XHR9O1xuICAgICAgICBcdFx0dGVhbVBvb2wuJHNhdmUoKTtcbiAgICAgICAgXHRcdGRlZmVycmVkLnJlc29sdmUoKTtcblxuICAgICAgICBcdH0pO1xuXG4gICAgICAgIFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldFRlYW1MaXN0KGlucHV0RXZlbnQpIHtcblxuICAgICAgICBcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgXHR2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG4gICAgICAgIFx0dmFyIHRlYW1MaXN0ID0gJGZpcmViYXNlQXJyYXkoXG4gICAgICAgIFx0XHRyZWZcbiAgICAgICAgXHRcdFx0LmNoaWxkKCdjb250ZXN0cycpXG4gICAgICAgIFx0XHRcdC5jaGlsZChpbnB1dEV2ZW50KVxuICAgICAgICBcdFx0XHQuY2hpbGQoJ3RlYW1Qb29sJylcbiAgICAgICAgXHQpO1xuXG4gICAgICAgIFx0dGVhbUxpc3QuJGxvYWRlZCgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIFx0XHRkZWZlcnJlZC5yZXNvbHZlKHRlYW1MaXN0KTtcbiAgICAgICAgXHR9KTtcblxuICAgICAgICBcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdIZWFkZXJDb250cm9sbGVyJywgSGVhZGVyQ29udHJvbGxlcik7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBIZWFkZXJDb250cm9sbGVyKCR0aW1lb3V0LCAkcm9vdFNjb3BlLCAkd2luZG93LCAkc3RhdGUsIGF1dGhTZXJ2aWNlKSB7XG5cbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICB2bS5sb2dPdXQgPSBsb2dPdXQ7XG5cbiAgICAgICAgYWN0aXZhdGUoKTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xuICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcuZHJvcGRvd24tYnV0dG9uJylcbiAgICAgICAgICAgICAgICAgICAgLmRyb3Bkb3duKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluRHVyYXRpb246IDMwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG91dER1cmF0aW9uOiAyMjUsXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdHJhaW5fd2lkdGg6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgaG92ZXI6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgZ3V0dGVyOiAtMTE0LFxuICAgICAgICAgICAgICAgICAgICAgICAgYmVsb3dPcmlnaW46IHRydWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LCA0MDApO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbG9nT3V0KCkge1xuICAgICAgICAgICAgYXV0aFNlcnZpY2UubG9nT3V0KCk7XG4gICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3ZnR2FtZXNMaXN0JywgdmdHYW1lc0xpc3QpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gdmdHYW1lc0xpc3QgKCkge1xuICAgICAgICAvLyBVc2FnZTpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gQ3JlYXRlczpcbiAgICAgICAgLy9cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBHYW1lc0xpc3RDb250cm9sbGVyLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgbGluazogbGluayxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy4vYXBwL2V2ZW50Q29tcG9uZW50cy9nYW1lc0xpc3QuZGlyZWN0aXZlLmh0bScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgXHRkYXRhOiAnPScsXG4gICAgICAgICAgICBcdG9wZW5HYW1lRnVuY3Rpb246ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBHYW1lc0xpc3RDb250cm9sbGVyKCkge1xuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgXHR2YXIgdm0gPSB0aGlzO1xuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgndmdNdWx0aUdhbWVMZWFkZXJib2FyZCcsIHZnTXVsdGlHYW1lTGVhZGVyYm9hcmQpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gdmdNdWx0aUdhbWVMZWFkZXJib2FyZCAoKSB7XG4gICAgICAgIC8vIFVzYWdlOlxuICAgICAgICAvL1xuICAgICAgICAvLyBDcmVhdGVzOlxuICAgICAgICAvL1xuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IE11bHRpR2FtZUxlYWRlcmJvYXJkQ29udHJvbGxlcixcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmssXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuL2FwcC9ldmVudENvbXBvbmVudHMvbXVsdGlHYW1lTGVhZGVyYm9hcmQuZGlyZWN0aXZlLmh0bScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgXHRkYXRhOiAnPScsXG4gICAgICAgICAgICAgICAgYXZhdGFyRGF0YTogJz0nLFxuICAgICAgICAgICAgXHRjb21wbGV0ZUxlbmd0aDogJz0nLFxuICAgICAgICAgICAgXHRvcGVuUGxheWVyRnVuY3Rpb246ICc9JyxcbiAgICAgICAgICAgICAgICBvcGVuTGVhZGVyYm9hcmRGdW5jdGlvbjogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIE11bHRpR2FtZUxlYWRlcmJvYXJkQ29udHJvbGxlcigpIHtcbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgIFx0dmFyIHZtID0gdGhpcztcbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3ZnU2luZ2xlR2FtZUxlYWRlcmJvYXJkJywgdmdTaW5nbGVHYW1lTGVhZGVyYm9hcmQpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gdmdTaW5nbGVHYW1lTGVhZGVyYm9hcmQgKCkge1xuICAgICAgICAvLyBVc2FnZTpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gQ3JlYXRlczpcbiAgICAgICAgLy9cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBTaW5nbGVHYW1lTGVhZGVyYm9hcmRDb250cm9sbGVyLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgbGluazogbGluayxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy4vYXBwL2V2ZW50Q29tcG9uZW50cy9zaW5nbGVHYW1lTGVhZGVyYm9hcmQuZGlyZWN0aXZlLmh0bScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgXHRkYXRhOiAnPScsXG4gICAgICAgICAgICAgICAgYXZhdGFyRGF0YTogJz0nLFxuICAgICAgICAgICAgXHRjb21wbGV0ZUxlbmd0aDogJz0nLFxuICAgICAgICAgICAgICAgIG9wZW5MZWFkZXJib2FyZEZ1bmN0aW9uOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gU2luZ2xlR2FtZUxlYWRlcmJvYXJkQ29udHJvbGxlcigpIHtcbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgIFx0dmFyIHZtID0gdGhpcztcbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3ZnU3RpY2t5TWVzc2FnZScsIHZnU3RpY2t5TWVzc2FnZSk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiB2Z1N0aWNreU1lc3NhZ2UgKCkge1xuICAgICAgICAvLyBVc2FnZTpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gQ3JlYXRlczpcbiAgICAgICAgLy9cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBTdGlja3lNZXNzYWdlQ29udHJvbGxlcixcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmssXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuL2FwcC9ldmVudENvbXBvbmVudHMvc3RpY2t5TWVzc2FnZS5kaXJlY3RpdmUuaHRtJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBcdHByb3BlcnRpZXM6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBTdGlja3lNZXNzYWdlQ29udHJvbGxlcigkdGltZW91dCkge1xuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgXHR2YXIgdm0gPSB0aGlzO1xuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmZpbHRlcignb3JkZXJPYmplY3RCeScsIG9yZGVyT2JqZWN0QnkpO1xuXG4gICAgZnVuY3Rpb24gb3JkZXJPYmplY3RCeSgpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGl0ZW1zLCBmaWVsZCwgcmV2ZXJzZSkge1xuICAgICAgICAgICAgdmFyIGZpbHRlcmVkID0gW107XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpdGVtcywgZnVuY3Rpb24oaXRlbSwga2V5KSB7XG4gICAgICAgICAgICAgICAgaXRlbS5rZXkgPSBrZXk7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWQucHVzaChpdGVtKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBmaWx0ZXJlZC5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChhW2ZpZWxkXSA+IGJbZmllbGRdID8gMSA6IC0xKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZihyZXZlcnNlKSBmaWx0ZXJlZC5yZXZlcnNlKCk7XG5cbiAgICAgICAgICAgIHJldHVybiBmaWx0ZXJlZDtcbiAgICAgICAgfTtcbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0F2YXRhckNvbnRyb2xsZXInLCBBdmF0YXJDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIEF2YXRhckNvbnRyb2xsZXIoJHJvb3RTY29wZSwgJHN0YXRlLCAkc3RhdGVQYXJhbXMsICR0aW1lb3V0LCBVcGxvYWQsIGltZ3VyLCBwcm9maWxlU2VydmljZSkge1xuXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgdm0udXBsb2FkQXZhdGFyID0gdXBsb2FkQXZhdGFyO1xuXG4gICAgICAgIGFjdGl2YXRlKCk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xuICAgICAgICBcdHByb2ZpbGVTZXJ2aWNlLmdldEF2YXRhckRhdGEoKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5hdmF0YXJEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gRklYTUU6IFRoaXMgbmVlZHMgdG8gYmUgdHJpZ2dlcmVkIGJ5IGEgJHJvb3RTY29wZSBicm9hZGNhc3Qgb2Ygd2hlbiBpdCByZWNlaXZlcyBwcm9maWxlIGRhdGEuXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwcm9maWxlU2VydmljZS5nZXRCYWRnZXNEYXRhKCRyb290U2NvcGUucHJvZmlsZS51c2VyTmFtZSkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmJhZGdlc0RhdGEgPSBtb2RlbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1cGxvYWRBdmF0YXIoKSB7XG5cbiAgICAgICAgXHR2bS5kaXNhYmxlQnV0dG9uID0gdHJ1ZTtcblxuICAgICAgICBcdGltZ3VyLnNldEFQSUtleSgnQ2xpZW50LUlEIGY1M2Q2ZDU4MzNiMDdiYycpO1xuICAgICAgICBcdGltZ3VyLnVwbG9hZCh2bS5maWxlKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgXHRcdHByb2ZpbGVTZXJ2aWNlLnNhdmVBdmF0YXJMaW5rKG1vZGVsWzBdLmxpbmssICRyb290U2NvcGUucHJvZmlsZS51c2VyTmFtZSk7XG4gICAgICAgIFx0XHRNYXRlcmlhbGl6ZS50b2FzdCgnWW91ciBhdmF0YXIgd2FzIHVwbG9hZGVkJywgNDAwMCk7XG5cbiAgICAgICAgXHRcdCR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICBcdFx0XHQkc3RhdGUuZ28oJ2hvbWUnKTtcbiAgICAgICAgXHRcdH0sIDEwMDApO1xuICAgICAgICBcdH0pO1xuXG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0NoYW5nZVBhc3N3b3JkQ29udHJvbGxlcicsIENoYW5nZVBhc3N3b3JkQ29udHJvbGxlcik7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBDaGFuZ2VQYXNzd29yZENvbnRyb2xsZXIoJHNjb3BlLCAkdGltZW91dCwgJHN0YXRlLCBBdXRoV3JhcHBlcikge1xuXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHZtLnN1Ym1pdENoYW5nZVBhc3N3b3JkID0gc3VibWl0Q2hhbmdlUGFzc3dvcmQ7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gc3VibWl0Q2hhbmdlUGFzc3dvcmQoKSB7XG5cbiAgICAgICAgICAgIGlmICgkc2NvcGUucHdDaGFuZ2VGb3JtLiR2YWxpZCkge1xuXG4gICAgICAgICAgICAgICAgQXV0aFdyYXBwZXIuJGNoYW5nZVBhc3N3b3JkKHtcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6IEF1dGhXcmFwcGVyLiRnZXRBdXRoKCkucGFzc3dvcmQuZW1haWwsXG4gICAgICAgICAgICAgICAgICAgIG9sZFBhc3N3b3JkOiB2bS5pbnB1dEN1cnJlbnRQYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgbmV3UGFzc3dvcmQ6IHZtLmlucHV0TmV3UGFzc3dvcmRcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIE1hdGVyaWFsaXplLnRvYXN0KCdZb3VyIHBhc3N3b3JkIHdhcyBjaGFuZ2VkLicsIDQwMDApO1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xuICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKTtcblxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ0lOVkFMSURfUEFTU1dPUkQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zaG93Q2hhbmdlUGFzc3dvcmRNZXNzYWdlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0hvbWVDb250cm9sbGVyJywgSG9tZUNvbnRyb2xsZXIpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gSG9tZUNvbnRyb2xsZXIoJHNjb3BlLCAkdGltZW91dCkge1xuXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuY29udHJvbGxlcignTGVhZGVyYm9hcmRDb250cm9sbGVyJywgTGVhZGVyYm9hcmRDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIExlYWRlcmJvYXJkQ29udHJvbGxlcigkcSwgJHRpbWVvdXQsICRmaXJlYmFzZUFycmF5LCBwcm9maWxlU2VydmljZSwgRklSRUJBU0VEQVRBKSB7XG5cbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgIFx0dmFyIHZtID0gdGhpcztcblxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgICAgICAgICAgIGdldFByb2ZpbGVTY29yZXMoKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5wcm9maWxlU2NvcmVEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcHJvZmlsZVNlcnZpY2UuZ2V0QXZhdGFyRGF0YSgpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLmF2YXRhckRhdGEgPSBtb2RlbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0UHJvZmlsZVNjb3JlcygpIHtcblxuICAgICAgICBcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgIFx0dmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuXG4gICAgICAgIFx0dmFyIHByb2ZpbGVTY29yZURhdGEgPSAkZmlyZWJhc2VBcnJheShcbiAgICAgICAgXHRcdHJlZlxuICAgICAgICBcdFx0XHQuY2hpbGQoJ2JhZGdlcycpXG4gICAgICAgIFx0KTtcblxuICAgICAgICBcdHByb2ZpbGVTY29yZURhdGEuJGxvYWRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgXHRcdGRlZmVycmVkLnJlc29sdmUocHJvZmlsZVNjb3JlRGF0YSk7XG4gICAgICAgIFx0fSk7XG5cbiAgICAgICAgXHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdQcm9maWxlQ29udHJvbGxlcicsIFByb2ZpbGVDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIFByb2ZpbGVDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlUGFyYW1zLCAkcSwgJHRpbWVvdXQsICRzdGF0ZSwgJGZpcmViYXNlQXJyYXksIGF1dGhTZXJ2aWNlLCBwcm9maWxlU2VydmljZSwgZXZlbnRTZXJ2aWNlKSB7XG5cbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgYWN0aXZhdGUoKTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcblxuICAgICAgICAgICAgcHJvZmlsZVNlcnZpY2UuZ2V0VXNlckRhdGEoJHN0YXRlUGFyYW1zLnVzZXJuYW1lKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5wcm9maWxlRGF0YSA9IG1vZGVsO1xuXG4gICAgICAgICAgICAgICAgcHJvZmlsZVNlcnZpY2UuZ2V0VG91cm5hbWVudEhpc3Rvcnkodm0ucHJvZmlsZURhdGEpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG91cm5hbWVudEhpc3RvcnlEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICAgICAgICAgIHZtLmV2ZW50U3RhbmRpbmdzID0gcHJvZmlsZVNlcnZpY2UuZ2V0VG91cm5hbWVudFN0YW5kaW5ncyh0b3VybmFtZW50SGlzdG9yeURhdGEsICRzdGF0ZVBhcmFtcy51c2VybmFtZSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAkKCcuY29sbGFwc2libGUnKS5jb2xsYXBzaWJsZSh7XG4gICAgICAgICAgICAgICAgICAgIGFjY29yZGlvbjogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHByb2ZpbGVTZXJ2aWNlLmdldEF2YXRhckRhdGEoKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5hdmF0YXJEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcHJvZmlsZVNlcnZpY2UuZ2V0QmFkZ2VzRGF0YSgkc3RhdGVQYXJhbXMudXNlcm5hbWUpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLmJhZGdlc0RhdGEgPSBtb2RlbDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuc2VydmljZSgncHJvZmlsZVNlcnZpY2UnLCBwcm9maWxlU2VydmljZSk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBwcm9maWxlU2VydmljZSgkcm9vdFNjb3BlLCAkcSwgJGZpcmViYXNlQXJyYXksICRmaXJlYmFzZU9iamVjdCwgZXZlbnRTZXJ2aWNlLCBGSVJFQkFTRURBVEEpIHtcblxuICAgIFx0dGhpcy5nZXRBdmF0YXJEYXRhID0gZ2V0QXZhdGFyRGF0YTtcbiAgICAgICAgdGhpcy5nZXRCYWRnZXNEYXRhID0gZ2V0QmFkZ2VzRGF0YTtcbiAgICBcdHRoaXMuZ2V0VG91cm5hbWVudEhpc3RvcnkgPSBnZXRUb3VybmFtZW50SGlzdG9yeTtcbiAgICAgICAgdGhpcy5nZXRUb3VybmFtZW50U3RhbmRpbmdzID0gZ2V0VG91cm5hbWVudFN0YW5kaW5ncztcbiAgICAgICAgdGhpcy5nZXRVc2VyRGF0YSA9IGdldFVzZXJEYXRhO1xuICAgICAgICB0aGlzLnNhdmVBdmF0YXJMaW5rID0gc2F2ZUF2YXRhckxpbms7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldEF2YXRhckRhdGEoKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgIHZhciBhdmF0YXJEYXRhID0gJGZpcmViYXNlT2JqZWN0KFxuICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoJ2F2YXRhcnMnKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgYXZhdGFyRGF0YS4kbG9hZGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoYXZhdGFyRGF0YSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEJhZGdlc0RhdGEoaW5wdXRVc2VyKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgIHZhciBiYWRnZXNEYXRhID0gJGZpcmViYXNlT2JqZWN0KFxuICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoJ2JhZGdlcycpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZChpbnB1dFVzZXIpXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBiYWRnZXNEYXRhLiRsb2FkZWQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShiYWRnZXNEYXRhKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0VG91cm5hbWVudEhpc3RvcnkoaW5wdXRVc2VyRGF0YSkge1xuXG4gICAgICAgIFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgXHR2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgXHQvLyBMb29wIHRocm91Z2ggZWFjaCBldmVudCBpbiB0aGUgcGxlZGdlZFRvIG9iamVjdC5cbiAgICAgICAgXHR2YXIgZXZlbnRzQXJyYXkgPSBbXTtcbiAgICAgICAgXHRmb3IgKHZhciBrZXkgaW4gaW5wdXRVc2VyRGF0YS5wbGVkZ2VkVG8pIHtcbiAgICAgICAgXHRcdGV2ZW50c0FycmF5LnB1c2goa2V5KTtcbiAgICAgICAgXHR9XG5cbiAgICAgICAgXHRkZWZlcnJlZC5yZXNvbHZlKGV2ZW50c0FycmF5KTtcblxuICAgICAgICBcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRUb3VybmFtZW50U3RhbmRpbmdzKGlucHV0VG91cm5hbWVudEhpc3RvcnksIGlucHV0VXNlcikge1xuXG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCBlYWNoIGV2ZW50IGluIHRoZSB1c2VyJ3MgaGlzdG9yeS5cbiAgICAgICAgICAgIHZhciBldmVudFN0YW5kaW5ncyA9IFtdO1xuICAgICAgICAgICAgaW5wdXRUb3VybmFtZW50SGlzdG9yeS5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICAgICAgICAgICAgICBldmVudFNlcnZpY2UuZ2V0RXZlbnRQcm9wZXJ0aWVzKGV2ZW50KS50aGVuKGZ1bmN0aW9uKGV2ZW50UHJvcGVydGllcykge1xuXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50UHJvcGVydGllcy4kbG9hZGVkKCkudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgY29uY2x1ZGVkLCBnZXQgdGhlIHVzZXIncyBzdGFuZGluZy5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudFByb3BlcnRpZXMuc3RhdGUgPT09ICdjb25jbHVkZWQnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRTdGFuZGluZ0RhdGEgPSAkZmlyZWJhc2VPYmplY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKCdzdGFuZGluZ3MnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKGV2ZW50KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFN0YW5kaW5nRGF0YS4kbG9hZGVkKCkudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnRTdGFuZGluZ0RhdGFbaW5wdXRVc2VyXSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFN0YW5kaW5ncy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBldmVudFByb3BlcnRpZXMubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVtaWVyOiBldmVudFByb3BlcnRpZXMucHJlbWllciA/IHRydWUgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3J0TmFtZTogZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6ICdjb25jbHVkZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBldmVudFByb3BlcnRpZXMuY29sb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGV2ZW50U3RhbmRpbmdEYXRhW2lucHV0VXNlcl1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U3RhbmRpbmdzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGV2ZW50UHJvcGVydGllcy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZW1pZXI6IGV2ZW50UHJvcGVydGllcy5wcmVtaWVyID8gdHJ1ZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnROYW1lOiBldmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogJ2NvbmNsdWRlZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGV2ZW50UHJvcGVydGllcy5jb2xvcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogLTFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50UHJvcGVydGllcy5zdGF0ZSA9PT0gJ2lucHJvZ3Jlc3MnIHx8IGV2ZW50UHJvcGVydGllcy5zdGF0ZSA9PT0gJ3VwY29taW5nJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTdGFuZGluZ3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGV2ZW50UHJvcGVydGllcy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVtaWVyOiBldmVudFByb3BlcnRpZXMucHJlbWllciA/IHRydWUgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG9ydE5hbWU6IGV2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogZXZlbnRQcm9wZXJ0aWVzLmNvbG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogZXZlbnRQcm9wZXJ0aWVzLnN0YXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGV2ZW50U3RhbmRpbmdzO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRVc2VyRGF0YShpbnB1dFVzZXIpIHtcblxuICAgICAgICBcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgIFx0dmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuXG4gICAgICAgIFx0dmFyIHVzZXJzRGF0YSA9ICRmaXJlYmFzZUFycmF5KFxuICAgICAgICBcdFx0cmVmXG4gICAgICAgIFx0XHRcdC5jaGlsZCgndXNlcnMnKVxuICAgICAgICBcdCk7XG5cbiAgICAgICAgXHR1c2Vyc0RhdGEuJGxvYWRlZChmdW5jdGlvbigpIHtcblxuICAgICAgICBcdFx0dXNlcnNEYXRhLmZvckVhY2goZnVuY3Rpb24odXNlcikge1xuICAgICAgICBcdFx0XHRpZiAodXNlci51c2VyTmFtZSA9PT0gaW5wdXRVc2VyKSB7XG4gICAgICAgIFx0XHRcdFx0ZGVmZXJyZWQucmVzb2x2ZSh1c2VyKTtcbiAgICAgICAgXHRcdFx0fVxuICAgICAgICBcdFx0fSk7XG5cbiAgICAgICAgXHR9KTtcblxuICAgICAgICBcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICAvLyBGSVhNRTogTWFrZSB0aGlzIHNlcnZlci1zaWRlLlxuICAgICAgICBmdW5jdGlvbiBzYXZlQXZhdGFyTGluayhpbnB1dExpbmssIGlucHV0VXNlcikge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgIHZhciBhdmF0YXJEYXRhID0gJGZpcmViYXNlT2JqZWN0KFxuICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoJ2F2YXRhcnMnKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgYXZhdGFyRGF0YS4kbG9hZGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGF2YXRhckRhdGFbaW5wdXRVc2VyXSA9IGlucHV0TGluaztcbiAgICAgICAgICAgICAgICBhdmF0YXJEYXRhLiRzYXZlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdSZWdDb250cm9sbGVyJywgUmVnQ29udHJvbGxlcik7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBSZWdDb250cm9sbGVyKCRzY29wZSwgJHJvb3RTY29wZSwgJHRpbWVvdXQsICR3aW5kb3csICRzdGF0ZSwgJGZpcmViYXNlT2JqZWN0LCBhdXRoU2VydmljZSwgQXV0aFdyYXBwZXIpIHtcblxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0ubG9naW5Ub0FjY291bnQgPSBsb2dpblRvQWNjb3VudDtcbiAgICAgICAgdm0ucGFzc3dvcmRSZXNldCA9IHBhc3N3b3JkUmVzZXQ7XG4gICAgICAgIHZtLnN1Ym1pdE5ld0FjY291bnQgPSBzdWJtaXROZXdBY2NvdW50O1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGxvZ2luVG9BY2NvdW50KCkge1xuXG4gICAgICAgICAgICBhdXRoU2VydmljZS5sb2dpblRvQWNjb3VudCh2bS5sb2dpbkVtYWlsLCB2bS5sb2dpblBhc3N3b3JkKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcblxuICAgICAgICAgICAgICAgIHZtLnNob3dJbnZhbGlkVXNlckVycm9yID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdm0uc2hvd0ludmFsaWRQYXNzd29yZEVycm9yID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAobW9kZWwgPT09ICdMT0dJTl9TVUNDRVNTJykge1xuXG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtb2RlbCA9PT0gJ0lOVkFMSURfVVNFUicpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uc2hvd0ludmFsaWRVc2VyRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtb2RlbCA9PT0gJ0lOVkFMSURfUEFTU1dPUkQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dJbnZhbGlkUGFzc3dvcmRFcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcGFzc3dvcmRSZXNldCgpIHtcblxuICAgICAgICAgICAgaWYgKCF2bS5sb2dpbkVtYWlsKSB7XG4gICAgICAgICAgICAgICAgdm0uc2hvd1Bhc3N3b3JkUmVzZXRFbWFpbE1lc3NhZ2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgQXV0aFdyYXBwZXIuJHJlc2V0UGFzc3dvcmQoe1xuICAgICAgICAgICAgICAgIGVtYWlsOiB2bS5sb2dpbkVtYWlsXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZtLnNob3dQYXNzd29yZFJlc2V0RW1haWxNZXNzYWdlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgTWF0ZXJpYWxpemUudG9hc3QoJ0EgcGFzc3dvcmQgcmVzZXQgZW1haWwgaGFzIGJlZW4gc2VudCB0byAnICsgdm0ubG9naW5FbWFpbCArICcuJywgNDAwMCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3VibWl0TmV3QWNjb3VudCgpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gRG9lcyB0aGUgdXNlciBleGlzdD8gSWYgc28sIHNob3cgYW4gZXJyb3IgbWVzc2FnZS5cbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmNoZWNrSWZVc2VyRXhpc3RzKHZtLm5ld1VzZXJuYW1lKS50aGVuKGZ1bmN0aW9uKHVzZXJFeGlzdHMpIHtcblxuICAgICAgICAgICAgICAgIHZtLnNob3dEdXBsaWNhdGVVc2VyRXJyb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2bS5zaG93RW1haWxUYWtlbkVycm9yID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAodXNlckV4aXN0cykge1xuXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dEdXBsaWNhdGVVc2VyRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICAvLyBUcnkgdG8gY3JlYXRlIHRoZSBuZXcgdXNlci5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmNyZWF0ZU5ld1VzZXIodm0ubmV3RW1haWwsIHZtLm5ld1Bhc3N3b3JkLCB2bS5uZXdVc2VybmFtZSkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2RlbCA9PT0gJ0VNQUlMX1RBS0VOJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2hvd0VtYWlsVGFrZW5FcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vZGVsID09PSAnQUNDT1VOVF9DUkVBVEVEJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdwcm9maWxlJywge3VzZXJuYW1lOiB2bS5uZXdVc2VybmFtZX0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=