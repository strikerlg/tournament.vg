(function() {
    'use strict';

    angular
        .module('vg.app', [
            /* Angular modules */
            'ngAnimate',
            /* App modules */
            /* Third-party modules */
            'ui.router',
            'firebase',
            'validation.match',
            'ordinal',
            'ngFileUpload',
            'ngImgur'
        ]);
})();;(function() {
	'use strict';

	angular
		.module('vg.app')
		.constant('FIREBASEDATA', {
			'FBURL': 'https://wolfscontests.firebaseio.com'
		})
		.config(config);

	/* @ngInject */
	function config($stateProvider, $urlRouterProvider) {

		// Redirect any unmatched URL to /.
		$urlRouterProvider.otherwise('/');

		$stateProvider
		    .state('home', {
		    	url: '/',
		    	templateUrl: 'app/home/home.htm',
		    	controller: 'HomeController as home'
		    })

		    .state('registerOrLogin', {
		    	url: '/registerOrLogin',
		    	templateUrl: '/app/home/reg.htm',
		    	controller: 'RegController as reg'
		    })

		    .state('profile', {
		    	url: '/profile/:username',
		    	templateUrl: '/app/home/profile.htm',
		    	controller: 'ProfileController as profile'
		    })

		    .state('leaderboard', {
		    	url: '/leaderboard',
		    	templateUrl: '/app/home/leaderboard.htm',
		    	controller: 'LeaderboardController as leaderboard'
		    })

		    .state('event', {
		    	url: '/event/:eventName/main',
		    	templateUrl: '/app/event/main.htm',
		    	controller: 'EventMainController as event'
		    })

		    .state('customizeAvatar', {
		    	url: '/customizeAvatar',
		    	templateUrl: '/app/home/avatar.htm',
		    	controller: 'AvatarController as avatar',

		    	resolve: {
		    		'currentAuth': ['AuthWrapper', function(AuthWrapper) {
		    			return AuthWrapper.$requireAuth();
		    		}]
		    	}
		    })

		    .state('changePassword', {
		    	url: '/changePassword',
		    	templateUrl: '/app/home/changePassword.htm',
		    	controller: 'ChangePasswordController as pwchange',

		    	resolve: {
		    		'currentAuth': ['AuthWrapper', function(AuthWrapper) {
		    			return AuthWrapper.$requireAuth();
		    		}]
		    	}
		    });
	}
	config.$inject = ["$stateProvider", "$urlRouterProvider"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .run(run);

    function run($rootScope, $location, $state, $firebaseObject, AuthWrapper, FIREBASEDATA) {

        $rootScope.$on('$stateChangeError', function(event, toState, toParams, fromState, fromParams, error) {
            if (error === 'AUTH_REQUIRED') {
                $state.go('registerOrLogin');
            }
        });

        $rootScope.$on('$stateChangeSuccess', function() {

            // If user is logged in, download their profile data to an object in $rootScope.
            // FIXME: We shouldn't need to do this every successful state change.
            if (AuthWrapper.$getAuth()) {
                
                var authData = AuthWrapper.$getAuth();
                var ref = new Firebase(FIREBASEDATA.FBURL);

                var profileData = $firebaseObject(ref.child('users').child(authData.uid));
                profileData.$bindTo($rootScope, 'profile').then(function(unbind) {
                    $rootScope.unbindFunction = unbind;
                });

            }

        });

    }
    run.$inject = ["$rootScope", "$location", "$state", "$firebaseObject", "AuthWrapper", "FIREBASEDATA"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('authService', authService);

    /* @ngInject */
    function authService($q, $rootScope, $state, $window, $timeout, $firebaseObject, AuthWrapper, FIREBASEDATA) {
        
        this.testData = 'hello world!';

    	this.checkIfUserExists = checkIfUserExists;
    	this.createNewUser = createNewUser;
        this.loginToAccount = loginToAccount;
        this.logOut = logOut;

    	///////////////////

    	function checkIfUserExists(inputUsername) {

    		var deferred = $q.defer();

    		var doesUserExist = false;
    		var usersRef = new $window.Firebase(FIREBASEDATA.FBURL + '/users');

    		usersRef.once('value', function(dataSnapshot) {

                $timeout(function() {
                    dataSnapshot.forEach(function(user) {
                        if (user.val().userName === inputUsername) {
                            doesUserExist = true;
                        }
                    });

                    deferred.resolve(doesUserExist);
                });

    		});

    		return deferred.promise;

    	}

    	function createNewUser(inputEmail, inputPassword, inputUsername) {

            var deferred = $q.defer();

    		AuthWrapper.$createUser({
    			email: inputEmail,
    			password: inputPassword
    		}).then(function(userData) {

    			// Create a data entry for the new username.
    			new Firebase(FIREBASEDATA.FBURL).child('users/' + userData.uid).set({

    				userName: inputUsername,
    				role: 'User'

    			}, function(errorData) {
    				console.error(errorData);
                    return errorData.code;
    			});

                // Create a data entry for the user's avatar.
                new Firebase(FIREBASEDATA.FBURL).child('avatars').child(inputUsername).set('http://api.adorable.io/avatars/42/' + inputUsername);

    			// Log the user in.
    			AuthWrapper.$authWithPassword({
    				email: inputEmail,
    				password: inputPassword
    			}).then(function() {
                    deferred.resolve('ACCOUNT_CREATED');
                });

    		}).catch(function(errorData) {

    			console.error(errorData);

    			if (errorData.code === 'EMAIL_TAKEN') {
                    deferred.resolve(errorData.code);
    			}

    		});

            return deferred.promise;

    	}

        function loginToAccount(inputEmail, inputPassword) {

            var deferred = $q.defer();

            AuthWrapper.$authWithPassword({
                email: inputEmail,
                password: inputPassword
            }).then(function(authData) {

                deferred.resolve('LOGIN_SUCCESS');

            }).catch(function(errorData) {

                if (errorData.code === 'INVALID_USER') {
                    deferred.resolve('INVALID_USER');
                } else if (errorData.code === 'INVALID_PASSWORD') {
                    deferred.resolve('INVALID_PASSWORD');
                }

            });

            return deferred.promise;

        }

        function logOut() {
            AuthWrapper.$unauth();
            $rootScope.unbindFunction();
        }

    }
    authService.$inject = ["$q", "$rootScope", "$state", "$window", "$timeout", "$firebaseObject", "AuthWrapper", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .factory('AuthWrapper', AuthWrapper);

    /* @ngInject */
    function AuthWrapper($firebaseAuth, FIREBASEDATA) {

        var ref = new Firebase(FIREBASEDATA.FBURL);
        return $firebaseAuth(ref);

    }
    AuthWrapper.$inject = ["$firebaseAuth", "FIREBASEDATA"];
    
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('eventService', eventService);

    /* @ngInject */
    function eventService($q, $filter, $firebaseObject, $firebaseArray, FIREBASEDATA) {

        this.createMultiGameFinalStandings = createMultiGameFinalStandings;
        this.getEventProperties = getEventProperties;
        this.getGameData = getGameData;
        this.getGamesList = getGamesList;
        this.getMultiGameLeaderboard = getMultiGameLeaderboard;
        this.getSingleGameLeaderboard = getSingleGameLeaderboard;
        this.getPlayerScores = getPlayerScores;

        ////////////////

        function createMultiGameFinalStandings(inputEvent) {

            // Calculate the final standings of the event.
            getMultiGameLeaderboard(inputEvent).then(function then(model) {

                var ref = new Firebase(FIREBASEDATA.FBURL);
                var inputEventStandings = $firebaseObject(
                    ref
                        .child('standings')
                        .child(inputEvent)
                );

                inputEventStandings.$loaded().then(function() {

                    model.forEach(function(standing) {
                        inputEventStandings[standing.key] = standing.position;
                    });

                    inputEventStandings.$save();

                });

            });

        }

        function getEventProperties(inputEvent) {

            var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var eventProperties = $firebaseObject(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('properties')
        	);

            deferred.resolve(eventProperties);

        	return deferred.promise;

        }

        function getGameData(inputEvent, inputGame) {

            var deferred = $q.defer();

            var ref = new Firebase(FIREBASEDATA.FBURL);

            getGamesList(inputEvent).then(function(gamesList) {

                gamesList.forEach(function(game) {

                    if (game.camelName === inputGame) {
                        deferred.resolve(game);
                    }

                });

            });

            return deferred.promise;

        }

        function getGamesList(inputEvent) {

        	var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var gamesList = $firebaseArray(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('activeGames')
        	);

        	gamesList.$loaded().then(function() {
        		deferred.resolve(gamesList);
        	});

        	return deferred.promise;

        }

        function getMultiGameLeaderboard(inputEvent) {

        	var deferred = $q.defer();

        	// We need to get the top 12 players for every game.
        	var playerPoints = {};

        	getGamesList(inputEvent).then(function then(model) {

        		var gamesList = model;
        		gamesList.forEach(function(game) {

        			if (game.scores) {

        				// Convert the game's scores to an array.
        				var scoresArray = $.map(game.scores, function(el) { return el; });
        				scoresArray = $filter('orderBy')(scoresArray, '-score');

        				var totalAward = 12;

        				// Iterate through the top scores awarding points.
        				for (var i = 0; i < scoresArray.length; i++) {

        					if (!playerPoints[scoresArray[i].userName]) {
        						playerPoints[scoresArray[i].userName] = {
        							points: 0
        						};
        					}

        					playerPoints[scoresArray[i].userName].points += totalAward;

        					if (totalAward > 0) {
        						totalAward -= 1;
        					}

        				}

        			}

        		});

        		// Find and resolve ties.
        		playerPoints = $filter('orderObjectBy')(playerPoints, 'points', true);
                var haveBottomScorersFloor = false;
                var floorRange = 0;
        		for (var i = 0; i < playerPoints.length; i += 1) {

        			if (playerPoints[i-1] && playerPoints[i].points && playerPoints[i-1].points) {

        				if (playerPoints[i].points === playerPoints[i-1].points) {
        					playerPoints[i].position = playerPoints[i-1].position;
        				} else {
        					playerPoints[i].position = (i+1);
        				}

        			} else {

        				if (i === 0) {
        					playerPoints[i].position = 1;
        				} else {

                            if (!haveBottomScorersFloor) {
                                // Get count of players in one position higher.
                                var getScoreCountOf = playerPoints[i-1].points;

                                for (var j = 0; j < playerPoints.length; j += 1) {
                                    if (playerPoints[j].points === getScoreCountOf) {
                                        floorRange += 1;
                                    }
                                }

                                haveBottomScorersFloor = true;
                            }

        					playerPoints[i].position = (playerPoints.length + 1) - floorRange;
        				}

        			}

        		}

        		deferred.resolve(playerPoints);

        	});

			return deferred.promise;

        }

        function getSingleGameLeaderboard(inputEvent) {

            var deferred = $q.defer();

            var ref = new Firebase(FIREBASEDATA.FBURL);
            var leaderboardData = $firebaseArray(
                ref
                    .child('contests')
                    .child(inputEvent)
                    .child('scores')
            );

            deferred.resolve(leaderboardData);

            return deferred.promise;

        }

        function getPlayerScores(inputEvent, inputGamesList, inputPlayer) {

            var deferred = $q.defer();

            var displayScores = [];

            // Iterate through every game.
            inputGamesList.forEach(function(game) {

                if (game.scores) {

                    // Convert the game's scores to an array.
                    var scoresArray = $.map(game.scores, function(el) { return el; });
                    scoresArray = $filter('orderBy')(scoresArray, '-score');

                    var totalAward = 12;

                    // Iterate through the scores starting from the top and find our user.
                    for (var i = 0; i < scoresArray.length; i++) {

                        // Found our player.
                        if (scoresArray[i].userName === inputPlayer) {

                            var newScoreObject = game;
                            newScoreObject.position = i+1;
                            newScoreObject.score = scoresArray[i].score;
                            newScoreObject.pointsEarned = totalAward;
                            newScoreObject.inpUrl = scoresArray[i].inpUrl ? scoresArray[i].inpUrl : null;
                            newScoreObject.twitchUrl = scoresArray[i].twitchUrl ? scoresArray[i].twitchUrl : null;
                            newScoreObject.mameVersion = scoresArray[i].mameVersion ? scoresArray[i].mameVersion : null;

                            displayScores.push(newScoreObject);
                            totalAward = 12;
                            break;

                        } else {
                            if (totalAward > 0) {
                                totalAward -= 1;
                            }
                        }

                    }

                }

            });

            deferred.resolve(displayScores);

            return deferred.promise;

        }

    }
    eventService.$inject = ["$q", "$filter", "$firebaseObject", "$firebaseArray", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('EventMainController', EventMainController);

    /* @ngInject */
    function EventMainController($scope, $filter, $stateParams, $state, $timeout, $firebaseArray, eventService, authService, profileService, teamService, FIREBASEDATA) {

        /* jshint validthis: true */
        var vm = this;

        vm.eventName = $stateParams.eventName;

        vm.createTeam = createTeam;
        vm.determinePoints = determinePoints;
        vm.getFirstPlaceScores = getFirstPlaceScores;
        vm.goToPlayerProfile = goToPlayerProfile;
        vm.openBadgesModal = openBadgesModal;
        vm.openGameModal = openGameModal;
        vm.openGameModalFromPlayerModal = openGameModalFromPlayerModal;
        vm.openManagementModal = openManagementModal;
        vm.openMultiGameLeaderboardModal = openMultiGameLeaderboardModal;
        vm.openPlayerModal = openPlayerModal;
        vm.openPlayerModalFromGameModal = openPlayerModalFromGameModal;
        vm.openPlayerModalFromLeaderboardModal = openPlayerModalFromLeaderboardModal;
        vm.openRulesModal = openRulesModal;

        initEvent();

        /////////////////////////////////

        function closeModal() {
            angular.element('.modal').closeModal();
        }

        function createTeam() {
            teamService.createTeam(vm.eventName, vm.newTeam).then(function() {
                Materialize.toast('Team ' + vm.newTeam.shortName + ' created.', 4000);
                vm.newTeam = null;
            });
        }

        function determinePoints(inputScoreData, inputIndex) {

            var userGamePoints;

            // No position greater than 12 gets points.
            if (inputIndex > 11) {
                userGamePoints = 0;
                return userGamePoints;
            }

            userGamePoints = 12 - inputIndex;

            var sortedScores = $filter('orderBy')(vm.gameScores, '-score');

            // Am I tied with the person above me? If so, match their points.
            if (sortedScores[inputIndex - 1]) {

                if (sortedScores[inputIndex - 1].score === inputScoreData.score) {
                    userGamePoints += 1;
                }
            }

            return userGamePoints;

        }

        function getFirstPlaceScores() {

            vm.gameList.forEach(function(game) {

                // If there are scores, get the top one.
                if (game.scores) {

                    var scoresArray = $.map(game.scores, function(el) { return el; });
                    scoresArray = $filter('orderBy')(scoresArray, '-score');
                    game.firstScore = scoresArray[0];

                }

            });

        }

        function goToPlayerProfile(inputPlayer) {

            closeModal();
            $state.go('profile', {username: inputPlayer});

        }

        function initEvent() {

            eventService.getEventProperties(vm.eventName).then(function then(model) {

                vm.eventProperties = model;

                vm.eventProperties.$loaded().then(function() {

                    // If this is a multigame event, get the data needed for multigame components.
                    if (vm.eventProperties.format.multiGame) {

                        eventService.getGamesList(vm.eventName).then(function then(model) {
                            vm.gameList = model;
                            getFirstPlaceScores();
                        });

                        eventService.getMultiGameLeaderboard(vm.eventName).then(function then(model) {
                            var leaderboard = model;
                            vm.leaderboardLength = leaderboard.length;
                            vm.summarizedLeaderboard = leaderboard.slice(0, 8);
                        });

                    // If this is a single game event, get the data needed for single game components.
                    } else {

                        eventService.getSingleGameLeaderboard(vm.eventName).then(function then(model) {
                            var leaderboard = model;
                            vm.leaderboardLength = leaderboard.length;
                            vm.summarizedLeaderboard = leaderboard;
                        });

                    }

                    // If this is a team-based event, get the data needed for team event components.
                    if (vm.eventProperties.format.teamBased) {

                        teamService.getTeamList(vm.eventName).then(function then(model) {
                            vm.teamList = model;
                        });

                    }

                    if (vm.eventProperties.state === 'upcoming') {
                        $('.collapsible').collapsible({
                            accordion: true
                        });
                    }

                });

            });

            profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });

        }

        function openBadgesModal() {

            angular.element('#badgesModal').openModal();
            angular.element('#badgesModalContent').scrollTop(0);

        }

        function openGameModal(inputGameName) {

            var ref = new Firebase(FIREBASEDATA.FBURL);

            eventService.getGameData(vm.eventName, inputGameName).then(function then(model) {
                vm.gameData = model;

                vm.gameScores = $firebaseArray(
                    ref
                        .child('contests')
                        .child(vm.eventName)
                        .child('activeGames')
                        .child(vm.gameData.$id)
                        .child('scores')
                );
            });

            angular.element('#gameModal').openModal();
            angular.element('#gameModal').addClass('.open-modal');
            angular.element('#gameModalContent').scrollTop(0);

        }

        function openManagementModal() {

            angular.element('#managementModal').openModal();
            angular.element('#managementModalContent').scrollTop(0);

        }

        function openMultiGameLeaderboardModal() {

            eventService.getMultiGameLeaderboard(vm.eventName).then(function then(model) {
                vm.completeLeaderboard = model;
            });

            angular.element('#multiGameLeaderboardModal').openModal();
            angular.element('#multiGameLeaderboardModalContent').scrollTop(0);

        }

        function openPlayerModal(inputPlayer) {

            vm.focusPlayer = inputPlayer;

            eventService.getPlayerScores(vm.eventName, vm.gameList, vm.focusPlayer).then(function then(model) {
                vm.playerScores = model;
            });

            angular.element('#playerModal').openModal();
            angular.element('#playerModalContent').scrollTop(0);

        }

        function openGameModalFromPlayerModal(inputGame) {

            closeModal();
            $timeout(function() {
                openGameModal(inputGame);
            }, 450);

        }

        function openPlayerModalFromGameModal(inputPlayer) {

            closeModal();
            $timeout(function() {
                openPlayerModal(inputPlayer);
            }, 450);

        }

        function openPlayerModalFromLeaderboardModal(inputPlayer) {

            closeModal();
            $timeout(function() {
                openPlayerModal(inputPlayer);
            }, 450);

        }

        function openRulesModal() {
            angular.element('#rulesModal').openModal();
        }

    }
    EventMainController.$inject = ["$scope", "$filter", "$stateParams", "$state", "$timeout", "$firebaseArray", "eventService", "authService", "profileService", "teamService", "FIREBASEDATA"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('teamService', teamService);

    /* @ngInject */
    function teamService($q, $firebaseArray, $firebaseObject, FIREBASEDATA) {

    	this.createTeam = createTeam;
        this.getTeamList = getTeamList;

        ////////////////

        function createTeam(inputEvent, inputNewTeamProperties) {

        	var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var teamPool = $firebaseObject(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('teamPool')
        	);

        	teamPool.$loaded().then(function() {

        		teamPool[inputNewTeamProperties.shortName] = {
        			fullName: inputNewTeamProperties.formalName
        		};
        		teamPool.$save();
        		deferred.resolve();

        	});

        	return deferred.promise;

        }

        function getTeamList(inputEvent) {

        	var deferred = $q.defer();

        	var ref = new Firebase(FIREBASEDATA.FBURL);
        	var teamList = $firebaseArray(
        		ref
        			.child('contests')
        			.child(inputEvent)
        			.child('teamPool')
        	);

        	teamList.$loaded().then(function() {
        		deferred.resolve(teamList);
        	});

        	return deferred.promise;

        }
    }
    teamService.$inject = ["$q", "$firebaseArray", "$firebaseObject", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgGamesList', vgGamesList);

    /* @ngInject */
    function vgGamesList () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: GamesListController,
            controllerAs: 'vm',
            link: link,
            restrict: 'E',
            templateUrl: './app/eventComponents/gamesList.directive.htm',
            scope: {
            	data: '=',
            	openGameFunction: '='
            }
        };
        return directive;

        function link(scope, element, attrs) {
        }
    }

    /* @ngInject */
    function GamesListController() {
        /* jshint validthis: true */
    	var vm = this;
    }
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgMultiGameLeaderboard', vgMultiGameLeaderboard);

    /* @ngInject */
    function vgMultiGameLeaderboard () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: MultiGameLeaderboardController,
            controllerAs: 'vm',
            link: link,
            restrict: 'E',
            templateUrl: './app/eventComponents/multiGameLeaderboard.directive.htm',
            scope: {
            	data: '=',
                avatarData: '=',
            	completeLength: '=',
            	openPlayerFunction: '=',
                openLeaderboardFunction: '='
            }
        };
        return directive;

        function link(scope, element, attrs) {
        }
    }

    /* @ngInject */
    function MultiGameLeaderboardController() {
        /* jshint validthis: true */
    	var vm = this;
    }
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgSingleGameLeaderboard', vgSingleGameLeaderboard);

    /* @ngInject */
    function vgSingleGameLeaderboard () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: SingleGameLeaderboardController,
            controllerAs: 'vm',
            link: link,
            restrict: 'E',
            templateUrl: './app/eventComponents/singleGameLeaderboard.directive.htm',
            scope: {
            	data: '=',
                avatarData: '=',
            	completeLength: '=',
                openLeaderboardFunction: '='
            }
        };
        return directive;

        function link(scope, element, attrs) {
        }
    }

    /* @ngInject */
    function SingleGameLeaderboardController() {
        /* jshint validthis: true */
    	var vm = this;
    }
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .directive('vgStickyMessage', vgStickyMessage);

    /* @ngInject */
    function vgStickyMessage () {
        // Usage:
        //
        // Creates:
        //
        var directive = {
            bindToController: true,
            controller: StickyMessageController,
            controllerAs: 'vm',
            link: link,
            restrict: 'E',
            templateUrl: './app/eventComponents/stickyMessage.directive.htm',
            scope: {
            	properties: '='
            }
        };
        return directive;

        function link(scope, element, attrs) {
        }
    }

    /* @ngInject */
    function StickyMessageController($timeout) {
        /* jshint validthis: true */
    	var vm = this;
    }
    StickyMessageController.$inject = ["$timeout"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('HeaderController', HeaderController);

    /* @ngInject */
    function HeaderController($timeout, $rootScope, $window, $state, authService) {

        /* jshint validthis: true */
        var vm = this;
        vm.logOut = logOut;

        activate();

        //////////////////////////

        function activate() {
            $timeout(function() {
                angular.element('.dropdown-button')
                    .dropdown({
                        inDuration: 300,
                        outDuration: 225,
                        constrain_width: false,
                        hover: false,
                        gutter: -114,
                        belowOrigin: true
                    });
            }, 400);
        }

        function logOut() {
            authService.logOut();
            $window.location.reload();
        }

    }
    HeaderController.$inject = ["$timeout", "$rootScope", "$window", "$state", "authService"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .filter('orderObjectBy', orderObjectBy);

    function orderObjectBy() {
        return function(items, field, reverse) {
            var filtered = [];

            angular.forEach(items, function(item, key) {
                item.key = key;
                filtered.push(item);
            });

            filtered.sort(function (a, b) {
                return (a[field] > b[field] ? 1 : -1);
            });

            if(reverse) filtered.reverse();

            return filtered;
        };
    }

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('AvatarController', AvatarController);

    /* @ngInject */
    function AvatarController($rootScope, $state, $stateParams, $timeout, Upload, imgur, profileService) {

        /* jshint validthis: true */
        var vm = this;
        vm.uploadAvatar = uploadAvatar;

        activate();

        ////////////////

        function activate() {
        	profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });

            // FIXME: This needs to be triggered by a $rootScope broadcast of when it receives profile data.
            $timeout(function() {
                profileService.getBadgesData($rootScope.profile.userName).then(function then(model) {
                    vm.badgesData = model;
                });
            }, 500);
        }

        function uploadAvatar() {

        	vm.disableButton = true;

        	imgur.setAPIKey('Client-ID f53d6d5833b07bc');
        	imgur.upload(vm.file).then(function then(model) {
        		profileService.saveAvatarLink(model[0].link, $rootScope.profile.userName);
        		Materialize.toast('Your avatar was uploaded', 4000);

        		$timeout(function() {
        			$state.go('home');
        		}, 1000);
        	});

        }

    }
    AvatarController.$inject = ["$rootScope", "$state", "$stateParams", "$timeout", "Upload", "imgur", "profileService"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('ChangePasswordController', ChangePasswordController);

    /* @ngInject */
    function ChangePasswordController($scope, $timeout, $state, AuthWrapper) {

        /* jshint validthis: true */
        var vm = this;
        
        vm.submitChangePassword = submitChangePassword;

        //////////////////

        function submitChangePassword() {

            if ($scope.pwChangeForm.$valid) {

                AuthWrapper.$changePassword({
                    email: AuthWrapper.$getAuth().password.email,
                    oldPassword: vm.inputCurrentPassword,
                    newPassword: vm.inputNewPassword
                }).then(function() {

                    Materialize.toast('Your password was changed.', 4000);
                    $timeout(function() {
                        $state.go('home');
                    }, 1000);

                }).catch(function(error) {
                    
                    if (error.code === 'INVALID_PASSWORD') {
                        vm.showChangePasswordMessage = true;
                    }

                });

            }

        }

    }
    ChangePasswordController.$inject = ["$scope", "$timeout", "$state", "AuthWrapper"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('HomeController', HomeController);

    /* @ngInject */
    function HomeController($scope, $timeout) {

        /* jshint validthis: true */
        var vm = this;

        ////////////////////////

    }
    HomeController.$inject = ["$scope", "$timeout"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('LeaderboardController', LeaderboardController);

    /* @ngInject */
    function LeaderboardController($q, $timeout, $firebaseArray, profileService, FIREBASEDATA) {

        /* jshint validthis: true */
    	var vm = this;

        activate();

        ////////////////

        function activate() {
            getProfileScores().then(function then(model) {
                vm.profileScoreData = model;
            });

            profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });
        }

        function getProfileScores() {

        	var deferred = $q.defer();
        	var ref = new Firebase(FIREBASEDATA.FBURL);

        	var profileScoreData = $firebaseArray(
        		ref
        			.child('badges')
        	);

        	profileScoreData.$loaded(function() {
        		deferred.resolve(profileScoreData);
        	});

        	return deferred.promise;

        }

    }
    LeaderboardController.$inject = ["$q", "$timeout", "$firebaseArray", "profileService", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('ProfileController', ProfileController);

    /* @ngInject */
    function ProfileController($scope, $stateParams, $q, $timeout, $state, $firebaseArray, authService, profileService, eventService) {

        /* jshint validthis: true */
        var vm = this;
        
        activate();

        /////////////////////////////////

        function activate() {

            profileService.getUserData($stateParams.username).then(function then(model) {
                vm.profileData = model;

                profileService.getTournamentHistory(vm.profileData).then(function then(model) {
                    var tournamentHistoryData = model;
                    vm.eventStandings = profileService.getTournamentStandings(tournamentHistoryData, $stateParams.username);
                });

                $('.collapsible').collapsible({
                    accordion: true
                });
            });

            profileService.getAvatarData().then(function then(model) {
                vm.avatarData = model;
            });

            profileService.getBadgesData($stateParams.username).then(function then(model) {
                vm.badgesData = model;
            });

        }

    }
    ProfileController.$inject = ["$scope", "$stateParams", "$q", "$timeout", "$state", "$firebaseArray", "authService", "profileService", "eventService"];

})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .service('profileService', profileService);

    /* @ngInject */
    function profileService($rootScope, $q, $firebaseArray, $firebaseObject, eventService, FIREBASEDATA) {

    	this.getAvatarData = getAvatarData;
        this.getBadgesData = getBadgesData;
    	this.getTournamentHistory = getTournamentHistory;
        this.getTournamentStandings = getTournamentStandings;
        this.getUserData = getUserData;
        this.saveAvatarLink = saveAvatarLink;

        ////////////////

        function getAvatarData() {

            var deferred = $q.defer();
            var ref = new Firebase(FIREBASEDATA.FBURL);

            var avatarData = $firebaseObject(
                ref
                    .child('avatars')
            );

            avatarData.$loaded(function() {
                deferred.resolve(avatarData);
            });

            return deferred.promise;

        }

        function getBadgesData(inputUser) {

            var deferred = $q.defer();
            var ref = new Firebase(FIREBASEDATA.FBURL);

            var badgesData = $firebaseObject(
                ref
                    .child('badges')
                    .child(inputUser)
            );

            badgesData.$loaded(function() {
                deferred.resolve(badgesData);
            });

            return deferred.promise;

        }

        function getTournamentHistory(inputUserData) {

        	var deferred = $q.defer();
        	var ref = new Firebase(FIREBASEDATA.FBURL);

        	// Loop through each event in the pledgedTo object.
        	var eventsArray = [];
        	for (var key in inputUserData.pledgedTo) {
        		eventsArray.push(key);
        	}

        	deferred.resolve(eventsArray);

        	return deferred.promise;

        }

        function getTournamentStandings(inputTournamentHistory, inputUser) {

            var ref = new Firebase(FIREBASEDATA.FBURL);

            // Loop through each event in the user's history.
            var eventStandings = [];
            inputTournamentHistory.forEach(function(event) {

                eventService.getEventProperties(event).then(function(eventProperties) {

                    eventProperties.$loaded().then(function() {

                        // If concluded, get the user's standing.
                        if (eventProperties.state === 'concluded') {

                            var eventStandingData = $firebaseObject(
                                ref
                                    .child('standings')
                                    .child(event)
                            );

                            eventStandingData.$loaded().then(function() {

                                if (eventStandingData[inputUser]) {

                                    eventStandings.push({
                                        name: eventProperties.name,
                                        premier: eventProperties.premier ? true : null,
                                        shortName: event,
                                        state: 'concluded',
                                        color: eventProperties.color,
                                        position: eventStandingData[inputUser]
                                    });

                                } else {

                                    eventStandings.push({
                                        name: eventProperties.name,
                                        premier: eventProperties.premier ? true : null,
                                        shortName: event,
                                        state: 'concluded',
                                        color: eventProperties.color,
                                        position: -1
                                    });

                                }

                            });

                        } else if (eventProperties.state === 'inprogress' || eventProperties.state === 'upcoming') {

                            eventStandings.push({
                                name: eventProperties.name,
                                premier: eventProperties.premier ? true : null,
                                shortName: event,
                                color: eventProperties.color,
                                state: eventProperties.state
                            });

                        }

                    });

                });

            });

            return eventStandings;

        }

        function getUserData(inputUser) {

        	var deferred = $q.defer();
        	var ref = new Firebase(FIREBASEDATA.FBURL);

        	var usersData = $firebaseArray(
        		ref
        			.child('users')
        	);

        	usersData.$loaded(function() {

        		usersData.forEach(function(user) {
        			if (user.userName === inputUser) {
        				deferred.resolve(user);
        			}
        		});

        	});

        	return deferred.promise;

        }

        // FIXME: Make this server-side.
        function saveAvatarLink(inputLink, inputUser) {
            
            var ref = new Firebase(FIREBASEDATA.FBURL);

            var avatarData = $firebaseObject(
                ref
                    .child('avatars')
            );

            avatarData.$loaded(function() {
                avatarData[inputUser] = inputLink;
                avatarData.$save();
            });

        }

    }
    profileService.$inject = ["$rootScope", "$q", "$firebaseArray", "$firebaseObject", "eventService", "FIREBASEDATA"];
})();;(function() {
    'use strict';

    angular
        .module('vg.app')
        .controller('RegController', RegController);

    /* @ngInject */
    function RegController($scope, $rootScope, $timeout, $window, $state, $firebaseObject, authService, AuthWrapper) {

        /* jshint validthis: true */
        var vm = this;

        vm.loginToAccount = loginToAccount;
        vm.passwordReset = passwordReset;
        vm.submitNewAccount = submitNewAccount;

        /////////////////////

        function loginToAccount() {

            authService.loginToAccount(vm.loginEmail, vm.loginPassword).then(function then(model) {

                vm.showInvalidUserError = false;
                vm.showInvalidPasswordError = false;

                if (model === 'LOGIN_SUCCESS') {

                    $state.go('home');

                } else if (model === 'INVALID_USER') {
                    vm.showInvalidUserError = true;
                    return;
                } else if (model === 'INVALID_PASSWORD') {
                    vm.showInvalidPasswordError = true;
                }

            });

        }

        function passwordReset() {

            if (!vm.loginEmail) {
                vm.showPasswordResetEmailMessage = true;
                return;
            }

            AuthWrapper.$resetPassword({
                email: vm.loginEmail
            }).then(function() {
                vm.showPasswordResetEmailMessage = false;
                Materialize.toast('A password reset email has been sent to ' + vm.loginEmail + '.', 4000);
            });

        }

        function submitNewAccount() {
            
            // Does the user exist? If so, show an error message.
            authService.checkIfUserExists(vm.newUsername).then(function(userExists) {

                vm.showDuplicateUserError = false;
                vm.showEmailTakenError = false;

                if (userExists) {

                    vm.showDuplicateUserError = true;
                    return;

                // Try to create the new user.
                } else {

                    authService.createNewUser(vm.newEmail, vm.newPassword, vm.newUsername).then(function then(model) {

                        if (model === 'EMAIL_TAKEN') {

                            vm.showEmailTakenError = true;
                            return;

                        } else if (model === 'ACCOUNT_CREATED') {

                            $state.go('profile', {username: vm.newUsername});

                        }

                    });

                }

            });

        }

    }
    RegController.$inject = ["$scope", "$rootScope", "$timeout", "$window", "$state", "$firebaseObject", "authService", "AuthWrapper"];

})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJhcHAuY29uZmlnLmpzIiwiYXBwLnJ1bi5qcyIsImF1dGgvYXV0aC5zZXJ2aWNlLmpzIiwiYXV0aC9hdXRod3JhcHBlci5mYWN0b3J5LmpzIiwiZXZlbnQvZXZlbnQuc2VydmljZS5qcyIsImV2ZW50L21haW4uY29udHJvbGxlci5qcyIsImV2ZW50L3RlYW0uc2VydmljZS5qcyIsImV2ZW50Q29tcG9uZW50cy9nYW1lc0xpc3QuZGlyZWN0aXZlLmpzIiwiZXZlbnRDb21wb25lbnRzL211bHRpR2FtZUxlYWRlcmJvYXJkLmRpcmVjdGl2ZS5qcyIsImV2ZW50Q29tcG9uZW50cy9zaW5nbGVHYW1lTGVhZGVyYm9hcmQuZGlyZWN0aXZlLmpzIiwiZXZlbnRDb21wb25lbnRzL3N0aWNreU1lc3NhZ2UuZGlyZWN0aXZlLmpzIiwiaGVhZGVyL2hlYWRlci5jb250cm9sbGVyLmpzIiwiaGVscGVycy9vcmRlck9iamVjdEJ5LmZpbHRlci5qcyIsImhvbWUvYXZhdGFyLmNvbnRyb2xsZXIuanMiLCJob21lL2NoYW5nZVBhc3N3b3JkLmNvbnRyb2xsZXIuanMiLCJob21lL2hvbWUuY29udHJvbGxlci5qcyIsImhvbWUvbGVhZGVyYm9hcmQuY29udHJvbGxlci5qcyIsImhvbWUvcHJvZmlsZS5jb250cm9sbGVyLmpzIiwiaG9tZS9wcm9maWxlLnNlcnZpY2UuanMiLCJob21lL3JlZy5jb250cm9sbGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQSxVQUFBOztZQUVBOzs7WUFHQTtZQUNBO1lBQ0E7WUFDQTtZQUNBO1lBQ0E7O0tBRUEsQ0NoQkEsQ0FBQSxXQUFBO0NBQ0E7O0NBRUE7R0FDQSxPQUFBO0dBQ0EsU0FBQSxnQkFBQTtHQUNBLFNBQUE7O0dBRUEsT0FBQTs7O0NBR0EsU0FBQSxPQUFBLGdCQUFBLG9CQUFBOzs7RUFHQSxtQkFBQSxVQUFBOztFQUVBO09BQ0EsTUFBQSxRQUFBO09BQ0EsS0FBQTtPQUNBLGFBQUE7T0FDQSxZQUFBOzs7T0FHQSxNQUFBLG1CQUFBO09BQ0EsS0FBQTtPQUNBLGFBQUE7T0FDQSxZQUFBOzs7T0FHQSxNQUFBLFdBQUE7T0FDQSxLQUFBO09BQ0EsYUFBQTtPQUNBLFlBQUE7OztPQUdBLE1BQUEsZUFBQTtPQUNBLEtBQUE7T0FDQSxhQUFBO09BQ0EsWUFBQTs7O09BR0EsTUFBQSxTQUFBO09BQ0EsS0FBQTtPQUNBLGFBQUE7T0FDQSxZQUFBOzs7T0FHQSxNQUFBLG1CQUFBO09BQ0EsS0FBQTtPQUNBLGFBQUE7T0FDQSxZQUFBOztPQUVBLFNBQUE7UUFDQSxlQUFBLENBQUEsZUFBQSxTQUFBLGFBQUE7U0FDQSxPQUFBLFlBQUE7Ozs7O09BS0EsTUFBQSxrQkFBQTtPQUNBLEtBQUE7T0FDQSxhQUFBO09BQ0EsWUFBQTs7T0FFQSxTQUFBO1FBQ0EsZUFBQSxDQUFBLGVBQUEsU0FBQSxhQUFBO1NBQ0EsT0FBQSxZQUFBOzs7Ozs7S0FLQSxDQ3ZFQSxDQUFBLFdBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUE7U0FDQSxJQUFBOztJQUVBLFNBQUEsSUFBQSxZQUFBLFdBQUEsUUFBQSxpQkFBQSxhQUFBLGNBQUE7O1FBRUEsV0FBQSxJQUFBLHFCQUFBLFNBQUEsT0FBQSxTQUFBLFVBQUEsV0FBQSxZQUFBLE9BQUE7WUFDQSxJQUFBLFVBQUEsaUJBQUE7Z0JBQ0EsT0FBQSxHQUFBOzs7O1FBSUEsV0FBQSxJQUFBLHVCQUFBLFdBQUE7Ozs7WUFJQSxJQUFBLFlBQUEsWUFBQTs7Z0JBRUEsSUFBQSxXQUFBLFlBQUE7Z0JBQ0EsSUFBQSxNQUFBLElBQUEsU0FBQSxhQUFBOztnQkFFQSxJQUFBLGNBQUEsZ0JBQUEsSUFBQSxNQUFBLFNBQUEsTUFBQSxTQUFBO2dCQUNBLFlBQUEsUUFBQSxZQUFBLFdBQUEsS0FBQSxTQUFBLFFBQUE7b0JBQ0EsV0FBQSxpQkFBQTs7Ozs7Ozs7OztLQVNBLENDbkNBLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLFFBQUEsZUFBQTs7O0lBR0EsU0FBQSxZQUFBLElBQUEsWUFBQSxRQUFBLFNBQUEsVUFBQSxpQkFBQSxhQUFBLGNBQUE7O1FBRUEsS0FBQSxXQUFBOztLQUVBLEtBQUEsb0JBQUE7S0FDQSxLQUFBLGdCQUFBO1FBQ0EsS0FBQSxpQkFBQTtRQUNBLEtBQUEsU0FBQTs7OztLQUlBLFNBQUEsa0JBQUEsZUFBQTs7TUFFQSxJQUFBLFdBQUEsR0FBQTs7TUFFQSxJQUFBLGdCQUFBO01BQ0EsSUFBQSxXQUFBLElBQUEsUUFBQSxTQUFBLGFBQUEsUUFBQTs7TUFFQSxTQUFBLEtBQUEsU0FBQSxTQUFBLGNBQUE7O2dCQUVBLFNBQUEsV0FBQTtvQkFDQSxhQUFBLFFBQUEsU0FBQSxNQUFBO3dCQUNBLElBQUEsS0FBQSxNQUFBLGFBQUEsZUFBQTs0QkFDQSxnQkFBQTs7OztvQkFJQSxTQUFBLFFBQUE7Ozs7O01BS0EsT0FBQSxTQUFBOzs7O0tBSUEsU0FBQSxjQUFBLFlBQUEsZUFBQSxlQUFBOztZQUVBLElBQUEsV0FBQSxHQUFBOztNQUVBLFlBQUEsWUFBQTtPQUNBLE9BQUE7T0FDQSxVQUFBO1NBQ0EsS0FBQSxTQUFBLFVBQUE7OztPQUdBLElBQUEsU0FBQSxhQUFBLE9BQUEsTUFBQSxXQUFBLFNBQUEsS0FBQSxJQUFBOztRQUVBLFVBQUE7UUFDQSxNQUFBOztVQUVBLFNBQUEsV0FBQTtRQUNBLFFBQUEsTUFBQTtvQkFDQSxPQUFBLFVBQUE7Ozs7Z0JBSUEsSUFBQSxTQUFBLGFBQUEsT0FBQSxNQUFBLFdBQUEsTUFBQSxlQUFBLElBQUEsdUNBQUE7OztPQUdBLFlBQUEsa0JBQUE7UUFDQSxPQUFBO1FBQ0EsVUFBQTtVQUNBLEtBQUEsV0FBQTtvQkFDQSxTQUFBLFFBQUE7OztTQUdBLE1BQUEsU0FBQSxXQUFBOztPQUVBLFFBQUEsTUFBQTs7T0FFQSxJQUFBLFVBQUEsU0FBQSxlQUFBO29CQUNBLFNBQUEsUUFBQSxVQUFBOzs7OztZQUtBLE9BQUEsU0FBQTs7OztRQUlBLFNBQUEsZUFBQSxZQUFBLGVBQUE7O1lBRUEsSUFBQSxXQUFBLEdBQUE7O1lBRUEsWUFBQSxrQkFBQTtnQkFDQSxPQUFBO2dCQUNBLFVBQUE7ZUFDQSxLQUFBLFNBQUEsVUFBQTs7Z0JBRUEsU0FBQSxRQUFBOztlQUVBLE1BQUEsU0FBQSxXQUFBOztnQkFFQSxJQUFBLFVBQUEsU0FBQSxnQkFBQTtvQkFDQSxTQUFBLFFBQUE7dUJBQ0EsSUFBQSxVQUFBLFNBQUEsb0JBQUE7b0JBQ0EsU0FBQSxRQUFBOzs7OztZQUtBLE9BQUEsU0FBQTs7OztRQUlBLFNBQUEsU0FBQTtZQUNBLFlBQUE7WUFDQSxXQUFBOzs7OztLQUlBLENDeEhBLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLFFBQUEsZUFBQTs7O0lBR0EsU0FBQSxZQUFBLGVBQUEsY0FBQTs7UUFFQSxJQUFBLE1BQUEsSUFBQSxTQUFBLGFBQUE7UUFDQSxPQUFBLGNBQUE7Ozs7O0tBSUEsQ0NmQSxDQUFBLFdBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUE7U0FDQSxRQUFBLGdCQUFBOzs7SUFHQSxTQUFBLGFBQUEsSUFBQSxTQUFBLGlCQUFBLGdCQUFBLGNBQUE7O1FBRUEsS0FBQSxnQ0FBQTtRQUNBLEtBQUEscUJBQUE7UUFDQSxLQUFBLGNBQUE7UUFDQSxLQUFBLGVBQUE7UUFDQSxLQUFBLDBCQUFBO1FBQ0EsS0FBQSwyQkFBQTtRQUNBLEtBQUEsa0JBQUE7Ozs7UUFJQSxTQUFBLDhCQUFBLFlBQUE7OztZQUdBLHdCQUFBLFlBQUEsS0FBQSxTQUFBLEtBQUEsT0FBQTs7Z0JBRUEsSUFBQSxNQUFBLElBQUEsU0FBQSxhQUFBO2dCQUNBLElBQUEsc0JBQUE7b0JBQ0E7eUJBQ0EsTUFBQTt5QkFDQSxNQUFBOzs7Z0JBR0Esb0JBQUEsVUFBQSxLQUFBLFdBQUE7O29CQUVBLE1BQUEsUUFBQSxTQUFBLFVBQUE7d0JBQ0Esb0JBQUEsU0FBQSxPQUFBLFNBQUE7OztvQkFHQSxvQkFBQTs7Ozs7Ozs7UUFRQSxTQUFBLG1CQUFBLFlBQUE7O1lBRUEsSUFBQSxXQUFBLEdBQUE7O1NBRUEsSUFBQSxNQUFBLElBQUEsU0FBQSxhQUFBO1NBQ0EsSUFBQSxrQkFBQTtVQUNBO1lBQ0EsTUFBQTtZQUNBLE1BQUE7WUFDQSxNQUFBOzs7WUFHQSxTQUFBLFFBQUE7O1NBRUEsT0FBQSxTQUFBOzs7O1FBSUEsU0FBQSxZQUFBLFlBQUEsV0FBQTs7WUFFQSxJQUFBLFdBQUEsR0FBQTs7WUFFQSxJQUFBLE1BQUEsSUFBQSxTQUFBLGFBQUE7O1lBRUEsYUFBQSxZQUFBLEtBQUEsU0FBQSxXQUFBOztnQkFFQSxVQUFBLFFBQUEsU0FBQSxNQUFBOztvQkFFQSxJQUFBLEtBQUEsY0FBQSxXQUFBO3dCQUNBLFNBQUEsUUFBQTs7Ozs7OztZQU9BLE9BQUEsU0FBQTs7OztRQUlBLFNBQUEsYUFBQSxZQUFBOztTQUVBLElBQUEsV0FBQSxHQUFBOztTQUVBLElBQUEsTUFBQSxJQUFBLFNBQUEsYUFBQTtTQUNBLElBQUEsWUFBQTtVQUNBO1lBQ0EsTUFBQTtZQUNBLE1BQUE7WUFDQSxNQUFBOzs7U0FHQSxVQUFBLFVBQUEsS0FBQSxXQUFBO1VBQ0EsU0FBQSxRQUFBOzs7U0FHQSxPQUFBLFNBQUE7Ozs7UUFJQSxTQUFBLHdCQUFBLFlBQUE7O1NBRUEsSUFBQSxXQUFBLEdBQUE7OztTQUdBLElBQUEsZUFBQTs7U0FFQSxhQUFBLFlBQUEsS0FBQSxTQUFBLEtBQUEsT0FBQTs7VUFFQSxJQUFBLFlBQUE7VUFDQSxVQUFBLFFBQUEsU0FBQSxNQUFBOztXQUVBLElBQUEsS0FBQSxRQUFBOzs7WUFHQSxJQUFBLGNBQUEsRUFBQSxJQUFBLEtBQUEsUUFBQSxTQUFBLElBQUEsRUFBQSxPQUFBO1lBQ0EsY0FBQSxRQUFBLFdBQUEsYUFBQTs7WUFFQSxJQUFBLGFBQUE7OztZQUdBLEtBQUEsSUFBQSxJQUFBLEdBQUEsSUFBQSxZQUFBLFFBQUEsS0FBQTs7YUFFQSxJQUFBLENBQUEsYUFBQSxZQUFBLEdBQUEsV0FBQTtjQUNBLGFBQUEsWUFBQSxHQUFBLFlBQUE7ZUFDQSxRQUFBOzs7O2FBSUEsYUFBQSxZQUFBLEdBQUEsVUFBQSxVQUFBOzthQUVBLElBQUEsYUFBQSxHQUFBO2NBQ0EsY0FBQTs7Ozs7Ozs7OztVQVVBLGVBQUEsUUFBQSxpQkFBQSxjQUFBLFVBQUE7Z0JBQ0EsSUFBQSx5QkFBQTtnQkFDQSxJQUFBLGFBQUE7VUFDQSxLQUFBLElBQUEsSUFBQSxHQUFBLElBQUEsYUFBQSxRQUFBLEtBQUEsR0FBQTs7V0FFQSxJQUFBLGFBQUEsRUFBQSxNQUFBLGFBQUEsR0FBQSxVQUFBLGFBQUEsRUFBQSxHQUFBLFFBQUE7O1lBRUEsSUFBQSxhQUFBLEdBQUEsV0FBQSxhQUFBLEVBQUEsR0FBQSxRQUFBO2FBQ0EsYUFBQSxHQUFBLFdBQUEsYUFBQSxFQUFBLEdBQUE7bUJBQ0E7YUFDQSxhQUFBLEdBQUEsWUFBQSxFQUFBOzs7a0JBR0E7O1lBRUEsSUFBQSxNQUFBLEdBQUE7YUFDQSxhQUFBLEdBQUEsV0FBQTttQkFDQTs7NEJBRUEsSUFBQSxDQUFBLHdCQUFBOztnQ0FFQSxJQUFBLGtCQUFBLGFBQUEsRUFBQSxHQUFBOztnQ0FFQSxLQUFBLElBQUEsSUFBQSxHQUFBLElBQUEsYUFBQSxRQUFBLEtBQUEsR0FBQTtvQ0FDQSxJQUFBLGFBQUEsR0FBQSxXQUFBLGlCQUFBO3dDQUNBLGNBQUE7Ozs7Z0NBSUEseUJBQUE7OzthQUdBLGFBQUEsR0FBQSxXQUFBLENBQUEsYUFBQSxTQUFBLEtBQUE7Ozs7Ozs7VUFPQSxTQUFBLFFBQUE7Ozs7R0FJQSxPQUFBLFNBQUE7Ozs7UUFJQSxTQUFBLHlCQUFBLFlBQUE7O1lBRUEsSUFBQSxXQUFBLEdBQUE7O1lBRUEsSUFBQSxNQUFBLElBQUEsU0FBQSxhQUFBO1lBQ0EsSUFBQSxrQkFBQTtnQkFDQTtxQkFDQSxNQUFBO3FCQUNBLE1BQUE7cUJBQ0EsTUFBQTs7O1lBR0EsU0FBQSxRQUFBOztZQUVBLE9BQUEsU0FBQTs7OztRQUlBLFNBQUEsZ0JBQUEsWUFBQSxnQkFBQSxhQUFBOztZQUVBLElBQUEsV0FBQSxHQUFBOztZQUVBLElBQUEsZ0JBQUE7OztZQUdBLGVBQUEsUUFBQSxTQUFBLE1BQUE7O2dCQUVBLElBQUEsS0FBQSxRQUFBOzs7b0JBR0EsSUFBQSxjQUFBLEVBQUEsSUFBQSxLQUFBLFFBQUEsU0FBQSxJQUFBLEVBQUEsT0FBQTtvQkFDQSxjQUFBLFFBQUEsV0FBQSxhQUFBOztvQkFFQSxJQUFBLGFBQUE7OztvQkFHQSxLQUFBLElBQUEsSUFBQSxHQUFBLElBQUEsWUFBQSxRQUFBLEtBQUE7Ozt3QkFHQSxJQUFBLFlBQUEsR0FBQSxhQUFBLGFBQUE7OzRCQUVBLElBQUEsaUJBQUE7NEJBQ0EsZUFBQSxXQUFBLEVBQUE7NEJBQ0EsZUFBQSxRQUFBLFlBQUEsR0FBQTs0QkFDQSxlQUFBLGVBQUE7NEJBQ0EsZUFBQSxTQUFBLFlBQUEsR0FBQSxTQUFBLFlBQUEsR0FBQSxTQUFBOzRCQUNBLGVBQUEsWUFBQSxZQUFBLEdBQUEsWUFBQSxZQUFBLEdBQUEsWUFBQTs0QkFDQSxlQUFBLGNBQUEsWUFBQSxHQUFBLGNBQUEsWUFBQSxHQUFBLGNBQUE7OzRCQUVBLGNBQUEsS0FBQTs0QkFDQSxhQUFBOzRCQUNBOzsrQkFFQTs0QkFDQSxJQUFBLGFBQUEsR0FBQTtnQ0FDQSxjQUFBOzs7Ozs7Ozs7O1lBVUEsU0FBQSxRQUFBOztZQUVBLE9BQUEsU0FBQTs7Ozs7O0tBS0EsQ0MzUUEsQ0FBQSxXQUFBO0lBQ0E7O0lBRUE7U0FDQSxPQUFBO1NBQ0EsV0FBQSx1QkFBQTs7O0lBR0EsU0FBQSxvQkFBQSxRQUFBLFNBQUEsY0FBQSxRQUFBLFVBQUEsZ0JBQUEsY0FBQSxhQUFBLGdCQUFBLGFBQUEsY0FBQTs7O1FBR0EsSUFBQSxLQUFBOztRQUVBLEdBQUEsWUFBQSxhQUFBOztRQUVBLEdBQUEsYUFBQTtRQUNBLEdBQUEsa0JBQUE7UUFDQSxHQUFBLHNCQUFBO1FBQ0EsR0FBQSxvQkFBQTtRQUNBLEdBQUEsa0JBQUE7UUFDQSxHQUFBLGdCQUFBO1FBQ0EsR0FBQSwrQkFBQTtRQUNBLEdBQUEsc0JBQUE7UUFDQSxHQUFBLGdDQUFBO1FBQ0EsR0FBQSxrQkFBQTtRQUNBLEdBQUEsK0JBQUE7UUFDQSxHQUFBLHNDQUFBO1FBQ0EsR0FBQSxpQkFBQTs7UUFFQTs7OztRQUlBLFNBQUEsYUFBQTtZQUNBLFFBQUEsUUFBQSxVQUFBOzs7UUFHQSxTQUFBLGFBQUE7WUFDQSxZQUFBLFdBQUEsR0FBQSxXQUFBLEdBQUEsU0FBQSxLQUFBLFdBQUE7Z0JBQ0EsWUFBQSxNQUFBLFVBQUEsR0FBQSxRQUFBLFlBQUEsYUFBQTtnQkFDQSxHQUFBLFVBQUE7Ozs7UUFJQSxTQUFBLGdCQUFBLGdCQUFBLFlBQUE7O1lBRUEsSUFBQTs7O1lBR0EsSUFBQSxhQUFBLElBQUE7Z0JBQ0EsaUJBQUE7Z0JBQ0EsT0FBQTs7O1lBR0EsaUJBQUEsS0FBQTs7WUFFQSxJQUFBLGVBQUEsUUFBQSxXQUFBLEdBQUEsWUFBQTs7O1lBR0EsSUFBQSxhQUFBLGFBQUEsSUFBQTs7Z0JBRUEsSUFBQSxhQUFBLGFBQUEsR0FBQSxVQUFBLGVBQUEsT0FBQTtvQkFDQSxrQkFBQTs7OztZQUlBLE9BQUE7Ozs7UUFJQSxTQUFBLHNCQUFBOztZQUVBLEdBQUEsU0FBQSxRQUFBLFNBQUEsTUFBQTs7O2dCQUdBLElBQUEsS0FBQSxRQUFBOztvQkFFQSxJQUFBLGNBQUEsRUFBQSxJQUFBLEtBQUEsUUFBQSxTQUFBLElBQUEsRUFBQSxPQUFBO29CQUNBLGNBQUEsUUFBQSxXQUFBLGFBQUE7b0JBQ0EsS0FBQSxhQUFBLFlBQUE7Ozs7Ozs7O1FBUUEsU0FBQSxrQkFBQSxhQUFBOztZQUVBO1lBQ0EsT0FBQSxHQUFBLFdBQUEsQ0FBQSxVQUFBOzs7O1FBSUEsU0FBQSxZQUFBOztZQUVBLGFBQUEsbUJBQUEsR0FBQSxXQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUE7O2dCQUVBLEdBQUEsa0JBQUE7O2dCQUVBLEdBQUEsZ0JBQUEsVUFBQSxLQUFBLFdBQUE7OztvQkFHQSxJQUFBLEdBQUEsZ0JBQUEsT0FBQSxXQUFBOzt3QkFFQSxhQUFBLGFBQUEsR0FBQSxXQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUE7NEJBQ0EsR0FBQSxXQUFBOzRCQUNBOzs7d0JBR0EsYUFBQSx3QkFBQSxHQUFBLFdBQUEsS0FBQSxTQUFBLEtBQUEsT0FBQTs0QkFDQSxJQUFBLGNBQUE7NEJBQ0EsR0FBQSxvQkFBQSxZQUFBOzRCQUNBLEdBQUEsd0JBQUEsWUFBQSxNQUFBLEdBQUE7Ozs7MkJBSUE7O3dCQUVBLGFBQUEseUJBQUEsR0FBQSxXQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUE7NEJBQ0EsSUFBQSxjQUFBOzRCQUNBLEdBQUEsb0JBQUEsWUFBQTs0QkFDQSxHQUFBLHdCQUFBOzs7Ozs7b0JBTUEsSUFBQSxHQUFBLGdCQUFBLE9BQUEsV0FBQTs7d0JBRUEsWUFBQSxZQUFBLEdBQUEsV0FBQSxLQUFBLFNBQUEsS0FBQSxPQUFBOzRCQUNBLEdBQUEsV0FBQTs7Ozs7b0JBS0EsSUFBQSxHQUFBLGdCQUFBLFVBQUEsWUFBQTt3QkFDQSxFQUFBLGdCQUFBLFlBQUE7NEJBQ0EsV0FBQTs7Ozs7Ozs7WUFRQSxlQUFBLGdCQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUE7Z0JBQ0EsR0FBQSxhQUFBOzs7OztRQUtBLFNBQUEsa0JBQUE7O1lBRUEsUUFBQSxRQUFBLGdCQUFBO1lBQ0EsUUFBQSxRQUFBLHVCQUFBLFVBQUE7Ozs7UUFJQSxTQUFBLGNBQUEsZUFBQTs7WUFFQSxJQUFBLE1BQUEsSUFBQSxTQUFBLGFBQUE7O1lBRUEsYUFBQSxZQUFBLEdBQUEsV0FBQSxlQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUE7Z0JBQ0EsR0FBQSxXQUFBOztnQkFFQSxHQUFBLGFBQUE7b0JBQ0E7eUJBQ0EsTUFBQTt5QkFDQSxNQUFBLEdBQUE7eUJBQ0EsTUFBQTt5QkFDQSxNQUFBLEdBQUEsU0FBQTt5QkFDQSxNQUFBOzs7O1lBSUEsUUFBQSxRQUFBLGNBQUE7WUFDQSxRQUFBLFFBQUEsY0FBQSxTQUFBO1lBQ0EsUUFBQSxRQUFBLHFCQUFBLFVBQUE7Ozs7UUFJQSxTQUFBLHNCQUFBOztZQUVBLFFBQUEsUUFBQSxvQkFBQTtZQUNBLFFBQUEsUUFBQSwyQkFBQSxVQUFBOzs7O1FBSUEsU0FBQSxnQ0FBQTs7WUFFQSxhQUFBLHdCQUFBLEdBQUEsV0FBQSxLQUFBLFNBQUEsS0FBQSxPQUFBO2dCQUNBLEdBQUEsc0JBQUE7OztZQUdBLFFBQUEsUUFBQSw4QkFBQTtZQUNBLFFBQUEsUUFBQSxxQ0FBQSxVQUFBOzs7O1FBSUEsU0FBQSxnQkFBQSxhQUFBOztZQUVBLEdBQUEsY0FBQTs7WUFFQSxhQUFBLGdCQUFBLEdBQUEsV0FBQSxHQUFBLFVBQUEsR0FBQSxhQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUE7Z0JBQ0EsR0FBQSxlQUFBOzs7WUFHQSxRQUFBLFFBQUEsZ0JBQUE7WUFDQSxRQUFBLFFBQUEsdUJBQUEsVUFBQTs7OztRQUlBLFNBQUEsNkJBQUEsV0FBQTs7WUFFQTtZQUNBLFNBQUEsV0FBQTtnQkFDQSxjQUFBO2VBQ0E7Ozs7UUFJQSxTQUFBLDZCQUFBLGFBQUE7O1lBRUE7WUFDQSxTQUFBLFdBQUE7Z0JBQ0EsZ0JBQUE7ZUFDQTs7OztRQUlBLFNBQUEsb0NBQUEsYUFBQTs7WUFFQTtZQUNBLFNBQUEsV0FBQTtnQkFDQSxnQkFBQTtlQUNBOzs7O1FBSUEsU0FBQSxpQkFBQTtZQUNBLFFBQUEsUUFBQSxlQUFBOzs7Ozs7S0FLQSxDQ3RQQSxDQUFBLFdBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUE7U0FDQSxRQUFBLGVBQUE7OztJQUdBLFNBQUEsWUFBQSxJQUFBLGdCQUFBLGlCQUFBLGNBQUE7O0tBRUEsS0FBQSxhQUFBO1FBQ0EsS0FBQSxjQUFBOzs7O1FBSUEsU0FBQSxXQUFBLFlBQUEsd0JBQUE7O1NBRUEsSUFBQSxXQUFBLEdBQUE7O1NBRUEsSUFBQSxNQUFBLElBQUEsU0FBQSxhQUFBO1NBQ0EsSUFBQSxXQUFBO1VBQ0E7WUFDQSxNQUFBO1lBQ0EsTUFBQTtZQUNBLE1BQUE7OztTQUdBLFNBQUEsVUFBQSxLQUFBLFdBQUE7O1VBRUEsU0FBQSx1QkFBQSxhQUFBO1dBQ0EsVUFBQSx1QkFBQTs7VUFFQSxTQUFBO1VBQ0EsU0FBQTs7OztTQUlBLE9BQUEsU0FBQTs7OztRQUlBLFNBQUEsWUFBQSxZQUFBOztTQUVBLElBQUEsV0FBQSxHQUFBOztTQUVBLElBQUEsTUFBQSxJQUFBLFNBQUEsYUFBQTtTQUNBLElBQUEsV0FBQTtVQUNBO1lBQ0EsTUFBQTtZQUNBLE1BQUE7WUFDQSxNQUFBOzs7U0FHQSxTQUFBLFVBQUEsS0FBQSxXQUFBO1VBQ0EsU0FBQSxRQUFBOzs7U0FHQSxPQUFBLFNBQUE7Ozs7O0tBSUEsQ0M3REEsQ0FBQSxXQUFBO0lBQ0E7O0lBRUE7U0FDQSxPQUFBO1NBQ0EsVUFBQSxlQUFBOzs7SUFHQSxTQUFBLGVBQUE7Ozs7O1FBS0EsSUFBQSxZQUFBO1lBQ0Esa0JBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTtZQUNBLE1BQUE7WUFDQSxVQUFBO1lBQ0EsYUFBQTtZQUNBLE9BQUE7YUFDQSxNQUFBO2FBQ0Esa0JBQUE7OztRQUdBLE9BQUE7O1FBRUEsU0FBQSxLQUFBLE9BQUEsU0FBQSxPQUFBOzs7OztJQUtBLFNBQUEsc0JBQUE7O0tBRUEsSUFBQSxLQUFBOztLQUVBLENDcENBLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLFVBQUEsMEJBQUE7OztJQUdBLFNBQUEsMEJBQUE7Ozs7O1FBS0EsSUFBQSxZQUFBO1lBQ0Esa0JBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTtZQUNBLE1BQUE7WUFDQSxVQUFBO1lBQ0EsYUFBQTtZQUNBLE9BQUE7YUFDQSxNQUFBO2dCQUNBLFlBQUE7YUFDQSxnQkFBQTthQUNBLG9CQUFBO2dCQUNBLHlCQUFBOzs7UUFHQSxPQUFBOztRQUVBLFNBQUEsS0FBQSxPQUFBLFNBQUEsT0FBQTs7Ozs7SUFLQSxTQUFBLGlDQUFBOztLQUVBLElBQUEsS0FBQTs7S0FFQSxDQ3ZDQSxDQUFBLFdBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUE7U0FDQSxVQUFBLDJCQUFBOzs7SUFHQSxTQUFBLDJCQUFBOzs7OztRQUtBLElBQUEsWUFBQTtZQUNBLGtCQUFBO1lBQ0EsWUFBQTtZQUNBLGNBQUE7WUFDQSxNQUFBO1lBQ0EsVUFBQTtZQUNBLGFBQUE7WUFDQSxPQUFBO2FBQ0EsTUFBQTtnQkFDQSxZQUFBO2FBQ0EsZ0JBQUE7Z0JBQ0EseUJBQUE7OztRQUdBLE9BQUE7O1FBRUEsU0FBQSxLQUFBLE9BQUEsU0FBQSxPQUFBOzs7OztJQUtBLFNBQUEsa0NBQUE7O0tBRUEsSUFBQSxLQUFBOztLQUVBLENDdENBLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLFVBQUEsbUJBQUE7OztJQUdBLFNBQUEsbUJBQUE7Ozs7O1FBS0EsSUFBQSxZQUFBO1lBQ0Esa0JBQUE7WUFDQSxZQUFBO1lBQ0EsY0FBQTtZQUNBLE1BQUE7WUFDQSxVQUFBO1lBQ0EsYUFBQTtZQUNBLE9BQUE7YUFDQSxZQUFBOzs7UUFHQSxPQUFBOztRQUVBLFNBQUEsS0FBQSxPQUFBLFNBQUEsT0FBQTs7Ozs7SUFLQSxTQUFBLHdCQUFBLFVBQUE7O0tBRUEsSUFBQSxLQUFBOzs7S0FFQSxDQ25DQSxDQUFBLFdBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUE7U0FDQSxXQUFBLG9CQUFBOzs7SUFHQSxTQUFBLGlCQUFBLFVBQUEsWUFBQSxTQUFBLFFBQUEsYUFBQTs7O1FBR0EsSUFBQSxLQUFBO1FBQ0EsR0FBQSxTQUFBOztRQUVBOzs7O1FBSUEsU0FBQSxXQUFBO1lBQ0EsU0FBQSxXQUFBO2dCQUNBLFFBQUEsUUFBQTtxQkFDQSxTQUFBO3dCQUNBLFlBQUE7d0JBQ0EsYUFBQTt3QkFDQSxpQkFBQTt3QkFDQSxPQUFBO3dCQUNBLFFBQUEsQ0FBQTt3QkFDQSxhQUFBOztlQUVBOzs7UUFHQSxTQUFBLFNBQUE7WUFDQSxZQUFBO1lBQ0EsUUFBQSxTQUFBOzs7OztLQUlBLENDdENBLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLE9BQUEsaUJBQUE7O0lBRUEsU0FBQSxnQkFBQTtRQUNBLE9BQUEsU0FBQSxPQUFBLE9BQUEsU0FBQTtZQUNBLElBQUEsV0FBQTs7WUFFQSxRQUFBLFFBQUEsT0FBQSxTQUFBLE1BQUEsS0FBQTtnQkFDQSxLQUFBLE1BQUE7Z0JBQ0EsU0FBQSxLQUFBOzs7WUFHQSxTQUFBLEtBQUEsVUFBQSxHQUFBLEdBQUE7Z0JBQ0EsUUFBQSxFQUFBLFNBQUEsRUFBQSxTQUFBLElBQUEsQ0FBQTs7O1lBR0EsR0FBQSxTQUFBLFNBQUE7O1lBRUEsT0FBQTs7OztLQUlBLENDMUJBLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLFdBQUEsb0JBQUE7OztJQUdBLFNBQUEsaUJBQUEsWUFBQSxRQUFBLGNBQUEsVUFBQSxRQUFBLE9BQUEsZ0JBQUE7OztRQUdBLElBQUEsS0FBQTtRQUNBLEdBQUEsZUFBQTs7UUFFQTs7OztRQUlBLFNBQUEsV0FBQTtTQUNBLGVBQUEsZ0JBQUEsS0FBQSxTQUFBLEtBQUEsT0FBQTtnQkFDQSxHQUFBLGFBQUE7Ozs7WUFJQSxTQUFBLFdBQUE7Z0JBQ0EsZUFBQSxjQUFBLFdBQUEsUUFBQSxVQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUE7b0JBQ0EsR0FBQSxhQUFBOztlQUVBOzs7UUFHQSxTQUFBLGVBQUE7O1NBRUEsR0FBQSxnQkFBQTs7U0FFQSxNQUFBLFVBQUE7U0FDQSxNQUFBLE9BQUEsR0FBQSxNQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUE7VUFDQSxlQUFBLGVBQUEsTUFBQSxHQUFBLE1BQUEsV0FBQSxRQUFBO1VBQ0EsWUFBQSxNQUFBLDRCQUFBOztVQUVBLFNBQUEsV0FBQTtXQUNBLE9BQUEsR0FBQTthQUNBOzs7Ozs7O0tBTUEsQ0NoREEsQ0FBQSxXQUFBO0lBQ0E7O0lBRUE7U0FDQSxPQUFBO1NBQ0EsV0FBQSw0QkFBQTs7O0lBR0EsU0FBQSx5QkFBQSxRQUFBLFVBQUEsUUFBQSxhQUFBOzs7UUFHQSxJQUFBLEtBQUE7O1FBRUEsR0FBQSx1QkFBQTs7OztRQUlBLFNBQUEsdUJBQUE7O1lBRUEsSUFBQSxPQUFBLGFBQUEsUUFBQTs7Z0JBRUEsWUFBQSxnQkFBQTtvQkFDQSxPQUFBLFlBQUEsV0FBQSxTQUFBO29CQUNBLGFBQUEsR0FBQTtvQkFDQSxhQUFBLEdBQUE7bUJBQ0EsS0FBQSxXQUFBOztvQkFFQSxZQUFBLE1BQUEsOEJBQUE7b0JBQ0EsU0FBQSxXQUFBO3dCQUNBLE9BQUEsR0FBQTt1QkFDQTs7bUJBRUEsTUFBQSxTQUFBLE9BQUE7O29CQUVBLElBQUEsTUFBQSxTQUFBLG9CQUFBO3dCQUNBLEdBQUEsNEJBQUE7Ozs7Ozs7Ozs7OztLQVdBLENDOUNBLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLFdBQUEsa0JBQUE7OztJQUdBLFNBQUEsZUFBQSxRQUFBLFVBQUE7OztRQUdBLElBQUEsS0FBQTs7Ozs7OztLQU1BLENDakJBLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLFdBQUEseUJBQUE7OztJQUdBLFNBQUEsc0JBQUEsSUFBQSxVQUFBLGdCQUFBLGdCQUFBLGNBQUE7OztLQUdBLElBQUEsS0FBQTs7UUFFQTs7OztRQUlBLFNBQUEsV0FBQTtZQUNBLG1CQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUE7Z0JBQ0EsR0FBQSxtQkFBQTs7O1lBR0EsZUFBQSxnQkFBQSxLQUFBLFNBQUEsS0FBQSxPQUFBO2dCQUNBLEdBQUEsYUFBQTs7OztRQUlBLFNBQUEsbUJBQUE7O1NBRUEsSUFBQSxXQUFBLEdBQUE7U0FDQSxJQUFBLE1BQUEsSUFBQSxTQUFBLGFBQUE7O1NBRUEsSUFBQSxtQkFBQTtVQUNBO1lBQ0EsTUFBQTs7O1NBR0EsaUJBQUEsUUFBQSxXQUFBO1VBQ0EsU0FBQSxRQUFBOzs7U0FHQSxPQUFBLFNBQUE7Ozs7OztLQUtBLENDOUNBLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLFdBQUEscUJBQUE7OztJQUdBLFNBQUEsa0JBQUEsUUFBQSxjQUFBLElBQUEsVUFBQSxRQUFBLGdCQUFBLGFBQUEsZ0JBQUEsY0FBQTs7O1FBR0EsSUFBQSxLQUFBOztRQUVBOzs7O1FBSUEsU0FBQSxXQUFBOztZQUVBLGVBQUEsWUFBQSxhQUFBLFVBQUEsS0FBQSxTQUFBLEtBQUEsT0FBQTtnQkFDQSxHQUFBLGNBQUE7O2dCQUVBLGVBQUEscUJBQUEsR0FBQSxhQUFBLEtBQUEsU0FBQSxLQUFBLE9BQUE7b0JBQ0EsSUFBQSx3QkFBQTtvQkFDQSxHQUFBLGlCQUFBLGVBQUEsdUJBQUEsdUJBQUEsYUFBQTs7O2dCQUdBLEVBQUEsZ0JBQUEsWUFBQTtvQkFDQSxXQUFBOzs7O1lBSUEsZUFBQSxnQkFBQSxLQUFBLFNBQUEsS0FBQSxPQUFBO2dCQUNBLEdBQUEsYUFBQTs7O1lBR0EsZUFBQSxjQUFBLGFBQUEsVUFBQSxLQUFBLFNBQUEsS0FBQSxPQUFBO2dCQUNBLEdBQUEsYUFBQTs7Ozs7Ozs7S0FPQSxDQzVDQSxDQUFBLFdBQUE7SUFDQTs7SUFFQTtTQUNBLE9BQUE7U0FDQSxRQUFBLGtCQUFBOzs7SUFHQSxTQUFBLGVBQUEsWUFBQSxJQUFBLGdCQUFBLGlCQUFBLGNBQUEsY0FBQTs7S0FFQSxLQUFBLGdCQUFBO1FBQ0EsS0FBQSxnQkFBQTtLQUNBLEtBQUEsdUJBQUE7UUFDQSxLQUFBLHlCQUFBO1FBQ0EsS0FBQSxjQUFBO1FBQ0EsS0FBQSxpQkFBQTs7OztRQUlBLFNBQUEsZ0JBQUE7O1lBRUEsSUFBQSxXQUFBLEdBQUE7WUFDQSxJQUFBLE1BQUEsSUFBQSxTQUFBLGFBQUE7O1lBRUEsSUFBQSxhQUFBO2dCQUNBO3FCQUNBLE1BQUE7OztZQUdBLFdBQUEsUUFBQSxXQUFBO2dCQUNBLFNBQUEsUUFBQTs7O1lBR0EsT0FBQSxTQUFBOzs7O1FBSUEsU0FBQSxjQUFBLFdBQUE7O1lBRUEsSUFBQSxXQUFBLEdBQUE7WUFDQSxJQUFBLE1BQUEsSUFBQSxTQUFBLGFBQUE7O1lBRUEsSUFBQSxhQUFBO2dCQUNBO3FCQUNBLE1BQUE7cUJBQ0EsTUFBQTs7O1lBR0EsV0FBQSxRQUFBLFdBQUE7Z0JBQ0EsU0FBQSxRQUFBOzs7WUFHQSxPQUFBLFNBQUE7Ozs7UUFJQSxTQUFBLHFCQUFBLGVBQUE7O1NBRUEsSUFBQSxXQUFBLEdBQUE7U0FDQSxJQUFBLE1BQUEsSUFBQSxTQUFBLGFBQUE7OztTQUdBLElBQUEsY0FBQTtTQUNBLEtBQUEsSUFBQSxPQUFBLGNBQUEsV0FBQTtVQUNBLFlBQUEsS0FBQTs7O1NBR0EsU0FBQSxRQUFBOztTQUVBLE9BQUEsU0FBQTs7OztRQUlBLFNBQUEsdUJBQUEsd0JBQUEsV0FBQTs7WUFFQSxJQUFBLE1BQUEsSUFBQSxTQUFBLGFBQUE7OztZQUdBLElBQUEsaUJBQUE7WUFDQSx1QkFBQSxRQUFBLFNBQUEsT0FBQTs7Z0JBRUEsYUFBQSxtQkFBQSxPQUFBLEtBQUEsU0FBQSxpQkFBQTs7b0JBRUEsZ0JBQUEsVUFBQSxLQUFBLFdBQUE7Ozt3QkFHQSxJQUFBLGdCQUFBLFVBQUEsYUFBQTs7NEJBRUEsSUFBQSxvQkFBQTtnQ0FDQTtxQ0FDQSxNQUFBO3FDQUNBLE1BQUE7Ozs0QkFHQSxrQkFBQSxVQUFBLEtBQUEsV0FBQTs7Z0NBRUEsSUFBQSxrQkFBQSxZQUFBOztvQ0FFQSxlQUFBLEtBQUE7d0NBQ0EsTUFBQSxnQkFBQTt3Q0FDQSxTQUFBLGdCQUFBLFVBQUEsT0FBQTt3Q0FDQSxXQUFBO3dDQUNBLE9BQUE7d0NBQ0EsT0FBQSxnQkFBQTt3Q0FDQSxVQUFBLGtCQUFBOzs7dUNBR0E7O29DQUVBLGVBQUEsS0FBQTt3Q0FDQSxNQUFBLGdCQUFBO3dDQUNBLFNBQUEsZ0JBQUEsVUFBQSxPQUFBO3dDQUNBLFdBQUE7d0NBQ0EsT0FBQTt3Q0FDQSxPQUFBLGdCQUFBO3dDQUNBLFVBQUEsQ0FBQTs7Ozs7OzsrQkFPQSxJQUFBLGdCQUFBLFVBQUEsZ0JBQUEsZ0JBQUEsVUFBQSxZQUFBOzs0QkFFQSxlQUFBLEtBQUE7Z0NBQ0EsTUFBQSxnQkFBQTtnQ0FDQSxTQUFBLGdCQUFBLFVBQUEsT0FBQTtnQ0FDQSxXQUFBO2dDQUNBLE9BQUEsZ0JBQUE7Z0NBQ0EsT0FBQSxnQkFBQTs7Ozs7Ozs7Ozs7WUFXQSxPQUFBOzs7O1FBSUEsU0FBQSxZQUFBLFdBQUE7O1NBRUEsSUFBQSxXQUFBLEdBQUE7U0FDQSxJQUFBLE1BQUEsSUFBQSxTQUFBLGFBQUE7O1NBRUEsSUFBQSxZQUFBO1VBQ0E7WUFDQSxNQUFBOzs7U0FHQSxVQUFBLFFBQUEsV0FBQTs7VUFFQSxVQUFBLFFBQUEsU0FBQSxNQUFBO1dBQ0EsSUFBQSxLQUFBLGFBQUEsV0FBQTtZQUNBLFNBQUEsUUFBQTs7Ozs7O1NBTUEsT0FBQSxTQUFBOzs7OztRQUtBLFNBQUEsZUFBQSxXQUFBLFdBQUE7O1lBRUEsSUFBQSxNQUFBLElBQUEsU0FBQSxhQUFBOztZQUVBLElBQUEsYUFBQTtnQkFDQTtxQkFDQSxNQUFBOzs7WUFHQSxXQUFBLFFBQUEsV0FBQTtnQkFDQSxXQUFBLGFBQUE7Z0JBQ0EsV0FBQTs7Ozs7OztLQU1BLENDMUxBLENBQUEsV0FBQTtJQUNBOztJQUVBO1NBQ0EsT0FBQTtTQUNBLFdBQUEsaUJBQUE7OztJQUdBLFNBQUEsY0FBQSxRQUFBLFlBQUEsVUFBQSxTQUFBLFFBQUEsaUJBQUEsYUFBQSxhQUFBOzs7UUFHQSxJQUFBLEtBQUE7O1FBRUEsR0FBQSxpQkFBQTtRQUNBLEdBQUEsZ0JBQUE7UUFDQSxHQUFBLG1CQUFBOzs7O1FBSUEsU0FBQSxpQkFBQTs7WUFFQSxZQUFBLGVBQUEsR0FBQSxZQUFBLEdBQUEsZUFBQSxLQUFBLFNBQUEsS0FBQSxPQUFBOztnQkFFQSxHQUFBLHVCQUFBO2dCQUNBLEdBQUEsMkJBQUE7O2dCQUVBLElBQUEsVUFBQSxpQkFBQTs7b0JBRUEsT0FBQSxHQUFBOzt1QkFFQSxJQUFBLFVBQUEsZ0JBQUE7b0JBQ0EsR0FBQSx1QkFBQTtvQkFDQTt1QkFDQSxJQUFBLFVBQUEsb0JBQUE7b0JBQ0EsR0FBQSwyQkFBQTs7Ozs7OztRQU9BLFNBQUEsZ0JBQUE7O1lBRUEsSUFBQSxDQUFBLEdBQUEsWUFBQTtnQkFDQSxHQUFBLGdDQUFBO2dCQUNBOzs7WUFHQSxZQUFBLGVBQUE7Z0JBQ0EsT0FBQSxHQUFBO2VBQ0EsS0FBQSxXQUFBO2dCQUNBLEdBQUEsZ0NBQUE7Z0JBQ0EsWUFBQSxNQUFBLDZDQUFBLEdBQUEsYUFBQSxLQUFBOzs7OztRQUtBLFNBQUEsbUJBQUE7OztZQUdBLFlBQUEsa0JBQUEsR0FBQSxhQUFBLEtBQUEsU0FBQSxZQUFBOztnQkFFQSxHQUFBLHlCQUFBO2dCQUNBLEdBQUEsc0JBQUE7O2dCQUVBLElBQUEsWUFBQTs7b0JBRUEsR0FBQSx5QkFBQTtvQkFDQTs7O3VCQUdBOztvQkFFQSxZQUFBLGNBQUEsR0FBQSxVQUFBLEdBQUEsYUFBQSxHQUFBLGFBQUEsS0FBQSxTQUFBLEtBQUEsT0FBQTs7d0JBRUEsSUFBQSxVQUFBLGVBQUE7OzRCQUVBLEdBQUEsc0JBQUE7NEJBQ0E7OytCQUVBLElBQUEsVUFBQSxtQkFBQTs7NEJBRUEsT0FBQSxHQUFBLFdBQUEsQ0FBQSxVQUFBLEdBQUE7Ozs7Ozs7Ozs7Ozs7OztLQWNBIiwiZmlsZSI6ImFwcC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnLCBbXG4gICAgICAgICAgICAvKiBBbmd1bGFyIG1vZHVsZXMgKi9cbiAgICAgICAgICAgICduZ0FuaW1hdGUnLFxuICAgICAgICAgICAgLyogQXBwIG1vZHVsZXMgKi9cbiAgICAgICAgICAgIC8qIFRoaXJkLXBhcnR5IG1vZHVsZXMgKi9cbiAgICAgICAgICAgICd1aS5yb3V0ZXInLFxuICAgICAgICAgICAgJ2ZpcmViYXNlJyxcbiAgICAgICAgICAgICd2YWxpZGF0aW9uLm1hdGNoJyxcbiAgICAgICAgICAgICdvcmRpbmFsJyxcbiAgICAgICAgICAgICduZ0ZpbGVVcGxvYWQnLFxuICAgICAgICAgICAgJ25nSW1ndXInXG4gICAgICAgIF0pO1xufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHRhbmd1bGFyXG5cdFx0Lm1vZHVsZSgndmcuYXBwJylcblx0XHQuY29uc3RhbnQoJ0ZJUkVCQVNFREFUQScsIHtcblx0XHRcdCdGQlVSTCc6ICdodHRwczovL3dvbGZzY29udGVzdHMuZmlyZWJhc2Vpby5jb20nXG5cdFx0fSlcblx0XHQuY29uZmlnKGNvbmZpZyk7XG5cblx0LyogQG5nSW5qZWN0ICovXG5cdGZ1bmN0aW9uIGNvbmZpZygkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG5cblx0XHQvLyBSZWRpcmVjdCBhbnkgdW5tYXRjaGVkIFVSTCB0byAvLlxuXHRcdCR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcblxuXHRcdCRzdGF0ZVByb3ZpZGVyXG5cdFx0ICAgIC5zdGF0ZSgnaG9tZScsIHtcblx0XHQgICAgXHR1cmw6ICcvJyxcblx0XHQgICAgXHR0ZW1wbGF0ZVVybDogJ2FwcC9ob21lL2hvbWUuaHRtJyxcblx0XHQgICAgXHRjb250cm9sbGVyOiAnSG9tZUNvbnRyb2xsZXIgYXMgaG9tZSdcblx0XHQgICAgfSlcblxuXHRcdCAgICAuc3RhdGUoJ3JlZ2lzdGVyT3JMb2dpbicsIHtcblx0XHQgICAgXHR1cmw6ICcvcmVnaXN0ZXJPckxvZ2luJyxcblx0XHQgICAgXHR0ZW1wbGF0ZVVybDogJy9hcHAvaG9tZS9yZWcuaHRtJyxcblx0XHQgICAgXHRjb250cm9sbGVyOiAnUmVnQ29udHJvbGxlciBhcyByZWcnXG5cdFx0ICAgIH0pXG5cblx0XHQgICAgLnN0YXRlKCdwcm9maWxlJywge1xuXHRcdCAgICBcdHVybDogJy9wcm9maWxlLzp1c2VybmFtZScsXG5cdFx0ICAgIFx0dGVtcGxhdGVVcmw6ICcvYXBwL2hvbWUvcHJvZmlsZS5odG0nLFxuXHRcdCAgICBcdGNvbnRyb2xsZXI6ICdQcm9maWxlQ29udHJvbGxlciBhcyBwcm9maWxlJ1xuXHRcdCAgICB9KVxuXG5cdFx0ICAgIC5zdGF0ZSgnbGVhZGVyYm9hcmQnLCB7XG5cdFx0ICAgIFx0dXJsOiAnL2xlYWRlcmJvYXJkJyxcblx0XHQgICAgXHR0ZW1wbGF0ZVVybDogJy9hcHAvaG9tZS9sZWFkZXJib2FyZC5odG0nLFxuXHRcdCAgICBcdGNvbnRyb2xsZXI6ICdMZWFkZXJib2FyZENvbnRyb2xsZXIgYXMgbGVhZGVyYm9hcmQnXG5cdFx0ICAgIH0pXG5cblx0XHQgICAgLnN0YXRlKCdldmVudCcsIHtcblx0XHQgICAgXHR1cmw6ICcvZXZlbnQvOmV2ZW50TmFtZS9tYWluJyxcblx0XHQgICAgXHR0ZW1wbGF0ZVVybDogJy9hcHAvZXZlbnQvbWFpbi5odG0nLFxuXHRcdCAgICBcdGNvbnRyb2xsZXI6ICdFdmVudE1haW5Db250cm9sbGVyIGFzIGV2ZW50J1xuXHRcdCAgICB9KVxuXG5cdFx0ICAgIC5zdGF0ZSgnY3VzdG9taXplQXZhdGFyJywge1xuXHRcdCAgICBcdHVybDogJy9jdXN0b21pemVBdmF0YXInLFxuXHRcdCAgICBcdHRlbXBsYXRlVXJsOiAnL2FwcC9ob21lL2F2YXRhci5odG0nLFxuXHRcdCAgICBcdGNvbnRyb2xsZXI6ICdBdmF0YXJDb250cm9sbGVyIGFzIGF2YXRhcicsXG5cblx0XHQgICAgXHRyZXNvbHZlOiB7XG5cdFx0ICAgIFx0XHQnY3VycmVudEF1dGgnOiBbJ0F1dGhXcmFwcGVyJywgZnVuY3Rpb24oQXV0aFdyYXBwZXIpIHtcblx0XHQgICAgXHRcdFx0cmV0dXJuIEF1dGhXcmFwcGVyLiRyZXF1aXJlQXV0aCgpO1xuXHRcdCAgICBcdFx0fV1cblx0XHQgICAgXHR9XG5cdFx0ICAgIH0pXG5cblx0XHQgICAgLnN0YXRlKCdjaGFuZ2VQYXNzd29yZCcsIHtcblx0XHQgICAgXHR1cmw6ICcvY2hhbmdlUGFzc3dvcmQnLFxuXHRcdCAgICBcdHRlbXBsYXRlVXJsOiAnL2FwcC9ob21lL2NoYW5nZVBhc3N3b3JkLmh0bScsXG5cdFx0ICAgIFx0Y29udHJvbGxlcjogJ0NoYW5nZVBhc3N3b3JkQ29udHJvbGxlciBhcyBwd2NoYW5nZScsXG5cblx0XHQgICAgXHRyZXNvbHZlOiB7XG5cdFx0ICAgIFx0XHQnY3VycmVudEF1dGgnOiBbJ0F1dGhXcmFwcGVyJywgZnVuY3Rpb24oQXV0aFdyYXBwZXIpIHtcblx0XHQgICAgXHRcdFx0cmV0dXJuIEF1dGhXcmFwcGVyLiRyZXF1aXJlQXV0aCgpO1xuXHRcdCAgICBcdFx0fV1cblx0XHQgICAgXHR9XG5cdFx0ICAgIH0pO1xuXHR9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5ydW4ocnVuKTtcblxuICAgIGZ1bmN0aW9uIHJ1bigkcm9vdFNjb3BlLCAkbG9jYXRpb24sICRzdGF0ZSwgJGZpcmViYXNlT2JqZWN0LCBBdXRoV3JhcHBlciwgRklSRUJBU0VEQVRBKSB7XG5cbiAgICAgICAgJHJvb3RTY29wZS4kb24oJyRzdGF0ZUNoYW5nZUVycm9yJywgZnVuY3Rpb24oZXZlbnQsIHRvU3RhdGUsIHRvUGFyYW1zLCBmcm9tU3RhdGUsIGZyb21QYXJhbXMsIGVycm9yKSB7XG4gICAgICAgICAgICBpZiAoZXJyb3IgPT09ICdBVVRIX1JFUVVJUkVEJykge1xuICAgICAgICAgICAgICAgICRzdGF0ZS5nbygncmVnaXN0ZXJPckxvZ2luJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgICRyb290U2NvcGUuJG9uKCckc3RhdGVDaGFuZ2VTdWNjZXNzJywgZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgIC8vIElmIHVzZXIgaXMgbG9nZ2VkIGluLCBkb3dubG9hZCB0aGVpciBwcm9maWxlIGRhdGEgdG8gYW4gb2JqZWN0IGluICRyb290U2NvcGUuXG4gICAgICAgICAgICAvLyBGSVhNRTogV2Ugc2hvdWxkbid0IG5lZWQgdG8gZG8gdGhpcyBldmVyeSBzdWNjZXNzZnVsIHN0YXRlIGNoYW5nZS5cbiAgICAgICAgICAgIGlmIChBdXRoV3JhcHBlci4kZ2V0QXV0aCgpKSB7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIGF1dGhEYXRhID0gQXV0aFdyYXBwZXIuJGdldEF1dGgoKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgICAgICB2YXIgcHJvZmlsZURhdGEgPSAkZmlyZWJhc2VPYmplY3QocmVmLmNoaWxkKCd1c2VycycpLmNoaWxkKGF1dGhEYXRhLnVpZCkpO1xuICAgICAgICAgICAgICAgIHByb2ZpbGVEYXRhLiRiaW5kVG8oJHJvb3RTY29wZSwgJ3Byb2ZpbGUnKS50aGVuKGZ1bmN0aW9uKHVuYmluZCkge1xuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnVuYmluZEZ1bmN0aW9uID0gdW5iaW5kO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSk7XG5cbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLnNlcnZpY2UoJ2F1dGhTZXJ2aWNlJywgYXV0aFNlcnZpY2UpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gYXV0aFNlcnZpY2UoJHEsICRyb290U2NvcGUsICRzdGF0ZSwgJHdpbmRvdywgJHRpbWVvdXQsICRmaXJlYmFzZU9iamVjdCwgQXV0aFdyYXBwZXIsIEZJUkVCQVNFREFUQSkge1xuICAgICAgICBcbiAgICAgICAgdGhpcy50ZXN0RGF0YSA9ICdoZWxsbyB3b3JsZCEnO1xuXG4gICAgXHR0aGlzLmNoZWNrSWZVc2VyRXhpc3RzID0gY2hlY2tJZlVzZXJFeGlzdHM7XG4gICAgXHR0aGlzLmNyZWF0ZU5ld1VzZXIgPSBjcmVhdGVOZXdVc2VyO1xuICAgICAgICB0aGlzLmxvZ2luVG9BY2NvdW50ID0gbG9naW5Ub0FjY291bnQ7XG4gICAgICAgIHRoaXMubG9nT3V0ID0gbG9nT3V0O1xuXG4gICAgXHQvLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICBcdGZ1bmN0aW9uIGNoZWNrSWZVc2VyRXhpc3RzKGlucHV0VXNlcm5hbWUpIHtcblxuICAgIFx0XHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgXHRcdHZhciBkb2VzVXNlckV4aXN0ID0gZmFsc2U7XG4gICAgXHRcdHZhciB1c2Vyc1JlZiA9IG5ldyAkd2luZG93LkZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCArICcvdXNlcnMnKTtcblxuICAgIFx0XHR1c2Vyc1JlZi5vbmNlKCd2YWx1ZScsIGZ1bmN0aW9uKGRhdGFTbmFwc2hvdCkge1xuXG4gICAgICAgICAgICAgICAgJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGFTbmFwc2hvdC5mb3JFYWNoKGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1c2VyLnZhbCgpLnVzZXJOYW1lID09PSBpbnB1dFVzZXJuYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZG9lc1VzZXJFeGlzdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZG9lc1VzZXJFeGlzdCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICBcdFx0fSk7XG5cbiAgICBcdFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICBcdH1cblxuICAgIFx0ZnVuY3Rpb24gY3JlYXRlTmV3VXNlcihpbnB1dEVtYWlsLCBpbnB1dFBhc3N3b3JkLCBpbnB1dFVzZXJuYW1lKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICBcdFx0QXV0aFdyYXBwZXIuJGNyZWF0ZVVzZXIoe1xuICAgIFx0XHRcdGVtYWlsOiBpbnB1dEVtYWlsLFxuICAgIFx0XHRcdHBhc3N3b3JkOiBpbnB1dFBhc3N3b3JkXG4gICAgXHRcdH0pLnRoZW4oZnVuY3Rpb24odXNlckRhdGEpIHtcblxuICAgIFx0XHRcdC8vIENyZWF0ZSBhIGRhdGEgZW50cnkgZm9yIHRoZSBuZXcgdXNlcm5hbWUuXG4gICAgXHRcdFx0bmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCkuY2hpbGQoJ3VzZXJzLycgKyB1c2VyRGF0YS51aWQpLnNldCh7XG5cbiAgICBcdFx0XHRcdHVzZXJOYW1lOiBpbnB1dFVzZXJuYW1lLFxuICAgIFx0XHRcdFx0cm9sZTogJ1VzZXInXG5cbiAgICBcdFx0XHR9LCBmdW5jdGlvbihlcnJvckRhdGEpIHtcbiAgICBcdFx0XHRcdGNvbnNvbGUuZXJyb3IoZXJyb3JEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGVycm9yRGF0YS5jb2RlO1xuICAgIFx0XHRcdH0pO1xuXG4gICAgICAgICAgICAgICAgLy8gQ3JlYXRlIGEgZGF0YSBlbnRyeSBmb3IgdGhlIHVzZXIncyBhdmF0YXIuXG4gICAgICAgICAgICAgICAgbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCkuY2hpbGQoJ2F2YXRhcnMnKS5jaGlsZChpbnB1dFVzZXJuYW1lKS5zZXQoJ2h0dHA6Ly9hcGkuYWRvcmFibGUuaW8vYXZhdGFycy80Mi8nICsgaW5wdXRVc2VybmFtZSk7XG5cbiAgICBcdFx0XHQvLyBMb2cgdGhlIHVzZXIgaW4uXG4gICAgXHRcdFx0QXV0aFdyYXBwZXIuJGF1dGhXaXRoUGFzc3dvcmQoe1xuICAgIFx0XHRcdFx0ZW1haWw6IGlucHV0RW1haWwsXG4gICAgXHRcdFx0XHRwYXNzd29yZDogaW5wdXRQYXNzd29yZFxuICAgIFx0XHRcdH0pLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoJ0FDQ09VTlRfQ1JFQVRFRCcpO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgXHRcdH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yRGF0YSkge1xuXG4gICAgXHRcdFx0Y29uc29sZS5lcnJvcihlcnJvckRhdGEpO1xuXG4gICAgXHRcdFx0aWYgKGVycm9yRGF0YS5jb2RlID09PSAnRU1BSUxfVEFLRU4nKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZXJyb3JEYXRhLmNvZGUpO1xuICAgIFx0XHRcdH1cblxuICAgIFx0XHR9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICBcdH1cblxuICAgICAgICBmdW5jdGlvbiBsb2dpblRvQWNjb3VudChpbnB1dEVtYWlsLCBpbnB1dFBhc3N3b3JkKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgICAgIEF1dGhXcmFwcGVyLiRhdXRoV2l0aFBhc3N3b3JkKHtcbiAgICAgICAgICAgICAgICBlbWFpbDogaW5wdXRFbWFpbCxcbiAgICAgICAgICAgICAgICBwYXNzd29yZDogaW5wdXRQYXNzd29yZFxuICAgICAgICAgICAgfSkudGhlbihmdW5jdGlvbihhdXRoRGF0YSkge1xuXG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgnTE9HSU5fU1VDQ0VTUycpO1xuXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnJvckRhdGEpIHtcblxuICAgICAgICAgICAgICAgIGlmIChlcnJvckRhdGEuY29kZSA9PT0gJ0lOVkFMSURfVVNFUicpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgnSU5WQUxJRF9VU0VSJyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlcnJvckRhdGEuY29kZSA9PT0gJ0lOVkFMSURfUEFTU1dPUkQnKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoJ0lOVkFMSURfUEFTU1dPUkQnKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gbG9nT3V0KCkge1xuICAgICAgICAgICAgQXV0aFdyYXBwZXIuJHVuYXV0aCgpO1xuICAgICAgICAgICAgJHJvb3RTY29wZS51bmJpbmRGdW5jdGlvbigpO1xuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5mYWN0b3J5KCdBdXRoV3JhcHBlcicsIEF1dGhXcmFwcGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIEF1dGhXcmFwcGVyKCRmaXJlYmFzZUF1dGgsIEZJUkVCQVNFREFUQSkge1xuXG4gICAgICAgIHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcbiAgICAgICAgcmV0dXJuICRmaXJlYmFzZUF1dGgocmVmKTtcblxuICAgIH1cbiAgICBcbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLnNlcnZpY2UoJ2V2ZW50U2VydmljZScsIGV2ZW50U2VydmljZSk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBldmVudFNlcnZpY2UoJHEsICRmaWx0ZXIsICRmaXJlYmFzZU9iamVjdCwgJGZpcmViYXNlQXJyYXksIEZJUkVCQVNFREFUQSkge1xuXG4gICAgICAgIHRoaXMuY3JlYXRlTXVsdGlHYW1lRmluYWxTdGFuZGluZ3MgPSBjcmVhdGVNdWx0aUdhbWVGaW5hbFN0YW5kaW5ncztcbiAgICAgICAgdGhpcy5nZXRFdmVudFByb3BlcnRpZXMgPSBnZXRFdmVudFByb3BlcnRpZXM7XG4gICAgICAgIHRoaXMuZ2V0R2FtZURhdGEgPSBnZXRHYW1lRGF0YTtcbiAgICAgICAgdGhpcy5nZXRHYW1lc0xpc3QgPSBnZXRHYW1lc0xpc3Q7XG4gICAgICAgIHRoaXMuZ2V0TXVsdGlHYW1lTGVhZGVyYm9hcmQgPSBnZXRNdWx0aUdhbWVMZWFkZXJib2FyZDtcbiAgICAgICAgdGhpcy5nZXRTaW5nbGVHYW1lTGVhZGVyYm9hcmQgPSBnZXRTaW5nbGVHYW1lTGVhZGVyYm9hcmQ7XG4gICAgICAgIHRoaXMuZ2V0UGxheWVyU2NvcmVzID0gZ2V0UGxheWVyU2NvcmVzO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVNdWx0aUdhbWVGaW5hbFN0YW5kaW5ncyhpbnB1dEV2ZW50KSB7XG5cbiAgICAgICAgICAgIC8vIENhbGN1bGF0ZSB0aGUgZmluYWwgc3RhbmRpbmdzIG9mIHRoZSBldmVudC5cbiAgICAgICAgICAgIGdldE11bHRpR2FtZUxlYWRlcmJvYXJkKGlucHV0RXZlbnQpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuICAgICAgICAgICAgICAgIHZhciBpbnB1dEV2ZW50U3RhbmRpbmdzID0gJGZpcmViYXNlT2JqZWN0KFxuICAgICAgICAgICAgICAgICAgICByZWZcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnc3RhbmRpbmdzJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZChpbnB1dEV2ZW50KVxuICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICBpbnB1dEV2ZW50U3RhbmRpbmdzLiRsb2FkZWQoKS50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIG1vZGVsLmZvckVhY2goZnVuY3Rpb24oc3RhbmRpbmcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0RXZlbnRTdGFuZGluZ3Nbc3RhbmRpbmcua2V5XSA9IHN0YW5kaW5nLnBvc2l0aW9uO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICBpbnB1dEV2ZW50U3RhbmRpbmdzLiRzYXZlKCk7XG5cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEV2ZW50UHJvcGVydGllcyhpbnB1dEV2ZW50KSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgXHR2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG4gICAgICAgIFx0dmFyIGV2ZW50UHJvcGVydGllcyA9ICRmaXJlYmFzZU9iamVjdChcbiAgICAgICAgXHRcdHJlZlxuICAgICAgICBcdFx0XHQuY2hpbGQoJ2NvbnRlc3RzJylcbiAgICAgICAgXHRcdFx0LmNoaWxkKGlucHV0RXZlbnQpXG4gICAgICAgIFx0XHRcdC5jaGlsZCgncHJvcGVydGllcycpXG4gICAgICAgIFx0KTtcblxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShldmVudFByb3BlcnRpZXMpO1xuXG4gICAgICAgIFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEdhbWVEYXRhKGlucHV0RXZlbnQsIGlucHV0R2FtZSkge1xuXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgIGdldEdhbWVzTGlzdChpbnB1dEV2ZW50KS50aGVuKGZ1bmN0aW9uKGdhbWVzTGlzdCkge1xuXG4gICAgICAgICAgICAgICAgZ2FtZXNMaXN0LmZvckVhY2goZnVuY3Rpb24oZ2FtZSkge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmIChnYW1lLmNhbWVsTmFtZSA9PT0gaW5wdXRHYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGdhbWUpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRHYW1lc0xpc3QoaW5wdXRFdmVudCkge1xuXG4gICAgICAgIFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICBcdHZhciByZWYgPSBuZXcgRmlyZWJhc2UoRklSRUJBU0VEQVRBLkZCVVJMKTtcbiAgICAgICAgXHR2YXIgZ2FtZXNMaXN0ID0gJGZpcmViYXNlQXJyYXkoXG4gICAgICAgIFx0XHRyZWZcbiAgICAgICAgXHRcdFx0LmNoaWxkKCdjb250ZXN0cycpXG4gICAgICAgIFx0XHRcdC5jaGlsZChpbnB1dEV2ZW50KVxuICAgICAgICBcdFx0XHQuY2hpbGQoJ2FjdGl2ZUdhbWVzJylcbiAgICAgICAgXHQpO1xuXG4gICAgICAgIFx0Z2FtZXNMaXN0LiRsb2FkZWQoKS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICBcdFx0ZGVmZXJyZWQucmVzb2x2ZShnYW1lc0xpc3QpO1xuICAgICAgICBcdH0pO1xuXG4gICAgICAgIFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldE11bHRpR2FtZUxlYWRlcmJvYXJkKGlucHV0RXZlbnQpIHtcblxuICAgICAgICBcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgXHQvLyBXZSBuZWVkIHRvIGdldCB0aGUgdG9wIDEyIHBsYXllcnMgZm9yIGV2ZXJ5IGdhbWUuXG4gICAgICAgIFx0dmFyIHBsYXllclBvaW50cyA9IHt9O1xuXG4gICAgICAgIFx0Z2V0R2FtZXNMaXN0KGlucHV0RXZlbnQpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuXG4gICAgICAgIFx0XHR2YXIgZ2FtZXNMaXN0ID0gbW9kZWw7XG4gICAgICAgIFx0XHRnYW1lc0xpc3QuZm9yRWFjaChmdW5jdGlvbihnYW1lKSB7XG5cbiAgICAgICAgXHRcdFx0aWYgKGdhbWUuc2NvcmVzKSB7XG5cbiAgICAgICAgXHRcdFx0XHQvLyBDb252ZXJ0IHRoZSBnYW1lJ3Mgc2NvcmVzIHRvIGFuIGFycmF5LlxuICAgICAgICBcdFx0XHRcdHZhciBzY29yZXNBcnJheSA9ICQubWFwKGdhbWUuc2NvcmVzLCBmdW5jdGlvbihlbCkgeyByZXR1cm4gZWw7IH0pO1xuICAgICAgICBcdFx0XHRcdHNjb3Jlc0FycmF5ID0gJGZpbHRlcignb3JkZXJCeScpKHNjb3Jlc0FycmF5LCAnLXNjb3JlJyk7XG5cbiAgICAgICAgXHRcdFx0XHR2YXIgdG90YWxBd2FyZCA9IDEyO1xuXG4gICAgICAgIFx0XHRcdFx0Ly8gSXRlcmF0ZSB0aHJvdWdoIHRoZSB0b3Agc2NvcmVzIGF3YXJkaW5nIHBvaW50cy5cbiAgICAgICAgXHRcdFx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHNjb3Jlc0FycmF5Lmxlbmd0aDsgaSsrKSB7XG5cbiAgICAgICAgXHRcdFx0XHRcdGlmICghcGxheWVyUG9pbnRzW3Njb3Jlc0FycmF5W2ldLnVzZXJOYW1lXSkge1xuICAgICAgICBcdFx0XHRcdFx0XHRwbGF5ZXJQb2ludHNbc2NvcmVzQXJyYXlbaV0udXNlck5hbWVdID0ge1xuICAgICAgICBcdFx0XHRcdFx0XHRcdHBvaW50czogMFxuICAgICAgICBcdFx0XHRcdFx0XHR9O1xuICAgICAgICBcdFx0XHRcdFx0fVxuXG4gICAgICAgIFx0XHRcdFx0XHRwbGF5ZXJQb2ludHNbc2NvcmVzQXJyYXlbaV0udXNlck5hbWVdLnBvaW50cyArPSB0b3RhbEF3YXJkO1xuXG4gICAgICAgIFx0XHRcdFx0XHRpZiAodG90YWxBd2FyZCA+IDApIHtcbiAgICAgICAgXHRcdFx0XHRcdFx0dG90YWxBd2FyZCAtPSAxO1xuICAgICAgICBcdFx0XHRcdFx0fVxuXG4gICAgICAgIFx0XHRcdFx0fVxuXG4gICAgICAgIFx0XHRcdH1cblxuICAgICAgICBcdFx0fSk7XG5cbiAgICAgICAgXHRcdC8vIEZpbmQgYW5kIHJlc29sdmUgdGllcy5cbiAgICAgICAgXHRcdHBsYXllclBvaW50cyA9ICRmaWx0ZXIoJ29yZGVyT2JqZWN0QnknKShwbGF5ZXJQb2ludHMsICdwb2ludHMnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICB2YXIgaGF2ZUJvdHRvbVNjb3JlcnNGbG9vciA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHZhciBmbG9vclJhbmdlID0gMDtcbiAgICAgICAgXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgcGxheWVyUG9pbnRzLmxlbmd0aDsgaSArPSAxKSB7XG5cbiAgICAgICAgXHRcdFx0aWYgKHBsYXllclBvaW50c1tpLTFdICYmIHBsYXllclBvaW50c1tpXS5wb2ludHMgJiYgcGxheWVyUG9pbnRzW2ktMV0ucG9pbnRzKSB7XG5cbiAgICAgICAgXHRcdFx0XHRpZiAocGxheWVyUG9pbnRzW2ldLnBvaW50cyA9PT0gcGxheWVyUG9pbnRzW2ktMV0ucG9pbnRzKSB7XG4gICAgICAgIFx0XHRcdFx0XHRwbGF5ZXJQb2ludHNbaV0ucG9zaXRpb24gPSBwbGF5ZXJQb2ludHNbaS0xXS5wb3NpdGlvbjtcbiAgICAgICAgXHRcdFx0XHR9IGVsc2Uge1xuICAgICAgICBcdFx0XHRcdFx0cGxheWVyUG9pbnRzW2ldLnBvc2l0aW9uID0gKGkrMSk7XG4gICAgICAgIFx0XHRcdFx0fVxuXG4gICAgICAgIFx0XHRcdH0gZWxzZSB7XG5cbiAgICAgICAgXHRcdFx0XHRpZiAoaSA9PT0gMCkge1xuICAgICAgICBcdFx0XHRcdFx0cGxheWVyUG9pbnRzW2ldLnBvc2l0aW9uID0gMTtcbiAgICAgICAgXHRcdFx0XHR9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFoYXZlQm90dG9tU2NvcmVyc0Zsb29yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEdldCBjb3VudCBvZiBwbGF5ZXJzIGluIG9uZSBwb3NpdGlvbiBoaWdoZXIuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBnZXRTY29yZUNvdW50T2YgPSBwbGF5ZXJQb2ludHNbaS0xXS5wb2ludHM7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBwbGF5ZXJQb2ludHMubGVuZ3RoOyBqICs9IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwbGF5ZXJQb2ludHNbal0ucG9pbnRzID09PSBnZXRTY29yZUNvdW50T2YpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmbG9vclJhbmdlICs9IDE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBoYXZlQm90dG9tU2NvcmVyc0Zsb29yID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgXHRcdFx0XHRcdHBsYXllclBvaW50c1tpXS5wb3NpdGlvbiA9IChwbGF5ZXJQb2ludHMubGVuZ3RoICsgMSkgLSBmbG9vclJhbmdlO1xuICAgICAgICBcdFx0XHRcdH1cblxuICAgICAgICBcdFx0XHR9XG5cbiAgICAgICAgXHRcdH1cblxuICAgICAgICBcdFx0ZGVmZXJyZWQucmVzb2x2ZShwbGF5ZXJQb2ludHMpO1xuXG4gICAgICAgIFx0fSk7XG5cblx0XHRcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRTaW5nbGVHYW1lTGVhZGVyYm9hcmQoaW5wdXRFdmVudCkge1xuXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG4gICAgICAgICAgICB2YXIgbGVhZGVyYm9hcmREYXRhID0gJGZpcmViYXNlQXJyYXkoXG4gICAgICAgICAgICAgICAgcmVmXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnY29udGVzdHMnKVxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoaW5wdXRFdmVudClcbiAgICAgICAgICAgICAgICAgICAgLmNoaWxkKCdzY29yZXMnKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShsZWFkZXJib2FyZERhdGEpO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0UGxheWVyU2NvcmVzKGlucHV0RXZlbnQsIGlucHV0R2FtZXNMaXN0LCBpbnB1dFBsYXllcikge1xuXG4gICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICAgICB2YXIgZGlzcGxheVNjb3JlcyA9IFtdO1xuXG4gICAgICAgICAgICAvLyBJdGVyYXRlIHRocm91Z2ggZXZlcnkgZ2FtZS5cbiAgICAgICAgICAgIGlucHV0R2FtZXNMaXN0LmZvckVhY2goZnVuY3Rpb24oZ2FtZSkge1xuXG4gICAgICAgICAgICAgICAgaWYgKGdhbWUuc2NvcmVzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gQ29udmVydCB0aGUgZ2FtZSdzIHNjb3JlcyB0byBhbiBhcnJheS5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHNjb3Jlc0FycmF5ID0gJC5tYXAoZ2FtZS5zY29yZXMsIGZ1bmN0aW9uKGVsKSB7IHJldHVybiBlbDsgfSk7XG4gICAgICAgICAgICAgICAgICAgIHNjb3Jlc0FycmF5ID0gJGZpbHRlcignb3JkZXJCeScpKHNjb3Jlc0FycmF5LCAnLXNjb3JlJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRvdGFsQXdhcmQgPSAxMjtcblxuICAgICAgICAgICAgICAgICAgICAvLyBJdGVyYXRlIHRocm91Z2ggdGhlIHNjb3JlcyBzdGFydGluZyBmcm9tIHRoZSB0b3AgYW5kIGZpbmQgb3VyIHVzZXIuXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2NvcmVzQXJyYXkubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gRm91bmQgb3VyIHBsYXllci5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzY29yZXNBcnJheVtpXS51c2VyTmFtZSA9PT0gaW5wdXRQbGF5ZXIpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBuZXdTY29yZU9iamVjdCA9IGdhbWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2NvcmVPYmplY3QucG9zaXRpb24gPSBpKzE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2NvcmVPYmplY3Quc2NvcmUgPSBzY29yZXNBcnJheVtpXS5zY29yZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTY29yZU9iamVjdC5wb2ludHNFYXJuZWQgPSB0b3RhbEF3YXJkO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1Njb3JlT2JqZWN0LmlucFVybCA9IHNjb3Jlc0FycmF5W2ldLmlucFVybCA/IHNjb3Jlc0FycmF5W2ldLmlucFVybCA6IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3U2NvcmVPYmplY3QudHdpdGNoVXJsID0gc2NvcmVzQXJyYXlbaV0udHdpdGNoVXJsID8gc2NvcmVzQXJyYXlbaV0udHdpdGNoVXJsIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTY29yZU9iamVjdC5tYW1lVmVyc2lvbiA9IHNjb3Jlc0FycmF5W2ldLm1hbWVWZXJzaW9uID8gc2NvcmVzQXJyYXlbaV0ubWFtZVZlcnNpb24gOiBudWxsO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVNjb3Jlcy5wdXNoKG5ld1Njb3JlT2JqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbEF3YXJkID0gMTI7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRvdGFsQXdhcmQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsQXdhcmQgLT0gMTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkaXNwbGF5U2NvcmVzKTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgfVxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuY29udHJvbGxlcignRXZlbnRNYWluQ29udHJvbGxlcicsIEV2ZW50TWFpbkNvbnRyb2xsZXIpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gRXZlbnRNYWluQ29udHJvbGxlcigkc2NvcGUsICRmaWx0ZXIsICRzdGF0ZVBhcmFtcywgJHN0YXRlLCAkdGltZW91dCwgJGZpcmViYXNlQXJyYXksIGV2ZW50U2VydmljZSwgYXV0aFNlcnZpY2UsIHByb2ZpbGVTZXJ2aWNlLCB0ZWFtU2VydmljZSwgRklSRUJBU0VEQVRBKSB7XG5cbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuXG4gICAgICAgIHZtLmV2ZW50TmFtZSA9ICRzdGF0ZVBhcmFtcy5ldmVudE5hbWU7XG5cbiAgICAgICAgdm0uY3JlYXRlVGVhbSA9IGNyZWF0ZVRlYW07XG4gICAgICAgIHZtLmRldGVybWluZVBvaW50cyA9IGRldGVybWluZVBvaW50cztcbiAgICAgICAgdm0uZ2V0Rmlyc3RQbGFjZVNjb3JlcyA9IGdldEZpcnN0UGxhY2VTY29yZXM7XG4gICAgICAgIHZtLmdvVG9QbGF5ZXJQcm9maWxlID0gZ29Ub1BsYXllclByb2ZpbGU7XG4gICAgICAgIHZtLm9wZW5CYWRnZXNNb2RhbCA9IG9wZW5CYWRnZXNNb2RhbDtcbiAgICAgICAgdm0ub3BlbkdhbWVNb2RhbCA9IG9wZW5HYW1lTW9kYWw7XG4gICAgICAgIHZtLm9wZW5HYW1lTW9kYWxGcm9tUGxheWVyTW9kYWwgPSBvcGVuR2FtZU1vZGFsRnJvbVBsYXllck1vZGFsO1xuICAgICAgICB2bS5vcGVuTWFuYWdlbWVudE1vZGFsID0gb3Blbk1hbmFnZW1lbnRNb2RhbDtcbiAgICAgICAgdm0ub3Blbk11bHRpR2FtZUxlYWRlcmJvYXJkTW9kYWwgPSBvcGVuTXVsdGlHYW1lTGVhZGVyYm9hcmRNb2RhbDtcbiAgICAgICAgdm0ub3BlblBsYXllck1vZGFsID0gb3BlblBsYXllck1vZGFsO1xuICAgICAgICB2bS5vcGVuUGxheWVyTW9kYWxGcm9tR2FtZU1vZGFsID0gb3BlblBsYXllck1vZGFsRnJvbUdhbWVNb2RhbDtcbiAgICAgICAgdm0ub3BlblBsYXllck1vZGFsRnJvbUxlYWRlcmJvYXJkTW9kYWwgPSBvcGVuUGxheWVyTW9kYWxGcm9tTGVhZGVyYm9hcmRNb2RhbDtcbiAgICAgICAgdm0ub3BlblJ1bGVzTW9kYWwgPSBvcGVuUnVsZXNNb2RhbDtcblxuICAgICAgICBpbml0RXZlbnQoKTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBjbG9zZU1vZGFsKCkge1xuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcubW9kYWwnKS5jbG9zZU1vZGFsKCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVUZWFtKCkge1xuICAgICAgICAgICAgdGVhbVNlcnZpY2UuY3JlYXRlVGVhbSh2bS5ldmVudE5hbWUsIHZtLm5ld1RlYW0pLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgTWF0ZXJpYWxpemUudG9hc3QoJ1RlYW0gJyArIHZtLm5ld1RlYW0uc2hvcnROYW1lICsgJyBjcmVhdGVkLicsIDQwMDApO1xuICAgICAgICAgICAgICAgIHZtLm5ld1RlYW0gPSBudWxsO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBkZXRlcm1pbmVQb2ludHMoaW5wdXRTY29yZURhdGEsIGlucHV0SW5kZXgpIHtcblxuICAgICAgICAgICAgdmFyIHVzZXJHYW1lUG9pbnRzO1xuXG4gICAgICAgICAgICAvLyBObyBwb3NpdGlvbiBncmVhdGVyIHRoYW4gMTIgZ2V0cyBwb2ludHMuXG4gICAgICAgICAgICBpZiAoaW5wdXRJbmRleCA+IDExKSB7XG4gICAgICAgICAgICAgICAgdXNlckdhbWVQb2ludHMgPSAwO1xuICAgICAgICAgICAgICAgIHJldHVybiB1c2VyR2FtZVBvaW50cztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdXNlckdhbWVQb2ludHMgPSAxMiAtIGlucHV0SW5kZXg7XG5cbiAgICAgICAgICAgIHZhciBzb3J0ZWRTY29yZXMgPSAkZmlsdGVyKCdvcmRlckJ5Jykodm0uZ2FtZVNjb3JlcywgJy1zY29yZScpO1xuXG4gICAgICAgICAgICAvLyBBbSBJIHRpZWQgd2l0aCB0aGUgcGVyc29uIGFib3ZlIG1lPyBJZiBzbywgbWF0Y2ggdGhlaXIgcG9pbnRzLlxuICAgICAgICAgICAgaWYgKHNvcnRlZFNjb3Jlc1tpbnB1dEluZGV4IC0gMV0pIHtcblxuICAgICAgICAgICAgICAgIGlmIChzb3J0ZWRTY29yZXNbaW5wdXRJbmRleCAtIDFdLnNjb3JlID09PSBpbnB1dFNjb3JlRGF0YS5zY29yZSkge1xuICAgICAgICAgICAgICAgICAgICB1c2VyR2FtZVBvaW50cyArPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHVzZXJHYW1lUG9pbnRzO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRGaXJzdFBsYWNlU2NvcmVzKCkge1xuXG4gICAgICAgICAgICB2bS5nYW1lTGlzdC5mb3JFYWNoKGZ1bmN0aW9uKGdhbWUpIHtcblxuICAgICAgICAgICAgICAgIC8vIElmIHRoZXJlIGFyZSBzY29yZXMsIGdldCB0aGUgdG9wIG9uZS5cbiAgICAgICAgICAgICAgICBpZiAoZ2FtZS5zY29yZXMpIHtcblxuICAgICAgICAgICAgICAgICAgICB2YXIgc2NvcmVzQXJyYXkgPSAkLm1hcChnYW1lLnNjb3JlcywgZnVuY3Rpb24oZWwpIHsgcmV0dXJuIGVsOyB9KTtcbiAgICAgICAgICAgICAgICAgICAgc2NvcmVzQXJyYXkgPSAkZmlsdGVyKCdvcmRlckJ5Jykoc2NvcmVzQXJyYXksICctc2NvcmUnKTtcbiAgICAgICAgICAgICAgICAgICAgZ2FtZS5maXJzdFNjb3JlID0gc2NvcmVzQXJyYXlbMF07XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnb1RvUGxheWVyUHJvZmlsZShpbnB1dFBsYXllcikge1xuXG4gICAgICAgICAgICBjbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAkc3RhdGUuZ28oJ3Byb2ZpbGUnLCB7dXNlcm5hbWU6IGlucHV0UGxheWVyfSk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGluaXRFdmVudCgpIHtcblxuICAgICAgICAgICAgZXZlbnRTZXJ2aWNlLmdldEV2ZW50UHJvcGVydGllcyh2bS5ldmVudE5hbWUpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuXG4gICAgICAgICAgICAgICAgdm0uZXZlbnRQcm9wZXJ0aWVzID0gbW9kZWw7XG5cbiAgICAgICAgICAgICAgICB2bS5ldmVudFByb3BlcnRpZXMuJGxvYWRlZCgpLnRoZW4oZnVuY3Rpb24oKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhpcyBpcyBhIG11bHRpZ2FtZSBldmVudCwgZ2V0IHRoZSBkYXRhIG5lZWRlZCBmb3IgbXVsdGlnYW1lIGNvbXBvbmVudHMuXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5ldmVudFByb3BlcnRpZXMuZm9ybWF0Lm11bHRpR2FtZSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICBldmVudFNlcnZpY2UuZ2V0R2FtZXNMaXN0KHZtLmV2ZW50TmFtZSkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uZ2FtZUxpc3QgPSBtb2RlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZXRGaXJzdFBsYWNlU2NvcmVzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTZXJ2aWNlLmdldE11bHRpR2FtZUxlYWRlcmJvYXJkKHZtLmV2ZW50TmFtZSkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGxlYWRlcmJvYXJkID0gbW9kZWw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0ubGVhZGVyYm9hcmRMZW5ndGggPSBsZWFkZXJib2FyZC5sZW5ndGg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uc3VtbWFyaXplZExlYWRlcmJvYXJkID0gbGVhZGVyYm9hcmQuc2xpY2UoMCwgOCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGEgc2luZ2xlIGdhbWUgZXZlbnQsIGdldCB0aGUgZGF0YSBuZWVkZWQgZm9yIHNpbmdsZSBnYW1lIGNvbXBvbmVudHMuXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U2VydmljZS5nZXRTaW5nbGVHYW1lTGVhZGVyYm9hcmQodm0uZXZlbnROYW1lKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgbGVhZGVyYm9hcmQgPSBtb2RlbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5sZWFkZXJib2FyZExlbmd0aCA9IGxlYWRlcmJvYXJkLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5zdW1tYXJpemVkTGVhZGVyYm9hcmQgPSBsZWFkZXJib2FyZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGEgdGVhbS1iYXNlZCBldmVudCwgZ2V0IHRoZSBkYXRhIG5lZWRlZCBmb3IgdGVhbSBldmVudCBjb21wb25lbnRzLlxuICAgICAgICAgICAgICAgICAgICBpZiAodm0uZXZlbnRQcm9wZXJ0aWVzLmZvcm1hdC50ZWFtQmFzZWQpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgdGVhbVNlcnZpY2UuZ2V0VGVhbUxpc3Qodm0uZXZlbnROYW1lKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS50ZWFtTGlzdCA9IG1vZGVsO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIGlmICh2bS5ldmVudFByb3BlcnRpZXMuc3RhdGUgPT09ICd1cGNvbWluZycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5jb2xsYXBzaWJsZScpLmNvbGxhcHNpYmxlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2NvcmRpb246IHRydWVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHByb2ZpbGVTZXJ2aWNlLmdldEF2YXRhckRhdGEoKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5hdmF0YXJEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb3BlbkJhZGdlc01vZGFsKCkge1xuXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNiYWRnZXNNb2RhbCcpLm9wZW5Nb2RhbCgpO1xuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjYmFkZ2VzTW9kYWxDb250ZW50Jykuc2Nyb2xsVG9wKDApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuR2FtZU1vZGFsKGlucHV0R2FtZU5hbWUpIHtcblxuICAgICAgICAgICAgdmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuXG4gICAgICAgICAgICBldmVudFNlcnZpY2UuZ2V0R2FtZURhdGEodm0uZXZlbnROYW1lLCBpbnB1dEdhbWVOYW1lKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5nYW1lRGF0YSA9IG1vZGVsO1xuXG4gICAgICAgICAgICAgICAgdm0uZ2FtZVNjb3JlcyA9ICRmaXJlYmFzZUFycmF5KFxuICAgICAgICAgICAgICAgICAgICByZWZcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnY29udGVzdHMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKHZtLmV2ZW50TmFtZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnYWN0aXZlR2FtZXMnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKHZtLmdhbWVEYXRhLiRpZClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jaGlsZCgnc2NvcmVzJylcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnI2dhbWVNb2RhbCcpLm9wZW5Nb2RhbCgpO1xuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjZ2FtZU1vZGFsJykuYWRkQ2xhc3MoJy5vcGVuLW1vZGFsJyk7XG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNnYW1lTW9kYWxDb250ZW50Jykuc2Nyb2xsVG9wKDApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuTWFuYWdlbWVudE1vZGFsKCkge1xuXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNtYW5hZ2VtZW50TW9kYWwnKS5vcGVuTW9kYWwoKTtcbiAgICAgICAgICAgIGFuZ3VsYXIuZWxlbWVudCgnI21hbmFnZW1lbnRNb2RhbENvbnRlbnQnKS5zY3JvbGxUb3AoMCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG9wZW5NdWx0aUdhbWVMZWFkZXJib2FyZE1vZGFsKCkge1xuXG4gICAgICAgICAgICBldmVudFNlcnZpY2UuZ2V0TXVsdGlHYW1lTGVhZGVyYm9hcmQodm0uZXZlbnROYW1lKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5jb21wbGV0ZUxlYWRlcmJvYXJkID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjbXVsdGlHYW1lTGVhZGVyYm9hcmRNb2RhbCcpLm9wZW5Nb2RhbCgpO1xuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjbXVsdGlHYW1lTGVhZGVyYm9hcmRNb2RhbENvbnRlbnQnKS5zY3JvbGxUb3AoMCk7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIG9wZW5QbGF5ZXJNb2RhbChpbnB1dFBsYXllcikge1xuXG4gICAgICAgICAgICB2bS5mb2N1c1BsYXllciA9IGlucHV0UGxheWVyO1xuXG4gICAgICAgICAgICBldmVudFNlcnZpY2UuZ2V0UGxheWVyU2NvcmVzKHZtLmV2ZW50TmFtZSwgdm0uZ2FtZUxpc3QsIHZtLmZvY3VzUGxheWVyKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5wbGF5ZXJTY29yZXMgPSBtb2RlbDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNwbGF5ZXJNb2RhbCcpLm9wZW5Nb2RhbCgpO1xuICAgICAgICAgICAgYW5ndWxhci5lbGVtZW50KCcjcGxheWVyTW9kYWxDb250ZW50Jykuc2Nyb2xsVG9wKDApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuR2FtZU1vZGFsRnJvbVBsYXllck1vZGFsKGlucHV0R2FtZSkge1xuXG4gICAgICAgICAgICBjbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBvcGVuR2FtZU1vZGFsKGlucHV0R2FtZSk7XG4gICAgICAgICAgICB9LCA0NTApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuUGxheWVyTW9kYWxGcm9tR2FtZU1vZGFsKGlucHV0UGxheWVyKSB7XG5cbiAgICAgICAgICAgIGNsb3NlTW9kYWwoKTtcbiAgICAgICAgICAgICR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIG9wZW5QbGF5ZXJNb2RhbChpbnB1dFBsYXllcik7XG4gICAgICAgICAgICB9LCA0NTApO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBvcGVuUGxheWVyTW9kYWxGcm9tTGVhZGVyYm9hcmRNb2RhbChpbnB1dFBsYXllcikge1xuXG4gICAgICAgICAgICBjbG9zZU1vZGFsKCk7XG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBvcGVuUGxheWVyTW9kYWwoaW5wdXRQbGF5ZXIpO1xuICAgICAgICAgICAgfSwgNDUwKTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gb3BlblJ1bGVzTW9kYWwoKSB7XG4gICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJyNydWxlc01vZGFsJykub3Blbk1vZGFsKCk7XG4gICAgICAgIH1cblxuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuc2VydmljZSgndGVhbVNlcnZpY2UnLCB0ZWFtU2VydmljZSk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiB0ZWFtU2VydmljZSgkcSwgJGZpcmViYXNlQXJyYXksICRmaXJlYmFzZU9iamVjdCwgRklSRUJBU0VEQVRBKSB7XG5cbiAgICBcdHRoaXMuY3JlYXRlVGVhbSA9IGNyZWF0ZVRlYW07XG4gICAgICAgIHRoaXMuZ2V0VGVhbUxpc3QgPSBnZXRUZWFtTGlzdDtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlVGVhbShpbnB1dEV2ZW50LCBpbnB1dE5ld1RlYW1Qcm9wZXJ0aWVzKSB7XG5cbiAgICAgICAgXHR2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIFx0dmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuICAgICAgICBcdHZhciB0ZWFtUG9vbCA9ICRmaXJlYmFzZU9iamVjdChcbiAgICAgICAgXHRcdHJlZlxuICAgICAgICBcdFx0XHQuY2hpbGQoJ2NvbnRlc3RzJylcbiAgICAgICAgXHRcdFx0LmNoaWxkKGlucHV0RXZlbnQpXG4gICAgICAgIFx0XHRcdC5jaGlsZCgndGVhbVBvb2wnKVxuICAgICAgICBcdCk7XG5cbiAgICAgICAgXHR0ZWFtUG9vbC4kbG9hZGVkKCkudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICBcdFx0dGVhbVBvb2xbaW5wdXROZXdUZWFtUHJvcGVydGllcy5zaG9ydE5hbWVdID0ge1xuICAgICAgICBcdFx0XHRmdWxsTmFtZTogaW5wdXROZXdUZWFtUHJvcGVydGllcy5mb3JtYWxOYW1lXG4gICAgICAgIFx0XHR9O1xuICAgICAgICBcdFx0dGVhbVBvb2wuJHNhdmUoKTtcbiAgICAgICAgXHRcdGRlZmVycmVkLnJlc29sdmUoKTtcblxuICAgICAgICBcdH0pO1xuXG4gICAgICAgIFx0cmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldFRlYW1MaXN0KGlucHV0RXZlbnQpIHtcblxuICAgICAgICBcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgXHR2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG4gICAgICAgIFx0dmFyIHRlYW1MaXN0ID0gJGZpcmViYXNlQXJyYXkoXG4gICAgICAgIFx0XHRyZWZcbiAgICAgICAgXHRcdFx0LmNoaWxkKCdjb250ZXN0cycpXG4gICAgICAgIFx0XHRcdC5jaGlsZChpbnB1dEV2ZW50KVxuICAgICAgICBcdFx0XHQuY2hpbGQoJ3RlYW1Qb29sJylcbiAgICAgICAgXHQpO1xuXG4gICAgICAgIFx0dGVhbUxpc3QuJGxvYWRlZCgpLnRoZW4oZnVuY3Rpb24oKSB7XG4gICAgICAgIFx0XHRkZWZlcnJlZC5yZXNvbHZlKHRlYW1MaXN0KTtcbiAgICAgICAgXHR9KTtcblxuICAgICAgICBcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3ZnR2FtZXNMaXN0JywgdmdHYW1lc0xpc3QpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gdmdHYW1lc0xpc3QgKCkge1xuICAgICAgICAvLyBVc2FnZTpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gQ3JlYXRlczpcbiAgICAgICAgLy9cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBHYW1lc0xpc3RDb250cm9sbGVyLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgbGluazogbGluayxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy4vYXBwL2V2ZW50Q29tcG9uZW50cy9nYW1lc0xpc3QuZGlyZWN0aXZlLmh0bScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgXHRkYXRhOiAnPScsXG4gICAgICAgICAgICBcdG9wZW5HYW1lRnVuY3Rpb246ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBHYW1lc0xpc3RDb250cm9sbGVyKCkge1xuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgXHR2YXIgdm0gPSB0aGlzO1xuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmRpcmVjdGl2ZSgndmdNdWx0aUdhbWVMZWFkZXJib2FyZCcsIHZnTXVsdGlHYW1lTGVhZGVyYm9hcmQpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gdmdNdWx0aUdhbWVMZWFkZXJib2FyZCAoKSB7XG4gICAgICAgIC8vIFVzYWdlOlxuICAgICAgICAvL1xuICAgICAgICAvLyBDcmVhdGVzOlxuICAgICAgICAvL1xuICAgICAgICB2YXIgZGlyZWN0aXZlID0ge1xuICAgICAgICAgICAgYmluZFRvQ29udHJvbGxlcjogdHJ1ZSxcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6IE11bHRpR2FtZUxlYWRlcmJvYXJkQ29udHJvbGxlcixcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmssXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuL2FwcC9ldmVudENvbXBvbmVudHMvbXVsdGlHYW1lTGVhZGVyYm9hcmQuZGlyZWN0aXZlLmh0bScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgXHRkYXRhOiAnPScsXG4gICAgICAgICAgICAgICAgYXZhdGFyRGF0YTogJz0nLFxuICAgICAgICAgICAgXHRjb21wbGV0ZUxlbmd0aDogJz0nLFxuICAgICAgICAgICAgXHRvcGVuUGxheWVyRnVuY3Rpb246ICc9JyxcbiAgICAgICAgICAgICAgICBvcGVuTGVhZGVyYm9hcmRGdW5jdGlvbjogJz0nXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBkaXJlY3RpdmU7XG5cbiAgICAgICAgZnVuY3Rpb24gbGluayhzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIE11bHRpR2FtZUxlYWRlcmJvYXJkQ29udHJvbGxlcigpIHtcbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgIFx0dmFyIHZtID0gdGhpcztcbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3ZnU2luZ2xlR2FtZUxlYWRlcmJvYXJkJywgdmdTaW5nbGVHYW1lTGVhZGVyYm9hcmQpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gdmdTaW5nbGVHYW1lTGVhZGVyYm9hcmQgKCkge1xuICAgICAgICAvLyBVc2FnZTpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gQ3JlYXRlczpcbiAgICAgICAgLy9cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBTaW5nbGVHYW1lTGVhZGVyYm9hcmRDb250cm9sbGVyLFxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxuICAgICAgICAgICAgbGluazogbGluayxcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRScsXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy4vYXBwL2V2ZW50Q29tcG9uZW50cy9zaW5nbGVHYW1lTGVhZGVyYm9hcmQuZGlyZWN0aXZlLmh0bScsXG4gICAgICAgICAgICBzY29wZToge1xuICAgICAgICAgICAgXHRkYXRhOiAnPScsXG4gICAgICAgICAgICAgICAgYXZhdGFyRGF0YTogJz0nLFxuICAgICAgICAgICAgXHRjb21wbGV0ZUxlbmd0aDogJz0nLFxuICAgICAgICAgICAgICAgIG9wZW5MZWFkZXJib2FyZEZ1bmN0aW9uOiAnPSdcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZTtcblxuICAgICAgICBmdW5jdGlvbiBsaW5rKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gU2luZ2xlR2FtZUxlYWRlcmJvYXJkQ29udHJvbGxlcigpIHtcbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgIFx0dmFyIHZtID0gdGhpcztcbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5kaXJlY3RpdmUoJ3ZnU3RpY2t5TWVzc2FnZScsIHZnU3RpY2t5TWVzc2FnZSk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiB2Z1N0aWNreU1lc3NhZ2UgKCkge1xuICAgICAgICAvLyBVc2FnZTpcbiAgICAgICAgLy9cbiAgICAgICAgLy8gQ3JlYXRlczpcbiAgICAgICAgLy9cbiAgICAgICAgdmFyIGRpcmVjdGl2ZSA9IHtcbiAgICAgICAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICAgICAgICBjb250cm9sbGVyOiBTdGlja3lNZXNzYWdlQ29udHJvbGxlcixcbiAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcbiAgICAgICAgICAgIGxpbms6IGxpbmssXG4gICAgICAgICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcuL2FwcC9ldmVudENvbXBvbmVudHMvc3RpY2t5TWVzc2FnZS5kaXJlY3RpdmUuaHRtJyxcbiAgICAgICAgICAgIHNjb3BlOiB7XG4gICAgICAgICAgICBcdHByb3BlcnRpZXM6ICc9J1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gZGlyZWN0aXZlO1xuXG4gICAgICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBTdGlja3lNZXNzYWdlQ29udHJvbGxlcigkdGltZW91dCkge1xuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgXHR2YXIgdm0gPSB0aGlzO1xuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0hlYWRlckNvbnRyb2xsZXInLCBIZWFkZXJDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIEhlYWRlckNvbnRyb2xsZXIoJHRpbWVvdXQsICRyb290U2NvcGUsICR3aW5kb3csICRzdGF0ZSwgYXV0aFNlcnZpY2UpIHtcblxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICAgIHZtLmxvZ091dCA9IGxvZ091dDtcblxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmVsZW1lbnQoJy5kcm9wZG93bi1idXR0b24nKVxuICAgICAgICAgICAgICAgICAgICAuZHJvcGRvd24oe1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5EdXJhdGlvbjogMzAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0RHVyYXRpb246IDIyNSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0cmFpbl93aWR0aDogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBob3ZlcjogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICBndXR0ZXI6IC0xMTQsXG4gICAgICAgICAgICAgICAgICAgICAgICBiZWxvd09yaWdpbjogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIDQwMCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBsb2dPdXQoKSB7XG4gICAgICAgICAgICBhdXRoU2VydmljZS5sb2dPdXQoKTtcbiAgICAgICAgICAgICR3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmZpbHRlcignb3JkZXJPYmplY3RCeScsIG9yZGVyT2JqZWN0QnkpO1xuXG4gICAgZnVuY3Rpb24gb3JkZXJPYmplY3RCeSgpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGl0ZW1zLCBmaWVsZCwgcmV2ZXJzZSkge1xuICAgICAgICAgICAgdmFyIGZpbHRlcmVkID0gW107XG5cbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChpdGVtcywgZnVuY3Rpb24oaXRlbSwga2V5KSB7XG4gICAgICAgICAgICAgICAgaXRlbS5rZXkgPSBrZXk7XG4gICAgICAgICAgICAgICAgZmlsdGVyZWQucHVzaChpdGVtKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBmaWx0ZXJlZC5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChhW2ZpZWxkXSA+IGJbZmllbGRdID8gMSA6IC0xKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZihyZXZlcnNlKSBmaWx0ZXJlZC5yZXZlcnNlKCk7XG5cbiAgICAgICAgICAgIHJldHVybiBmaWx0ZXJlZDtcbiAgICAgICAgfTtcbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0F2YXRhckNvbnRyb2xsZXInLCBBdmF0YXJDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIEF2YXRhckNvbnRyb2xsZXIoJHJvb3RTY29wZSwgJHN0YXRlLCAkc3RhdGVQYXJhbXMsICR0aW1lb3V0LCBVcGxvYWQsIGltZ3VyLCBwcm9maWxlU2VydmljZSkge1xuXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgdm0udXBsb2FkQXZhdGFyID0gdXBsb2FkQXZhdGFyO1xuXG4gICAgICAgIGFjdGl2YXRlKCk7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xuICAgICAgICBcdHByb2ZpbGVTZXJ2aWNlLmdldEF2YXRhckRhdGEoKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5hdmF0YXJEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgLy8gRklYTUU6IFRoaXMgbmVlZHMgdG8gYmUgdHJpZ2dlcmVkIGJ5IGEgJHJvb3RTY29wZSBicm9hZGNhc3Qgb2Ygd2hlbiBpdCByZWNlaXZlcyBwcm9maWxlIGRhdGEuXG4gICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBwcm9maWxlU2VydmljZS5nZXRCYWRnZXNEYXRhKCRyb290U2NvcGUucHJvZmlsZS51c2VyTmFtZSkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLmJhZGdlc0RhdGEgPSBtb2RlbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sIDUwMCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiB1cGxvYWRBdmF0YXIoKSB7XG5cbiAgICAgICAgXHR2bS5kaXNhYmxlQnV0dG9uID0gdHJ1ZTtcblxuICAgICAgICBcdGltZ3VyLnNldEFQSUtleSgnQ2xpZW50LUlEIGY1M2Q2ZDU4MzNiMDdiYycpO1xuICAgICAgICBcdGltZ3VyLnVwbG9hZCh2bS5maWxlKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgXHRcdHByb2ZpbGVTZXJ2aWNlLnNhdmVBdmF0YXJMaW5rKG1vZGVsWzBdLmxpbmssICRyb290U2NvcGUucHJvZmlsZS51c2VyTmFtZSk7XG4gICAgICAgIFx0XHRNYXRlcmlhbGl6ZS50b2FzdCgnWW91ciBhdmF0YXIgd2FzIHVwbG9hZGVkJywgNDAwMCk7XG5cbiAgICAgICAgXHRcdCR0aW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICBcdFx0XHQkc3RhdGUuZ28oJ2hvbWUnKTtcbiAgICAgICAgXHRcdH0sIDEwMDApO1xuICAgICAgICBcdH0pO1xuXG4gICAgICAgIH1cblxuICAgIH1cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0NoYW5nZVBhc3N3b3JkQ29udHJvbGxlcicsIENoYW5nZVBhc3N3b3JkQ29udHJvbGxlcik7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBDaGFuZ2VQYXNzd29yZENvbnRyb2xsZXIoJHNjb3BlLCAkdGltZW91dCwgJHN0YXRlLCBBdXRoV3JhcHBlcikge1xuXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgdmFyIHZtID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHZtLnN1Ym1pdENoYW5nZVBhc3N3b3JkID0gc3VibWl0Q2hhbmdlUGFzc3dvcmQ7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vXG5cbiAgICAgICAgZnVuY3Rpb24gc3VibWl0Q2hhbmdlUGFzc3dvcmQoKSB7XG5cbiAgICAgICAgICAgIGlmICgkc2NvcGUucHdDaGFuZ2VGb3JtLiR2YWxpZCkge1xuXG4gICAgICAgICAgICAgICAgQXV0aFdyYXBwZXIuJGNoYW5nZVBhc3N3b3JkKHtcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6IEF1dGhXcmFwcGVyLiRnZXRBdXRoKCkucGFzc3dvcmQuZW1haWwsXG4gICAgICAgICAgICAgICAgICAgIG9sZFBhc3N3b3JkOiB2bS5pbnB1dEN1cnJlbnRQYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgbmV3UGFzc3dvcmQ6IHZtLmlucHV0TmV3UGFzc3dvcmRcbiAgICAgICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuXG4gICAgICAgICAgICAgICAgICAgIE1hdGVyaWFsaXplLnRvYXN0KCdZb3VyIHBhc3N3b3JkIHdhcyBjaGFuZ2VkLicsIDQwMDApO1xuICAgICAgICAgICAgICAgICAgICAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xuICAgICAgICAgICAgICAgICAgICB9LCAxMDAwKTtcblxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ0lOVkFMSURfUEFTU1dPUkQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5zaG93Q2hhbmdlUGFzc3dvcmRNZXNzYWdlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG5cbiAgICB9XG5cbn0pKCk7IiwiKGZ1bmN0aW9uKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXJcbiAgICAgICAgLm1vZHVsZSgndmcuYXBwJylcbiAgICAgICAgLmNvbnRyb2xsZXIoJ0hvbWVDb250cm9sbGVyJywgSG9tZUNvbnRyb2xsZXIpO1xuXG4gICAgLyogQG5nSW5qZWN0ICovXG4gICAgZnVuY3Rpb24gSG9tZUNvbnRyb2xsZXIoJHNjb3BlLCAkdGltZW91dCkge1xuXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgICAgdmFyIHZtID0gdGhpcztcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuY29udHJvbGxlcignTGVhZGVyYm9hcmRDb250cm9sbGVyJywgTGVhZGVyYm9hcmRDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIExlYWRlcmJvYXJkQ29udHJvbGxlcigkcSwgJHRpbWVvdXQsICRmaXJlYmFzZUFycmF5LCBwcm9maWxlU2VydmljZSwgRklSRUJBU0VEQVRBKSB7XG5cbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgIFx0dmFyIHZtID0gdGhpcztcblxuICAgICAgICBhY3RpdmF0ZSgpO1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcbiAgICAgICAgICAgIGdldFByb2ZpbGVTY29yZXMoKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5wcm9maWxlU2NvcmVEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcHJvZmlsZVNlcnZpY2UuZ2V0QXZhdGFyRGF0YSgpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLmF2YXRhckRhdGEgPSBtb2RlbDtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0UHJvZmlsZVNjb3JlcygpIHtcblxuICAgICAgICBcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgIFx0dmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuXG4gICAgICAgIFx0dmFyIHByb2ZpbGVTY29yZURhdGEgPSAkZmlyZWJhc2VBcnJheShcbiAgICAgICAgXHRcdHJlZlxuICAgICAgICBcdFx0XHQuY2hpbGQoJ2JhZGdlcycpXG4gICAgICAgIFx0KTtcblxuICAgICAgICBcdHByb2ZpbGVTY29yZURhdGEuJGxvYWRlZChmdW5jdGlvbigpIHtcbiAgICAgICAgXHRcdGRlZmVycmVkLnJlc29sdmUocHJvZmlsZVNjb3JlRGF0YSk7XG4gICAgICAgIFx0fSk7XG5cbiAgICAgICAgXHRyZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdQcm9maWxlQ29udHJvbGxlcicsIFByb2ZpbGVDb250cm9sbGVyKTtcblxuICAgIC8qIEBuZ0luamVjdCAqL1xuICAgIGZ1bmN0aW9uIFByb2ZpbGVDb250cm9sbGVyKCRzY29wZSwgJHN0YXRlUGFyYW1zLCAkcSwgJHRpbWVvdXQsICRzdGF0ZSwgJGZpcmViYXNlQXJyYXksIGF1dGhTZXJ2aWNlLCBwcm9maWxlU2VydmljZSwgZXZlbnRTZXJ2aWNlKSB7XG5cbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczogdHJ1ZSAqL1xuICAgICAgICB2YXIgdm0gPSB0aGlzO1xuICAgICAgICBcbiAgICAgICAgYWN0aXZhdGUoKTtcblxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcblxuICAgICAgICAgICAgcHJvZmlsZVNlcnZpY2UuZ2V0VXNlckRhdGEoJHN0YXRlUGFyYW1zLnVzZXJuYW1lKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5wcm9maWxlRGF0YSA9IG1vZGVsO1xuXG4gICAgICAgICAgICAgICAgcHJvZmlsZVNlcnZpY2UuZ2V0VG91cm5hbWVudEhpc3Rvcnkodm0ucHJvZmlsZURhdGEpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgdG91cm5hbWVudEhpc3RvcnlEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICAgICAgICAgIHZtLmV2ZW50U3RhbmRpbmdzID0gcHJvZmlsZVNlcnZpY2UuZ2V0VG91cm5hbWVudFN0YW5kaW5ncyh0b3VybmFtZW50SGlzdG9yeURhdGEsICRzdGF0ZVBhcmFtcy51c2VybmFtZSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAkKCcuY29sbGFwc2libGUnKS5jb2xsYXBzaWJsZSh7XG4gICAgICAgICAgICAgICAgICAgIGFjY29yZGlvbjogdHJ1ZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHByb2ZpbGVTZXJ2aWNlLmdldEF2YXRhckRhdGEoKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcbiAgICAgICAgICAgICAgICB2bS5hdmF0YXJEYXRhID0gbW9kZWw7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcHJvZmlsZVNlcnZpY2UuZ2V0QmFkZ2VzRGF0YSgkc3RhdGVQYXJhbXMudXNlcm5hbWUpLnRoZW4oZnVuY3Rpb24gdGhlbihtb2RlbCkge1xuICAgICAgICAgICAgICAgIHZtLmJhZGdlc0RhdGEgPSBtb2RlbDtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxufSkoKTsiLCIoZnVuY3Rpb24oKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgYW5ndWxhclxuICAgICAgICAubW9kdWxlKCd2Zy5hcHAnKVxuICAgICAgICAuc2VydmljZSgncHJvZmlsZVNlcnZpY2UnLCBwcm9maWxlU2VydmljZSk7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBwcm9maWxlU2VydmljZSgkcm9vdFNjb3BlLCAkcSwgJGZpcmViYXNlQXJyYXksICRmaXJlYmFzZU9iamVjdCwgZXZlbnRTZXJ2aWNlLCBGSVJFQkFTRURBVEEpIHtcblxuICAgIFx0dGhpcy5nZXRBdmF0YXJEYXRhID0gZ2V0QXZhdGFyRGF0YTtcbiAgICAgICAgdGhpcy5nZXRCYWRnZXNEYXRhID0gZ2V0QmFkZ2VzRGF0YTtcbiAgICBcdHRoaXMuZ2V0VG91cm5hbWVudEhpc3RvcnkgPSBnZXRUb3VybmFtZW50SGlzdG9yeTtcbiAgICAgICAgdGhpcy5nZXRUb3VybmFtZW50U3RhbmRpbmdzID0gZ2V0VG91cm5hbWVudFN0YW5kaW5ncztcbiAgICAgICAgdGhpcy5nZXRVc2VyRGF0YSA9IGdldFVzZXJEYXRhO1xuICAgICAgICB0aGlzLnNhdmVBdmF0YXJMaW5rID0gc2F2ZUF2YXRhckxpbms7XG5cbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGdldEF2YXRhckRhdGEoKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgIHZhciBhdmF0YXJEYXRhID0gJGZpcmViYXNlT2JqZWN0KFxuICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoJ2F2YXRhcnMnKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgYXZhdGFyRGF0YS4kbG9hZGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoYXZhdGFyRGF0YSk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG5cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIGdldEJhZGdlc0RhdGEoaW5wdXRVc2VyKSB7XG5cbiAgICAgICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgIHZhciBiYWRnZXNEYXRhID0gJGZpcmViYXNlT2JqZWN0KFxuICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoJ2JhZGdlcycpXG4gICAgICAgICAgICAgICAgICAgIC5jaGlsZChpbnB1dFVzZXIpXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBiYWRnZXNEYXRhLiRsb2FkZWQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShiYWRnZXNEYXRhKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZ2V0VG91cm5hbWVudEhpc3RvcnkoaW5wdXRVc2VyRGF0YSkge1xuXG4gICAgICAgIFx0dmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcbiAgICAgICAgXHR2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgXHQvLyBMb29wIHRocm91Z2ggZWFjaCBldmVudCBpbiB0aGUgcGxlZGdlZFRvIG9iamVjdC5cbiAgICAgICAgXHR2YXIgZXZlbnRzQXJyYXkgPSBbXTtcbiAgICAgICAgXHRmb3IgKHZhciBrZXkgaW4gaW5wdXRVc2VyRGF0YS5wbGVkZ2VkVG8pIHtcbiAgICAgICAgXHRcdGV2ZW50c0FycmF5LnB1c2goa2V5KTtcbiAgICAgICAgXHR9XG5cbiAgICAgICAgXHRkZWZlcnJlZC5yZXNvbHZlKGV2ZW50c0FycmF5KTtcblxuICAgICAgICBcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRUb3VybmFtZW50U3RhbmRpbmdzKGlucHV0VG91cm5hbWVudEhpc3RvcnksIGlucHV0VXNlcikge1xuXG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCBlYWNoIGV2ZW50IGluIHRoZSB1c2VyJ3MgaGlzdG9yeS5cbiAgICAgICAgICAgIHZhciBldmVudFN0YW5kaW5ncyA9IFtdO1xuICAgICAgICAgICAgaW5wdXRUb3VybmFtZW50SGlzdG9yeS5mb3JFYWNoKGZ1bmN0aW9uKGV2ZW50KSB7XG5cbiAgICAgICAgICAgICAgICBldmVudFNlcnZpY2UuZ2V0RXZlbnRQcm9wZXJ0aWVzKGV2ZW50KS50aGVuKGZ1bmN0aW9uKGV2ZW50UHJvcGVydGllcykge1xuXG4gICAgICAgICAgICAgICAgICAgIGV2ZW50UHJvcGVydGllcy4kbG9hZGVkKCkudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgY29uY2x1ZGVkLCBnZXQgdGhlIHVzZXIncyBzdGFuZGluZy5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChldmVudFByb3BlcnRpZXMuc3RhdGUgPT09ICdjb25jbHVkZWQnKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXZlbnRTdGFuZGluZ0RhdGEgPSAkZmlyZWJhc2VPYmplY3QoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKCdzdGFuZGluZ3MnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKGV2ZW50KVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFN0YW5kaW5nRGF0YS4kbG9hZGVkKCkudGhlbihmdW5jdGlvbigpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnRTdGFuZGluZ0RhdGFbaW5wdXRVc2VyXSkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBldmVudFN0YW5kaW5ncy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lOiBldmVudFByb3BlcnRpZXMubmFtZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVtaWVyOiBldmVudFByb3BlcnRpZXMucHJlbWllciA/IHRydWUgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNob3J0TmFtZTogZXZlbnQsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGU6ICdjb25jbHVkZWQnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiBldmVudFByb3BlcnRpZXMuY29sb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zaXRpb246IGV2ZW50U3RhbmRpbmdEYXRhW2lucHV0VXNlcl1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV2ZW50U3RhbmRpbmdzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGV2ZW50UHJvcGVydGllcy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZW1pZXI6IGV2ZW50UHJvcGVydGllcy5wcmVtaWVyID8gdHJ1ZSA6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hvcnROYW1lOiBldmVudCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogJ2NvbmNsdWRlZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sb3I6IGV2ZW50UHJvcGVydGllcy5jb2xvcixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvbjogLTFcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGV2ZW50UHJvcGVydGllcy5zdGF0ZSA9PT0gJ2lucHJvZ3Jlc3MnIHx8IGV2ZW50UHJvcGVydGllcy5zdGF0ZSA9PT0gJ3VwY29taW5nJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZXZlbnRTdGFuZGluZ3MucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IGV2ZW50UHJvcGVydGllcy5uYW1lLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmVtaWVyOiBldmVudFByb3BlcnRpZXMucHJlbWllciA/IHRydWUgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzaG9ydE5hbWU6IGV2ZW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjogZXZlbnRQcm9wZXJ0aWVzLmNvbG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZTogZXZlbnRQcm9wZXJ0aWVzLnN0YXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgcmV0dXJuIGV2ZW50U3RhbmRpbmdzO1xuXG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRVc2VyRGF0YShpbnB1dFVzZXIpIHtcblxuICAgICAgICBcdHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgIFx0dmFyIHJlZiA9IG5ldyBGaXJlYmFzZShGSVJFQkFTRURBVEEuRkJVUkwpO1xuXG4gICAgICAgIFx0dmFyIHVzZXJzRGF0YSA9ICRmaXJlYmFzZUFycmF5KFxuICAgICAgICBcdFx0cmVmXG4gICAgICAgIFx0XHRcdC5jaGlsZCgndXNlcnMnKVxuICAgICAgICBcdCk7XG5cbiAgICAgICAgXHR1c2Vyc0RhdGEuJGxvYWRlZChmdW5jdGlvbigpIHtcblxuICAgICAgICBcdFx0dXNlcnNEYXRhLmZvckVhY2goZnVuY3Rpb24odXNlcikge1xuICAgICAgICBcdFx0XHRpZiAodXNlci51c2VyTmFtZSA9PT0gaW5wdXRVc2VyKSB7XG4gICAgICAgIFx0XHRcdFx0ZGVmZXJyZWQucmVzb2x2ZSh1c2VyKTtcbiAgICAgICAgXHRcdFx0fVxuICAgICAgICBcdFx0fSk7XG5cbiAgICAgICAgXHR9KTtcblxuICAgICAgICBcdHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuXG4gICAgICAgIH1cblxuICAgICAgICAvLyBGSVhNRTogTWFrZSB0aGlzIHNlcnZlci1zaWRlLlxuICAgICAgICBmdW5jdGlvbiBzYXZlQXZhdGFyTGluayhpbnB1dExpbmssIGlucHV0VXNlcikge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgcmVmID0gbmV3IEZpcmViYXNlKEZJUkVCQVNFREFUQS5GQlVSTCk7XG5cbiAgICAgICAgICAgIHZhciBhdmF0YXJEYXRhID0gJGZpcmViYXNlT2JqZWN0KFxuICAgICAgICAgICAgICAgIHJlZlxuICAgICAgICAgICAgICAgICAgICAuY2hpbGQoJ2F2YXRhcnMnKVxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgYXZhdGFyRGF0YS4kbG9hZGVkKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIGF2YXRhckRhdGFbaW5wdXRVc2VyXSA9IGlucHV0TGluaztcbiAgICAgICAgICAgICAgICBhdmF0YXJEYXRhLiRzYXZlKCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICB9XG59KSgpOyIsIihmdW5jdGlvbigpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyXG4gICAgICAgIC5tb2R1bGUoJ3ZnLmFwcCcpXG4gICAgICAgIC5jb250cm9sbGVyKCdSZWdDb250cm9sbGVyJywgUmVnQ29udHJvbGxlcik7XG5cbiAgICAvKiBAbmdJbmplY3QgKi9cbiAgICBmdW5jdGlvbiBSZWdDb250cm9sbGVyKCRzY29wZSwgJHJvb3RTY29wZSwgJHRpbWVvdXQsICR3aW5kb3csICRzdGF0ZSwgJGZpcmViYXNlT2JqZWN0LCBhdXRoU2VydmljZSwgQXV0aFdyYXBwZXIpIHtcblxuICAgICAgICAvKiBqc2hpbnQgdmFsaWR0aGlzOiB0cnVlICovXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XG5cbiAgICAgICAgdm0ubG9naW5Ub0FjY291bnQgPSBsb2dpblRvQWNjb3VudDtcbiAgICAgICAgdm0ucGFzc3dvcmRSZXNldCA9IHBhc3N3b3JkUmVzZXQ7XG4gICAgICAgIHZtLnN1Ym1pdE5ld0FjY291bnQgPSBzdWJtaXROZXdBY2NvdW50O1xuXG4gICAgICAgIC8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuXG4gICAgICAgIGZ1bmN0aW9uIGxvZ2luVG9BY2NvdW50KCkge1xuXG4gICAgICAgICAgICBhdXRoU2VydmljZS5sb2dpblRvQWNjb3VudCh2bS5sb2dpbkVtYWlsLCB2bS5sb2dpblBhc3N3b3JkKS50aGVuKGZ1bmN0aW9uIHRoZW4obW9kZWwpIHtcblxuICAgICAgICAgICAgICAgIHZtLnNob3dJbnZhbGlkVXNlckVycm9yID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgdm0uc2hvd0ludmFsaWRQYXNzd29yZEVycm9yID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAobW9kZWwgPT09ICdMT0dJTl9TVUNDRVNTJykge1xuXG4gICAgICAgICAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZScpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtb2RlbCA9PT0gJ0lOVkFMSURfVVNFUicpIHtcbiAgICAgICAgICAgICAgICAgICAgdm0uc2hvd0ludmFsaWRVc2VyRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtb2RlbCA9PT0gJ0lOVkFMSURfUEFTU1dPUkQnKSB7XG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dJbnZhbGlkUGFzc3dvcmRFcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcGFzc3dvcmRSZXNldCgpIHtcblxuICAgICAgICAgICAgaWYgKCF2bS5sb2dpbkVtYWlsKSB7XG4gICAgICAgICAgICAgICAgdm0uc2hvd1Bhc3N3b3JkUmVzZXRFbWFpbE1lc3NhZ2UgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgQXV0aFdyYXBwZXIuJHJlc2V0UGFzc3dvcmQoe1xuICAgICAgICAgICAgICAgIGVtYWlsOiB2bS5sb2dpbkVtYWlsXG4gICAgICAgICAgICB9KS50aGVuKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZtLnNob3dQYXNzd29yZFJlc2V0RW1haWxNZXNzYWdlID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgTWF0ZXJpYWxpemUudG9hc3QoJ0EgcGFzc3dvcmQgcmVzZXQgZW1haWwgaGFzIGJlZW4gc2VudCB0byAnICsgdm0ubG9naW5FbWFpbCArICcuJywgNDAwMCk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3VibWl0TmV3QWNjb3VudCgpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gRG9lcyB0aGUgdXNlciBleGlzdD8gSWYgc28sIHNob3cgYW4gZXJyb3IgbWVzc2FnZS5cbiAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmNoZWNrSWZVc2VyRXhpc3RzKHZtLm5ld1VzZXJuYW1lKS50aGVuKGZ1bmN0aW9uKHVzZXJFeGlzdHMpIHtcblxuICAgICAgICAgICAgICAgIHZtLnNob3dEdXBsaWNhdGVVc2VyRXJyb3IgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB2bS5zaG93RW1haWxUYWtlbkVycm9yID0gZmFsc2U7XG5cbiAgICAgICAgICAgICAgICBpZiAodXNlckV4aXN0cykge1xuXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dEdXBsaWNhdGVVc2VyRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgICAgICAgICAvLyBUcnkgdG8gY3JlYXRlIHRoZSBuZXcgdXNlci5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgIGF1dGhTZXJ2aWNlLmNyZWF0ZU5ld1VzZXIodm0ubmV3RW1haWwsIHZtLm5ld1Bhc3N3b3JkLCB2bS5uZXdVc2VybmFtZSkudGhlbihmdW5jdGlvbiB0aGVuKG1vZGVsKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtb2RlbCA9PT0gJ0VNQUlMX1RBS0VOJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uc2hvd0VtYWlsVGFrZW5FcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vZGVsID09PSAnQUNDT1VOVF9DUkVBVEVEJykge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdwcm9maWxlJywge3VzZXJuYW1lOiB2bS5uZXdVc2VybmFtZX0pO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgIH1cblxuICAgIH1cblxufSkoKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=